<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

<link href="favicon.ico" rel="shortcut icon" type="image/x-icon">

<script language="JavaScript" src="owc_atom.js"></script>
<script>
<!--

var ServersNB=["http://localhost/cgi-bin/server1/nimmbus.cgi","http://localhost/cgi-bin/server2/nimmbus.cgi"];
var LastServerNB=0;


//Després de intentar fer servir l'objecte link() sense exit he hagut de fer això.
function DonaHost(s)
{
	if (-1!=s.indexOf("//"))
	{
		s2=s.substring(s.indexOf("//")+2,s.length);
		if (-1!=s2.indexOf("/"))
			return s2.substring(0,s2.indexOf("/"));
		else
			return s2;
	}
	else
	{
		if (-1!=s.indexOf("/"))
			return s.substring(0,s.indexOf("/"));
		else
			return s;
	}
}

function ConfirmExit()
{
	return DonaCadena3("Realment vols sortir del NiMMbus? (Les accions no guardades es perdran)", "¿Realmente desea salir de NiMMbus? (La acciones no guardadas se perderán)", "Do you really want to exit NiMMbus? (The unsaved accions will be lost)");
}
window.onbeforeunload = ConfirmExit;


// Inspirat en https://www.webdesignerdepot.com/2013/03/how-to-manage-the-back-button-with-javascript/
function GoBackOnePage()
{
	if (location.hash.length > 0)
		ChangePannel(location.hash.replace('#',''), false);
	else
		SurtDeNimmbus();
}
window.onhashchange = GoBackOnePage;

function RevisaCrossSserverServersNB(servers)
{
var s_host, pos_host;
	for (var i=0; i<servers.length; i++)
	{
		s_host=DonaHost(servers[i]);
		if (s_host.toLowerCase()=="localhost" && location.host.toLowerCase()!="localhost")
		{
			alert("Error en pujar la versió als servidors. ServersNB[] encara diu \"localhost\"!");
			break;
		}
		if (s_host.toLowerCase()!=location.host.toLowerCase())
		{
			//Canvio l'arrel del servidor local per l'arrel de la plana del navegador per estar segur que l'ajax funcionarà sense "cross server vulmerability".
			pos_host=(-1!=servers[i].indexOf("//")) ? servers[i].indexOf("//")+2 : 0;
			servers[i]=servers[i].substring(0,pos_host)+location.host+servers[i].substring(pos_host+s_host.length, servers[i].length);
		}
	}
}

RevisaCrossSserverServersNB(ServersNB);

//From: http://www.technicaladvices.com/2012/07/16/preventing-backspace-from-navigating-back-in-all-the-browsers/
document.onkeydown = function (event) 
{
	
	if (!event) { /* This will happen in IE */
		event = window.event;
	}
		
	var keyCode = event.keyCode;
	
	if (keyCode == 8 &&
		((event.target || event.srcElement).tagName != "TEXTAREA") && 
		((event.target || event.srcElement).tagName != "INPUT")) { 
		
		if (navigator.userAgent.toLowerCase().indexOf("msie") == -1) {
			event.stopPropagation();
		} else {
			event.returnValue = false;
		}
		
		return false;
	}
};	

function UpdateLastServer()
{
	LastServerNB++;
	if (LastServerNB>=ServersNB.length)
		LastServerNB=0;
}

var LanguagesNB=["cat","spa","eng"];
var ActiveLanguage=2;

function DonaCadenaJSON(s)
{
	if (ActiveLanguage==0)
		return s.cat;
	else if (ActiveLanguage==1)
		return s.spa;
	else if (ActiveLanguage==2)
		return s.eng;
}

function DonaCadena3(cat,spa,eng)
{
	if (ActiveLanguage==0)
		return cat;
	else if (ActiveLanguage==1)
		return spa;
	else if (ActiveLanguage==2)
		return eng;
}

function DonaCadenaCodelistDeSelect(selector)
{
	if (selector.selectedIndex!=-1)
		return selector.options[selector.selectedIndex].value;
	else
		return "";
}

function SeleccionaSelectDesDeValor(selector, valor)
{
	if (valor)
	{
		for (var i=0; i<selector.length; i++)
		{
			if (selector.options[i].value==valor)
			{
				selector.selectedIndex=i;
				return;
			}					
		}
	} 
}

function GetActiveLanguageIndex(language)
{
	for (var i=0; i<LanguagesNB.length; i++)
	{
		if (LanguagesNB[i]==language)
			return i;
	}
	return -1;
}

function ChangeLanguage(lang)
{
	ActiveLanguage=lang;
	document.getElementById("front-welcome-text-title").innerHTML=DonaCadena3(
		"Benvinguts al NiMMbus", "Bienvenidos al NiMMbus", "Welcome to NiMMbus");
	document.getElementById("front-welcome-text-subtitle").innerHTML=DonaCadena3(
		"La observació de la terra a tot arreu. Comparteix informació i valoracions amb altres.",
		"La observación de la tierra en todas partes. Comparte información y valoraciones con los demás.",
		"Earth observation everywhere. Share information and feedback with others.");
	document.getElementById("front-language-lang").innerHTML=DonaCadena3(
		"<small>Idioma:</small> Català",
		"<small>Idioma:</small> Español",
		"<small>Language:</small> English");
	document.getElementById("front-signup-lang").innerHTML=DonaCadena3(
		"Nou al NiMMbus? Registra't:",
		"Nuevo en NiMMbus? Registrese:",
		"New to NiMMbus? Sign up:");
	document.getElementById("sign_in_user").placeholder=DonaCadena3("Usuari o email", "Usuario o email", "Username or email");
	document.getElementById("sign_in_pass").placeholder=DonaCadena3("Contrasenya", "Contraseña","Password");
	document.getElementById("sign_in_btn").value=DonaCadena3("Iniciar sessió", "Iniciar sesión", "Sign in");
	document.getElementById("sign_in_forgot").innerHTML=DonaCadena3("Has oblidat la contrasenya?", "¿Olvidadó la contraseña?", "Forgot the password?");

	document.getElementById("sign_up_user").placeholder=DonaCadena3("Usuari", "Usuario", "Username");
	document.getElementById("sign_up_pass").placeholder=DonaCadena3("Contrasenya", "Contraseña","Password");
	document.getElementById("sign_up_pass_valid").placeholder=DonaCadena3("Verificació de contrasenya", "Verificación de contraseña","Password verification");
	document.getElementById("sign_up_btn").value=DonaCadena3("Registrar-se al NiMMbus", "Registrarse en NiMMBus", "Sign up for NiMMbus");
	/*document.getElementById("info_comment").innerHTML=DonaCadena3("La informació serà presentada aquí", "La información será presentada aquí", "Information will be presented here");*/
	document.getElementById("settings-tooltip-text").innerHTML=DonaCadena3("Configuració", "Configuración", "Settings");
	document.getElementById("settings-profile").innerHTML=DonaCadena3("Perfil", "Perfil", "Profile");
	document.getElementById("settings-signout").innerHTML=DonaCadena3("Sortir", "Salir", "Sign out");

	document.getElementById("main-left-pannel-since-text").innerHTML=DonaCadena3("Membre des de", "Miembro desde", "Member since");

	document.getElementById("resources-title-text").innerHTML=DonaCadena3("Recursos", "Recursos", "Resources");
	document.getElementById("resources-subtitle-text").innerHTML=DonaCadena3("Llista de recursos disponibles", "Lista de recursos disponibles", "List of available resources");
	document.getElementById("newer-resources-tooltip-text").innerHTML=DonaCadena3("Veure recursos més nous", "Ver recursos más nuevos", "See newer resources");
	document.getElementById("older-resources-tooltip-text").innerHTML=DonaCadena3("Veure recursos més antics", "Ver recursos más antiguos", "See older resources");

	document.getElementById("new-resource_btn").value=innerHTML=DonaCadena3("Nou", "Nuevo", "New");
	document.getElementById("new-resource-tooltip-text").innerHTML=DonaCadena3("Crear nou recurs", "Crear nuevo recurso", "Create new resource");
	document.getElementById("new-resource-href").innerHTML=DonaCadena3("Hiperenllaç", "Hiperenlace", "Hiperlink");
	document.getElementById("new-resource-poi").innerHTML=DonaCadena3("Punt d'interés", "Punto de interés", "Point of interest");
	document.getElementById("new-resource-feedback").innerHTML=DonaCadena3("Valoració", "Valoración", "Feedback");
	document.getElementById("new-resource-citation").innerHTML=DonaCadena3("Citació", "Citación", "Citation");

	document.getElementById("title-href-resource_screen").innerHTML=DonaCadena3("Títol", "Título", "Title");
	document.getElementById("title-href-resource_screen_descrip").innerHTML=DonaCadena3("Per exemple: Rius de Catalunya", "Por ejemplo: Rios de Cataluña", "For exemple: Catalonia rivers");
	document.getElementById("href-href-resource_screen").innerHTML=DonaCadena3("Hiperenllaç", "Hiperenlace", "Hiperlink");
	document.getElementById("href-href-resource_descrip").innerHTML=DonaCadena3("Per exemple: http://www6.gencat.net/mediamb/sig/bases/pein.mmz", "Por ejemplo: http://www6.gencat.net/mediamb/sig/bases/pein.mmz", "For exemple: http://www6.gencat.net/mediamb/sig/bases/pein.mmz");
	document.getElementById("mimetype-href-resource_screen").innerHTML=DonaCadena3("Format", "Formato", "Format");
	document.getElementById("other-mimetype-href-resource_value").innerHTML=DonaCadena3("Altres", "Otros", "Other");
	document.getElementById("mimetype-href-resource_screen_descrip").innerHTML=DonaCadena3("Format del fitxer al qual apunta l'hiperenllaç", "Formato del fichero al que apunta el hiperenllace", "File format of the hiperlink target");
	document.getElementById("reason-href-resource_screen").innerHTML=DonaCadena3("Motivació", "Motivación", "Motivation");
	document.getElementById("reason-href-resource_screen_descrip").innerHTML=DonaCadena3("Motiu pel qual el recurs resulta rellevant", "Motivo por el cual el recurso resulta relevante", "Reason why the resource is relevant");
	document.getElementById("href-resource-delete_btn").value=DonaCadena3("Eliminar hiperenllaç", "Eliminar hiperenlace", "Delete hiperlink");
	document.getElementById("href-resource-exit_btn").value=DonaCadena3("Sortir", "Salir", "Close");
	document.getElementById("href-resource-close_btn").value=DonaCadena3("Descartar", "Descartar", "Discard");

	document.getElementById("poi-gps-resource_btn").value=DonaCadena3("Obtenir del dispositiu", "Obtener del dispositivo", "Get it from the device");
	document.getElementById("title-poi-resource_screen").innerHTML=DonaCadena3("Títol", "Título", "Title");
	document.getElementById("title-poi-resource_screen_descrip").innerHTML=DonaCadena3("Per exemple: Aplec de la sardana", "Por ejemplo: Feira de abril", "For exemple: Olimpic games statium");
	document.getElementById("long-poi-resource_screen").innerHTML=DonaCadena3("Longitud", "Longitud", "Longitude");
	document.getElementById("long-poi-resource_descrip").innerHTML=DonaCadena3("Longitud en graus. Per exemple: 3.25656", "Longitud en grados. Por ejemplo: 3.25656", "Longitude in degrees. For exemple: 3.25656");
	document.getElementById("lat-poi-resource_screen").innerHTML=DonaCadena3("Latitud", "Latitud", "Latitude");
	document.getElementById("lat-poi-resource_descrip").innerHTML=DonaCadena3("Latitud en graus. Per exemple: 41.3389", "Latitud en grados. Por ejemplo: 41.3389", "Latitude in degrees. For exemple: 41.3389");
	document.getElementById("pos-accur-poi-resource_screen").innerHTML=DonaCadena3("Exactitud", "Exactitud", "Accuracy");
	document.getElementById("pos-accur-poi-resource_descrip").innerHTML=DonaCadena3("Exactitud posicional preferiblement en m. Per exemple: 25m", "Exactitud posicional preferiblemente en m. Por ejemplo: 25m", "Posicional accuracy, if possible in m. For exemple: 25m");
	document.getElementById("elevation-poi-resource_screen").innerHTML=DonaCadena3("Elevació", "Elevación", "Elevation");
	document.getElementById("elevation-poi-resource_descrip").innerHTML=DonaCadena3("Elevació en metres. Per exemple: 123.4", "Elevación en metros. Por ejemplo: 123.4", "Elevation in meters. For exemple: 123.4");
	document.getElementById("reason-poi-resource_screen").innerHTML=DonaCadena3("Motivació", "Motivación", "Motivation");
	document.getElementById("reason-poi-resource_screen_descrip").innerHTML=DonaCadena3("Motiu pel qual el recurs resulta rellevant", "Motivo por el cual el recurso resulta relevante", "Reason why the resource is relevant");
	document.getElementById("poi-resource-delete_btn").value=DonaCadena3("Eliminar punt", "Eliminar punto", "Delete point");
	document.getElementById("poi-resource-exit_btn").value=DonaCadena3("Sortir", "Salir", "Close");
	document.getElementById("poi-resource-close_btn").value=DonaCadena3("Descartar", "Descartar", "Discard");

	document.getElementById("targetRole-feedback-resource_screen").innerHTML=DonaCadena3("Rol del recurs", "Rol del recurso", "Resouce role");
	document.getElementById("primary-targetRole-feedback-resource_value").innerHTML=DonaCadena3("Primari", "Primario", "Primary");
	document.getElementById("secundary-targetRole-feedback-resource_value").innerHTML=DonaCadena3("Secundari", "Secundario", "Secundary");
	document.getElementById("supplementary-targetRole-feedback-resource_value").innerHTML=DonaCadena3("Suplementari", "Suplementario", "Supplementary");
	document.getElementById("targetRole-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Quin és el paper d'aquest recurs que està valorant: P.ex. Primari", "Cual es el papel del recurso que se está valorando: P.ex. Primario", "What is the role of the resource this feedback is about: E.g. Primary");

	document.getElementById("title-feedback-resource_screen").innerHTML=DonaCadena3("Títol", "Título", "Title");
	document.getElementById("title-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Per exemple: Bon servidor de mapes", "Por ejemplo: Buen servidor de mapas", "For exemple: Good map server");
	document.getElementById("abstract-feedback-resource_screen").innerHTML=DonaCadena3("Resum", "Resumen", "Abstract");
	document.getElementById("abstract-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Descripció textual curta de la valoració", "Descripción textual corta de la valoración", "Brief narrative description of the feedback item");
	document.getElementById("reason-feedback-resource_screen").innerHTML=DonaCadena3("Propòsit", "Propósito", "Purpose");
  	document.getElementById("reason-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Raó o intenció per la qual explico la meva experiència i dono la meva valoració", "Razón o intención por la cual explico mi experiencia y proporciono mi valoración", "Reason or intention with which I explain my experience and provide this feedback");

	document.getElementById("contactRole-feedback-resource_screen").innerHTML=DonaCadena3("Rol del contacte", "Rol del contacto", "Contact role");
	document.getElementById("commercialDataProd-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Productor comercial de dades", "Productor comercial de datos", "Commercial data producer");
	document.getElementById("commercialAddValue-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Afegir valor a les dades comercials", "Añadir valor a los datos comerciales", "Commercial added value");
	document.getElementById("researchDataProd-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Productor de dades científiques", "Productor de datos científicos", "Scientific data producer");
	document.getElementById("researchEndUser-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Usuari científic final", "Usuario científico final", "Research end user");
	document.getElementById("decisionMaker-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Responsables de presa de decisions", "Responsables de toma de decisiones", "Decision maker");
	document.getElementById("generalPublic-contactRole-feedback-resource_value").innerHTML=DonaCadena3("Públic general", "Público general", "General public");
	document.getElementById("contactRole-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Rol de l'usuari en el context d'aquesta valoració", "Rol del usuario en el contexto de esta valoración", "User's role in the context of this feedback item");

	document.getElementById("comment-feedback-resource_screen").innerHTML=DonaCadena3("Comentari", "Comentario", "Comment");
	document.getElementById("comment-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Comentari de l'usuari sobre el recurs", "Comentario del usuario sobre el recurso", "User's comment about the resource");
	document.getElementById("comment-motiv-feedback-resource_screen").innerHTML=DonaCadena3("Motivació del comentari", "Motivación del comentario", "Comment motivation");
	document.getElementById("undefined-motivation-feedback-resource_value").innerHTML=DonaCadena3("Indefinit", "Indefinido", "Undefined");
	document.getElementById("comment-motivation-feedback-resource_value").innerHTML=DonaCadena3("Comentari", "Comentario", "Comment");
	document.getElementById("question-motivation-feedback-resource_value").innerHTML=DonaCadena3("Pregunta", "Pregunta", "Question");
	document.getElementById("answer-motivation-feedback-resource_value").innerHTML=DonaCadena3("Solució", "Solución", "Answer");
	document.getElementById("acceptedAnswer-motivation-feedback-resource_value").innerHTML=DonaCadena3("Solució acceptada", "Solución acceptada", "Accepted answer");
	document.getElementById("response-motivation-feedback-resource_value").innerHTML=DonaCadena3("Resposta", "Respuesta", "Response");		
	document.getElementById("justification-motivation-feedback-resource_value").innerHTML=DonaCadena3("Justificació", "Justificación", "Justification");
	document.getElementById("resolution-motivation-feedback-resource_value").innerHTML=DonaCadena3("Resolució", "Resolución", "Resolution");
	document.getElementById("moderation-motivation-feedback-resource_value").innerHTML=DonaCadena3("Moderació", "Moderación", "Moderation");
	document.getElementById("comment-motiv-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Motivació del comentari de l'usuari sobre el recurs", "Motivación del comentario del usuario sobre el recurso", "Motivation of user's comment about the resource");
	
	document.getElementById("rating-feedback-resource_screen").innerHTML=DonaCadena3("Puntuació", "Puntuación", "Rating");
	document.getElementById("undefined-rating-feedback-resource_value").innerHTML=DonaCadena3("Indefinit", "Indefinido", "Undefined");
	document.getElementById("oneStar-rating-feedback-resource_value").innerHTML=DonaCadena3("1 estrella: Molt dolent", "1 estrella: Muy malo", "1 star: very bad");
	document.getElementById("twoStars-rating-feedback-resource_value").innerHTML=DonaCadena3("2 estrelles: Dolent", "2 estrellas: Malo", "2 stars: Bad");
	document.getElementById("threeStars-rating-feedback-resource_value").innerHTML=DonaCadena3("3 estrelles: Regular", "3 estrellas: Regular", "3 stars: Regular");
	document.getElementById("fourStars-rating-feedback-resource_value").innerHTML=DonaCadena3("4 estrelles: Bo", "4 estrellas: Bueno", "4 stars: Good");
	document.getElementById("fiveStars-rating-feedback-resource_value").innerHTML=DonaCadena3("5 estrelles: Excel·lent", "5 estrellas: Excelente", "5 stars: Excellent");		
	document.getElementById("rating-feedback-resource_screen_descrip").innerHTML=DonaCadena3("Codi numèric que puntua subjectivament el recurs", "Código numérico que puntúa subjectivamente el recurso", "Numeric code that qualifies subjectively the resource");

	document.getElementById("feedback-resource-delete_btn").value=DonaCadena3("Eliminar valoració", "Eliminar valoración", "Delete feedback");
	document.getElementById("feedback-resource-exit_btn").value=DonaCadena3("Sortir", "Salir", "Close");
	document.getElementById("feedback-resource-close_btn").value=DonaCadena3("Descartar", "Descartar", "Discard");

	document.getElementById("title-citation-resource_screen").innerHTML=DonaCadena3("Títol", "Título", "Title");
	document.getElementById("title-citation-resource_screen_descrip").innerHTML=DonaCadena3("Per exemple: Mapa Cobertes del Sòl de Catalunya", "Por ejemplo: Sistema de Información sobre Ocupación del Suelo de España", "For exemple: Corine Land Cover 2012");
	document.getElementById("id-code-citation-resource_screen").innerHTML=DonaCadena3("Identificador", "Identificador", "Identifier");
	document.getElementById("id-code-citation-resource_screen_descrip").innerHTML=DonaCadena3("Identificador del recurs. P. ex.:", "Identificador del recurso. P. ej.:", "Resource identifier. E.g.:") + " c90fd0c1-ebdf-4df9-9216-4592ed843644";
	document.getElementById("id-namespace-citation-resource_screen").innerHTML=DonaCadena3("Espai de noms", "Espacio de nombres", "Namespace");
	document.getElementById("id-namespace-citation-resource_screen_descrip").innerHTML=DonaCadena3("Espai de noms on l'identificador és únic. P. ex.:", "Espacio de nombres donde el identificador es único. P. ej.:", "Namespace where the identifier is unique. E.g.:") + " http://sdi.eea.europa.eu/catalogue";
	document.getElementById("url-link-citation-resource_screen").innerHTML=DonaCadena3("Adreça URL", "Dirección URL", "URL Link");
	document.getElementById("url-link-citation-resource_screen_descrip").innerHTML=DonaCadena3("Recurs en línia relacionat amb l'element. P. ex.:", "Recurso en línea relacionado con el elemento. P. ej.:", "Online resource related to the element. E.g.:") + " http://land.copernicus.eu/pan-european/corine-land-cover/clc-2012/view";
	document.getElementById("url-descrip-citation-resource_screen").innerHTML=DonaCadena3("Descripció URL", "Descripción URL", "URL description");
	document.getElementById("url-descrip-citation-resource_screen_descrip").innerHTML=DonaCadena3("Descripció detallada de què és o què fa el recurs en línia. P. ex.: Exploració de les dades en un navegador", "Descripción detallada de qué es o qué hace el recurso en línea. P. ej. Exploración de les datos en un navegador", "Detailed description of what the online resource is/does. E.g. View the data on a web browser");
	
	document.getElementById("url-function-citation-resource_screen").innerHTML=DonaCadena3("Funció", "Función", "Function");
	document.getElementById("undefined-url-function-citation-resource_value").innerHTML=DonaCadena3("Indefinit", "Indefinido", "Undefined");
	document.getElementById("download-url-function-citation-resource_value").innerHTML=DonaCadena3("Descàrrega", "Descarga", "Download");
	document.getElementById("information-url-function-citation-resource_value").innerHTML=DonaCadena3("Informació", "Información", "Information");
	document.getElementById("offlineAccess-url-function-citation-resource_value").innerHTML=DonaCadena3("Accés fora de línia", "Acceso fuera de línea", "Offline access");
	document.getElementById("order-url-function-citation-resource_value").innerHTML=DonaCadena3("Comandes", "Encargos", "Order");
	document.getElementById("search-url-function-citation-resource_value").innerHTML=DonaCadena3("Cerca", "Búsqueda", "Search");
	document.getElementById("completeMetadata-url-function-citation-resource_value").innerHTML=DonaCadena3("Metadades completes", "Metadatos completos", "Complete Metadata");
	document.getElementById("browseGraphic-url-function-citation-resource_value").innerHTML=DonaCadena3("Exploració", "Exploración", "View");
	document.getElementById("upload-url-function-citation-resource_value").innerHTML=DonaCadena3("Càrrega", "Carga", "Upload");
	document.getElementById("emailService-url-function-citation-resource_value").innerHTML=DonaCadena3("Servei de correu electrònic", "Servicio de correo electrónico", "Email service");
	document.getElementById("browsing-url-function-citation-resource_value").innerHTML=DonaCadena3("Navegació", "Navegación", "Browsing");
	document.getElementById("fileAccess-url-function-citation-resource_value").innerHTML=DonaCadena3("Accés a fitxer", "Acceso a fichero", "File access");
	document.getElementById("url-function-citation-resource_screen_descrip").innerHTML=DonaCadena3("Funció del link. P. ex. Exploració", "Función del link. P. ex. Exploración", "Function of the link. E.g. View");
	
	document.getElementById("citation-resource-delete_btn").value=DonaCadena3("Eliminar citació", "Eliminar citación", "Delete citation");
	document.getElementById("citation-resource-exit_btn").value=DonaCadena3("Sortir", "Salir", "Close");
	document.getElementById("citation-resource-close_btn").value=DonaCadena3("Descartar", "Descartar", "Discard");

	document.getElementById("account-title-text").innerHTML=DonaCadena3("Compte", "Cuenta", "Account");
	document.getElementById("account-subtitle-text").innerHTML=DonaCadena3("Canvia les característiques bàsiques del teu compte i la configuració d'idioma", "Cambie las características básicas de su cuenta y la configuración de idioma", "Change your basic account and language settings.");
	document.getElementById("new_user_screen").innerHTML=DonaCadena3("Usuari", "Usuario", "Username");
	document.getElementById("new_user_descrip").innerHTML=DonaCadena3("Pots canviar el teu usuari en qualsevol moment.", "Puede cambiar su usuario en cualquier momento.", "How can change your username at any time.");
	document.getElementById("email_screen").innerHTML=DonaCadena3("Correu electrònic", "Correo electrónico", "Email");
	document.getElementById("email_screen_descrip").innerHTML=DonaCadena3("Per a validacions i notificacions per email", "Para validaciones y notificaciones por email", "For email notifications and verifications");
	document.getElementById("name_screen").innerHTML=DonaCadena3("Nom", "Nombre", "Name");
	document.getElementById("name_screen_descrip").innerHTML=DonaCadena3("El teu nom i cognoms", "Su nombre y apellidos", "Your name and surname");
	document.getElementById("bio_screen").innerHTML=DonaCadena3("Biografia", "Biografía", "Bio");
	document.getElementById("bio_screen_descrip").innerHTML=DonaCadena3("Un text curt que et descriu", "Un text corto que le describe", "About yourself in a few words.");
	document.getElementById("current_pass_screen").innerHTML=DonaCadena3("Contrasenya actual", "Contraseña actual", "Current password");
	document.getElementById("current_pass_screen_descrip").innerHTML=DonaCadena3("Cal que proporcionis la contrasenya actual si la vols canviar.", "Es necesario proporcionar la contraseña actual si desea cambiarla.", "Your current password is needed only if you want to change it.");
	document.getElementById("new_pass_screen").innerHTML=DonaCadena3("Contrasenya nova", "Contraseña nueva","New password");
	document.getElementById("new_pass_screen_descrip").innerHTML=DonaCadena3("Pots canviar la teva contrasenya en qualsevol moment.", "Puede cambiar su contraseña en cualquier momento.", "How can change your password at any time.");
	document.getElementById("new_pass_valid_screen").innerHTML=DonaCadena3("Validació de contrasenya", "Validación de contraseña","Verify password");
	document.getElementById("new_pass_valid_screen_descrip").innerHTML=DonaCadena3("Cal que tornis a escriure la teva contrasenya.", "Debes repetir la contraseña.", "You need to repeat your new password.");
	document.getElementById("language_screen").innerHTML=DonaCadena3("Idioma", "Idioma", "Language");
	document.getElementById("language_screen_descrip").innerHTML=DonaCadena3("L'idioma que fas servir (l'entorn canviarà a aquest idioma).", "El idioma que usas (el entorno canviará a este idioma).", "The language you use (the interface will change to this language).");
	document.getElementById("account_btn").value=DonaCadena3("Guardar canvis", "Guardar cambios", "Save changes");
	document.getElementById("account-close_btn").value=DonaCadena3("Descartar", "Descartar", "Close");

	document.getElementById("share-title-text").innerHTML=DonaCadena3("Compartir", "Compartir", "Share");
	document.getElementById("share-subtitle-text").innerHTML=DonaCadena3("Comparteix aquest recurs amb els altres", "Comparte este recurso con otros", "Share this resource with others");
	document.getElementById("new_share_screen").innerHTML=DonaCadena3("Usuari o email", "Usuario o email", "Username or email");
	document.getElementById("new_share_descrip").innerHTML=DonaCadena3("Escriu un nom d'usuari de NiMMbus o un email, escull els drets i prem [Afegir]", "Escriba un nombre de usuario de NiMMbus o un email, escoja los derechos y presione [Añadir]", "Type a username in NiMMbus or an email, choose the rights and press [Add]");
	document.getElementById("new_share_open_screen").innerHTML=DonaCadena3("Tots", "Todos", "All");
	document.getElementById("new_share_open_read_label").innerHTML=DonaCadena3("Obrir a tothom per llegir", "Abrir a todos para lectura", "Open to everybody for reading");
	document.getElementById("new_share_open_descrip").innerHTML=DonaCadena3("Marca aqueta casella si vols obrir l'access a aquest recurs a tothom (fins i tot sense identificar-se)", "Marca esta casilla si desea obrir el acceso a este recurso a todos (incluso sin identificarse)", "Check this box if you want to open the access to this resource to everyone (even if they are not identified)");
	document.getElementById("new_share_open_btn").value=DonaCadena3("Afegir", "Añadir", "Add");
	document.getElementById("new_share_rights_read_label").innerHTML=DonaCadena3("Llegir", "Leer", "Read");
	document.getElementById("new_share_rights_write_label").innerHTML=DonaCadena3("Escriure", "Escribir", "Write");
	document.getElementById("new_share_rights_share_label").innerHTML=DonaCadena3("Compartir", "Compartir", "Share");
	document.getElementById("new_share_btn").value=DonaCadena3("Afegir", "Añadir", "Add");
	document.getElementById("current_share_screen").innerHTML=DonaCadena3("Llista de comparticions", "Lista de comparticiones", "Sharing list");
	document.getElementById("current_share_descrip").innerHTML=DonaCadena3("Fes clic a les creus per esborrar usuaris de la llista.", "Haga clic a las cruces para borrar usuarios de la lista.", "Click on the crosses to remove users from the list.");
	document.getElementById("share-close_btn").value=DonaCadena3("Tancar", "Cerrar", "Close");

	document.getElementById("feedback-title-text").innerHTML=DonaCadena3("Valoracions", "Valoraciones", "Feedback items");
	document.getElementById("feedback-subtitle-text").innerHTML=DonaCadena3("Valoracions sobre el recurs:", "Valoraciones sobre el recurso:", "Feedback about the resource:");
	document.getElementById("new_feedback_screen").innerHTML=DonaCadena3("Valoració", "Valoración", "Feedback");
	document.getElementById("new_feedback_descrip").innerHTML=DonaCadena3("Prem [Afegir] per a crear una nova valoració sobre aquest recurs", "Presione [Añadir] para crear una nueva valoración sobre este recurso", "Press [Add] to create a new feedback item about this resource");
	document.getElementById("new_feedback_btn").value=DonaCadena3("Afegir", "Añadir", "Add");
	document.getElementById("current_feedback_screen").innerHTML=DonaCadena3("Llista de valoracions", "Lista de valoraciones", "Feedback list");
	document.getElementById("current_feedback_descrip").innerHTML=DonaCadena3("Prem [Editar] per a veure, modificar o esborrar aquesta valoració", "Presione [Editar] para ver, modificar o borrar esta valoración", "Press [Edit] to view, modify or delete this feedback item");
	document.getElementById("feedback-close_btn").value=DonaCadena3("Tancar", "Cerrar", "Close");

	document.getElementById("reset-pass-title-text").innerHTML=DonaCadena3("Restabliment de contrasenya", "Reestablecimiento de contraseña", "Password reset");
	document.getElementById("reset-pass-subtitle-text").innerHTML=DonaCadena3("Troba el teu compte de NiMMbus", "Encuentre su cuenta de NiMMbus", "Find your NiMMbus account");
	document.getElementById("reset-pass_user_descrip").innerHTML=DonaCadena3("Introdueixi el nom d'usuari o correu electrònic. Se t'enviarà un email amb un enllaç per canviar la contrasenya.", "Introduzca su nombre de usuario o el correo electrónico. Se le enviará un email con un enllace para cambiar la contraseña.", "Enter your username or email. An email will be sent to you with a link to change the password.");
	document.getElementById("reset-pass_btn").value=DonaCadena3("Cerca", "Búsqueda", "Search");

	document.getElementById("new-pass-title-text").innerHTML=DonaCadena3("Nova contrasenya", "Nueva contraseña", "New password");
	document.getElementById("new-pass-subtitle-text").innerHTML=DonaCadena3("Canvia la teva contrasenya del teu compte de NiMMbus", "Cambie su contraseña para su cuenta de NiMMbus", "Change password in your NiMMbus account");
	document.getElementById("new-pass_new_pass_screen").innerHTML=DonaCadena3("Contrasenya nova", "Contraseña nueva","New password");
	document.getElementById("new-pass_new_pass_screen_descrip").innerHTML=DonaCadena3("Escriu directament la teva contrasenya nova.", "Escriva directamente su contraseña nueva.", "Write your new password here.");
	document.getElementById("new-pass_new_pass_valid_screen").innerHTML=DonaCadena3("Validació de contrasenya", "Validación de contraseña","Verify password");
	document.getElementById("new-pass_new_pass_valid_screen_descrip").innerHTML=DonaCadena3("Cal que tornis a escriure la teva contrasenya nova.", "Debes repetir la nueva contraseña.", "You need to repeat your new password.");
	document.getElementById("new-pass_btn").value=DonaCadena3("Canviar", "Canviar", "Change");

	document.getElementById("new-user-title-text").innerHTML=DonaCadena3("Nou al NiMMbus? Registra't:", "Nuevo en NiMMbus? Registrese:", "New to NiMMbus? Sign up:");
	document.getElementById("new-user-subtitle-text").innerHTML=DonaCadena3("Crea el teu compte de NiMMbus", "Cree su cuenta de NiMMbus", "Create your NiMMbus account");
	document.getElementById("new-user_new_user_screen").innerHTML=DonaCadena3("Usuari", "Usuario", "Username");
	document.getElementById("new-user_new_user_screen_descrip").innerHTML=DonaCadena3("Escriu el nom d'usuari que desitges.", "Escriva en nombre de usuario que desea.", "Write your username here.");
	document.getElementById("new-user_new_pass_screen").innerHTML=DonaCadena3("Contrasenya", "Contraseña","Password");
	document.getElementById("new-user_new_pass_screen_descrip").innerHTML=DonaCadena3("Escriu la teva contrasenya.", "Escriva directamente su contraseña.", "Write your new password here.");
	document.getElementById("new-user_new_pass_valid_screen").innerHTML=DonaCadena3("Validació de contrasenya", "Validación de contraseña","Verify password");
	document.getElementById("new-user_new_pass_valid_screen_descrip").innerHTML=DonaCadena3("Cal que tornis a escriure la teva contrasenya nova.", "Debes repetir la nueva contraseña.", "You need to repeat your new password.");
	document.getElementById("new-user_email_screen").innerHTML=DonaCadena3("Correu electrònic", "Correo electrónico", "Email");
	document.getElementById("new-user_email_screen_descrip").innerHTML=DonaCadena3("Per a validacions i notificacions per email", "Para validaciones y notificaciones por email", "For email notifications and verifications");
	document.getElementById("new-user_btn").value=DonaCadena3("Registrar-se al NiMMbus", "Registrarse en NiMMBus", "Sign up for NiMMbus");

	document.getElementById("execute-token-title-text").innerHTML=DonaCadena3("Solicitut", "Solicitud", "Request");
	document.getElementById("execute-token-wait-text").innerHTML=DonaCadena3("Espereu...", "Espere...", "Please wait...");
}

function DonaCadenaIdNoPotSerBuit(id)
{
	return document.getElementById(id).innerHTML + " "+ DonaCadena3("no pot ser buit.", "no puede estar vacio.", "cannot be blank.");
}


// Funció inspirada en una de SitePoint Pty. Ltd, www.sitepoint.com
function Ajax() 
{
  this.req = null;
  this.url = null;
  this.status = null;
  this.statusText = '';
  this.method = 'GET';
  this.async = true;
  this.dataPayload = "";
  this.readyState = null;
  this.responseText = null;
  this.responseXML = null;
  this.handleResp = null;
  this.responseFormat = 'text/plain', // 'text/plain', 'text/xml', 'object'
  this.requestFormat = 'application/x-www-form-urlencoded'  //només per POST
  this.structResp=null;
  this.mimeType = null;  
  this.headers = [];

  this.init = function() {
    var i = 0;
    var reqTry = [ 
      function() { return new XMLHttpRequest(); },
      function() { return new ActiveXObject('Msxml2.XMLHTTP') },
      function() { return new ActiveXObject('Microsoft.XMLHTTP' )} ];
      
    while (!this.req && (i < reqTry.length)) {
      try { 
        this.req = reqTry[i++]();
      } 
      catch(e) {}
    }
    return true;
  };
  this.doGet = function(url, hand, response_format, struct) 
  {
    //alert(url);  //·$·Per a depurar
    this.url = url;
    this.handleResp = hand;
    this.responseFormat = response_format || 'text/plain';
    this.structResp = struct;
    this.doReq();
  };

  this.doPost = function(url, request_format, dataPayload, hand, response_format, struct) 
  {
    this.url = url;
	this.requestFormat = request_format || 'application/x-www-form-urlencoded';    
    this.dataPayload = dataPayload;
    this.handleResp = hand;
    this.responseFormat = response_format || 'text/plain';
	this.structResp = struct;
    this.method = 'POST';
    this.doReq();
  };

  this.doReq = function() 
  {
    var self = null;
    var req = null;
    var headArr = [];
    
    if (!this.init()) {
      alert('Could not create XMLHttpRequest object.');
      return;
    }
    req = this.req;
    req.open(this.method, this.url, this.async);
    if (this.method == 'POST') 
        req.setRequestHeader('Content-Type', this.requestFormat);
    self = this;
	
    req.onreadystatechange = function() 
    {
      var resp = null;
      self.readyState = req.readyState;
      if (req.readyState == 4) {
        
		self.status = req.status;
        self.statusText = req.statusText;
        self.responseText = req.responseText;
        self.responseXML = req.responseXML;
	switch(self.responseFormat) {
          case 'text/plain':
            resp = self.responseText;
            break;
          case 'text/xml':
            resp = self.responseXML;
            break;
          case 'object':
            resp = req;
            break;
        }
		
		if(self.structResp)
		   self.structResp.text=self.responseText;
        if (self.status > 199 && self.status < 300) {
          if (!self.handleResp) {
            alert('No response handler defined ' +
              'for this XMLHttpRequest object.');
            return;
          }
          else {
            if(self.structResp) 
            	self.handleResp(resp, self.structResp);
	    	else
		  		self.handleResp(resp);
          }
        }
        
        else {
          self.handleErr(resp);
        }
      }
    }
    req.send(this.dataPayload);
  };
  this.abort = function() {
    if (this.req) {
      this.req.onreadystatechange = function() { };
      this.req.abort();
      this.req = null;
    }
  };
  this.handleErr = function() {
    var errorWin;
    // Create new window and display error
    try {
      errorWin = window.open('', 'errorWin');
      errorWin.document.body.innerHTML = this.responseText;
    }
    // If pop-up gets blocked, inform user
    catch(e) {
      alert('An error occurred, but the error message cannot be displayed because of your browser\'s pop-up blocker.\n' +
      'You could try to allow pop-ups from this Web site. Meanwhile, the text version of the error is:\n' + this.responseText);
    }
  };
  this.setMimeType = function(mimeType) {
    this.mimeType = mimeType;
  };  
  this.setHandlerResp = function(funcRef) {
    this.handleResp = funcRef;
  };
  this.setHandlerErr = function(funcRef) {
    this.handleErr = funcRef; 
  };
  this.setHandlerBoth = function(funcRef) {
    this.handleResp = funcRef;
    this.handleErr = funcRef;
  };
  this.setRequestHeader = function(headerName, headerValue) {
    this.headers.push(headerName + ': ' + headerValue);
  };
}

var ShowInfoShortTimeOut=0;
var ShowInfoOtherTimeOut=0;

function RemoveInfo(id)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML="";
	document.getElementById(id_div).style.opacity='0';
	if (id=="short" || id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
	}
}

function ShowInfo(id, s)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML=s;
	document.getElementById(id_div).style.opacity='1';
        if (id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else if (id=="short")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
		ShowInfoShortTimeOut=setTimeout("RemoveInfo(\""+id+"\")",3000);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
		ShowInfoOtherTimeOut=setTimeout("RemoveInfo(\""+id+"\")",15000);
	}
}

//Inspired in http://stackoverflow.com/questions/387736/how-to-stop-event-propagation-with-inline-onclick-attribute
function StopPropagationClick(e)
{
	if (!e)
		e = window.event;

	if (e.stopPropagation)    //IE9 & Other Browsers
		e.stopPropagation();
	
	else if (e.cancelBubble)  //IE8 and Lower
		e.cancelBubble = true;
}

function DonaDataJSComAText(d)
{
	return d.getFullYear()+ "-" + ((d.getMonth() + 1>9) ? "":"0") + (d.getMonth() + 1)+ "-" + ((d.getDate()>9) ? "":"0") + d.getDate()+ " " + ((d.getHours()>9) ? "":"0") + d.getHours()+ ":" +((d.getMinutes()>9) ? "":"0") + d.getMinutes()+ ":" +((d.getSeconds()>9) ? "":"0") + d.getSeconds();
}

function DonaDataISOComAText(d)
{
var s;
	s=d;
	if (s.indexOf("T")!=-1)
		s=s.substring(0, s.indexOf("T"))+" "+s.substring(s.indexOf("T")+1, s.length);
	if (s.indexOf(".")!=-1)
	        s=s.substring(0, s.indexOf("."));
	if (s.indexOf("Z")!=-1)
	        s=s.substring(0, s.indexOf("Z"));
        return s;
}

function DonaValorDeFormulari(clau_a_buscar, contingut, inclou_servidor)
{
var clau=clau_a_buscar.toUpperCase()+"=";
	if (inclou_servidor==true)
		contingut=contingut.substring(contingut.indexOf("?")+1,contingut.length);
	if (contingut.charAt(0)=="?")
		contingut=contingut.substring(1,contingut.length);

	var kvp=contingut.split("&");
	for (var i_kvp=0; i_kvp<kvp.length; i_kvp++)
	{
		if (kvp[i_kvp].substring(0, clau.length).toUpperCase()==clau)
			return unescape(kvp[i_kvp].substring(clau.length,kvp[i_kvp].length));
	}
	return null;
}

//http://stackoverflow.com/questions/1144783/replacing-all-occurrences-of-a-string-in-javascript
function ReplaceAll(s, find, replace) 
{
	return s.replace(new RegExp(find, 'g'), replace);
}

/*Aquesta funció fa un subconjunt del que fa encodeURIComponent(), que hem 
  observat que remplaça les lletres accentuades per caràcters unicode i això no va bé.*/
function DonaCadenaPerValorDeFormulari(s)
{
	s=ReplaceAll(s, "&", "%26");
	s=ReplaceAll(s, "=", "%3D");
	s=ReplaceAll(s, "\\?", "%3F");  //http://stackoverflow.com/questions/889957/escaping-question-mark-in-regex-javascript
	return s;
}

/*Copied from http://www.w3schools.com/dom/dom_loadxmldoc.asp    finalment no la necessito.
function loadXMLString(txt) 
{
var xmlDoc;
	if (window.DOMParser)
	{
		var parser=new DOMParser();
		xmlDoc=parser.parseFromString(txt,"text/xml");
	}
	else // code for IE
   	{
		xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
		xmlDoc.async=false;
		xmlDoc.loadXML(txt); 
	}
	return xmlDoc;
}*/

function DonaTextDesDeGcoCharacterString(item)
{
	var elem=GetValueXMLElementByName(item, "gco", "CharacterString");
	if (elem)
		return elem;
	else
		return "";
}

function OmpleInputDesDeWPSLiteralOutput(item)
{
	var literal_data=GetXMLElementByName(item, "wps", "LiteralData");
	if (literal_data && literal_data.childNodes[0] && literal_data.childNodes[0].nodeValue)
		return literal_data.childNodes[0].nodeValue;
	else
		return "";
}

function OmpleInputDesDeWPSComplexOutput(item)
{
	return GetXMLElementByName(item, "wps", "ComplexData");
}

var PendingToken="";
var ActionAfterSignIn=null;
var ParamActionAfterSignIn=null;
var ChangeLang=true;  //Change language following user preferences?

function AnalitzarParametresURL()
{
var clau=new Array("USER=", "PASSWORD=", "EMAIL=", "LANGUAGE=", "TOKEN=", "TOKEN_DESC=", "PAGE=", "TARGET_TITLE=", "TARGET_CODE=", "TARGET_CODE_SPACE=");
var newpage="";
var email, target_title="", target_code="", target_code_space="";

	if (location.search && location.search.substring(0,1)=="?")
	{
		var kvp=location.search.substring(1, location.search.length).split("&");
		for (var i_kvp=0; i_kvp<kvp.length; i_kvp++)
		{
			for (var i_clau=0; i_clau<clau.length; i_clau++)
			{
				if (kvp[i_kvp].substring(0, clau[i_clau].length).toUpperCase()==clau[i_clau])
				{
					var valor=unescape(kvp[i_kvp].substring(clau[i_clau].length,kvp[i_kvp].length));
					if (i_clau==0)  //USER
						document.sign_in.user.value=valor;
					else if (i_clau==1)  //PASSWORD
						document.sign_in.pass.value=valor;
					else if (i_clau==2)  //EMAIL
						email=valor;
					else if (i_clau==3)  //LANGUAGE
					{
						var i;
						i=GetActiveLanguageIndex(valor.toLowerCase());
						if (i==-1)
							ShowInfo("long", DonaCadena3("Idioma no suportat", "Idioma no soportado", "Unsuported language") +": \""+ valor.toLowerCase()+"\".");
						else
						{
							ActiveLanguage=i;
							ChangeLang=false;
						}
					}
					else if (i_clau==4)  //TOKEN
						PendingToken=valor;
					else if (i_clau==5)  //TOKEN_DESC
						document.getElementById("execute-token-subtitle-text").innerHTML=valor;
					else if (i_clau==6)  // PAGE
						newpage=valor.toUpperCase();
					else if (i_clau==7)  // TARGET_TITLE
						target_title=valor
					else if (i_clau==8)  // TARGET_CODE
						target_code=valor
					else if (i_clau==9)  // TARGET_CODE_SPACE
						target_code_space=valor
					else
						ShowInfo("long", DonaCadena3("Clau no identificada", "Clave no identificada", "Unidentified key") +": \""+ valor+"\".");
					break;
				}
			}
		}
	}


	if (newpage!="")
	{
	
		if (newpage=="NEWPASSWORD")
			EntraANewPassword();
		else if (newpage=="NEWUSER")
			EntraANewUser(email);
		else if (newpage=="TOKEN")
			EntraAExecuteToken();
		else if (newpage=="RESETPASSWORD")
		{
			if (PendingToken=="")
			{
				ShowInfo("long", DonaCadena3("Es necessari tenir un vale.", "Es necesario tener un vale.", "Valid token required."));
				return;
			}
			EntraAResetPassword();
		}
		else if (newpage=="MAIN")
			EntraANimmbusMain();
		else if (newpage=="ADD_FEEDBACK")
		{
			if (target_title=="" || target_code=="")
			{
				ShowInfo("long", DonaCadena3("Es necessari indicar TARGET_TITLE= i TARGET_CODE=.", "Es necesario indicar TARGET_TITLE= i TARGET_CODE=.", "TARGET_TITLE= and TARGET_CODE= should be provided."));
				return;
			}
			ActionAfterSignIn=EntraAAddFeedback;
			ParamActionAfterSignIn={"title":target_title, "code": target_code, "code_space": target_code_space};
		}
		else
			ShowInfo("long", DonaCadena3("Plana no identificada", "Página no identificada", "Unidentified page name") +": \""+ newpage+"\".");
	}

}

function InitFrontPage()
{
	SurtDeNimmbus();
	AnalitzarParametresURL();
	ChangeLanguage(ActiveLanguage);
}

var TimeOutBoxCloser=0;
var CloseDropDownListOutMenu=null;
var CloseDropDownListOutSubMenu=null;

function SwitchDropDownList(menu_id, submenu_id)
{
	if (document.getElementById(submenu_id).style.visibility=="")
		document.getElementById(submenu_id).style.visibility="hidden";

	if (document.getElementById(submenu_id).style.visibility=="hidden")
	{
		document.getElementById(submenu_id).style.visibility="visible";
		//Remove menu when clicking outside: http://www.techjunkie.com/close-div-click-outside/
		CloseDropDownListOut(CloseDropDownListOutSubMenu);

		CloseDropDownListOutMenu=menu_id;
		CloseDropDownListOutSubMenu=submenu_id;

		document.body.removeEventListener('click', CloseDropDownListOutEvent, false);
		if (TimeOutBoxCloser)
			clearTimeout(TimeOutBoxCloser);
		TimeOutBoxCloser=setTimeout("document.body.addEventListener('click', CloseDropDownListOutEvent, false);", 300);
	}
	else
		CloseDropDownListOut(submenu_id);
}

function CloseDropDownListOut(id)
{
	document.body.removeEventListener('click', CloseDropDownListOut, false);
	if (id)
		document.getElementById(id).style.visibility='hidden';
}

function CloseDropDownListOutEvent(event)
{
	if (!event)
		event=window.event;
	if(event.target.id != CloseDropDownListOutMenu)
	{
		CloseDropDownListOut(CloseDropDownListOutSubMenu);
		CloseDropDownListOutSubMenu=null;		
	}
}


function DonaIDProcessDesDeRootXML(root)
{
var process, metadata, title, id;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,8)=="sync_id:")
				{
					return title.value.substring(8);
				}
			}
		}
	}
	return "";
}

function DonaIDRecursDesDeRootXML(root)
{
var process, metadata, title, id;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,7)=="obj_id:")
				{
					return title.value.substring(7);
				}
			}
		}
	}
	return "";
}

function TiraAPantallaRespostaSiNoEntenc(root, no_usat)
{
	//Si no entenc el document el tiro sencer a la finestra
	if (root.xml)
	{
		ShowInfo("long", "<xmp>"+root.xml+"</xmp>");
		UpdateLastServer();
		return;
	}
	if (XMLSerializer)
	{
		var serializer = new XMLSerializer();   
		ShowInfo("long", "<xmp>"+serializer.serializeToString(root)+"</xmp>");		
		UpdateLastServer();
		return;
	}
	ShowInfo("long", DonaCadena3(
				"El servidor ha respost però no és possible mostrar el resultat en aquest navegador.",
				"El servidor ha respondido pero no es posible mostrar el resultado en este navegador.",
				"The server responded but it is not possible to show the result on this browser."));
	UpdateLastServer();
	return;
}

function DonaRootXML(doc, no_usat)
{
	if (!doc || !doc.documentElement)
	{
		
		ShowInfo("long", DonaCadena3(
			"El servidor ha respost però no puc identificar la seva resposta.",
			"El servidor ha respondido pero no puedo identificar su respuesta.",
			"The server responded but it can not be identified correctly."));
		UpdateLastServer();
		return null;
	}
	return doc.documentElement;
}

function AnalitzaExceptionReport(root, no_usat)
{
var exception_error;

	exception_error=GetXMLElementByName(root, "ows", "ExceptionText");
	if (exception_error)
	{
		ShowInfo("long", exception_error.childNodes[0].nodeValue);
		UpdateLastServer();
		return true;
	}
	//Si no trobo text, potser encara trovaré el codi
	exception_error=GetXMLElementByName(root, "ows", "Exception");
	if (exception_error)
	{
		exception_error=GetXMLAttributeByName(exception_error, null, "exceptionCode");
		if (exception_error && exception_error.value)
		{
			ShowInfo("long", exception_error.value);
			UpdateLastServer();
			return true;
		}
	}
	return false;
}


var ajaxExecuteNB;

var TimeOutDonaResposta=0;

function AvaluaResposta(doc, nom_funcio)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	id_obj=DonaIDRecursDesDeRootXML(root);  //La execució de NB_RESOURCE:CREATE dona l'ID de recurs que s'està en procés de crear.
	if (id_obj!="")
		IdResourceToSaveChanges=id_obj;

	id_proces=DonaIDProcessDesDeRootXML(root);
	if (id_proces!="")
	{
		//ShowInfo("long", "Process id:"+id_proces);
		if (TimeOutDonaResposta)
			clearTimeout(TimeOutDonaResposta);
		TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+id_proces+"\", \""+nom_funcio+"\")", 500);
		return;
	}
	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function DiguesOKIEntraANimmbusCallBack()
{
	ShowInfo("short", DonaCadena3("Tot bé", "Todo correcto", "Ok!"));
	if (ActionAfterSignIn)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
		EntraANimmbusMain(true);
}

function AvaluaRespostaOk(doc, nom_funcio)
{
var root, process_succeeded;

	RemoveInfo("permanent");

	root=DonaRootXML(doc, document);
	if (!root)
		return;

	if (AnalitzaExceptionReport(root, document))
		return;

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		fn=window[nom_funcio];
		if (typeof fn === "function")
			fn(); 
		else 
			alert("AvaluaRespostaOk(doc, nom_funcio) error in parameter \"nom_funcio\": "+ nom_funcio +" is not a function.");
		UpdateLastServer();
		return;
	}

	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function SignInNB()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:VALIDATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value), AvaluaRespostaOk, "text/xml", 
				"DiguesOKIEntraANimmbusCallBack");
        ShowInfo("permanent", DonaCadena3("Missatge enviat", "Mensage enviado", "Message sent"));
	return false;
}

function AvaluaRespostaGetReturn(doc, nom_funcio)
{
var root, output, identifier;
var fn;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				var codi="";
				if (identifier.childNodes[0].nodeValue=="code")
				{					
					codi=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (codi=="0")
					{
						RemoveInfo("permanent");
						ShowInfo("short", DonaCadena3("Tot bé", "Todo correcto", "Ok!"));
						//··· M'agradaria obtenir l'identificador del codi del objecte creat/modificat aquí i posar-lo a IdResourceToSaveChanges 
						UpdateLastServer();
						//uso el truco següent: http://www.sitepoint.com/call-javascript-function-string-without-using-eval
						fn=window[nom_funcio];
						if (typeof fn === "function")
							fn(); 
						else 
							alert("AvaluaRespostaGetReturn(doc, nom_funcio) error in parameter \"nom_funcio\": "+ nom_funcio +" is not a function.");
						return;
					}
					if (codi=="7")
					{
						if (TimeOutDonaResposta)
							clearTimeout(TimeOutDonaResposta);
						TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+DonaIDProcessDesDeRootXML(root)+"\", \""+nom_funcio+"\");", 500);
						return;
					}
				}
				
				if (identifier.childNodes[0].nodeValue=="description")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s=="")
						s=DonaCadena3("Error sense descripció. Codi", "Error sin descripción. Código", "Error without descripcion. Code")+ ": " +codi;
						
					RemoveInfo("permanent");
					ShowInfo("long", s);
					UpdateLastServer();
					return;
				}
			}
		}
	}
	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function EvaluateGetReturnProcess(id, nom_funcio)
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SYNC:GETRETURN&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&SYNC_ID="+id, AvaluaRespostaGetReturn, "text/xml", 
				nom_funcio);
}

function AvaluaRespostaRetrieveUserMinPreferences(doc)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language" && ChangeLang)
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						var i;
						i=GetActiveLanguageIndex(s);
						if (i==-1)
						{
							ShowInfo("long", DonaCadena3("Idioma no suportat.", "Idioma no soportado.", "Unsuported language."));
						}
						else
						{
							if (ActiveLanguage!=i)
							{
								ChangeLanguage(i);
								ShowInfo("short", DonaCadena3("Idioma canviat a preferències.", "Idioma cambiado segun preferencias.", "Language changes to preferences."));
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="name")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						document.account_form.name.value=s;
						document.getElementById("main-left-pannel-title-text").innerHTML=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="obj_time")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
						document.getElementById("main-left-pannel-date-text").innerHTML=s.substring(0, s.indexOf("T"));
				}
			}
		}
		UpdateLastServer();
	}
	else
	{	
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function RetrieveUserMinPreferences()
{
	//RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value), AvaluaRespostaRetrieveUserMinPreferences, "text/xml", null);
        //ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));
	return false;
}

function AvaluaRespostaRetrieveResourceCompacte(doc, dades)
{
var root, output, identifier, s, elem, citation, md_identifier, title, code, code_space, type;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					title=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="type")
					type=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation")
				{					
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						md_identifier=GetXMLElementByName(citation, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								code=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								code_space=DonaTextDesDeGcoCharacterString(elem);
						}
					}
				}		
			}
		}
		RemoveInfo("permanent");
		document.getElementById(dades.type_element).innerHTML=DonaCadena3("Recurs valorat", "Recurso valorado", "Resource about");
		if (type=="CITATION")
			document.getElementById(dades.compact_element).innerHTML="<img src=\""+DonaNomImgTipusRecurs(type)+"\" align=\"left\">" + title + "<br>code: " + code + ", code_space: " + code_space;
		else
			document.getElementById(dades.compact_element).innerHTML=title;
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function AvaluaRespostaRetrieveResourceHref(doc, id)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.href_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="href")
					document.href_resource_form.href.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="mimetype")
				{					
					SeleccionaSelectDesDeValor(document.href_resource_form.mimetype, 
							OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.href_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("href-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("href-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("href-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("href-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadena3("Descripció detallada d'aquest hiperenllaç (no tens drets de modificació)", "Descripción detallada de este hiperenlace (no tiene derechos de modificación)", "Detailed description of this hiperlink (you do not have modification rights)");
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetResourceToSaveChanges="";
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourcePoi(doc, id)
{
var root, output, identifier, s, georss;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.poi_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="position")
				{					
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "gml", "pos");
						if (s && -1!=s.indexOf(" "))
						{
							document.poi_resource_form.lat.value=s.substring(0,s.indexOf(" "));
							document.poi_resource_form.long.value=s.substring(s.indexOf(" ")+1, s.length);
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="elevation")
				{
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "georss", "elev");
						if (s)
							document.poi_resource_form.elevation.value=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.poi_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="pos_accuracy")
					document.poi_resource_form.pos_accur.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("poi-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("poi-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("poi-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("poi-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadena3("Descripció detallada d'aquest punt d'interés (no tens drets de modificació)", "Descripción detallada de este punto de interés (no tiene derechos de modificación)", "Detailed description of this point of interest (you do not have modification rights)");
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetResourceToSaveChanges="";
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceFeedback(doc, id)
{
var root, output, identifier, s, georss;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.feedback_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.feedback_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="abstract")
					document.feedback_resource_form.abstract.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));					
				else if (identifier.childNodes[0].nodeValue=="contactRole")				
				{					
					SeleccionaSelectDesDeValor(document.feedback_resource_form.contactRole, 
								OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="comment")
					document.feedback_resource_form.comment.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));					
				else if (identifier.childNodes[0].nodeValue=="motivation")
				{					
					SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, 
								OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="rating")
				{					
					SeleccionaSelectDesDeValor(document.feedback_resource_form.rating, 
								OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("feedback-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("feedback-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("feedback-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("feedback-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadena3("Descripció detallada d'aquesta valoració (no tens drets de modificació)", "Descripción detallada de esta valoración (no tiene derechos de modificación)", "Detailed description of this feedback (you do not have modification rights)");
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetResourceToSaveChanges="";  //No estic segur que s'hagi de fer això aquí
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceCitation(doc, id)
{
var root, output, identifier, s, elem, citation, md_identifier, onlineResource;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.citation_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation")
				{					
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						md_identifier=GetXMLElementByName(citation, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								document.citation_resource_form.id_code.value=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								document.citation_resource_form.id_namespace.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						onlineResource=GetXMLElementByName(citation, "cit", "CI_OnlineResource");
						if (onlineResource)
						{					
							//LINK
							elem=GetXMLElementByName(onlineResource, "cit", "linkage");
							if (elem)
								document.citation_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
							//DESCRIPTION
							elem=GetXMLElementByName(onlineResource, "cit", "description");
							if (elem)
								document.citation_resource_form.url_descrip.value=DonaTextDesDeGcoCharacterString(elem);
							//FUNCTION
							elem=GetXMLElementByName(onlineResource, "cit", "CI_OnLineFunctionCode");
							if (elem)
								SeleccionaSelectDesDeValor(document.citation_resource_form.function_code, 
												GetXMLAttributeByName(elem, null, "codeListValue"));
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					document.getElementById("citation-resource_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("citation-resource-exit_btn").style.display=(rights.indexOf("W")==-1) ? 'inline' : 'none';
					document.getElementById("citation-resource-close_btn").style.display=(rights.indexOf("W")==-1) ? 'none' : 'inline';
					document.getElementById("citation-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
					if (rights.indexOf("W")==-1)
						document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadena3("Descripció detallada d'aquesta citació (no tens drets de modificació)", "Descripción detallada de esta citación (no tiene derechos de modificación)", "Detailed description of this citation (you do not have modification rights)");
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		TargetResourceToSaveChanges="";	
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function PopulateCompactDescriptionResource(id, type_element, compact_element)
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+id, AvaluaRespostaRetrieveResourceCompacte, "text/xml", {"type_element": type_element, "compact_element": compact_element});
        ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));
}

function EditResource(query, type)
{	
var id=DonaValorDeFormulari("RESOURCE", query, true);
var AvaluaRespostaRetrieveResource;

	if (id==null)
	{
		ShowInfo("long", DonaCadena3("Identificador de recurs no trobat.", "Identificador de recurso no encontrado.", "Cannot found resource identifier."));
		return;
	}
	
	if (type=="HREF")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceHref;
		MostraHRefResource(id);
	}
	else if (type=="POI")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourcePoi;
		MostraPoiResource(id);
	}
	else if (type=="FEEDBACK")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceFeedback;
		MostraFeedbackResource(id, '');
	}
	else if (type=="CITATION")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceCitation;
		MostraCitationResource(id);
	}
	else
	{
		ShowInfo("long", DonaCadena3("Tipus de recurs no suportat", "Tipo de recurso no soportado.", "Unsupported resource type")+": "+type);
		return;
	}

	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+id, AvaluaRespostaRetrieveResource, "text/xml", id);
        ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));
}


function DonaNomImgTipusRecurs(type)
{
	if (type=="HREF")
		return "link48.png";
	if (type=="POI")
		return "point48.png";  
	if (type=="FEEDBACK")
		return "feedback48.png";             
	if (type=="CITATION")
		return "citation48.png";
	return "";
}

var ResourcesPerPage=10;  //solució provisional a l'espera de que sigui conigurrable per usuari

function AvaluaRespostaEnumerateResources(doc, make_pannel_visible)
{
var root, s, type;
	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=new ParseOWSContextAtom(root);

	if (make_pannel_visible)
		ChangePannel("resources", true);

	if (owc.properties.totalResults==0)
		document.getElementById("resources-hits-text").innerHTML="<small>"+DonaCadena3("Useu el botó \"Nou\" per crear recursos", "Use el botón \"Nuevo\" para crear recursos", "Use the \"New\" button to create resources")+"</small>";
	else
		document.getElementById("resources-hits-text").innerHTML="["+owc.properties.startIndex + "," +(parseInt(owc.properties.startIndex)+owc.features.length-1)+ "] "+ DonaCadena3("de", "de", "of") + " " +  owc.properties.totalResults;
	if (owc.properties.startIndex==1 || owc.properties.totalResults==0)
	{
		document.getElementById("newer-resources_btn").onclick=null;
		document.getElementById("newer-resources_btn").className="submit_btn_disable";
	}
	else
	{
		document.getElementById("newer-resources_btn").onclick=new Function("EnumerateResources("+((owc.properties.startIndex<=ResourcesPerPage) ? 1 : owc.properties.startIndex-ResourcesPerPage)+", false);");
		document.getElementById("newer-resources_btn").className="submit_btn";
	}

	if (parseInt(owc.properties.startIndex)+owc.features.length-1==owc.properties.totalResults || owc.properties.totalResults==0)
	{
		document.getElementById("older-resources_btn").onclick=null;
		document.getElementById("older-resources_btn").className="submit_btn_disable";
	}
	else
	{
		document.getElementById("older-resources_btn").onclick=new Function("EnumerateResources("+(parseInt(owc.properties.startIndex)+ResourcesPerPage)+", false);");
		document.getElementById("older-resources_btn").className="submit_btn";
	}

	s="<ol class=\"white-area-list\">";
	if (owc.features)
	{
		for (var i=0; i<owc.features.length; i++)
		{
			// type is decided searching for a category with scheme equal no nimmbus. If more than one is present (it should not happen) the first one is used
			// initially type is set to "" in case no category properly defines it
			type="";
			if (owc.features[i].properties.categories)
			{
				for (var j=0; j<owc.features[i].properties.categories.length; j++)
				{
					if (owc.features[i].properties.categories[j].scheme &&
						owc.features[i].properties.categories[j].scheme=="http://www.opengis.uab.cat/nimmbus/resource_type" &&
						owc.features[i].properties.categories[j].term)
					{
						if (owc.features[i].properties.categories[j].term=="POI")
							type="POI"; 
						else if (owc.features[i].properties.categories[j].term=="HREF")
							type="HREF";
						else if (owc.features[i].properties.categories[j].term=="FEEDBACK")
							type="FEEDBACK";
						else if (owc.features[i].properties.categories[j].term=="CITATION")
							type="CITATION";
			  			else
			  				continue;
				  		break;
					}		
				}
			}

			s+="<div class=\"white-area-li\"><li class=\"white-area-li-text\" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'"+type+"\');\"><img class=\"white-area-li-img\" src=\"";
			s+=DonaNomImgTipusRecurs(type);
			s+="\"><strong>" +owc.features[i].properties.authors[0].name+"</strong> "+DonaDataISOComAText(owc.features[i].properties.updated)+"<br/>";
			
			if (type=="HREF")
				s+=" <a class=\"white-area-li-text-link\" href=\""+owc.features[i].properties.links.enclosures[0].href+"\" target=\"_blank\" onClick=\"StopPropagationClick(event);return true;\">"+owc.features[i].properties.title+"</a>";
			else if (type=="POI")
				s+=owc.features[i].properties.title+" (lat/long: "+ owc.features[i].geometry.coordinates[1]+","+owc.features[i].geometry.coordinates[0]+")";
			else if (type=="FEEDBACK" || type=="CITATION")
				s+=owc.features[i].properties.title;
                
			s+="<br/><span class=\"white-area-li-shadow\"> ";
			s+="<a class=\"white-area-li-shadow-link\" onClick=\"MostraFeedbackList(event, \'"+owc.features[i].id+"\', \'"+type+"\');\">"+DonaCadena3("Valoració", "Valoración", "Feedback")+"</a>&nbsp;&nbsp;&nbsp; ";
                      		
			if (owc.features[i].properties.rights && owc.features[i].properties.rights.indexOf("S")!=-1)
				s+="<a class=\"white-area-li-shadow-link\" onClick=\"MostraShareResource(event, \'"+owc.features[i].id+"\', \'"+type+"\');\">"+DonaCadena3("Compartir", "Compartir", "Share")+"</a>&nbsp;&nbsp;&nbsp; ";
			s+="<a class=\"white-area-li-shadow-link\" onClick=\"MostraTagResource(event, \'"+owc.features[i].id+"\');\">"+DonaCadena3("Etiquetar", "Etiquetar", "Tag")+"</a></span></li></div>"
		}
	}
	s+="</ol>";
	
	document.getElementById("resources-list").innerHTML=s;

	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

var ajaxExecuteNBResource;

function EnumerateResources(start_index, make_pannel_visible)
{
	RemoveInfo("long");
	ajaxExecuteNBResource=new Ajax();
	ajaxExecuteNBResource.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&STARTINDEX="+start_index+"&COUNT="+ResourcesPerPage, AvaluaRespostaEnumerateResources, "text/xml", make_pannel_visible);
        ShowInfo("permanent", DonaCadena3("Demanant llista de recursos...", "Pidiendo lista de recursos...", "Requesting resource list..."));
	return false;
}

function AvaluaRespostaRetrieveUserData(doc, no_usat)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language")
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						for (var i=0; i<LanguagesNB.length; i++)
						{
							if (LanguagesNB[i]==s)
							{
								if (ActiveLanguage!=i)
								{
									ChangeLanguage(i);
									document.account_form.language.selectedIndex=ActiveLanguage;
									ShowInfo("short", DonaCadena3("Idioma canviat a preferències.", "Idioma cambiado segun preferencias.", "Language changes to preferences."));
								}
								break;
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="email")
					document.account_form.email.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="name")
					document.account_form.name.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="bio")
					document.account_form.bio.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
			}
		}
		RemoveInfo("permanent");
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function RetrieveUserData()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value), AvaluaRespostaRetrieveUserData, "text/xml", null);
        ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));
	return false;
}

function ChangePannel(id, add_hash)
{
var i_pannel, 
	pannel=[{"id": "front-page", "parent": null, "title": {"cat": "Identificació al NiMMbus", "spa": "Identificación en NiMMbus", "eng": "NiMMbus login"}}, 
		{"id": "reset-pass-page", "parent": null, "title": {"cat": "Reestabliment de contrasenya de NiMMbus", "spa": "Reestablecimiento de contraseña de NiMMbus", "eng": "NiMMbus reset password"}}, 
		{"id": "new-pass-page", "parent": null, "title": {"cat": "Reestabliment de contrasenya de NiMMbus", "spa": "Reestablecimiento de contraseña de NiMMbus", "eng": "NiMMbus reset password"}}, 
		{"id": "new-user-page", "parent": null, "title": {"cat": "Registra't al NiMMbus", "spa": "Registrese en NiMMbus", "eng": "Sign up for NiMMbus"}},
		{"id": "execute-token-page", "parent": null, "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}},
		{"id": "new-user-page", "parent": null, "title": {"cat": "Registra't al NiMMbus", "spa": "Registrese en NiMMbus", "eng": "Sign up for NiMMbus"}},
		{"id": "main-page", "parent": null, "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}},
		{"id": "account", "parent": "main-page", "title": {"cat": "Compte de NiMMbus", "spa": "Cuenta de NiMMbus", "eng": "NiMMbus account"}}, 
		{"id": "href-resource", "parent": "main-page", "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}}, 
		{"id": "poi-resource", "parent": "main-page", "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}}, 
		{"id": "feedback-resource", "parent": "main-page", "title": {"cat": "NiMMbus: Valoració", "spa": "NiMMbus: Valoración", "eng": "NiMMbus: Feedback"}}, 
		{"id": "citation-resource", "parent": "main-page", "title": {"cat": "NiMMbus: Citació", "spa": "NiMMbus: Citación", "eng": "NiMMbus: Citation"}}, 
		{"id": "resources", "parent": "main-page", "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}}, 
		{"id": "feedback", "parent": "main-page", "title": {"cat": "NiMMbus: Valoracions", "spa": "NiMMbus: Valoraciones", "eng": "NiMMbus: Feedbacks"}}, 
		{"id": "share", "parent": "main-page", "title": {"cat": "NiMMbus: Comapartir", "spa": "NiMMbus: Compartir", "eng": "NiMMbus: Share"}}
		/*, {"id": "tag", "parent": "main-page", "title": {"cat": "NiMMbus", "spa": "NiMMbus", "eng": "NiMMbus"}} */];
	
	for (var i in pannel)
	{ 
		if (id==pannel[i].id)
		{
			i_pannel=i;
			break;
		}
	}

	for (var i in pannel)
	{ 
		if (i!=i_pannel)
		{
			if (pannel[i].id==pannel[i_pannel].parent)
				;  //Evito apagar el pare del id escollit.
			else
			{
				document.getElementById(pannel[i].id).style.visibility='hidden';
				if (pannel[i].parent && pannel[i].parent!=pannel[i_pannel].parent)  //Evito apagar el pare que és el mateix pare que l'escollit.
					document.getElementById(pannel[i].parent).style.visibility='hidden';
			}
		}
		else 
		{
		        document.title = DonaCadenaJSON(pannel[i_pannel].title);
			document.getElementById(pannel[i_pannel].id).style.visibility='visible';
			if (pannel[i_pannel].parent)
				document.getElementById(pannel[i_pannel].parent).style.visibility='visible';
		}
	}

	
	if (add_hash)
		location.hash=id;
	window.scrollTo(0, 0);
}

function MostraAccount(es_nou)
{
	NewUserChangeTimeOut=0;
	document.account_form.new_user.value=document.sign_in.user.value;
	document.account_form.email.value="";
	document.account_form.email.value="";
	document.account_form.name.value="";
	document.account_form.bio.value="";
	document.account_form.current_pass="";
	document.account_form.new_pass="";
	document.account_form.new_pass_valid="";
	document.account_form.language.selectedIndex=ActiveLanguage;
	
	RetrieveUserData();
	if (es_nou)
	{
		document.getElementById("current_pass_fieldset").style.display='none';
		document.getElementById("new_user_fieldset").style.display='none';
		document.getElementById("new_pass_fieldset").style.display='none';
		document.getElementById("new_pass_valid_fieldset").style.display='none';
		document.getElementById("account-close_btn").style.display='none';
	}
	else
	{
		document.getElementById("current_pass_fieldset").style.display='table';
		document.getElementById("new_user_fieldset").style.display='table';
		document.getElementById("new_pass_fieldset").style.display='table';
		document.getElementById("new_pass_valid_fieldset").style.display='table';
		document.getElementById("account-close_btn").style.display='inline';
	}
	ChangePannel("account", true);
}

var IdResourceToSaveChanges="";
var TargetResourceToSaveChanges="";

function MostraHRefResource(id)
{
	ChangePannel("href-resource", true);
	IdResourceToSaveChanges=id;
	TargetResourceToSaveChanges="";
	document.getElementById("href-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadena3("Nou hiperenllaç", "Nuevo hiperenlace", "New hiperlink");
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadena3("Introdueix les característiques d'aquest hiperenllaç", "Introduce las características de este hiperenlace", "Define the characteristics of this hiperlink");
		document.getElementById("href-resource_btn").value=DonaCadena3("Crear", "Crear", "Create");
		document.getElementById("href-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadena3("Hiperenllaç", "Hiperenlace", "Hiperlink");
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadena3("Modifica les característiques d'aquest hiperenllaç", "Modifica las características de este hiperenlace", "Modify the characteristics of this hiperlink");
		document.getElementById("href-resource_btn").value=DonaCadena3("Guardar canvis", "Guardar cambios", "Save changes");
		document.getElementById("href-resource-delete_btn").style.display='inline';
	}
}

function MostraPoiResource(id)
{
	ChangePannel("poi-resource", true);
	IdResourceToSaveChanges=id;
	TargetResourceToSaveChanges="";
	//document.getElementById("long-poi-resource_alert").style.display='none';
	//document.getElementById("lat-poi-resource_alert").style.display='none';
	document.getElementById("elevation-poi-resource_alert").style.display='none';
	document.getElementById("reason-poi-resource_alert").style.display='none';
	document.getElementById("poi-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadena3("Nou punt d'interés", "Nuevo punto de interés", "New point of interest");
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadena3("Introdueix les característiques d'aquest punt", "Introduce las características de este punto", "Define the characteristics of this point");
		document.getElementById("poi-resource_btn").value=DonaCadena3("Crear", "Crear", "Create");
		document.getElementById("poi-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadena3("Punt d'interés", "Punto de interés", "Point of interest");
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadena3("Modifica les característiques d'aquest punt", "Modifica las características de este punto", "Modify the characteristics of this point");
		document.getElementById("poi-resource_btn").value=DonaCadena3("Guardar canvis", "Guardar cambios", "Save changes");
		document.getElementById("poi-resource-delete_btn").style.display='inline';
	}
}

function MostraFeedbackResource(id, target)
{
	ChangePannel("feedback-resource", true);
	if (id=='' && target==null)  //Marca de que estic afegit un feedback a un target seccionat 
		TargetResourceToSaveChanges=IdResourceToSaveChanges;
	else
		TargetResourceToSaveChanges=target;

	IdResourceToSaveChanges=id;

	if (target!="" || (id=='' && target==null)) 
		PopulateCompactDescriptionResource(TargetResourceToSaveChanges, "target_feedback-resource_compact_screen", "target_feedback-resource_compact_descrip");

	document.getElementById("feedback-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadena3("Nova valoració", "Nueva valoración", "New feedback");
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadena3("Introdueix les característiques d'aquesta valoració", "Introduce las características de esta valoración", "Define the characteristics of this feedback");
		document.getElementById("feedback-resource_btn").value=DonaCadena3("Crear", "Crear", "Create");
		document.getElementById("feedback-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadena3("Valoració", "Valoración", "Feedback");
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadena3("Modifica les característiques d'aquesta valoració", "Modifica las características de esta valoración", "Modify the characteristics of this feedback");
		document.getElementById("feedback-resource_btn").value=DonaCadena3("Guardar canvis", "Guardar cambios", "Save changes");
		document.getElementById("feedback-resource-delete_btn").style.display='inline';
	}
}

function SurtDeAddFeedbackCallBack()
{
	//DetermineCitationID
	ShowInfo("short", DonaCadena3("Citació creada", "Citación creada", "Citation Created"));
	RetrieveUserMinPreferences();
	EnumerateResources(1, false);
	MostraFeedbackResource('', null);
}

function AvaluaRespostaCreaTargetNoNecessari(doc)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return null;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return null;
	}

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		//Si ha retornat de manera immediata amb una ProcessSucceeded vol dir que no calia crear cap target. Es podria comprobar més bé mirant is "msg_id:" és 99 però no em cal.
		id_obj=DonaIDRecursDesDeRootXML(root);
		RemoveInfo("permanent");
		return id_obj;
	}
	return "";
}

function AvaluaRespostaRetrieveTarget(doc, nom_funcio)
{
var target_id;
	//Determina si la resposta a estat "error" "ja existeix" i puc obtenir el target_id
	target_id=AvaluaRespostaCreaTargetNoNecessari(doc);
	if (target_id==null)  // El fitxer doc no és ni tant sols un xml que es pugui entendre.
		return;
	if (target_id=="")
		AvaluaResposta(doc, nom_funcio);  //El recurs no existia i està en procés de creació
	else
	{
		RetrieveUserMinPreferences();
		EnumerateResources(1, false);
		MostraFeedbackResource('', target_id);  //el recurs existeix i es pot afegir el feedback sobre ell sense esperar.
	}
}

//Funció inspirada en SendCitationResourceChanges() però molt més automàtica.
function EntraAAddFeedback(target)
{
        ShowInfo("permanent", DonaCadena3("Citatió enviada", "Citación enviada", "Citation sent"));
	ajaxExecuteNB=new Ajax();	
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:CREATE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=CITATION"+"&TITLE="+target.title+
				"&ID_CODE="+target.code+"&ID_NAMESPACE="+target.code_space+
				"&URL_LINK=&URL_DESCRIP=&URL_FUNCTION=", AvaluaRespostaRetrieveTarget, "text/xml", 
				"SurtDeAddFeedbackCallBack");
	return false;
}

function MostraCitationResource(id)
{
	ChangePannel("citation-resource", true);
	IdResourceToSaveChanges=id;
	TargetResourceToSaveChanges="";
	document.getElementById("citation-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadena3("Nova citació", "Nueva citación", "New citation");
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadena3("Introdueix les característiques d'aquesta citació", "Introduce las características de esta citación", "Define the characteristics of this citation");
		document.getElementById("citation-resource_btn").value=DonaCadena3("Crear", "Crear", "Create");
		document.getElementById("citation-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadena3("Citació", "Citación", "Citation");
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadena3("Modifica les característiques d'aquesta citació", "Modifica las características de esta citación", "Modify the characteristics of this citation");
		document.getElementById("citation-resource_btn").value=DonaCadena3("Guardar canvis", "Guardar cambios", "Save changes");
		document.getElementById("feedback-resource-delete_btn").style.display='inline';
	}
}

function MostraShareResource(event, query, type)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);
	IdResourceToSaveChanges=id;
	TargetResourceToSaveChanges="";
	
	RetrieveShareAuthorizedList(type);
	EnumerateShareResource(id);

	ChangePannel("share", true);
}

/*This function draws the "Feedback items" form.*/
function MostraFeedbackList(event, query, type)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);
	IdResourceToSaveChanges=id;
	TargetResourceToSaveChanges="";  //No estic segur que estigui bé ·$·
	
	EnumerateFeedbackResource(id);
	PopulateCompactDescriptionResource(id, "feedback_target_compact_screen", "feedback_target_compact_descrip");

	ChangePannel("feedback", true);
}

function MostraTagResource(event, query)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);

	//IdResourceToSaveChanges=id;

	alert("Sorry, not implemented yet");
	
	//NewUserChangeTimeOut=0;
	//RetrieveUserData();
	//ChangePannel("tag", true);
}

function AvaluaRespostaShareEnumerate(doc, id)
{
var root, output, identifier, text_current_share_list, has_anonymous=false;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	text_current_share_list="";

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="borrower" ||
			    identifier.childNodes[0].nodeValue=="owner")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					var rights=GetValueXMLElementByName(nb_user, "nb_share", "rights");
					var user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					var name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					var email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					if (user=="Anonymous")
						has_anonymous=true;
					if (user==document.sign_in.user.value)  //soc jo mateix.
						text_current_share_list+=user + " (<i>"+DonaCadena3("Jo mateix", "Yo mismo", "Myself")+"</i>)";
					else
						text_current_share_list+=user+ " <i>" +name+ "</i>" + (email=="" ? "": " &lt;" +email+"&gt;");
					text_current_share_list += (rights.indexOf("R")==-1 ? "" : " " + DonaCadena3("Llegir", "Leer", "Read")+"<img src=\"check16.png\"/>") + (rights.indexOf("W")==-1 ? "" : " " + DonaCadena3("Escriure", "Escribir", "Write")+"<img src=\"check16.png\"/>") + (rights.indexOf("S")==-1 ? "" : " " + DonaCadena3("Compartir", "Compartir", "Share")+"<img src=\"check16.png\"/>") + (rights.indexOf("O")==-1 ? "" : " " + DonaCadena3("Propietari", "Propietario", "Owner")+"<img src=\"check16.png\"/>");
					if (identifier.childNodes[0].nodeValue=="borrower")
						text_current_share_list+=" <a href=\'javascript:void(0);\' onclick=\'DeleteShareResource(\""+user+"\")\'><img src=\"delete16.png\" border=\"0\"/></a>"
					text_current_share_list+="<br/>";
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	document.getElementById("current_share_list").innerHTML=text_current_share_list;
	document.getElementById("current_share_fieldset").style.display=(text_current_share_list=="") ? 'none' : 'inline';
	document.getElementById("new_share_open_fieldset").style.display=(has_anonymous) ? 'none': 'inline';
	return;
}

function EnumerateShareResource(id)
{	
	if (id==null)
	{
	        ShowInfo("long", DonaCadena3("Identificador de recurs no trobat.", "Identificador de recurso no encontrado.", "Cannot found resource identifier."));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+id, AvaluaRespostaShareEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));

	return true;
}

function AvaluaRespostaFeedbackEnumerate(doc, id)
{
var root, text_current_feedback_list;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=new ParseOWSContextAtom(root);

	ChangePannel("feedback", true);

	document.getElementById("current_feedback_fieldset").style.display=(!owc.features || owc.features.length) ? 'inline' : 'none';

	text_current_feedback_list="";
	if (owc.features)
	{
		for (var i=0; i<owc.features.length; i++)
		{
			//We are supposing that all the returned objects are of the same type: FEEDBACK

			text_current_feedback_list+=owc.features[i].properties.title;
			text_current_feedback_list+=" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadena3("Editar", "Editar", "Edit") +"\" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'FEEDBACK\')\"/>";
			text_current_feedback_list+="<br/>";			
		}
	}
	document.getElementById("current_feedback_list").innerHTML=text_current_feedback_list;

	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function EnumerateFeedbackResource(id)
{	
	if (id==null)
	{
	        ShowInfo("long", DonaCadena3("Identificador de recurs no trobat.", "Identificador de recurso no encontrado.", "Cannot found resource identifier."));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=FEEDBACK&TARGET="+id, AvaluaRespostaFeedbackEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));

	return true;
}

function AvaluaRespostaShareAuthorized(doc, no_usat)
{
var root, output, identifier, nb_user;
var user, name, email;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	//En aquest punt esborro el contingut del select si n'hi havia.
	while (document.share_form.new_share_select.options.length)
		document.share_form.new_share_select.options[0]=null;

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="authorized")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					document.share_form.new_share_select.options[document.share_form.new_share_select.options.length]=new Option(user+ "  " +name+ "  " +(email=="" ? "": "<" +email+">"), user);
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function RetrieveShareAuthorizedList(type)
{	
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:AUTHORIZED&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE="+type, AvaluaRespostaShareAuthorized, "text/xml", null);
        //En aquest cas no dic res: ShowInfo("permanent", DonaCadena3("Demanant dades...", "Pidiendo datos...", "Requesting data..."));

	return true;
}

function SurtDeAddShareCallBack()
{
	ShowInfo("short", DonaCadena3("Afegit", "Añadido", "Added"));
	EnumerateShareResource(IdResourceToSaveChanges);
}

function AddShareResource(tothom)
{	
	if (IdResourceToSaveChanges=="")
	{
	        ShowInfo("long", DonaCadena3("Identificador de recurs no trobat.", "Identificador de recurso no encontrado.", "Cannot found resource identifier."));
		return;
	}
	if (tothom)
	{
		ajaxExecuteNB=new Ajax();
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER=Anonymous&RIGHTS=R", AvaluaResposta, "text/xml", "SurtDeAddShareCallBack");
	}
	else
	{
		if (document.share_form.new_share.value=="")
		{
			ShowInfo("long", DonaCadenaIdNoPotSerBuit("new_share_screen"));
			return false;
		}
		ajaxExecuteNB=new Ajax();
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+document.share_form.new_share.value+"&RIGHTS=R"+(document.share_form.W.checked ? "W":"")+(document.share_form.S.checked ? "S":""), AvaluaResposta, "text/xml", 
				"SurtDeAddShareCallBack");
	}
        ShowInfo("permanent", DonaCadena3("Afegint...", "Añadiendo...", "Adding..."));

	return true;
}

function SurtDeDeleteShareCallBack()
{
	ShowInfo("short", DonaCadena3("Esborrat", "Eliminado", "Deleted"));
	EnumerateShareResource(IdResourceToSaveChanges);
}

function DeleteShareResource(user)
{	
	if (IdResourceToSaveChanges=="")
	{
	        ShowInfo("long", DonaCadena3("Identificador de recurs no trobat.", "Identificador de recurso no encontrado.", "Cannot found resource identifier."));
		return;
	}
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:DELETE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+user, AvaluaResposta, "text/xml", 
				"SurtDeDeleteShareCallBack");
        ShowInfo("permanent", DonaCadena3("Eliminant...", "Eliminando...", "Deleting..."));

	return false;
}


function ShowShareAuthorizedList()
{
	if (document.share_form.new_share_select.options.length)
		document.getElementById("new_share_select").style.display='inline';
}

function HideShareAuthorizedList()
{
	document.getElementById("new_share_select").style.display='none';
}

function SelectionShareAuthorizedList()
{
	if (document.share_form.new_share_select.selectedIndex!=-1)
		document.share_form.new_share.value=document.share_form.new_share_select.options[document.share_form.new_share_select.selectedIndex].value;
}

function SendHRefResourceChanges()
{
var s,s2;
	if (document.href_resource_form.href.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("href-href-resource_screen"));
		return false;
	}
	if (document.href_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-href-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadena3("Recurs enviat", "Recurso enviado", "Resource sent"));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadena3("Modificacions enviades", "Modificaciones enviadas", "Modifications sent"));
	}
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=HREF"+"&HREF="+DonaCadenaPerValorDeFormulari(document.href_resource_form.href.value)+"&MIMETYPE="+document.href_resource_form.mimetype.value+"&TITLE="+DonaCadenaPerValorDeFormulari(document.href_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.href_resource_form.reason.value)+s2, AvaluaResposta, "text/xml", 
				"SurtDeHRefResourceChangesCallBack");
	return false;
}

function SendPoiResourceChanges()
{
var s,s2;
	if (document.poi_resource_form.long.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("long-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.lat.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("lat-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-poi-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadena3("Recurs enviat", "Recurso enviado", "Resource sent"));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadena3("Modificacions enviades", "Modificaciones enviadas", "Modifications sent"));
	}
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=POI"+"&POSITION=<georss:where><gml:Point><gml:pos>" + document.poi_resource_form.lat.value+ " " +document.poi_resource_form.long.value+ "</gml:pos></gml:Point></georss:where>" + (document.poi_resource_form.elevation.value=="" ? "" : "&ELEVATION=<georss:elev>"+document.poi_resource_form.elevation.value+"</georss:elev>") + "&TITLE="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.reason.value)+"&POS_ACCURACY="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.pos_accur.value)+s2, AvaluaResposta, "text/xml", 
				"SurtDePoiResourceChangesCallBack");
	return false;
}

function SendFeedbackResourceChanges()
{
var s,s2;
	if (document.feedback_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-feedback-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadena3("Recurs enviat", "Recurso enviado", "Resource sent"));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadena3("Modificacions enviades", "Modificaciones enviadas", "Modifications sent"));
	}
	if (TargetResourceToSaveChanges!="")
		s2+="&TARGET_1="+TargetResourceToSaveChanges+"&TARGET_ROLE_1="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.targetRole);

	ajaxExecuteNB=new Ajax();	
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=FEEDBACK"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.title.value)+
				"&REASON="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.reason.value)+"&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.abstract.value)+
				"&CONTACT_ROLE="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.contactRole)+"&COMMENT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.comment.value)+
				"&MOTIVATION="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.motivation)+"&RATING="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.rating)+s2, AvaluaResposta, "text/xml", 
				"SurtDeFeedbackResourceChangesCallBack");
	return false;
}

function SendCitationResourceChanges()
{
var s,s2;
	if (document.citation_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-citation-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	        ShowInfo("permanent", DonaCadena3("Recurs enviat", "Recurso enviado", "Resource sent"));
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	        ShowInfo("permanent", DonaCadena3("Modificacions enviades", "Modificaciones enviadas", "Modifications sent"));
	}
	ajaxExecuteNB=new Ajax();	
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&TYPE=CITATION"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.title.value)+
				"&ID_CODE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_code.value)+"&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_namespace.value)+
				"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_link.value)+"&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_descrip.value)+
				"&URL_FUNCTION="+DonaCadenaCodelistDeSelect(document.citation_resource_form.function_code)+s2, AvaluaResposta, "text/xml", 
				"SurtDeCitationResourceChangesCallBack");
	return false;
}


function SendResourceDelete(type)
{
var SurtDeResourceDeleteCallBack, s;

	s=DonaCadena3("Estàs segur que vols eliminar del tot ", "¿Está seguro que desea eliminar completamente ", "Are you sure that you want to completely delete this ");

	if (type=="HREF")
		s+=DonaCadena3("aquest hiperenllaç", "este hiperenllace", "hiperlink");
	else if (type=="POI")
		s+=DonaCadena3("aquest punt d'interés", "este punto de interés", "point of interest");
	else if (type=="FEEDBACK")
		s+=DonaCadena3("aquesta valoració", "esta valoración", "feedback item");
	else if (type=="CITATION")
		s+=DonaCadena3("aquesta citació", "esta citación", "citation");
	else
	{
	        ShowInfo("long", DonaCadena3("Tipus de recurs no identificat", "Tipo de recurso no identificado", "Unidentified resource type"));
		return false;
	}
	s+="?";

	if (false==confirm(s))
		return false;

	if (type=="HREF")
		SurtDeResourceDeleteCallBack="SurtDeHRefResourceDeleteCallBack"
	else if (type=="POI")
		SurtDeResourceDeleteCallBack="SurtDePoiResourceDeleteCallBack"
	else if (type=="FEEDBACK")
		SurtDeResourceDeleteCallBack="SurtDeFeedbackResourceDeleteCallBack"
	else if (type=="CITATION")
		SurtDeResourceDeleteCallBack="SurtDeCitationResourceDeleteCallBack"
	else
		return false;

	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:DELETE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&RESOURCE="+IdResourceToSaveChanges,
				 AvaluaResposta, "text/xml", "SurtDeResourceDeleteCallBack");
        ShowInfo("permanent", DonaCadena3("Petició enviada", "Petición enviada", "Request sent"));
	return false;
}

function SurtDeHRefResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadena3("Vol sortir sense guardar?", "¿Desea salir sin guardar?", "Do you want to exit without saving changes?")))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDeHRefResourceChangesCallBack()
{
	ShowInfo("short", DonaCadena3("Canvis guardats", "Cambios guardados", "Changes send"));
	SurtDeHRefResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDeHRefResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadena3("Hiperenllaç esborrat", "Hiperenllace eliminado", "Hiperlink deleted"));
	SurtDeHRefResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDePoiResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadena3("Vol sortir sense guardar?", "¿Desea salir sin guardar?", "Do you want to exit without saving changes?")))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDePoiResourceChangesCallBack()
{
	ShowInfo("short", DonaCadena3("Canvis guardats", "Cambios guardados", "Changes send"));
	SurtDePoiResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDePoiResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadena3("Punt d'interés esborrat", "Punto de interés eliminado", "Point of interest deleted"));
	SurtDePoiResourceChanges(false);
	EnumerateResources(1, true);
}

function GetPoiFromDeviceCallBack(position) 
{
var d;
	setTimeout("RemoveInfo('permanent');ShowInfo('short', DonaCadena3('Fet', 'Hecho', 'Done'));", 1200);
	
	document.poi_resource_form.long.value=position.coords.longitude;
	/*document.getElementById("long-poi-resource_alert").style.display='inline';
	document.getElementById("long-poi-resource_alert").innerHTML=DonaCadena3("Exactitud", "Exactitud", "Accuracy")+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.lat.value=position.coords.latitude;
	/*document.getElementById("lat-poi-resource_alert").style.display='inline';
	document.getElementById("lat-poi-resource_alert").innerHTML=DonaCadena3("Exactitud", "Exactitud", "Accuracy")+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.pos_accur.value=position.coords.accuracy+"m";

	if (position.coords.altitude)
	{
		document.poi_resource_form.elevation.value=position.coords.altitude;
		document.getElementById("elevation-poi-resource_alert").style.display='inline';
		if (position.coords.coords.altitudeAccuracy)
			document.getElementById("elevation-poi-resource_alert").innerHTML=DonaCadena3("Exactitud", "Exactitud", "Accuracy")+": "+position.coords.coords.altitudeAccuracy+" m";
	}
	document.getElementById("reason-poi-resource_alert").style.display='inline';
	d = new Date(position.timestamp);
	document.getElementById("reason-poi-resource_alert").innerHTML=DonaCadena3("Obtinguda a les", "Obtenida a las", "Got it at") + ": " + DonaDataJSComAText(d) +". ";
	if (position.coords.speed && position.coords.speed!=0.0)
	{
		document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadena3("Velocitat", "Velocidad", "Speed")+": "+position.coords.speed*3.6 + " km/h. ";
		if (position.coords.heading)
			document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadena3("Direcció", "Dirección", "Heading")+": "+position.coords.heading + ".";
	}
}

function GetPoiFromDeviceErrorCallBack(error)
{
	switch (error.code) 
	{
		case error.PERMISSION_DENIED:
			ShowInfo("long", DonaCadena3("L'usuari ha denegat la petició de geolocalització.", "El usuario ha denegado la petición de geolocalización.", "User denied the request for Geolocation."));
			break;
	        case error.POSITION_UNAVAILABLE:
			ShowInfo("long", DonaCadena3("La informació de geolocalització no està disponible.", "La informació de geolocalització no està disponible", "Location information is unavailable."));
			break;
        	case error.TIMEOUT:
			ShowInfo("long", DonaCadena3("La petició per obtenir la geolocalitzacion ha caducat.", "La petición para obtenir la geolocalización ha caducado.", "The request to get user location timed out."));
			break;
		case error.UNKNOWN_ERROR:
		default:
			ShowInfo("long", DonaCadena3("Error desconnegut en la geolocalització.", "Error desconocido en la geolocalización.", "Unknown error occurred in geolocation."));
			break;
	}
}

var TimeOutGPS=0;

function GetPoiFromDevice()
{
	if (navigator.geolocation) 
	{
		ShowInfo("permanent", DonaCadena3("Intentant obtenint la informació de geolocalització", "Intentando obtener la información de geolocalización", "Trying to get the geolocation information"));
		navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack);		
		if (TimeOutGPS)
			clearTimeout(TimeOutGPS);
		TimeOutGPS=setTimeout("ShowInfo('short', DonaCadena3('Intentant obtenint més exactitud', 'Intentando obtener más exactitud', 'Trying to get more accuracy'));navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack, {maximumAge:600000, timeout:12000, enableHighAccuracy: true});", 1800);
	}
	else 
		ShowInfo("long", DonaCadena3("La geolocalització des del dispositiu no està suportada en aquest navegador d'Internet", "La geolocalización desde el dispositivo no está suportada en este navegador de Internet", "Geolocation is not supported by this Internet browser"));
}

function SurtDeFeedbackResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadena3("Vol sortir sense guardar?", "¿Desea salir sin guardar?", "Do you want to exit without saving changes?")))
			return false;
	}
	if (ActionAfterSignIn==EntraAAddFeedback)
	{
		window.onbeforeunload=null;
		window.close();
	}
	else
		ChangePannel("resources", true);
}

function SurtDeFeedbackResourceChangesCallBack()
{
	ShowInfo("short", DonaCadena3("Canvis guardats", "Cambios guardados", "Changes send"));
	SurtDeFeedbackResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDeFeedbackResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadena3("Valoració esborrada", "Valoración eliminada", "Feedback deleted"));
	SurtDeFeedbackResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDeCitationResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadena3("Vol sortir sense guardar?", "¿Desea salir sin guardar?", "Do you want to exit without saving changes?")))
			return false;
	}
	ChangePannel("resources", true);
}

function SurtDeCitationResourceChangesCallBack()
{
	ShowInfo("short", DonaCadena3("Canvis guardats", "Cambios guardados", "Changes send"));
	SurtDeCitationResourceChanges(false);
	EnumerateResources(1, true);
}

function SurtDeCitationResourceDeleteCallBack()
{
	ShowInfo("short", DonaCadena3("Citació esborrada", "Citación eliminada", "Citation deleted"));
	SurtDeCitationResourceChanges(false);
	EnumerateResources(1, true);
}


function EntraAAccountCallBack()
{
	document.sign_in.user.value=document.sign_up.user.value;
	document.sign_in.pass.value=document.sign_up.pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadena3("Avui", "Hoy", "Today");

	EntraANimmbus(true);
	MostraAccount(true);
}

function SignUpNB()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_up.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_up.pass.value), AvaluaResposta, "text/xml", "EntraAAccountCallBack");
        ShowInfo("permanent", DonaCadena3("Missatge enviat", "Mensage enviado", "Message sent"));
	return false;
}

function EntraANewAccountCallBack()
{
	//document.getElementById("new-user-page").style.visibility="hidden";
	document.sign_in.user.value=document.new_user_form.new_user.value;
	document.sign_in.pass.value=document.new_user_form.new_pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadena3("Avui", "Hoy", "Today");

	EntraANimmbus(true);
	MostraAccount(true);
}

function SendNewUserNB()
{
var s;
	RemoveInfo("long");

	if (PendingToken=="")
		s="";
	else
		s="&TOKEN="+PendingToken;

	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&USER="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_pass.value)+"&EMAIL="+DonaCadenaPerValorDeFormulari(document.new_user_form.email.value)+s, AvaluaResposta, "text/xml", "EntraANewAccountCallBack");
        ShowInfo("permanent", DonaCadena3("Missatge enviat", "Mensage enviado", "Message sent"));
	return false;
}

function EntraANimmbus(es_nou)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("main-page").style.visibility="visible";
	//ChangePannel("main-page", true);
	if (es_nou)
		document.getElementById("new-resource").style.display="none";
	document.getElementById("main-left-pannel-title-text").innerHTML=document.sign_in.user.value;  //This is going to be replaced by the name and surname latter.
	document.getElementById("main-left-pannel-subtitle-text").innerHTML=document.sign_in.user.value;
}

function EntraANimmbusMain()
{
	EntraANimmbus(false);
	RetrieveUserMinPreferences();
	EnumerateResources(1, true);
}

function EntraAResetPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("reset-pass-page").style.visibility="visible";
	ChangePannel("reset-pass-page",true);
}

function EntraANewPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-pass-page").style.visibility="visible";
	ChangePannel("new-pass-page",true);
}

function EntraANewUser(email)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-user-page").style.visibility="visible";
	ChangePannel("new-user-page",true);	
	document.new_user_form.email.value=email;
}

function EntraAExecuteToken()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("execute-token-page").style.visibility="visible";
	ChangePannel("execute-token-page",true);	
	if (document.getElementById("execute-token-subtitle-text").innerHTML!="")
	        document.title = document.getElementById("execute-token-subtitle-text").innerHTML;
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&USER="+document.sign_in.user.value, AvaluaResposta, "text/xml", 
				"SurtDeExecuteTokenCallBack");
        ShowInfo("permanent", DonaCadena3("Solicitant...", "Solicitando...", "Requesting..."));
}

function EntraAIdentificioNimmbus()
{
	ChangePannel("front-page", true);
}

function SurtDeExecuteTokenCallBack()
{
	//document.getElementById("execute-token-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeResetPasswordCallBack()
{
	//document.getElementById("reset-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNewPasswordCallBack()
{
	//document.getElementById("new-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNimmbus()
{
	SurtDeAccount();
	//document.getElementById("main-page").style.visibility="hidden";
	//document.getElementById("resources").style.visibility="hidden";
	EntraAIdentificioNimmbus();
	//window.scrollTo(0, 0);
}

function SurtDeAccount()
{
	//ChangePannel("resources", false);
	document.getElementById("new_user_alert").style.display="none";
	document.getElementById("current_pass_alert").style.display="none";
	document.getElementById("new_pass_alert").style.display="none";
	document.getElementById("new_pass_valid_alert").style.display="none";
	document.getElementById("new-resource").style.display="inline";	
}

/*function SurtDeShare()
{
	ChangePannel("resources", true);
	return false;
}*/

function SurtIRetornaAResources()
{
	ChangePannel("resources", true);
	return false;
}

function SurtDeAccountCallBack()
{
	if (document.account_form.new_pass.value!="")
		document.sign_in.pass.value=document.account_form.new_pass.value;
	if (document.sign_in.user.value!=document.account_form.new_user.value)
		document.sign_in.user.value=document.account_form.new_user.value;
	document.getElementById("main-left-pannel-title-text").innerHTML=document.account_form.name.value;

	ChangeLanguage(ActiveLanguage=document.account_form.language.selectedIndex);
	ShowInfo("short", DonaCadena3("Canvis guardats", "Cambios guardados", "Changes send"));
	SurtDeAccount();
	ChangePannel("resources", true);
}

function SendAccountChanges()
{
	if (NewUserChangeTimeOut)
		clearTimeout(NewUserChangeTimeOut);
	if (document.account_form.current_pass.value!="" && document.account_form.current_pass.value!=document.sign_in.pass.value)
	{
		ShowInfo("long", DonaCadena3("La teva contrasenya actual no coincideix amb la que has indicat.", "Su contraseña actual no coincide con la que ha indicado.", "Your current password does not match with the one provided."));
		return false;
	}
	if (document.account_form.new_pass.value!="" && document.account_form.new_pass.value!=document.account_form.new_pass_valid.value)
	{
		ShowInfo("long", DonaCadena3("La nova contrasenya no coincideix amb la de validació.", "Su nueva contraseña no coincide con la de validación.", "Your new password does not match with the validation one."));
		return false;
	}
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:MODIFY&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+"&NEW_USER="+((document.account_form.new_user.value==document.sign_in.user.value) ? "" : DonaCadenaPerValorDeFormulari(document.account_form.new_user.value))+"&NEW_PASSWORD="+DonaCadenaPerValorDeFormulari(document.account_form.new_pass.value)+
				"&EMAIL="+DonaCadenaPerValorDeFormulari(document.account_form.email.value)+"&NAME="+DonaCadenaPerValorDeFormulari(document.account_form.name.value)+"&BIO="+DonaCadenaPerValorDeFormulari(document.account_form.bio.value), AvaluaResposta, "text/xml", 
				"SurtDeAccountCallBack");
        ShowInfo("permanent", DonaCadena3("Missatge enviat", "Mensage enviado", "Message sent"));
	return false;
}

function SendPasswordReset()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RESETPASSWORD&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&USER="+DonaCadenaPerValorDeFormulari(document.reset_pass_form.user.value), AvaluaResposta, "text/xml", 
				"SurtDeResetPasswordCallBack");
        ShowInfo("permanent", DonaCadena3("Cercant...", "Buscando...", "Searching..."));
	return false;
}

function SendNewPasswordToken()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_pass_form.new_pass.value), AvaluaResposta, "text/xml", 
				"SurtDeNewPasswordCallBack");
        ShowInfo("permanent", DonaCadena3("Canviat...", "Canviando...", "Changing..."));
	return false;
}

function GetWPSProcessIdentifierName(root)
{
var process, identifier;
	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		identifier=GetXMLElementByName(process, "ows", "Identifier");
		if (identifier)
			return identifier.childNodes[0].nodeValue;
	}
	return null;
}


var NewUserChangeTimeOut=0;
var NewPassChangeTimeOut=0;

function EscriuStatusAElement(doc, user_pass)
{
var root, output, identifier, process_name;
var elem;

	elem=document.getElementById(user_pass.alert_id);
	root=DonaRootXML(doc, document);
	if (!root || AnalitzaExceptionReport(root, document))
	{
		NewUserChangeTimeOut=0;
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}

	process_name=GetWPSProcessIdentifierName(root);
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (process_name && output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier && identifier.childNodes[0].nodeValue=="statusCode")
			{					
				var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				if (s!="")
				{
					if (process_name=="NB_USER:AVAILABLE")
					{
						if (s=="available")
							elem.innerHTML=DonaCadena3("Disponible!", "¡Disponible!", "Available!");
						else if (s=="empty")
							elem.innerHTML=DonaCadena3("El nom d'usuari no pot ser buit", "El nombre de usuario no puede ser blanco", "Username can't be blank");
						else if (s=="same")
							elem.innerHTML=DonaCadena3("El nom d'usuari és el que ja tens", "El nombre de usuario es el que ya tiene", "Username is what you already have");
						else if (s=="taken")
							elem.innerHTML=DonaCadena3("El nom d'usuari ha estat reservada per altres", "El nombre de usuario ha sido reservado por otros", "Username has already been taken");							
						UpdateLastServer();
					}
					else if (process_name=="NB_USER:GOODPASSWORD")
					{
						if (s=="strong")
							elem.innerHTML=DonaCadena3("Robusta", "Robusta", "Strong");
						else if (s=="medium")
							elem.innerHTML=DonaCadena3("Robustesa mitjana", "Robustez media", "Medium");
						else if (s=="weak")
							elem.innerHTML=DonaCadena3("Fràgil", "Frágil", "Weak");
						else if (s=="user")
							elem.innerHTML=DonaCadena3("No pot contenir el nom d'usuari", "No puede contener el nombre de usuario", "Cannot contain the user name");							
						else if (s=="short")
							elem.innerHTML=DonaCadena3("Massa curta", "Demasiado corta", "Too short");							
						CheckPassValidCorrectness(user_pass.pass_valid_alert_id, user_pass.pass, user_pass.pass_valid);
						UpdateLastServer();
					}
					else
					{
						alert("Known process id: "+ process_name);
						TiraAPantallaRespostaSiNoEntenc(root, document);
						elem.style.display="none";
					}
				}
			}
		}
	}
	else
	{
		TiraAPantallaRespostaSiNoEntenc(root, document);
		elem.style.display="none";
	}
	NewUserChangeTimeOut=0;
	NewPassChangeTimeOut=0;
	return;
}


function CheckNewUserCorrectness(alert_id, new_user, user)
{
	elem=document.getElementById(alert_id);
	elem.style.display="inline";
	elem.innerHTML=DonaCadena3("Comprobant...", "Comprobando...", "Checking...");
	var user_pass = {alert_id:alert_id};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:AVAILABLE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user)+
				"&NEW_USER="+DonaCadenaPerValorDeFormulari(new_user), EscriuStatusAElement, "text/xml", 
				user_pass);
}

function NewUserInputChange()
{
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new_user_alert\", document.account_form.new_user.value, document.sign_in.user.value);",1500);
}

function NewUserUserInputChange()
{
	if (document.new_user_form.new_user.value=="")
	{
		document.getElementById("new-user_new_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new-user_new_user_alert\", document.new_user_form.new_user.value, \"\");",1500);
}

function SignUpUserInputChange()
{
	if (document.sign_up.user.value=="")
	{
		document.getElementById("sign_up_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"sign_up_user_alert\", document.sign_up.user.value, \"\");",1500);
}

function CheckNewPassCorrectness(pass_alert_id, pass_valid_alert_id, user, pass, pass_valid)
{
	elem=document.getElementById(pass_alert_id);
	if (pass=="")
	{
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}
	elem.style.display="inline";
	elem.innerHTML=DonaCadena3("Comprobant...", "Comprobando...", "Checking...");
	var user_pass = {alert_id:pass_alert_id, pass_valid_alert_id:pass_valid_alert_id, pass:pass, pass_valid:pass_valid};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:GOODPASSWORD&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user) +
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(pass), EscriuStatusAElement, "text/xml", user_pass);
}

function NewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new_pass_alert\", \"new_pass_valid_alert\", (document.account_form.new_user.value==\"\") ? document.sign_in.user.value : document.account_form.new_user.value, document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}

function NewPassNewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-pass_new_pass_alert\", \"new-pass_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-user_new_pass_alert\", \"new-user_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"sign_up_pass_alert\", \"sign_up_pass_valid_alert\", document.sign_up.user.value, document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var PassValidChangeTimeOut=0;

function CheckPassValidCorrectness(alert_id, pass, pass_valid)
{
	if (pass=="" || pass_valid=="") 
	{
		document.getElementById(alert_id).style.display="none";
	}
	else
	{
		document.getElementById(alert_id).style.display="inline";

		if (pass==pass_valid)
			document.getElementById(alert_id).innerHTML=DonaCadena3("Correcte!", "¡Correcto!", "Ok!");
		else
			document.getElementById(alert_id).innerHTML=DonaCadena3("Error de verificació de contrasenya", "Error de verificación de contraseña", "Password verification error");
	}
	PassValidChangeTimeOut=0;
	return;
}

function PassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new_pass_valid_alert\", document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}


function NewPassPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-pass_new_pass_valid_alert\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-user_new_pass_valid_alert\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"sign_up_pass_valid_alert\", document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var CurrentPassChangeTimeOut=0;

function CheckCurrentPassCorrectness()
{
	if (document.account_form.current_pass.value=="") 
	{
		document.getElementById("new_pass_alert").style.display="none";
	}
	else
	{
		document.getElementById("current_pass_alert").style.display="inline";
	
		if (document.account_form.current_pass.value==document.sign_in.pass.value)
			document.getElementById("current_pass_alert").innerHTML=DonaCadena3("Correcta!", "¡Correcta!", "Ok!");
		else
			document.getElementById("current_pass_alert").innerHTML=DonaCadena3("Contrasenya incorrecta", "Contraseña incorrecta!", "Wrong password");
	}
	CurrentPassChangeTimeOut=0;
	return;
}

function CurrentPassInputChange()
{
	if (CurrentPassChangeTimeOut==0)
		CurrentPassChangeTimeOut=setTimeout("CheckCurrentPassCorrectness();",1500);
}

</script>

<style>
.text-input:focus {
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) inset, 0 0 8px rgba(82, 168, 236, 0.6);
}

.text-input {
  border: 1px solid #56B4EF;
  height: 29px;
  transition: background 0.2s linear 0s;
  box-shadow: 0 1px 0 #EEEEEE inset, 0 1px 0 #FFFFFF;
  border-radius: 3px;
  font-size: 13px;
  font-family: "Gotham Narrow SSm",sans-serif;
  line-height: 20px;
  padding: 4px;
}

.submit_btn {
  border-radius: 4px;
  box-shadow: 0 1px 0 #FFFFFF;
  line-height: 11px;
  background-color: #55ACEE;
  background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.05));
  border: 1px solid #3B88C3;
  color: #FFFFFF;
  font-size: 14px;
  font-weight: bold;
  padding: 8px 16px;
}

.submit_btn:hover {
  background-color: #3B88C3;
}

.submit_btn_disable {
  border-radius: 4px;
  box-shadow: 0 1px 0 #FFFFFF;
  line-height: 11px;
  background-color: #55ACEE;
  background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.05));
  border: 1px solid #3B88C3;
  color: #CCCCCC;
  font-size: 14px;
  font-weight: bold;
  padding: 8px 16px;
}


.packet_paragraph {
  margin: 0 0 0 0;
}

.front-bg {
  background: none repeat scroll 0 0 #000000;
  height: 200%;
  left: -50%;
  top: -2%;
  position: fixed;
  width: 200%;
  z-index: -1;
}

.front-bg img {
  bottom: 0;
  display: none;
  left: 0;
  margin: auto;
  min-height: 50%;
  min-width: 50%;
  right: 0;
  top: 0;
}

.front-welcome-text { 
  bottom: 0;
  color: #CCD6DD;
  font-size: 20px;
  font-weight: 300;
  left: 10%;
  top: 130px;
  width: 33%;
  height: 330px;
  line-height: 22px;
  padding: 20px;
  position: absolute;
  text-align: left;
  text-shadow: 0 1px 2px #000000;
  font-family: "Gotham Narrow SSm",sans-serif;
  //background-color: #55EEAC;
  background-color: #33AA77;
}

.front-language {
  background: none repeat scroll 0 0 #FFFFFF;
  bottom: 0;
  color: #66757F;
  left: 80%;
  top: 20px;
  width: 150px;
  height: 30px;
  line-height: 22px;
  padding: 20px;
  position: absolute;
  text-align: left;
  font-family: "Gotham Narrow SSm",sans-serif;
  border-radius: 4px;
  border: 1px solid #C1C8CD;
}

.dropdown-list {
  background: none repeat scroll 0 0 #FFFFFF;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.25);
  bottom: 0;
  color: #66757F;
  line-height: 22px;
  padding: 20px;
  position: absolute;
  text-align: left;
  font-family: "Gotham Narrow SSm",sans-serif;
  border-radius: 4px;
  border: 1px solid #C1C8CD;
  visibility: hidden;
  z-index: 100;
  cursor: pointer;
}

.dropdown-language {
    //background-color: black;
    //color: white;
    display: block;
    text-decoration: none;
    text-align: center;
    cursor: pointer;
    white-space: nowrap;
}

.dropdown-list_active {
    //background-color: black;
    //color: white;
    display: block;
    text-decoration: none;
    text-align: left;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.2s linear 0s;
}

.dropdown-list_active:hover {
    background-color: #3B88C3;
    color: white;
    display: block;
    text-decoration: none;
    text-align: left;
    cursor: pointer;
    white-space: nowrap;
}

.dropdown-caret {
    left: 60;
    float: left;
    height: 10px;
    overflow: hidden;
    position: absolute;
    top: -10px;
    width: 18px;
}

.caret-outer {
    border-bottom: 10px solid rgba(0, 0, 0, 0.1);
    border-left: 10px solid rgba(0, 0, 0, 0);
    border-right: 10px solid rgba(0, 0, 0, 0);
    height: auto;
    left: 0;
    top: 0;
    width: auto;
    display: inline-block;
    margin-left: -1px;
    position: absolute;
}

.caret-inner {
    border-bottom: 9px solid rgba(255, 255, 255, 0.98);
    border-left: 9px solid rgba(0, 0, 0, 0);
    border-right: 9px solid rgba(0, 0, 0, 0);
    left: 1px;
    top: 1px;
    display: inline-block;
    margin-left: -1px;
    position: absolute;
}

.white-area {
  background: none repeat scroll 0 0 #FFFFFF;
  bottom: 0;
  //color: #CCD6DD;
  color: #66757F;
  font-size: 14px;
  font-weight: 300;
  line-height: 22px;
  padding: 20px;
  position: absolute;
  text-align: left;
  //text-shadow: 0 1px 2px #000000;
  font-family: "Gotham Narrow SSm",sans-serif;
  border-radius: 4px;
  border: 1px solid #C1C8CD;
  z-index: 2;
  display: table;  //Auto sizes height if content is too long
}

.white-area-title {
  margin: 0 0 10px 0;
  border-bottom: 1px solid #E1E8ED;
  //;box-shadow: 0 1px 0 #FFFFFF;
  color: #66757F;
  display: block;
  font-size: 18px;
  font-weight: 300;
  //position: relative;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6);
}

.white-area-list {
  list-style: none outside none;
  margin-left: 0;
  padding: 0;
}

.white-area-li {
  display: table;
  width: 100%;
  border-bottom: 1px solid #e1e8ed;
  min-height: 68px;
  cursor: pointer;
}

.white-area-li:hover {
    background-color: #f5f8fa;
}

.white-area-li-text {
  padding: 9px 12px 9px 60px;
  list-style: none outside none;
}

.white-area-li-text-link {
    text-decoration: none;
    color: #0084B4;
}

.white-area-li-text-link:active, .white-area-li-text-link:focus, .white-area-li-text-link:hover{
    text-decoration: underline;
}


.white-area-li-img {
  float: left;
  margin-left: -58px;
  margin-top: 3px;
  -moz-force-broken-image-icon: 1;
  border-radius: 5px;
  height: 48px;
  width: 48px;
  border: 0 none;
}

.white-area-li-shadow {
  font-size: 11px;
  color: #CCCCCC;
  position: relative;
  left: 30; 
}

.white-area-li-shadow:hover {
  font-size: 11px;
  color: #66757F;
}

.white-area-li-shadow-link {
    text-decoration: none;
    color: inherit;
}

.white-area-li-shadow-link:active, .white-area-li-shadow-link:focus, .white-area-li-shadow-link:hover{
    color: #0084B4;
    text-decoration: underline;
}


/* inspirat amb http://stackoverflow.com/questions/114543/how-to-horizontally-center-a-div-in-a-div */
.long-note-outer {
    position: fixed;
    text-align: center;
    top: 30;
    width: 100%;
    z-index: 98;
}

.short-note-outer {
    position: fixed;
    text-align: center;
    top: 0;
    width: 100%;
    z-index: 98;
}

.note-inner {
    overflow: hidden; 
    line-height: 110%;
    font-family: "Gotham Narrow SSm",sans-serif;
    background: #fde073;
    display: table;
    margin: 0 auto;
    -webkit-box-shadow: 0 0 5px black;
    -moz-box-shadow:    0 0 5px black;
    box-shadow:         0 0 5px black;
    border-radius: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 2px;
    padding-bottom: 2px;
    opacity: 0;
    z-index: 101;
    transition: opacity 0.3s cubic-bezier(0.42, 0, 0.58, 1);
}

.caret {
  margin-top: 0;  
  vertical-align: middle;
  border-left: 4px solid rgba(0, 0, 0, 0);
  border-right: 4px solid rgba(0, 0, 0, 0);
  border-top: 4px solid #66757F;
  display: inline-block;
  height: 0;
  margin-left: 2px;
  margin-top: 5px;
  width: 0;
}

.main-page-bar {
  background: none repeat scroll 0 0 #FFFFFF;
  top: 0px;
  left: 0px;
  color: #CCD6DD;
  font-size: 14px;
  font-weight: 300;
  width: 100%;
  height: 40px;
  padding: 0px;
  position: fixed;
  text-align: left;
  font-family: "Gotham Narrow SSm",sans-serif;
  border-bottom: 1px solid #e1e8ed;
  z-index: 97;
}

.tooltip {
    text-decoration: none;
    text-align: center;
    width: 100px;
    white-space: nowrap;
    position: absolute;
    font-size: 14px;
    line-height: normal;
    opacity: 0;
    transition: opacity 0.3s cubic-bezier(0.42, 0, 0.58, 1);
    /* Safari */
    -webkit-transition; opacity 0.3s cubic-bezier(0.42, 0, 0.58, 1);
    z-index: 99;
}

.tooltip-caret {
  margin-top: 0;  
  margin-bottom: 0;  
  vertical-align: middle;
  border-left: 6px solid rgba(0, 0, 0, 0);
  border-right: 6px solid rgba(0, 0, 0, 0);
  border-bottom: 6px solid #000000;
  display: inline-block;
  height: 0;
  //margin-left: 3px;
  //margin-top: 5px;
  width: 0;
}

.tooltip-text {
    border-top: 1px solid #000000;
    border-bottom: 1px solid #000000;
    border-left: 3px solid #000000;
    border-right: 3px solid #000000;
    background-color: #000000;
    color: white;
    border-radius: 3px;
}

.control-group {
    display: table;
    clear: both;
    margin-bottom: 15px;
    width: 95%
}

.control-label {
    border-bottom: 0 none;
    float: left;
    font-size: 13px;
    line-height: 20px;
    margin: 0;
    padding-top: 5px;
    text-align: right;
    width: 120px;
    color: #292F33;
    cursor: pointer;
    display: block;
}

.controls {
    margin-left: 140px;
}

.controls p {
    color: #8899A6;
    margin: 0;
}

.form-actions {
    margin: 20px 0 8px;
    padding-left: 140px;
}

.text_button {
    color: #0084B4;
    cursor: pointer;
}

.text_button:active, .text_button:focus, .text_button:hover {
    color: #0084B4;
    text-decoration: underline;
}


</style>
</head>


<body onLoad="InitFrontPage();">

<div class="long-note-outer">
<div id="long-note" class="note-inner"></div>
</div>

<div class="short-note-outer">
<div id="short-note" class="note-inner"></div>
</div>

<!-- *** IDENTIFICATION FRONT PAGE *** -->

<div id="front-page">

<div class="front-bg">
<img src="topoorto.jpg" style="display: block;">
</div>


<div class="front-welcome-text">
<h1 id="front-welcome-text-title" style="line-height: normal; margin: 0px">Benvinguts al NiMMbus.</h1>
<p id="front-welcome-text-subtitle" style="margin: 10px"></p>
<br>
<img src="NiMMbus.png" style="display: block;">
<table><tr><td><img src="nextgeoss36.png" style="display: block;"><img src="prj730329.png" style="display: block;"></td><td><img src="OGC_WPS_GUF.png" width="100" style="display: block;"></td></tr></table>
</div>

<div class="front-language">
<a class="dropdown-language" id="dropdown-language" onClick="SwitchDropDownList('dropdown-language', 'front-language-list');">
<span id="front-language-lang">
Language: English
</span>
<b class="caret"></b>
</a>
</div>

<div id="front-language-list" class="dropdown-list" style="left: 85%; top: 70px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a class="dropdown-list_active" onClick="ChangeLanguage(0);SwitchDropDownList('dropdown-language', 'front-language-list');">
Català</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(1);SwitchDropDownList('dropdown-language', 'front-language-list');">
Español</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(2);SwitchDropDownList('dropdown-language', 'front-language-list');">
English</a>
</div>

<div class="white-area" style="left: 50%; top: 130px; width: 300px; height: 80px;">
<form id="sign_in" name="sign_in" class="packet_paragraph" method="get" onSubmit="return SignInNB();">
<p class="packet_paragraph"><input id="sign_in_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" autocomplete="on"></p>
<p class="packet_paragraph"><input id="sign_in_pass" type="password" size="50" maxlength="39" class="text-input" name="pass" value="" style="width: 140px;" placeholder="Password">
<input id="sign_in_btn" class="submit_btn" type="submit" value="Sign in"></p>
<p class="packet_paragraph"><a id="sign_in_forgot" class="text_button" onClick="EntraAResetPassword();">Forgot password?</a></p>
</form>
</div>


<div class="white-area" style="left: 50%; top: 275px; width: 300px; height: 130px;">
<form id="sign_up" name="sign_up" class="packet_paragraph" method="get" onSubmit="return SignUpNB();">
<h2 id="front-signup-lang" class="white-area-title">New to NiMMbus? Sign up:</h2>
<p id="sign_up_user_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" onkeyup="SignUpUserInputChange();" onpaste="SignUpUserInputChange();" oninput="SignUpUserInputChange();"></p>
<p id="sign_up_pass_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass" value="" placeholder="Password" onkeyup="SignUpPassInputChange();" onpaste="SignUpPassInputChange();" oninput="SignUpPassInputChange();"></p>
<p id="sign_up_pass_valid_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass_valid" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass_valid" value="" placeholder="Password" onkeyup="SignUpPassValidInputChange();" onpaste="SignUpPassValidInputChange();" oninput="SignUpPassValidInputChange();"></p>
<p class="packet_paragraph"><input id="sign_up_btn" class="submit_btn" type="submit" value="Sign up for NiMMbus"></p>
</form>
</div>

</div>  <!--End of id="front-page" -->


<!-- *** MAIN PAGE *** -->
<div id="main-page" style="visibility: hidden;">

<div class="front-bg" style="top: 40px;">
<img src="cloudbackgroud.jpg" style="display: block;">
</div>

<!-- *** MAIN PAGE TOP BAR *** -->

<div class="main-page-bar">
<span style="left: 100px; top:0px; position: absolute; font-size: 20px;">
<img src="nimmbus_icon.png" style="vertical-align: bottom;"/> NiMMbus<sup>Beta</sup> &nbsp;&nbsp; <img src="nextgeoss30.png" style="vertical-align: bottom;"/>
</span>

<span style="left: 90%; top:5px; position: absolute;">
<a id="dropdown-settings" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');" onMouseOver="document.getElementById('settings-tooltip').style.opacity='1';" onMouseOut="document.getElementById('settings-tooltip').style.opacity='0';">
<img src="gear_icon.png" style="vertical-align: bottom;" />
</a>
</span>

<span id="settings-tooltip" class="tooltip" style="left: 87%; top:34px;">
<b class="tooltip-caret"></b><br>
<span id="settings-tooltip-text" class="tooltip-text">Settings</span>
</span>

<div id="settings-list" class="dropdown-list" style="left: 86%; top: 40px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a id="settings-profile" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');MostraAccount(false);">
Profile</a>
<a id="settings-signout" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');SurtDeNimmbus();">
Sign out</a>
</div>  <!--End of id="settings-list" -->
</div>  <!--End of class="main-page-bar" -->

<!-- *** MAIN PAGE LEFT PANNEL *** -->

<div id="main-left-pannel" class="white-area" style="left: 3%; top: 45px; width: 18%; height: 150px;">

<h2 id="main-left-pannel-title-text" class="white-area-title">User</h2>
<p id="main-left-pannel-subtitle-text" class="packet_paragraph">
<p class="packet_paragraph"><span id="main-left-pannel-since-text"></span>: <span id="main-left-pannel-date-text"></span></p>

<div id="new-resource" style="position:absolute; bottom: 20px: left: 20px;">
<form id="main-left-pannel_form" name="main_left_pannel_form" method="get" onSubmit="return false">

<p></p>

<input id="new-resource_btn" class="submit_btn" type="button" value="New" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list');" onMouseOver="document.getElementById('new-resource-tooltip').style.opacity='1';" onMouseOut="document.getElementById('new-resource-tooltip').style.opacity='0';"/>


<span id="new-resource-tooltip" class="tooltip" style="left: -17px; top:45px;">
<b class="tooltip-caret"></b><br>
<span id="new-resource-tooltip-text" class="tooltip-text">New resource</span>
</span>

<div id="new-resource-list" class="dropdown-list" style="left: -37px; top: 53px; width: 110px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a id="new-resource-href" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraHRefResource('');"></a>
<a id="new-resource-poi" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraPoiResource('');"></a>
<a id="new-resource-citation" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraCitationResource('');"></a>
<a id="new-resource-feedback" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-new-resource', 'new-resource-list'); MostraFeedbackResource('','');"></a>
</div>  <!--End of id="new-resource-list" -->
</form>
</div>  <!--End of id="new-resource" -->

</div>  <!--End of id="main-left-pannel" -->

<!-- *** RESOURCES RIGHT PANNEL *** -->

<div id="resources" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto;">
<h2 id="resources-title-text" class="white-area-title">Resources</h2>
<form id="resources_form" name="resources_form" method="get" onSubmit="return false">

<table style="width: 100%;"><tr><td id="resources-subtitle-text">List of resources.</td>
<td align="right"><span id="resources-hits-text">1-100 of 123</span> 

<input id="newer-resources_btn" class="submit_btn" type="button" value="<" onMouseOver="document.getElementById('newer-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('newer-resources-tooltip').style.opacity='0';"><input id="older-resources_btn" class="submit_btn" type="button" value=">" onMouseOver="document.getElementById('older-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('older-resources-tooltip').style.opacity='0';">

<span id="newer-resources-tooltip" class="tooltip" style="right: 40px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="newer-resources-tooltip-text" class="tooltip-text">Newer</span>
</span>

<span id="older-resources-tooltip" class="tooltip" style="right: 0px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="older-resources-tooltip-text" class="tooltip-text">Older</span>
</span>

</td></tr></table>
</form>

<div id="resources-list" style="border-top: 1px solid #e1e8ed;"></div>
</div>  <!--End of id="resources" -->


<!-- *** HREF DLG *** -->

<div id="href-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="href-resource-title-text" class="white-area-title">Resource</h2>
<p id="href-resource-subtitle-text">Change your basic resource and language settings.</p>

<form id="href-resource_form" name="href_resource_form" method="get" autocomplete="off" onSubmit="return SendHRefResourceChanges();">

<div id="title-href-resource_fieldset" class="control-group">
<label class="control-label" id="title-href-resource_screen" for="title-href-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-href-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-href-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="title-href-resource_fieldset" -->

<div id="href-href-resource_fieldset" class="control-group">
<label class="control-label" id="href-href-resource_screen" for="href-href-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="href-href-resource_screen_value" name="href" maxlength="1999" style="width: 80%;"/></p>
<p id="href-href-resource_descrip"></p>
</div>
</div>  <!--End of id="href-href-resource_fieldset" -->

<div id="mimetype-href-resource_fieldset" class="control-group">
<label class="control-label" id="mimetype-href-resource_screen" for="mimetype-href-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="mimetype-href-resource_screen_value" name="mimetype">
<option value="application/x-mmzx">MMZX</option>
<option value="application/x-mmz" default="default">MMZ</option>
<option value="application/x-zip-compressed">ZIP</option>
<option value="image/jpeg">JPEG</option>
<option value="image/png">PNG</option>
<option value="" id="other-mimetype-href-resource_value"></option>
</select>
<p id="mimetype-href-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="mimetype-href-resource_fieldset" -->

<div id="reason-href-resource_fieldset" class="control-group">
<label class="control-label" id="reason-href-resource_screen" for="reason-href-resource_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="reason-href-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-href-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="reason-href-resource_fieldset" -->

<div class="form-actions">
<input id="href-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="href-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('HREF');" />
<input id="href-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeHRefResourceChanges(true);" />
<input id="href-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeHRefResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="href-resource" -->


<!-- *** POI DLG *** -->

<div id="poi-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="poi-resource-title-text" class="white-area-title"></h2>
<p id="poi-resource-subtitle-text"></p>

<form id="poi-resource_form" name="poi_resource_form" method="get" autocomplete="off" onSubmit="return SendPoiResourceChanges();">

<div id="title-poi-resource_fieldset" class="control-group">
<label class="control-label" id="title-poi-resource_screen" for="title-poi-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-poi-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-poi-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="title-poi-resource_fieldset" -->

<div id="long-poi-resource_fieldset" class="control-group">
<label class="control-label" id="long-poi-resource_screen" for="long-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="long-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="long-poi-resource_screen_value" name="long" maxlength="20" style="width: 40%;"/> <input id="poi-gps-resource_btn" class="submit_btn" type="button" value="GPS" onClick="GetPoiFromDevice();" /></p>
<p id="long-poi-resource_descrip"></p>
</div>
</div>  <!--End of id="long-poi-resource_fieldset" -->

<div id="lat-poi-resource_fieldset" class="control-group">
<label class="control-label" id="lat-poi-resource_screen" for="lat-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="lat-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="lat-poi-resource_screen_value" name="lat" maxlength="20" style="width: 40%;"/></p>
<p id="lat-poi-resource_descrip"></p>
</div>
</div>  <!--End of id="lat-poi-resource_fieldset" -->

<div id="pos-accur-poi-resource_fieldset" class="control-group">
<label class="control-label" id="pos-accur-poi-resource_screen" for="pos-accur-poi-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="pos_accur-poi-resource_screen_value" name="pos_accur" maxlength="10" style="width: 40%;"/></p>
<p id="pos-accur-poi-resource_descrip"></p>
</div>
</div>  <!--End of id="pos_accur-poi-resource_fieldset" -->

<div id="elevation-poi-resource_fieldset" class="control-group">
<label class="control-label" id="elevation-poi-resource_screen" for="elevation-poi-resource_screen_value"></label>
<div class="controls">
<p id="elevation-poi-resource_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="elevation-poi-resource_screen_value" name="elevation" maxlength="20" style="width: 40%;"/></p>
<p id="elevation-poi-resource_descrip"></p>
</div>
</div>  <!--End of id="elevation-poi-resource_fieldset" -->

<div id="reason-poi-resource_fieldset" class="control-group">
<label class="control-label" id="reason-poi-resource_screen" for="reason-poi-resource_screen_value"></label>
<div class="controls">
<p id="reason-poi-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="reason-poi-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-poi-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="reason-poi-resource_fieldset" -->

<div class="form-actions">
<input id="poi-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="poi-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('POI');" />
<input id="poi-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePoiResourceChanges(true);" />
<input id="poi-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePoiResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="poi-resource" -->

<!-- *** FEEDBACK RESOURCE DLG *** -->

<div id="feedback-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-resource-title-text" class="white-area-title"></h2>
<p id="feedback-resource-subtitle-text"></p>

<form id="feedback-resource_form" name="feedback_resource_form" method="get" autocomplete="off" onSubmit="return SendFeedbackResourceChanges();">

<div class="control-group">
<label class="control-label" id="target_feedback-resource_compact_screen" for="feedback-resource_target_compact_value"></label>
<div class="controls">
<p id="target_feedback-resource_compact_descrip"></p>
</div>
</div>

<div id="targetRole-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="targetRole-feedback-resource_screen" for="targetRole-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="targetRole-feedback-resource_screen_value" name="targetRole">
<option value="primary" id="primary-targetRole-feedback-resource_value" default="default"></option>
<option value="secundary" id="secundary-targetRole-feedback-resource_value"></option>
<option value="supplementary" id="supplementary-targetRole-feedback-resource_value"></option>
</select>
<p id="targetRole-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="targetRole-feedback-resource_fieldset" -->

<div id="title-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="title-feedback-resource_screen" for="title-feedback-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-feedback-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="title-feedback-resource_fieldset" -->

<div id="abstract-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="abstract-feedback-resource_screen" for="abstract-feedback-resource_screen_value"></label>
<div class="controls">
<p id="abstract-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="abstract-feedback-resource_screen_value" name="abstract" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="abstract-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="abstract-feedback-resource_fieldset" -->

<div id="reason-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="reason-feedback-resource_screen" for="reason-feedback-resource_screen_value"></label>
<div class="controls">
<p id="reason-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="reason-feedback-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="reason-feedback-resource_fieldset" -->

<div id="contactRole-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="contactRole-feedback-resource_screen" for="contactRole-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="contactRole-feedback-resource_screen_value" name="contactRole">
<option value="commercialDataProducer" id="commercialDataProd-contactRole-feedback-resource_value"></option>
<option value="commercialAddedValue" id="commercialAddValue-contactRole-feedback-resource_value"></option>
<option value="researchDataProducer" id="researchDataProd-contactRole-feedback-resource_value"></option>
<option value="researchEndUser" id="researchEndUser-contactRole-feedback-resource_value"></option>
<option value="decisionMaker" id="decisionMaker-contactRole-feedback-resource_value"></option>
<option value="generalPublic" id="generalPublic-contactRole-feedback-resource_value" default="default"></option>
</select>
<p id="contactRole-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="contactRole-feedback-resource_fieldset" -->

<div id="comment-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="comment-feedback-resource_screen" for="comment-feedback-resource_screen_value"></label>
<div class="controls">
<p id="comment-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="comment-feedback-resource_screen_value" name="comment" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="comment-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="comment-feedback-resource_fieldset" -->

<div id="comment-motiv-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="comment-motiv-feedback-resource_screen" for="comment-motiv-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="comment-motiv-feedback-resource_screen_value" name="motivation">
<option value="" id="undefined-motivation-feedback-resource_value" default="default"></option>
<option value="comment" id="comment-motivation-feedback-resource_value"></option>
<option value="question" id="question-motivation-feedback-resource_value"></option>
<option value="answer" id="answer-motivation-feedback-resource_value"></option>
<option value="acceptedAnswer" id="acceptedAnswer-motivation-feedback-resource_value"></option>
<option value="response" id="response-motivation-feedback-resource_value"></option>		
<option value="justification" id="justification-motivation-feedback-resource_value"></option>
<option value="resolution" id="resolution-motivation-feedback-resource_value"></option>
<option value="moderation" id="moderation-motivation-feedback-resource_value"></option>
</select>	
<p id="comment-motiv-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="comment-motiv-feedback-resource_fieldset" -->

<div id="rating-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="rating-feedback-resource_screen" for="rating-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="rating-feedback-resource_screen_value" name="rating">
<option value="" id="undefined-rating-feedback-resource_value" default="default"></option>
<option value="1" id="oneStar-rating-feedback-resource_value"></option>
<option value="2" id="twoStars-rating-feedback-resource_value"></option>
<option value="3" id="threeStars-rating-feedback-resource_value"></option>
<option value="4" id="fourStars-rating-feedback-resource_value"></option>
<option value="5" id="fiveStars-rating-feedback-resource_value"></option>
</select>	
<p id="rating-feedback-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="comment-motiv-feedback-resource_fieldset" -->

<div class="form-actions">
<input id="feedback-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="feedback-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('FEEDBACK');" />
<input id="feedback-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChanges(true);" />
<input id="feedback-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="feedback-resource" -->

<!-- *** CITATION RESOURCE DLG *** -->
<div id="citation-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="citation-resource-title-text" class="white-area-title"></h2>
<p id="citation-resource-subtitle-text"></p>

<form id="citation-resource_form" name="citation_resource_form" method="get" autocomplete="off" onSubmit="return SendCitationResourceChanges();">

<div id="title-citation-resource_fieldset" class="control-group">
<label class="control-label" id="title-citation-resource_screen" for="title-citation-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-citation-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="title-citation-resource_fieldset" -->

<div id="id-code-citation-resource_fieldset" class="control-group">
<label class="control-label" id="id-code-citation-resource_screen" for="id-code-citation-resource_screen_value"></label>
<div class="controls">
<p id="id-code-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="id-code-citation-resource_screen_value" name="id_code" maxlength="254" style="width: 80%;"/>
<p id="id-code-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="id-code-citation-resource_fieldset" -->

<div id="id-namespace-citation-resource_fieldset" class="control-group">
<label class="control-label" id="id-namespace-citation-resource_screen" for="id-namespace-citation-resource_screen_value"></label>
<div class="controls">
<p id="id-namespace-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="id-namespace-citation-resource_screen_value" name="id_namespace" maxlength="254" style="width: 80%;"/>
<p id="id-namespace-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="id-namespace-citation-resource_fieldset" -->

<div id="url-link-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-link-citation-resource_screen" for="url-link-citation-resource_screen_value"></label>
<div class="controls">
<p id="url-link-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="url-link-citation-resource_screen_value" name="url_link" maxlength="149" style="width: 80%;"/>
<p id="url-link-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="url-link-citation-resource_fieldset" -->

<div id="url-descrip-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-descrip-citation-resource_screen" for="url-descrip-citation-resource_screen_value"></label>
<div class="controls">
<p id="url-descrip-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="url-descrip-citation-resource_screen_value" name="url_descrip" maxlength="254" style="width: 80%;"/>
<p id="url-descrip-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="url-descrip-citation-resource_fieldset" -->

<div id="url-function-citation-resource_fieldset" class="control-group">
<label class="control-label" id="url-function-citation-resource_screen" for="url-function-citation-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="url-function-citation-resource_screen_value" name="function_code">	
<option value="undefined" id="undefined-url-function-citation-resource_value"></option>
<option value="download" id="download-url-function-citation-resource_value"></option>
<option value="information" id="information-url-function-citation-resource_value"></option>
<option value="offlineAccess" id="offlineAccess-url-function-citation-resource_value"></option>
<option value="order" id="order-url-function-citation-resource_value"></option>
<option value="search" id="search-url-function-citation-resource_value"></option>
<option value="completeMetadata" id="completeMetadata-url-function-citation-resource_value"></option>
<option value="browseGraphic" id="browseGraphic-url-function-citation-resource_value"></option>
<option value="upload" id="upload-url-function-citation-resource_value"></option>
<option value="emailService" id="emailService-url-function-citation-resource_value"></option>
<option value="browsing" id="browsing-url-function-citation-resource_value"></option>
<option value="fileAccess" id="fileAccess-url-function-citation-resource_value"></option>
</select>
<p id="url-function-citation-resource_screen_descrip"></p>
</div>
</div>  <!--End of id="url-function-citation-resource_fieldset" -->

<div class="form-actions">
<input id="citation-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="citation-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete('CITATION');" />
<input id="citation-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChanges(true);" />
<input id="citation-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="citation-resource" -->

<!-- *** ACCOUNT DLG *** -->

<div id="account" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="account-title-text" class="white-area-title">Account</h2>
<p id="account-subtitle-text">Change your basic account and language settings.</p>

<form id="account_form" name="account_form" method="get" autocomplete="off" onSubmit="return SendAccountChanges();">

<div id="new_user_fieldset" class="control-group">
<label class="control-label" id="new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserInputChange();" onpaste="NewUserInputChange();" oninput="NewUserInputChange();"/></p>
<p id="new_user_descrip"></p>
</div>
</div>  <!--End of id="new_user_fieldset" -->

<div id="email_fieldset" class="control-group">
<label class="control-label" id="email_screen" for="email_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" id="email_screen_value" value="" name="email" style="width: 60%;" maxlength="79"/>
<p id="email_screen_descrip"></p>
</div>
</div>  <!--End of id="email_fieldset" -->

<div id="name_fieldset" class="control-group">
<label class="control-label" id="name_screen" for="name_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="name_screen_value" name="name" style="width: 60%;" maxlength="99"/>
<p id="name_screen_descrip"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="bio_fieldset" class="control-group">
<label class="control-label" id="bio_screen" for="bio_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="bio_screen_value" name="bio" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="bio_screen_descrip"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="current_pass_fieldset" class="control-group">
<label class="control-label" id="current_pass_screen" for="current_pass_screen_value"></label>
<div class="controls">
<p id="current_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="current_pass_screen_value" name="current_pass" maxlength="39" onkeyup="CurrentPassInputChange();" onpaste="CurrentPassInputChange();" oninput="CurrentPassInputChange();"/></p>
<p id="current_pass_screen_descrip"></p>
</div>
</div>  <!--End of id="current_pass_fieldset" -->

<div id="new_pass_fieldset" class="control-group">
<label class="control-label" id="new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassInputChange();" onpaste="NewPassInputChange();" oninput="NewPassInputChange();"/></p>
<p id="new_pass_screen_descrip"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div id="new_pass_valid_fieldset" class="control-group">
<label class="control-label" id="new_pass_valid_screen" for="new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="PassValidInputChange();" onpaste="PassValidInputChange();" oninput="PassValidInputChange();"/></p>
<p id="new_pass_valid_screen_descrip"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div id="language_fieldset" class="control-group">
<label class="control-label" id="language_screen" for="language_screen_value"></label>
<div class="controls">
<select class="text-input" id="language_screen_value" name="language">
<option value="cat">Català</option>
<option value="spa">Español</option>
<option value="eng">English</option>
</select>
<p id="language_screen_descrip"></p>
</div>
</div>  <!--End of id="languge_fieldset" -->

<div class="form-actions">
<input id="account_btn" class="submit_btn" type="submit" value="Save changes">
<input id="account-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeAccount();">
</div>

</form>

</div>  <!--End of id="account" -->

<!-- *** SHARE DLG *** -->

<div id="share" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="share-title-text" class="white-area-title"></h2>
<p id="share-subtitle-text"></p>

<form id="share_form" name="share_form" method="get" autocomplete="off" onSubmit="return SurtIRetornaAResources();">

<div class="control-group">
<label class="control-label" id="new_share_screen" for="new_share_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new_share_screen_value" name="new_share" maxlength="79" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();"/> <label id="new_share_rights_read_label" for="new_share_rights_read"></label><img src="check16.png" id="new_share_rights_read"/>, <label id="new_share_rights_write_label" for="new_share_rights_write"></label><input type="checkbox" id="new_share_rights_write" name="W" checked="checked"/>, <label id="new_share_rights_share_label" for="new_share_rights_share"></label><input type="checkbox" id="new_share_rights_share" name="S" checked="checked"/> <input id="new_share_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(false);"/></p>
<p id="new_share_select" style="display:none;position:absolute;">
<select size=10 class="text-input" name="new_share_select" style="height:116px;width:250px;" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();" onchange="SelectionShareAuthorizedList();HideShareAuthorizedList();">
</select>
</p>
<p id="new_share_descrip"></p>
</div>
</div>

<div id="new_share_open_fieldset" class="control-group">
<label class="control-label" id="new_share_open_screen"></label>
<div class="controls">
<p><label id="new_share_open_read_label" for="new_share_open_rights_read"></label> <input id="new_share_open_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(true);"/></p>
<p id="new_share_open_descrip"></p>
</div>
</div>  <!--End of id="new_share_open_fieldset" -->

<div id="current_share_fieldset" class="control-group">
<label class="control-label" id="current_share_screen"></label>
<div class="controls">
<p id="current_share_list"></p>
<p id="current_share_descrip"></p>
</div>
</div>  <!--End of id="current_share_fieldset" -->

<div class="form-actions">
<input id="share-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="share" -->


<!-- *** FEEDBACK DLG *** -->

<div id="feedback" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-title-text" class="white-area-title"></h2>
<p id="feedback-subtitle-text"></p>

<form id="feedback_form" name="feedback_form" method="get" autocomplete="off" onSubmit="return SurtIRetornaAResources();">

<div class="control-group">
<label class="control-label" id="feedback_target_compact_screen" for="feedback_target_compact_value"></label>
<div class="controls">
<p id="feedback_target_compact_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new_feedback_screen" for="new_feedback_screen_value"></label>
<div class="controls">
<p><input id="new_feedback_btn" class="submit_btn" type="button" value="" onClick="MostraFeedbackResource('', null);"/></p>
<p id="new_feedback_descrip"></p>
</div>
</div>

<div id="current_feedback_fieldset" class="control-group">
<label class="control-label" id="current_feedback_screen"></label>
<div class="controls">
<p id="current_feedback_list"></p>
<p id="current_feedback_descrip"></p>
</div>
</div>  <!--End of id="current_feedback_fieldset" -->

<div class="form-actions">
<input id="feedback-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="feedback" -->


</div>  <!--End of id="main-page" -->

<!-- *** PASSWORD RESET PAGE *** -->

<div id="reset-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="reset-pass-title-text" class="white-area-title">Password reset</h2>
<p id="reset-pass-subtitle-text">Find your NiMMbus account.</p>

<form id="reset-pass_form" name="reset_pass_form" method="get" autocomplete="off" onSubmit="return SendPasswordReset();">
<p><input type="text" class="text-input" value="" id="reset-pass_user_screen_value" name="user" maxlength="79" /></p>
<p id="reset-pass_user_descrip"></p>

<div class="form-actions"><input id="reset-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="reset-pass-page" -->

<!-- *** NEW PASSWORD PAGE *** -->

<div id="new-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-pass-title-text" class="white-area-title">ChangePassword</h2>
<p id="new-pass-subtitle-text">Change password in your NiMMbus account.</p>

<form id="new-pass_form" name="new_pass_form" method="get" autocomplete="off" onSubmit="return SendNewPasswordToken();">

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassNewPassInputChange();" onpaste="NewPassNewPassInputChange();" oninput="NewPassNewPassInputChange();"/></p>
<p id="new-pass_new_pass_screen_descrip"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_valid_screen" for="new-pass_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewPassPassValidInputChange();" onpaste="NewPassPassValidInputChange();" oninput="NewPassPassValidInputChange();"/></p>
<p id="new-pass_new_pass_valid_screen_descrip"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div class="form-actions"><input id="new-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="new-pass-page" -->

<!-- *** NEW USER PAGE *** -->

<div id="new-user-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-user-title-text" class="white-area-title">New User</h2>
<p id="new-user-subtitle-text">Create your NiMMbus account.</p>

<form id="new-user_form" name="new_user_form" method="get" autocomplete="off" onSubmit="return SendNewUserNB();">

<div class="control-group">
<label class="control-label" id="new-user_new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new-user_new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new-user_new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserUserInputChange();" onpaste="NewUserUserInputChange();" oninput="NewUserUserInputChange();"/>
<p id="new-user_new_user_screen_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_screen" for="new-user_new_pass_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewUserPassInputChange();" onpaste="NewUserPassInputChange();" oninput="NewUserPassInputChange();"/></p>
<p id="new-user_new_pass_screen_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_valid_screen" for="new-user_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewUserPassValidInputChange();" onpaste="NewUserPassValidInputChange();" oninput="NewUserPassValidInputChange();"/></p>
<p id="new-user_new_pass_valid_screen_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_email_screen" for="new-user_email_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new-user_email_screen_value" name="email" maxlength="79"/></p>
<p id="new-user_email_screen_descrip"></p>
</div>
</div>

<div class="form-actions"><input id="new-user_btn" class="submit_btn" type="submit" value="New"></div>
</form>

</div>  <!--End of id="new-user-page" -->

<!-- *** EXECUTE TOKEN PAGE *** -->

<div id="execute-token-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="execute-token-title-text" class="white-area-title">Token</h2>
<p id="execute-token-subtitle-text"></p>
<p id="execute-token-wait-text"></p>

</div>  <!--End of id="execute-token-page" -->
</body>
</html>