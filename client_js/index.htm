<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title id="head_title">NiMMbus login</title>
<!--script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script-->

<link href="favicon.ico" rel="shortcut icon" type="image/x-icon">
<link rel="stylesheet" href="nimmbus.css">

<script language="JavaScript" src="xml.js"></script>
<script language="JavaScript" src="owc_atom.js"></script>
<script language="JavaScript" src="wps_iso_guf.js"></script>
<script language="JavaScript" src="guf_locale.js"></script>
<script language="JavaScript" src="guf.js"></script>

<script language="JavaScript" src="Nmmblang.js"></script>

<script language="JavaScript" src="hello.all.min.js"></script>
<!-- https://adodson.com/hello.js/modules#hellojs-already-has-you-connected -->
<!--script language="JavaScript" src="google.js"></script-->
<script language="JavaScript" src="landsense.js"></script>
<script language="JavaScript" src="nextgeoss.js"></script>

<script>

/* 
    This file is part of NiMMbus system. NiMMbus is a solution for 
    storing geospatial resources on the MiraMon private cloud. 
    MiraMon is a family of GIS&RS products developed since 1994 
    and includes a desktop GIS, a desktop Metadata Manager, a 
    Web Map Browser and the NiMMbus system. 
    
    The NiMMbus JavaScript client is free software: you can redistribute 
    it and/or modify it under the terms of the GNU Affero General 
    Public License as published by the Free Software Foundation, 
    either version 3 of the License, or (at your option) any later version.

    The NiMMbus JavaScript client is distributed in the hope that 
    it will be useful, but WITHOUT ANY WARRANTY; without even the 
    implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
    See the GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General 
    Public License along with the NiMMbus JavaScript Client.
    If not, see https://www.gnu.org/licenses/licenses.html#AGPL.
    
    The NiMMbus JavaScript Client can be updated from
    https://github.com/grumets/NiMMbus.

    Copyright 2014, 2022 Xavier Pons

    Aquest codi JavaScript ha estat idea de Joan Masó Pau (joan maso at uab cat) 
    amb l'ajut de l'Alaitz Zabala (alaitz zabala at uab cat)
    dins del grup del MiraMon. MiraMon és un projecte del 
    CREAF que elabora programari de Sistema d'Informació Geogràfica 
    i de Teledetecció per a la visualització, consulta, edició i anàlisi 
    de mapes ràsters i vectorials. Aquest progamari programari inclou
    aplicacions d'escriptori i també servidors i clients per Internet.
    No tots aquests productes són gratuïts o de codi obert. 
    
    En particular, el client JavaScript del NiMMbus es distribueix sota 
    els termes de la llicència GNU Affero General Public License, 
    mireu https://www.gnu.org/licenses/licenses.html#AGPL.
    
    El client JavaScript del NiMMbus es pot actualitzar des de 
    https://github.com/grumets/NiMMbus.
*/

//·$· "use strict" --> si ho fem caldrà passar molt temps recorrent tots els botons etc per estar segurs que no hi ha res no declarat!!

function CollapseFieldset(elem, state)
/* "state" can be:
- undefined -> the current state of the property is changed
- none/block -> this state is applied */
{
var div=elem.nextElementSibling;
	if (div)
	{
		if (state)
		{
			if (state=="none")
				div.style.display="block";
			else if (state=="block")
				div.style.display="none";
			//if I do not understand what "state" is, it is not used
		}
		
		if (div.style.display=="none")
		{
			div.style.display="block";
			elem.classList.remove("collapsed");
		}	
		else
		{
			div.style.display="none";
			elem.classList.add("collapsed");
		}
	}
}

	
<!--

//var ServersNB=["http://localhost/cgi-bin/server1/nimmbus.cgi","http://localhost/cgi-bin/server2/nimmbus.cgi"];
var ServersNB=["https://www.nimmbus.cat/cgi-bin/nimmbus.cgi"];
var LastServerNB=0;


https://stackoverflow.com/questions/13356493/decode-utf-8-with-javascript
/*function encode_utf8(s) {
  return unescape(encodeURIComponent(s));
}*/

function decode_utf8(s) {
  return decodeURIComponent(escape(s));
}

//Després de intentar fer servir l'objecte link() sense exit he hagut de fer això.
//En realitat el que s'hauria de fer servir és el constructor new URL().
// A aquesta funció se li pot passar el path absolut o un path relatiu seguit d'una adreça base. 
//Returns the hostname and port number of a URL
function DonaHost(s)
{
var pos_barrabarra, pos_barra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
	{
		s2=s.substring(pos_barrabarra+2,s.length);
		if (-1!=(pos_barra=s2.indexOf("/")))
			return s2.substring(0,pos_barra);
		return s2;
	}
	else
	{
		if (-1!=(pos_barra=s.indexOf("/")))
			return s.substring(0,pos_barra);		
		return s;
	}
}
		
//Returns the protocol, hostname and port number of a URL
function DonaHrefOrigin(s)
	{
var pos_barrabarra, pos_barra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
	{
		s2=s.substring(pos_barrabarra+2,s.length);
		if (-1!=(pos_barra=s2.indexOf("/")))
			return s.substring(0,pos_barrabarra+2+pos_barra);
		return s;
	}
	else
	{
		if (-1!=(pos_barra=s.indexOf("/")))
			return s.substring(0,pos_barra);	
		return s;
}
}

//Returns the protocol of a URL
function DonaProtocol(s)
{
var pos_barrabarra;
		
	if (-1!=(pos_barrabarra=s.indexOf("//")))
		return s.substring(0,pos_barrabarra);
	return "";
}

function ConfirmExit()
{
	return DonaCadenaJSON(Msg_Exit_NiMMbus_Question);
}

// Inspirat en https://www.webdesignerdepot.com/2013/03/how-to-manage-the-back-button-with-javascript/
function GoBackOnePage()
{
	if (location.hash.length > 0 && location.hash!="#front-page")
		ChangePannel(location.hash.replace('#',''), false);
	else
		SurtDeNimmbus();
}
window.onhashchange = GoBackOnePage;

function RevisaCrossSserverServersNB(servers)
{
var s_host; 
	for (var i=0; i<servers.length; i++)
	{
		s_host=DonaHost(servers[i]);		
		if (s_host.toLowerCase()=="localhost" && location.host.toLowerCase()!="localhost")
		{
			alert("Error en pujar la versió als servidors. ServersNB[] encara diu \"localhost\"!");
			break;
		}

		s_host=DonaHrefOrigin(servers[i]);
		if (s_host.toLowerCase()!=location.origin.toLowerCase())
		{
			//Canvio l'arrel del servidor local per l'arrel de la plana del navegador per estar segur que l'ajax funcionarà sense "cross server vulnerability".
			//var pos_host=(-1!=servers[i].indexOf("//")) ? servers[i].indexOf("//")+2 : 0;
			//servers[i]=servers[i].substring(0,pos_host)+location.host+servers[i].substring(pos_host+s_host.length, servers[i].length);

			//Canvio l'arrel de la plana del navegador per l'arrel del servidor local, per estar segur que l'ajax funcionarà sense "cross server vulnerability" i que els servidors d'autentificació rebran el nom de domini que tenen registrat (assumint que servers està bé).
			location.replace(s_host+location.href.substring(location.origin.length, location.href.length));
		}
	}
	if (location.host.toLowerCase()=="localhost")
	{
		document.getElementById("sso-debug-button").style.display="inline";
		document.getElementById("sso-debug-button").disabled=false;
	}
}

/*
function RevisaProtocolServersNB(servers)
{
var s_protocol, pos_protocol;
	
	//En aquest cas mirem només el primer perquè haurien de ser tots iguals i perquè sovint això està només a un servidor
	//Volem mirar que el protocol de la plana amb el protocol del servidor i, si no és igual, forçar el del servidor
	//(i.e. si em demanen http:// i és un https:// el canvio
	
	s_protocol=DonaProtocol(servers[0]);
	
	if (s_protocol.toLowerCase()!=location.protocol.toLowerCase())
	{
		//Canvio l'indicador de protocol de la plana per la que té el servidor
		pos_protocol=(-1!=location.href.indexOf("//")) ? location.href.indexOf("//")+2 : 0;		
		location.replace(s_protocol+"//"+location.href.substring(pos_protocol,location.href.length));
		//Canvio l'arrel del servidor local per l'arrel de la plana del navegador per estar segur que l'ajax funcionarà sense "cross server vulnerability".
		pos_host=(-1!=servers[i].indexOf("//")) ? servers[i].indexOf("//")+2 : 0;
		servers[i]=servers[i].substring(0,pos_host)+location.host+servers[i].substring(pos_host+s_host.length, servers[i].length);

	}
}

RevisaProtocolServersNB(ServersNB);*/

//From: http://www.technicaladvices.com/2012/07/16/preventing-backspace-from-navigating-back-in-all-the-browsers/
document.onkeydown = function (event) 
{
	
	if (!event) { /* This will happen in IE */
		event = window.event;
	}
		
	var keyCode = event.keyCode;
	
	if (keyCode == 8 &&
		((event.target || event.srcElement).tagName != "TEXTAREA") && 
		((event.target || event.srcElement).tagName != "INPUT")) { 
		
		if (navigator.userAgent.toLowerCase().indexOf("msie") == -1) {
			event.stopPropagation();
		} else {
			event.returnValue = false;
		}
		
		return false;
	}
};	

function UpdateLastServer()
{
	LastServerNB++;
	if (LastServerNB>=ServersNB.length)
		LastServerNB=0;
}

function DonaCadenaCodelistDeSelect(selector)
{
	if (selector.selectedIndex!=-1)
		return selector.options[selector.selectedIndex].value;
	else
		return "";
}

function DonaCadenaCodelistDeRadio(radio)
{
	for (var i=0; i<radio.length; i++)
	{
		if (radio[i].checked)
			return radio[i].value;
	}
	return "";
}


function SeleccionaSelectDesDeValor(selector, valor)
{
	if (valor)
	{
		for (var i=0; i<selector.length; i++)
		{
			if (selector.options[i].value==valor)
			{
				selector.selectedIndex=i;
				return;
			}					
		}
	} 
}

function SeleccionaRadioDesDeValor(radio, valor)
{
	if (valor)
	{
		for (var i=0; i<radio.length; i++)
			radio[i].checked=(radio[i].value==valor) ? true : false;
	}
	else
	{
		for (var i=0; i<radio.length; i++)
			radio[i].checked=false;
	}	 
}

function DonaCadenaIdNoPotSerBuit(id)
{
	return document.getElementById(id).innerHTML + " "+ DonaCadenaJSON(Msg_cannot_be_blank);
}


// Funció inspirada en una de SitePoint Pty. Ltd, www.sitepoint.com
function Ajax() 
{
	this.req = null;
	this.url = null;
	this.status = null;
	this.statusText = '';
	this.method = 'GET';
	this.async = true;
	this.dataPayload = "";
	this.readyState = null;
	this.responseText = null;
	this.responseXML = null;
	this.handleResp = null;
	this.responseFormat = 'text/plain', // 'text/plain', 'text/xml', 'object'
	this.requestFormat = 'application/x-www-form-urlencoded'  //només per POST
	this.structResp=null;
	this.mimeType = null;  
	//this.headers = [];
	this.requestHeaders=[];

	this.init = function() {
		var i = 0;
		var reqTry = [ 
			function() { return new XMLHttpRequest(); },
			function() { return new ActiveXObject('Msxml2.XMLHTTP') },
			function() { return new ActiveXObject('Microsoft.XMLHTTP' )} ];
      
		while (!this.req && (i < reqTry.length)) {
			try { 
				this.req = reqTry[i++]();
			} 
			catch(e) {}
		}
		return true;
	};
	this.doGet = function(url, hand, response_format, struct) 
	{
			this.url = url;
			this.handleResp = hand;
			this.responseFormat = response_format || 'text/plain';
			this.structResp = struct;
			this.doReq();
	};

	this.doPost = function(url, request_format, dataPayload, hand, response_format, struct) 
	{
		this.url = url;
		this.requestFormat = request_format || 'application/x-www-form-urlencoded';    
		this.dataPayload = dataPayload;
		this.handleResp = hand;
		this.responseFormat = response_format || 'text/plain';
		this.structResp = struct;
		this.method = 'POST';
		this.doReq();
	};


	this.doReq = function()
	{
		if (AccessTokenType=="landsense" || AccessTokenType=="nextgeoss")
		{
			//In external authentication, session expires. We need to be sure that it is valid or we risc that a server that is slow on responding could try to validate a token that has already expired.
			var currentTime, expires;

			if (AccessTokenType=="nextgeoss")
				expires=AccessTokenExpires;
			else
				expires=OmpleHelloAccessTokenIType(AccessTokenType);  //Automatic regenerated token is valid
			
			var currentTime = (new Date()).getTime() / 1000;  //in seconds since 1970/01/01
			if ((expires-19) <= currentTime)
			{
				if (expires<currentTime)
					ValidaSSO(true, null, this);
				else
				{
					//Session is close to expire. Since forced authentication does not work, we simply wait until the access token is invalid and then we will request it again.
					ShowInfo("long", DonaCadenaJSON(Msg_Revalidating_authentication) +": "+ Math.floor(expires-currentTime+3) + DonaCadenaJSON(Msg_seconds)+".");
					setTimeout(ValidaSSO, (expires-currentTime+3)*1000, true, null, this);
				}
				return;  //this.doReqAutenticated es fa després de fer altres coses.
			}
		}
		this.doReqAutenticated();
	}
	
	this.doReqAutenticated = function()
	{
		var self = null;
		var req = null;
		var headArr = [];    
	
		if (!this.init()) {
			alert('Could not create XMLHttpRequest object.');
			return;
		}

		if (AccessTokenType=="landsense" || AccessTokenType=="nextgeoss")
			OmpleHelloAccessTokenIType(AccessTokenType);
		AfegeixCredencialsToken(this);

		req = this.req;
		req.open(this.method, this.url, this.async);
		if (this.method == 'POST') 
			req.setRequestHeader('Content-Type', this.requestFormat);
		for (var i=0; i<this.requestHeaders.length; i++)
			req.setRequestHeader(this.requestHeaders[i].name, this.requestHeaders[i].value);

		self = this;
	
		req.onreadystatechange = function() {
			var resp = null;
			self.readyState = req.readyState;
			if (req.readyState == 4) {
				self.status = req.status;
				self.statusText = req.statusText;
				self.responseText = req.responseText;
				self.responseXML = req.responseXML;
				switch(self.responseFormat) {
					case 'text/plain':
						resp = self.responseText;
						break;
					case 'text/xml':
						resp = self.responseXML;
						break;
					case 'object':
						resp = req;
						break;
				}
		
				if(self.structResp)
					self.structResp.text=self.responseText;
				if (self.status > 199 && self.status < 300) {
					if (!self.handleResp) {
						alert('No response handler defined for this XMLHttpRequest object.');
            					return;
					}
					if(self.structResp) 
					{
						try
						{
					            	self.handleResp(resp, self.structResp);
						}
						catch(e)
						{
							alert("Error on handling server response")
						}
					}
					else
						self.handleResp(resp);
				} else {
					self.handleErr(resp);
				}
			}
		}
		req.send(this.dataPayload);
	};
	this.abort = function() {
		if (this.req) {
			this.req.onreadystatechange = function() { };
			this.req.abort();
			this.req = null;
		}
	};
	this.handleErr = function() {
		var errorWin;
		// Create new window and display error
		try {
			errorWin = window.open('', 'errorWin');
			errorWin.document.body.innerHTML = this.responseText;
		}
		// If pop-up gets blocked, inform user
		catch(e) {
			alert('An error occurred, but the error message cannot be displayed because of your browser\'s pop-up blocker.\n' +
				'You could try to allow pop-ups from this Web site. Meanwhile, the text version of the error is:\n' + this.responseText);
		}
	};
	this.setMimeType = function(mimeType) {
		this.mimeType = mimeType;
	};
	this.setHandlerResp = function(funcRef) {
		this.handleResp = funcRef;
	};
	this.setHandlerErr = function(funcRef) {
		this.handleErr = funcRef; 
	};
	this.setHandlerBoth = function(funcRef) {
		this.handleResp = funcRef;
		this.handleErr = funcRef;
	};
	this.setRequestHeader = function(headerName, headerValue) {
		this.requestHeaders.push({"name": headerName, "value": headerValue});
    		//this.headers.push(headerName + ': ' + headerValue);
  	};
}

var ShowInfoShortTimeOut=0;
var ShowInfoOtherTimeOut=0;

function RemoveInfo(id)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML="";
	document.getElementById(id_div).style.opacity='0';
	if (id=="short" || id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
	}
}

function ShowInfo(id, s)
{
var id_div;
	if (id=="permanent")
		id_div="short-note";
	else
		id_div=id+"-note";
	document.getElementById(id_div).innerHTML=s;
	document.getElementById(id_div).style.opacity='1';
  
  if (id=="permanent")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
	}
	else if (id=="short")
	{
		if (ShowInfoShortTimeOut)
			clearTimeout(ShowInfoShortTimeOut);
		ShowInfoShortTimeOut=setTimeout("RemoveInfo(\""+id+"\");",3000);
	}
	else
	{
		if (ShowInfoOtherTimeOut)
			clearTimeout(ShowInfoOtherTimeOut);
		ShowInfoOtherTimeOut=setTimeout("RemoveInfo(\""+id+"\");",15000);
	}
}

//Inspired in http://stackoverflow.com/questions/387736/how-to-stop-event-propagation-with-inline-onclick-attribute
function StopPropagationClick(e)
{
	if (!e)
		e = window.event;

	if (e.stopPropagation)    //IE9 & Other Browsers
		e.stopPropagation();
	
	else if (e.cancelBubble)  //IE8 and Lower
		e.cancelBubble = true;
}

function DonaDataJSComAText(d)
{
	return d.getFullYear()+ "-" + ((d.getMonth() + 1>9) ? "":"0") + (d.getMonth() + 1)+ "-" + ((d.getDate()>9) ? "":"0") + d.getDate()+ " " + ((d.getHours()>9) ? "":"0") + d.getHours()+ ":" +((d.getMinutes()>9) ? "":"0") + d.getMinutes()+ ":" +((d.getSeconds()>9) ? "":"0") + d.getSeconds();
}

function DonaValorDeFormulari(clau_a_buscar, contingut, inclou_servidor)
{
var clau=clau_a_buscar.toUpperCase()+"=";
	if (inclou_servidor==true)
		contingut=contingut.substring(contingut.indexOf("?")+1,contingut.length);
	if (contingut.charAt(0)=="?")
		contingut=contingut.substring(1,contingut.length);

	var kvp=contingut.split("&");
	for (var i_kvp=0; i_kvp<kvp.length; i_kvp++)
	{
		if (kvp[i_kvp].substring(0, clau.length).toUpperCase()==clau)
			return unescape(kvp[i_kvp].substring(clau.length,kvp[i_kvp].length));
	}
	return null;
}

function DonaCadenaDataPerValorDeFormulari(str_data)
{
	//Els recursos data i hora usats no deixen enviar el formulari si no està complert, per tant cap problema de dates o hores "a mitges"
	//He comprovat que el recurs data (al Chrome com a mínim) et pot tornar això "19777-08-03"
	//No cal usar DonaCadenaPerValorDeFormulari perquè els caràcters que aquesta funció substitueix no estan presents a aquest recurs segur		
	var pos = str_data.indexOf("-");
	if (pos == -1 || pos < 4) //No té cap guió (també si és buida!) o anys escrit amb menys de 4 digits
	{	//No hauria de passar, i el recurs sembla no permetre-ho, però per si de cas si passa això entenc que està malament i retorno ""
		var s="";	
		return s;
	}

	if (pos == 4) //tinc any de 4 digits: ####-[...] -> tot ok
		return str_data;
	
	//any escrit amb més de quatre dígits, que he comprovat que això amb el recurs sí que pot passar	
		return str_data.substring(0,4)+str_data.substring(pos);
}

function DonaCadenaDataHoraPerValorDeFormulari(str_data, str_hora)
{
var s="";

	//Els recursos data i hora usats no deixen enviar el formulari si no està complert, per tant cap problema de dates o hores "a mitges"
	//El que si que pot passar és que algú defineixi l'hora i no la data, però això ja ho controlo jo aquí sota :)
	//No cal usar DonaCadenaPerValorDeFormulari perquè els caràcters que aquesta funció substitueix no estan presents a aquest recurs segur		
	s=DonaCadenaDataPerValorDeFormulari(str_data);
	if (s=="")
		return s;

	if (str_hora=="")
		return s;		
	//Per que els XML validin, la data hora hora ha de ser fins els segons i amb Z (o altres indicadors de fus, però ara no ens liem amb això)
	s+="T"+str_hora+":00Z";
	
	return s;
}

/*Copied from http://www.w3schools.com/dom/dom_loadxmldoc.asp    finalment no la necessito.
function loadXMLString(txt) 
{
var xmlDoc;
	if (window.DOMParser)
	{
		var parser=new DOMParser();
		xmlDoc=parser.parseFromString(txt,"text/xml");
	}
	else // code for IE
   	{
		xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
		xmlDoc.async=false;
		xmlDoc.loadXML(txt); 
	}
	return xmlDoc;
}*/

var PendingToken="";
var ActionAfterSignIn=null;
var ParamActionAfterSignIn=null;
var ChangeLang=true;  //Change language following user preferences?

function ExtreuParametresKVPdeCadena(cadena, query)
{
		for (var i=0; i<cadena.length; i++)
		{
			var j = cadena[i].indexOf("=");  // Gets the first index where a space occours
			if (j==-1)
			{
				alert("Format error in query URL '" + cadena + "', Key and value pair (KVP) '" + cadena[i] + "' without '='.").
				break;
			}
			query[unescape(cadena[i].substring(0, j)).toUpperCase()]=unescape(cadena[i].substring(j+1));
		}
		return;
}

var PendingPostMessage="";
var ParamsQuery={};

function AnalitzarParametresURL(fragment)
{
var share_borrower_1="", access_token_type="";
var i;
var query={};
var kvp="";
		
	if (fragment)
	{
		PendingPostMessage="";
		kvp=fragment.substring(1, fragment.length).split("&");
	}
	else if (location.search && location.search.substring(0,1)=="?")
	{
		ParamsQuery.newpage="";
		ParamsQuery.email="";
		ParamsQuery.llista_targets=[];		
		kvp=location.search.substring(1, location.search.length).split("&");
	 }
		
	if (kvp)
	{		
		ExtreuParametresKVPdeCadena(kvp, query);
		if (query["USER"])
			document.sign_in.user.value=query["USER"];
		if (query["PASSWORD"])
			document.sign_in.pass.value=query["PASSWORD"];
		if (query["EMAIL"])
			ParamsQuery.email=query["EMAIL"];
		if (query["LANGUAGE"])
		{
			i=GetActiveLanguageIndex(query["LANGUAGE"].toLowerCase());
			if (i==-1)
				ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_language)+": \""+query["LANGUAGE"].toLowerCase()+"\".");
			else
			{
				ActiveLanguage=i;
				ChangeLang=false;
			}
		}
		if (query["TOKEN"])
			PendingToken=query["TOKEN"];
		if (query["TOKEN_DESC"])
			document.getElementById("execute-token-subtitle-text").innerHTML=query["TOKEN_DESC"];
		if (query["PAGE"])
			ParamsQuery.newpage=query["PAGE"].toUpperCase();
		if (query["SHARE_BORROWER_1"])
			share_borrower_1=query["SHARE_BORROWER_1"];
			
		var sufix="";
		i=1
		while (true)
		{
			if (query["TARGET_TITLE"+sufix] && query["TARGET_CODE"+sufix])
				;
			else
			   break;
		
			ParamsQuery.llista_targets.push({"title": query["TARGET_TITLE"+sufix], "code": query["TARGET_CODE"+sufix], 
					"code_space": (query["TARGET_CODESPACE"+sufix] ? query["TARGET_CODESPACE"+sufix].replace("https://","http://") : ""), 
					"role": (query["TARGET_ROLE"+sufix] ? query["TARGET_ROLE"+sufix] : "primary"), 
					"share_borrower_1": share_borrower_1});				
	
			i++;
			sufix="_"+i;
		}
		
		if (query["ACCESS_TOKEN_TYPE"])
		{
			access_token_type=query["ACCESS_TOKEN_TYPE"].toLowerCase;
			if (access_token_type=="nextgeoss")
				ValidaSSONextGEOSS(true, SignInNBNextGEOSS, null);
			else if (access_token_type=="landsense")
				ValidaSSOLandSense(true, SignInNBLandSense, null);
			else if (access_token_type=="google")
				ValidaSSOGoogle();
			else if (access_token_type=="debug")
				ValidaSSODebug();					
		}
		if (query["ABSTRACT"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.abstract=query["ABSTRACT"];
		}
		if (query["REPORT_ASPECT"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.report_aspect=query["REPORT_ASPECT"];
		}
		if (query["SPECIFIC_USAGE"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.specific_usage=query["SPECIFIC_USAGE"];
		}
		if (query["RU_CODE"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_code=query["RU_CODE"];
		}
		if (query["RU_CODE_FORMAT"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_code_format=query["RU_CODE_FORMAT"];
		}
		if (query["RU_PLATFORM"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_platform=query["RU_PLATFORM"];
		}
		if (query["RU_VERSION"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_version=query["RU_VERSION"];
		}
		if (query["RU_SCHEMA"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_schema=query["RU_SCHEMA"];
		}					
		if (query["RU_SUGG_APP"])
		{
			if (!ElementsOfAFeedback)
				ElementsOfAFeedback={};						
			ElementsOfAFeedback.ru_sugg_app=query["RU_SUGG_APP"];
		}
		/*else
			ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_key) +": \""+ valor+"\".");
		break;*/
		if (query["POST_MESSAGE_FROM"])
		{
			PendingPostMessage=query["POST_MESSAGE_FROM"];
			if (window.opener)
			{
				NotifyOpenerIAmReady(PendingPostMessage);
				return;
			}	
			else
				ShowInfo("long", "POST_MESSAGE_FROM param without an opener, it will be ommited");
		}
	}

	if (typeof ParamsQuery.newpage !== "undefined" && ParamsQuery.newpage!="")
	{	
		if (ParamsQuery.newpage=="NEWPASSWORD")
			EntraANewPassword();
		else if (ParamsQuery.newpage=="NEWUSER")
			EntraANewUser(ParamsQuery.email);
		else if (ParamsQuery.newpage=="TOKEN")
			EntraAExecuteToken();
		else if (ParamsQuery.newpage=="RESETPASSWORD")
		{
			if (PendingToken=="")
			{
				ShowInfo("long", DonaCadenaJSON(Msg_Valid_token_required));
				return;
			}
			EntraAResetPassword();
		}
		else if (ParamsQuery.newpage=="MAIN")
			EntraANimmbusMain();
		else if (ParamsQuery.newpage=="ADDFEEDBACK")
		{
			if (ParamsQuery.llista_targets.length==0) //no he detectat cap target vàlid
			{
				ShowInfo("long", DonaCadenaJSON(Msg_TARGET_TILE_and_CODE_needed));
				return;
			}
			ActionAfterSignIn=EntraAAddFeedback;	
			ParamActionAfterSignIn={targets : ParamsQuery.llista_targets};
		}
		else
			ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_page) +": \""+ ParamsQuery.newpage+"\".");
	}
}

function NotifyOpenerIAmReady(url)
{
	if (window.opener)
		window.opener.postMessage("I'm ready", url); //"el primer paràmetre no l'usem per res però podria servir per dir alguna cosa al opener"
}

function InitFrontPage()
{
	RevisaCrossSserverServersNB(ServersNB);
	InitHello();
	SurtDeNimmbus();
	AnalitzarParametresURL();
	ChangeLanguage(ActiveLanguage, ResourcesPerPage);
}

var TimeOutBoxCloser=0;
var CloseDropDownListOutMenu=null;
var CloseDropDownListOutSubMenu=null;

function SwitchDropDownList(menu_id, submenu_id)
{
	if (document.getElementById(submenu_id).style.visibility=="")
		document.getElementById(submenu_id).style.visibility="hidden";

	if (document.getElementById(submenu_id).style.visibility=="hidden")
	{
		document.getElementById(submenu_id).style.visibility="visible";
		//Remove menu when clicking outside: http://www.techjunkie.com/close-div-click-outside/
		CloseDropDownListOut(CloseDropDownListOutSubMenu);

		CloseDropDownListOutMenu=menu_id;
		CloseDropDownListOutSubMenu=submenu_id;

		document.body.removeEventListener('click', CloseDropDownListOutEvent, false);
		if (TimeOutBoxCloser)
			clearTimeout(TimeOutBoxCloser);
		TimeOutBoxCloser=setTimeout("document.body.addEventListener('click', CloseDropDownListOutEvent, false);", 300);
	}
	else
		CloseDropDownListOut(submenu_id);
}

function CloseDropDownListOut(id)
{
	document.body.removeEventListener('click', CloseDropDownListOut, false);
	if (id)
		document.getElementById(id).style.visibility='hidden';
}

function CloseDropDownListOutEvent(event)
{
	if (!event)
		event=window.event;
	if(event.target.id != CloseDropDownListOutMenu)
	{
		CloseDropDownListOut(CloseDropDownListOutSubMenu);
		CloseDropDownListOutSubMenu=null;		
	}
}

function DonaIDProcessDesDeRootXML(root)
{
var process, metadata, title, id;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,8)=="sync_id:")
				{
					return title.value.substring(8);
				}
			}
		}
	}
	return "";
}

function DonaIDRecursDesDeRootXML(root)
{
var process, metadata, title;

	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
		if (metadata)
		{
			for (var item=0; item<metadata.length; item++)
			{
				title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
				if (title && title.value.substring(0,7)=="obj_id:")
				{
					return title.value.substring(7);
				}
			}
		}
	}
	return "";
}

//En alguns casos poso un msg_id i msg_desc per comunicar coses.
//p.ex un NB_RESOURCE:CREATE pot dir que el recurs no es crea perquè ja existeix.
function MostraMissatgeDesDeRootProcesXML(root)
{
var process_succeeded, process, metadata, title;

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		process=GetXMLElementByName(root, "wps", "Process");
		if (process)
		{
			metadata=GetXMLElementCollectionByName(process, "ows", "Metadata");
			if (metadata)
			{
				for (var item=0; item<metadata.length; item++)
				{
					title=GetXMLAttributeByName(metadata.item(item), "xlink", "title");
					if (title && title.value.substring(0,9)=="msg_desc:")
					{
						ShowInfo("long", title.value.substring(9));
						return true;
					}
				}
			}
		}
	}
	return false;
}

function TiraAPantallaRespostaSiNoEntenc(root, no_usat)
{
	//Si no entenc el document el tiro sencer a la finestra
	if (root.xml)
	{
		ShowInfo("long", "<xmp>"+root.xml+"</xmp>");
		UpdateLastServer();
		return;
	}
	if (XMLSerializer)
	{
		var serializer = new XMLSerializer();   
		ShowInfo("long", "<xmp>"+serializer.serializeToString(root)+"</xmp>");		
		UpdateLastServer();
		return;
	}
	ShowInfo("long", DonaCadenaJSON(Msg_Server_answer_cannot_be_shown));
	UpdateLastServer();
	return;
}

function DonaRootXML(doc, no_usat)
{
	if (!doc || !doc.documentElement)
	{
		
		ShowInfo("long", DonaCadenaJSON(Msg_Server_answer_cannot_be_identified));
		UpdateLastServer();
		return null;
	}
	return doc.documentElement;
}

function AnalitzaExceptionReport(root, no_usat)
{
var exception_error;

	exception_error=GetXMLElementByName(root, "ows", "ExceptionText");
	if (exception_error)
	{
		ShowInfo("long", exception_error.childNodes[0].nodeValue);
		UpdateLastServer();
		return true;
	}
	//Si no trobo text, potser encara trobaré el codi
	exception_error=GetXMLElementByName(root, "ows", "Exception");
	if (exception_error)
	{
		exception_error=GetXMLAttributeByName(exception_error, null, "exceptionCode");
		if (exception_error && exception_error.value)
		{
			ShowInfo("long", exception_error.value);
			UpdateLastServer();
			return true;
		}
	}
	return false;
}


var ajaxExecuteNB;

var TimeOutDonaResposta=0;

function AvaluaResposta(doc, nom_funcio_i_params, target_en_creacio)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	id_obj=DonaIDRecursDesDeRootXML(root);  //La execució de NB_RESOURCE:CREATE dona l'ID de recurs que s'està en procés de crear.
	if (id_obj!="")
	{
		//Exploro si pot ser que hi hagi un missatge de resposta immediata
		if (MostraMissatgeDesDeRootProcesXML(root))
		{
			RemoveInfo("permanent");
			return;
		}
		if (target_en_creacio)
		{
			var json_funcio_i_params=JSON.parse(nom_funcio_i_params);
			var json_params=JSON.parse(json_funcio_i_params.params);
			TargetsOfAFeedback.push({"id_target": id_obj, "role": (json_params.current_role ? json_params.current_role : "primary")}); 
		}
		else
			IdResourceToSaveChanges=id_obj;
	}
	
	id_proces=DonaIDProcessDesDeRootXML(root);
	if (id_proces!="")
	{
		//ShowInfo("long", "Process id:"+id_proces);
		if (TimeOutDonaResposta)
			clearTimeout(TimeOutDonaResposta);
		TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+id_proces+"\", "+nom_funcio_i_params+");", 1300);
		return;
	}

	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function DiguesOKIEntraANimmbusCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Ok));
	window.onbeforeunload = ConfirmExit;
	if (ActionAfterSignIn)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
		EntraANimmbusMain(true);
}

function AvaluaRespostaOk(doc, nom_funcio)
{
var root, output, process_succeeded, identifier;

	RemoveInfo("permanent");

	root=DonaRootXML(doc, document);
	if (!root || AnalitzaExceptionReport(root, document))
		return;

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		output=GetXMLElementCollectionByName(root, "wps", "Output");

		if (output && output.length)
		{
			for (var item=0; item<output.length; item++)
			{
				identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
				if (identifier && identifier.childNodes[0].nodeValue=="statusCode")
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s=="uncreated")
					{
						//Cal crear l'usuari i esperar fins que sigui fet per entrar.
						UpdateLastServer();
						SignUpNB("DiguesOKIEntraANimmbusCallBack");
						return;		
					}
				}
			}
		}

		fn=window[nom_funcio];
		if (typeof fn === "function")
			fn(); 
		else 
			alert("AvaluaRespostaOk(doc, nom_funcio) error in parameter \"nom_funcio\": "+ nom_funcio +" is not a function.");
		UpdateLastServer();
		return;
	}

	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function InitHello()
{
	hello.init({
		//google: '281597821362-tkj1tngjiiuul47m6dkhrorrsdqomahu.apps.googleusercontent.com',
		landsense: '920b7ffa-1d18-b836-8ff3-514042772543@as.landsense.eu',
		nextgeoss: '@!27B7.E085.07A1.6DE7!0001!F5E4.0B8E!0008!7BBE.671A.BD2B.6459'
	}, {redirect_uri: ((location.pathname.charAt(location.pathname.length-1)=='/') ? location.pathname.substring(0, location.pathname.length-1) : location.pathname), popup: {width: 800}});
	document.getElementById("landsense-button").disabled=false;
	document.getElementById("nextgeoss-button").disabled=false;
}

/* Called when Google Javascript API Javascript is loaded
 The "normal" prodedure indicated here: https://developers.google.com/identity/sign-in/web/sign-in
 is not applicable because the user does not have control and Google takes precedence to any other kind
 of identification forcing immediate validation on google systems. Instead, the procedure described here 
 (and adopted by us):
 http://usefulangle.com/post/55/google-login-javascript-api allow for creating a botton that the user
 is free to select among other offered alternatives.
 The instructions includes the ay to register in google console: https://console.developers.google.com
 both the API key for google+ API and the Credentials for the NiMMBus web application.*/

function HandleGoogleApiLibrary() 
{
	// Load "client" & "auth2" libraries
	gapi.load('client:auth2', {
		callback: function() {
			// Initialize client library
			// clientId & scope is provided => automatically initializes auth2 library
			gapi.client.init({
		    	apiKey: 'AIzaSyBSTYA3cOVJ1fuVGBrJXT8gsrRvFjp74x8',
		    	clientId: '281597821362-tkj1tngjiiuul47m6dkhrorrsdqomahu.apps.googleusercontent.com',
		    	scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/plus.me'
			}).then(
				// On success
				function(success) {
			  		// After library is successfully loaded then enable the login button
					document.getElementById("google-button").disabled=false;
				}, 
				// On error
				function(error) {
					alert(DonaCadenaJSON(Msg_Failure_loading_Google_libraries));
			  	}
			);
		},
		onerror: function() {
			// Failed to load libraries
			alert(DonaCadenaJSON(Msg_Failure_loading_Google_libraries));
		}
	});
}

var AccessToken="";
var AccessTokenType="";
var AccessTokenExpires=0; //Only populated and needed for nextgeoss

function parseJwt(token) 
{
	var base64Url = token.split(".")[1];
	var base64 = base64Url.replace("-", "+").replace("_", "/");
	return JSON.parse(window.atob(base64));
}

function OmpleHelloAccessTokenIType(access_token_type)
{
	try
	{
		var authResponse=hello(access_token_type).getAuthResponse();
		if (!authResponse || !authResponse.access_token)
			return 0;
		if (authResponse.access_token!=AccessToken || AccessTokenType!=access_token_type)
		{
			var jwt = parseJwt(authResponse.id_token);
	
			// https://github.com/kjur/jsrsasign/wiki/Tutorial-for-JWT-verification
	
			if (access_token_type=="nextgeoss")
				document.sign_in.user.value=decode_utf8(jwt.user_name);  //Sembla que nextgeoss que ho diferent i envia el nom del utf8. En canvi landsense ho fa "normal".
			else
				document.sign_in.user.value=jwt.name;
			AccessToken = authResponse.access_token;
			AccessTokenType = access_token_type;
		}
		return authResponse.expires;
	}
	catch (err)
	{
		alert("Error: " +err.message);
	}
}

function SignInNBNextGEOSS()
{
	OmpleHelloAccessTokenIType("nextgeoss");
	SignInNB();
}

function SignInNBLandSense()
{
	OmpleHelloAccessTokenIType("landsense");
	SignInNB();
}

function ValidaSSO(popup, f_callback, pending_ajax_req)
{
	if (AccessTokenType=="landsense")
	{
		ValidaSSOLandSense(popup, f_callback, pending_ajax_req);
		return;
	}
	if (AccessTokenType=="nextgeoss")
	{
		ValidaSSONextGEOSS(popup, f_callback, pending_ajax_req);
		return;
}
}

// Click on login button
function ValidaSSOLandSense(popup, f_callback, pending_ajax_req)
{
	document.getElementById("landsense-button").disabled=true;

	hello("landsense").login({redirect_uri: location.pathname, scope: "openid profile email", display: (popup ? "popup" : "none")}).then(
		function(success) {
			//alert("success");
			//console.log("Success login LandSense: " + success);
			if (f_callback)
				f_callback();
			if (pending_ajax_req)
				pending_ajax_req.doReqAutenticated();
			document.getElementById("landsense-button").disabled=false;
		},
		// On error
		function(error) {
			alert(DonaCadenaJSON(Msg_LandSense_login_failed) + error.error.message);
			document.getElementById("landsense-button").disabled=false;
		}
	);
}

function ValidaSSONextGEOSS(popup, f_callback, pending_ajax_req)
{
	document.getElementById("nextgeoss-button").disabled=true;

	/*The automatic regeneration of the token in the background happens every 10 minutes (wrong timing since token expires in 5 minutes only). 
	To make the situation worse, the automatically generated new token does not work in the server side, so I have to force reauthentification using 
	'force: true'. Then, I cannot relay on the expiration of the new automatic token that I get from hello.getAutoResponse() and I will save the old 
	expiration date and relay on it. (JM) 2018-07-05*/
	hello("nextgeoss").login({redirect_uri: ((location.pathname.charAt(location.pathname.length-1)=='/') ? location.pathname.substring(0, location.pathname.length-1) : location.pathname), scope: "open_id profile email user_name", display: (popup ? "popup" : "none"), force: true}).then(
		function(success) {
			//alert("success");
			//console.log("Success login NextGEOSS: " + success);
			AccessTokenExpires=success.authResponse.expires;
			if (f_callback)
				f_callback();
			if (pending_ajax_req)
				pending_ajax_req.doReqAutenticated();
			document.getElementById("nextgeoss-button").disabled=false;
		},
		// On error
		function(error) {
			alert(DonaCadenaJSON(Msg_NextGEOSS_login_failed) + error.error.message);
			document.getElementById("nextgeoss-button").disabled=false;
		}
	);
}

// Click on login button
function ValidaSSODebug()
{
	document.getElementById("sso-debug-button").disabled=true;

	document.sign_in.user.value="Debug"
	AccessToken = "1234-5678-1234-5678";
	AccessTokenType = "debug";
	document.getElementById("sso-debug-button").disabled=false;
	SignInNB();
}


// Click on login button
function ValidaSSOGoogle() 
{
	document.getElementById("google-button").disabled=true;
			
	// API call for Google login
	gapi.auth2.getAuthInstance().signIn().then(
		// On success
		function(success) {
			// API call to get user information
			gapi.client.request({ path: 'https://www.googleapis.com/plus/v1/people/me' }).then(
				// On success
				function(success) {
					var user_info = JSON.parse(success.body);
					//console.log(user_info);
					document.sign_in.user.value=user_info.displayName;

					//user_info.id;
					//user_info.gender;
					//user_info.image.url;
					//emails[0].value;

					//Extret de: https://github.com/google/google-api-javascript-client/issues/239
					AccessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token;
					AccessTokenType = "google";
					//console.log("ID Token: " + AccessToken);

					//$("#google-button").hide();  No cal així si retrocedeixo funciona.
					document.getElementById("google-button").disabled=false;

					SignInNB();
				},
				// On error
				function(error) {
					document.getElementById("google-button").disabled=false;

					alert(DonaCadenaJSON(Msg_Google_Account_info_not_retrieved));
				}
			);
		},
		// On error
		function(error) {
			document.getElementById("google-button").disabled=false;
			alert(DonaCadenaJSON(Msg_Google_login_failed));
		}
	);
};


function AfegeixCredencialsToken(ajax)
{
	if (AccessToken.length)
	{
		ajax.setRequestHeader("nb-access-token", AccessToken);  //Eliminar aquest
		ajax.setRequestHeader("Authorization", "Bearer " + AccessToken);
		ajax.setRequestHeader("nb-access-token-type", AccessTokenType);
	}
}

function AfegeixCredencialsUsuari(ajax, user, pass)
{
	if (AccessToken.length==0)
	{
		ajax.setRequestHeader("nb-user", (user==null ? document.sign_in.user.value : user.value));
		ajax.setRequestHeader("nb-password", (pass==null ? document.sign_in.pass.value : pass.value));
	}
}

function SignInNB()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:VALIDATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaOk, "text/xml",
				"DiguesOKIEntraANimmbusCallBack");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function AvaluaRespostaGetReturn(doc, nom_funcio_i_params)
{
var root, output, identifier;
var fn;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				var codi="";
				if (identifier.childNodes[0].nodeValue=="code")
				{					
					codi=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (codi=="0")
					{
						RemoveInfo("permanent");
						ShowInfo("short", DonaCadenaJSON(Msg_Ok));
						UpdateLastServer();
						//uso el truco següent: http://www.sitepoint.com/call-javascript-function-string-without-using-eval
						fn=window[nom_funcio_i_params.nom_funcio]
						if (typeof fn === "function")
						{
							if (typeof nom_funcio_i_params.params === "string" && nom_funcio_i_params.params[0]==="{")
							//en algun context params conté un JSON en string (p.ex "{"targets":[{"title":"Sentinel 2 L2A Collection","code":"Sentinel2Level...")
								fn(JSON.parse(nom_funcio_i_params.params));
							else //i en altres només una cadena normal "FEEDBACK"
								fn(nom_funcio_i_params.params);
						}
						else 
							alert("AvaluaRespostaGetReturn(doc, nom_funcio_i_params) error in parameter \"nom_funcio_i_params.nom_funcio\": "+ nom_funcio_i_params.nom_funcio +" is not a function.");
						return;
					}
					if (codi=="7")
					{
						if (TimeOutDonaResposta)
							clearTimeout(TimeOutDonaResposta);
						TimeOutDonaResposta=setTimeout("EvaluateGetReturnProcess(\""+DonaIDProcessDesDeRootXML(root)+"\", "+JSON.stringify(nom_funcio_i_params)+");", 1000);
						return;
					}
				}
				
				if (identifier.childNodes[0].nodeValue=="description")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s=="")
						s=DonaCadenaJSON(Msg_Error_without_description)+ ": " +codi;

					RemoveInfo("permanent");
					ShowInfo("long", s);
					UpdateLastServer();
					return;
				}
			}
		}
	}
	RemoveInfo("permanent");
	TiraAPantallaRespostaSiNoEntenc(root, document);
	return;
}

function EvaluateGetReturnProcess(id, nom_funcio_i_params)
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SYNC:GETRETURN&LANGUAGE="+LanguagesNB[ActiveLanguage]+"&SYNC_ID="+id, AvaluaRespostaGetReturn, "text/xml", 
				nom_funcio_i_params);
}

function AvaluaRespostaRetrieveUserMinPreferences(doc)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language" && ChangeLang)
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						var i;
						i=GetActiveLanguageIndex(s);
						if (i==-1)
						{
							ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_language));
						}
						else
						{
							if (ActiveLanguage!=i)
							{
								ChangeLanguage(i, ResourcesPerPage);
								ShowInfo("short", DonaCadenaJSON(Msg_Language_changed_preferences));
								if (location.hash=="#feedback-resource" && ActionAfterSignIn==TancaFinestraNimmbus)
								{ //he entrat directament a pàgina de valoració des de ADDFEEDBACK
									document.getElementById("feedback-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_feedback);
									document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_feedback_characteristics);
									document.getElementById("feedback-resource_btn").value=DonaCadenaJSON(Msg_Create);									
								}
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="name")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						document.account_form.name.value=s;
						document.getElementById("main-left-pannel-title-text").innerHTML=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="obj_time")
				{
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
						document.getElementById("main-left-pannel-date-text").innerHTML=s.substring(0, s.indexOf("T"));
				}
			}
		}
		UpdateLastServer();
	}
	else
	{	
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function RetrieveUserMinPreferences()
{
	//RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaRetrieveUserMinPreferences, "text/xml", null);
        //ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
	return false;
}

function ObreSelectorGeneral(make_pannel_visible, resource_type, resource_origin, element_origin)
{
		EnumerateResources(1, {"type_enum":"resource-selector", "make_pannel_visible":make_pannel_visible, "resource_type": resource_type, "resource_origin": resource_origin, "element_origin": element_origin});
		return;	
}

function EliminaPublicOfAFeedback(del_item)
{
	PublicsOfAFeedback.splice(del_item, 1);	
	OmpleRecursPublicsDesDePublicsOfAFeedback(true);
	PublicsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixPublicOfAFeedback(id_public, open_data)
{
	if (id_public==null)
		;
	/*else if (id_public=='')
		ShowInfo("short", DonaCadenaJSON(Msg_Publication_already_related_no_added_again));*/
	else
	{		
		PublicsOfAFeedback.push({"id_public": id_public, "open_data": open_data});
 		OmpleRecursPublicsDesDePublicsOfAFeedback(true);
		PublicsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}

function EliminaRefDocOfAFeedback(del_item)
{
	RefDocsOfAFeedback.splice(del_item, 1);	
	OmpleRecursRefDocsDesDeRefDocsOfAFeedback(true);
	RefDocsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixRefDocOfAFeedback(id_public, open_data)
{
	if (id_public==null)
		;
	/*else if (id_public=='')
		ShowInfo("short", DonaCadenaJSON(Msg_***_already_related_no_added_again));*/
	else
	{		
		RefDocsOfAFeedback.push({"id_public": id_public, "open_data": open_data});
 		OmpleRecursRefDocsDesDeRefDocsOfAFeedback(true);
		RefDocsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}

function EliminaAltRsrcOfAFeedback(del_item)
{
	AltRsrcsOfAFeedback.splice(del_item, 1);	
	OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback(true);
	AltRsrcsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixAltRsrcOfAFeedback(id_citation, open_data)
{
	if (id_citation==null)
		;
	/*else if (id_citation=='')
		ShowInfo("short", DonaCadenaJSON(Msg_***_already_related_no_added_again));*/
	else
	{		
		AltRsrcsOfAFeedback.push({"id_citation": id_citation, "open_data": open_data});
 		OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback(true);
		AltRsrcsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}

function EliminaFixRsrcOfAFeedback(del_item)
{
	FixRsrcsOfAFeedback.splice(del_item, 1);	
	OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback(true);
	FixRsrcsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixFixRsrcOfAFeedback(id_citation, open_data)
{
	if (id_citation==null)
		;
	/*else if (id_citation=='')
		ShowInfo("short", DonaCadenaJSON(Msg_***_already_related_no_added_again));*/
	else
	{		
		FixRsrcsOfAFeedback.push({"id_citation": id_citation, "open_data": open_data});
 		OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback(true);
		FixRsrcsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}


function EliminaAddDocOfAFeedback(del_item)
{
	AddDocsOfAFeedback.splice(del_item, 1);	
	OmpleRecursAddDocsDesDeAddDocsOfAFeedback(true);
	AddDocsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixAddDocOfAFeedback(id_citation, open_data)
{
	if (id_citation==null)
		;
	/*else if (id_citation=='')
		ShowInfo("short", DonaCadenaJSON(Msg_***_already_related_no_added_again));*/
	else
	{		
		AddDocsOfAFeedback.push({"id_citation": id_citation, "open_data": open_data});
 		OmpleRecursAddDocsDesDeAddDocsOfAFeedback(true);
		AddDocsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}

function EliminaTargetOfAFeedback(del_item)
{
	RecuperaCanvisARolesATargetsOfAFeedback();		
	TargetsOfAFeedback.splice(del_item, 1);	
	OmpleRecursTargetsDesDeTargetsOfAFeedback(true);
	TargetsOfAFeedbackHaveChanged=true;	
	return;	
}

function AfegeixTargetOfAFeedback(id_target, open_data)
{
	if (id_target==null)  //S'ha cancel·lat d'afegir res.
		;
	/*else if (id_target=='') //S'ha seleccionat un recurs que no té sentit que se seleccioni.
		ShowInfo("short", DonaCadenaJSON(Msg_Resource_already_targeted_no_added_again));*/
	else
	{
		RecuperaCanvisARolesATargetsOfAFeedback();		
		TargetsOfAFeedback.push({"id_target": id_target, "role": "primary", "open_data": open_data});
		OmpleRecursTargetsDesDeTargetsOfAFeedback(true);
		TargetsOfAFeedbackHaveChanged=true;	
	}

	//ChangePannel("feedback-resource", true);
	history.back();
	return;	
}

function EliminaResponsibleOfACitation(del_item)
{
	RecuperaCanvisARolesAResponsiblesOfACitation();		
	ResponsiblesOfACitation.splice(del_item, 1);	
	OmpleRecursResponsiblesDesDeResponsiblesOfACitation(true);
	ResponsiblesOfACitationHaveChanged=true;	
	return;	
}

function AfegeixResponsibleOfACitation(id_responsible, open_data)
{
	if (id_responsible==null)  //S'ha cancel·lat d'afegir res.
		;
	/*else if (id_responsible=='') //S'ha seleccionat un recurs que no té sentit que se seleccioni.
		ShowInfo("short", DonaCadenaJSON(Msg_Resource_already_targeted_no_added_again $$$ ));*/
	else
	{
		RecuperaCanvisARolesAResponsiblesOfACitation();		
		ResponsiblesOfACitation.push({"id_responsible": id_responsible, "role": "undefined", "open_data": open_data});
		OmpleRecursResponsiblesDesDeResponsiblesOfACitation(true);
		ResponsiblesOfACitationHaveChanged=true;	
	}

	//ChangePannel("citation-resource", true);
	history.back();
	return;	
}

function EliminaResponsibleOfAPublication(del_item)
{
	RecuperaCanvisARolesAResponsiblesOfAPublication();		
	ResponsiblesOfAPublication.splice(del_item, 1);	
	OmpleRecursResponsiblesDesDeResponsiblesOfAPublication(true);
	ResponsiblesOfAPublicationHaveChanged=true;	
	return;	
}

function AfegeixResponsibleOfAPublication(id_responsible, open_data)
{
	if (id_responsible==null)  //S'ha cancel·lat d'afegir res.
		;
	/*else if (id_responsible=='') //S'ha seleccionat un recurs que no té sentit que se seleccioni.
		ShowInfo("short", DonaCadenaJSON(Msg_Resource_already_targeted_no_added_again $$$ ));*/
	else
	{
		RecuperaCanvisARolesAResponsiblesOfAPublication();		
		ResponsiblesOfAPublication.push({"id_responsible": id_responsible, "role": "undefined", "open_data": open_data});
		OmpleRecursResponsiblesDesDeResponsiblesOfAPublication(true);
		ResponsiblesOfAPublicationHaveChanged=true;	
	}

	//ChangePannel("publication-resource", true);
	history.back();
	return;	
}

function AvaluaRespostaRetrieveResourceCompacte(doc, dades)
{ 
var root, output, identifier, s, elem, citation, md_identifier, title, code=null, code_space=null, type, href=null, position=null, open_data=false, s_table;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					title=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="openData")
				{
					open_data=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
					if (dades.is_target_public_or_none==1) //aquest item és un dels arrays de targets de FB
						TargetsOfAFeedback[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==2)  //aquest item és un dels arrays de publics de FB
						PublicsOfAFeedback[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==3)  //aquest item és un dels arrays de responsibles de Citation
						ResponsiblesOfACitation[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==4)  //aquest item és un dels arrays de responsibles de Publication
						ResponsiblesOfAPublication[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==5)	//aquest item és un dels arrays de RefDocs (publics) de FB
						RefDocsOfAFeedback[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==6)	//aquest item és un dels arrays de AddDocs (citations) de FB
						AddDocsOfAFeedback[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==7)	//aquest item és un dels arrays de AltRsrc (citations) de FB
						AltRsrcsOfAFeedback[dades.del_item-1].open_data=open_data;
					else if (dades.is_target_public_or_none==8)	//aquest item és un dels arrays de FixRsrc (citations) de FB
						FixRsrcsOfAFeedback[dades.del_item-1].open_data=open_data;
					//else if (dades.is_target_public_or_none==0)	
				}
				else if (identifier.childNodes[0].nodeValue=="type")
					type=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation" || identifier.childNodes[0].nodeValue=="publication")
				{	//els puc fer junts perquè només miro els elements de la part comuna				
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						md_identifier=GetXMLElementByName(citation, "mcc", "MD_Identifier");
						if (md_identifier)
						{
							//CODE						
							elem=GetXMLElementByName(md_identifier, "mcc", "code");
							if (elem)
								code=DonaTextDesDeGcoCharacterString(elem);
							//NAMESPACE
							elem=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
							if (elem)
								code_space=DonaTextDesDeGcoCharacterString(elem);
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="individu") 
				{
					;	//de moment no recupero res particular, potser més endavant posar email o, quan el tingui, el nom de l'organisme -> email || organisme $$
				}
				else if (identifier.childNodes[0].nodeValue=="organism") 
				{
					;	//de moment no recupero res particular, potser més endavant posar email o, quan el tingui, el nom de l'organisme -> email || organisme $$
				}
				else if (identifier.childNodes[0].nodeValue=="href")
					href=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="position")
				{				
					var georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
						position=GetValueXMLElementByName(georss, "gml", "pos");
				}
			}
		}
		RemoveInfo("permanent");		
		compact_element_item=(dades.del_item ? dades.compact_element+"_"+dades.del_item : dades.compact_element);
		//document.getElementById(compact_element_item).innerHTML="<table width=\"80%\">"; -> si faig això posa el table i el /table :( -> ho construeixo sobre s_table i després ho assigno
		s_table="<table width=\"100%\">";
		s_table+="<tr><td width=\"80\" align=\"center\"><img src=\""+DonaNomImgTipusRecurs(type, true)+"\">";

		if (dades.open_data && !open_data)
			s_table+="<img src=\"ExclamationMark36.png\" id=\""+compact_element_item+"_shared\"></td>";
		else //creo un element img també amb src="", perquè així el ID existeix sempre
			s_table+="<img src=\"\" id=\""+compact_element_item+"_shared\"></td>"; 
		
		s_table+="<td>"+title;		
		if ((type=="CITATION" || type=="PUBLICAT") && code)
			s_table+="<br>code: " + code + ", code_space: " + (code_space ? code_space : "");
		else if (type=="HREF" && href)
			s_table+="<br><a href=\"" + href + "\">" + href + "</a>";			
		else if (type=="POI" && position)
			s_table+="<br>lat/long: " + position;		
		//else if	(type=="INDIVIDU" && (email || organisme)) $$
		//else if	(type=="ORGANISM" && (adreça)) $$
		s_table+="</td>"
	
		if (dades.role || (dades.del_item && dades.del_function))
		{
			if (dades.role && dades.del_item && dades.del_function) //hi haurà informació del role i també botó esborrar
			{
				if (dades.select_role=="targetRole")
					s_table+="<td width=\"240\" align=\"right\">";
				else //responsibleRole cal més espai
					s_table+="<td width=\"280\" align=\"right\">";
			}
			else //només hi ha una de les dues coses
				s_table+="<td width=\"120\" align=\"right\">";
				
			if (dades.role)
			{
				if (dades.select_role=="targetRole")
				{
					select_role_item=(dades.del_item ? dades.select_role+"_"+dades.del_item : dades.select_role);
					s_table+=DonaCadenaJSON(Msg_Role)+": "+
							"<select class=\"text-input\" id=\""+select_role_item+"-feedback-resource_screen_value\" name=\""+select_role_item+"\">"+
								"<option value=\"primary\" "+((dades.role=="primary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["primary"])+"</option>"+
								"<option value=\"secondary\" "+((dades.role=="secondary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["secondary"])+"</option>"+
								"<option value=\"supplementary\" "+((dades.role=="supplementary") ? " selected=\"selected\"" : "")+">"+DonaCadenaJSON(GUF_TargetRoleCode["supplementary"])+"</option>"+
							"</select>";
				}
				else if (dades.select_role=="responsibleRole")
				{
					select_role_item=(dades.del_item ? dades.select_role+"_"+dades.del_item : dades.select_role);
					s_table+=DonaCadenaJSON(Msg_Role)+": "+
							"<select class=\"text-input\" id=\""+select_role_item+"-resource_screen_value\" name=\""+select_role_item+"\">";
							
					for (i in CI_RoleCode)
					{
						if (dades.role==i)
							s_table+="<option value=\""+i+"\" "+" selected=\"selected\""+">"+DonaCadenaJSON(CI_RoleCode[i])+"</option>";
						else
							s_table+="<option value=\""+i+"\">"+DonaCadenaJSON(CI_RoleCode[i])+"</option>";
					}								
					s_table+="</select>";							
				}
				else //tinc un valor de "role" però no tinc un select_role a crear, perquè estic en un context de només lectura -> ho poso com un text
				{
					if (typeof CI_RoleCode[dades.role] === "undefined")
					{
						if (typeof GUF_TargetRoleCode[dades.role] === "undefined")
							s_table+=DonaCadenaJSON(Msg_Role)+": "+dades.role;
						else								
							s_table+=DonaCadenaJSON(Msg_Role)+": "+DonaCadenaJSON(GUF_TargetRoleCode[dades.role]);						
					}
					else
						s_table+=DonaCadenaJSON(Msg_Role)+": "+DonaCadenaJSON(CI_RoleCode[dades.role]);						
				}
			}
			
			if (dades.del_item && dades.del_function)
				s_table+="<input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Delete) +"\" onClick=\""+dades.del_function+"("+(dades.del_item-1)+")\"/>";
				
			s_table+="</td>";
		}
		s_table+="</tr></table>";
		document.getElementById(compact_element_item).innerHTML=s_table;
		
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}


function AvaluaRespostaRetrieveResourceHref(doc, id)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.href_resource_form.title.value="";
		document.href_resource_form.href.value="";
		document.href_resource_form.reason.value="";
		//Valor per defecte de mimetype és "Other" que es marca amb CadenaBuida
		SeleccionaSelectDesDeValor(document.href_resource_form.mimetype, "");
				
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.href_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="href")
					document.href_resource_form.href.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="mimetype")
				{					
					SeleccionaSelectDesDeValor(document.href_resource_form.mimetype, 
							OmpleInputDesDeWPSLiteralOutput(output.item(item)));
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.href_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					var puc_modificar=true;
					
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Hyperlink_detailed_description_no_modification);
					}			
					document.getElementById("href-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("href-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("href-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("href-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';					
				}				
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;		
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourcePoi(doc, id)
{
var root, output, identifier, s, georss;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.poi_resource_form.title.value="";
		document.poi_resource_form.lat.value="";
		document.poi_resource_form.long.value="";
		document.poi_resource_form.elevation.value="";
		document.poi_resource_form.reason.value="";
		document.poi_resource_form.pos_accur.value=""
	
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.poi_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="position")
				{					
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "gml", "pos");
						if (s && -1!=s.indexOf(" "))
						{
							document.poi_resource_form.lat.value=s.substring(0,s.indexOf(" "));
							document.poi_resource_form.long.value=s.substring(s.indexOf(" ")+1, s.length);
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="elevation")
				{
					georss=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (georss)
					{
						s=GetValueXMLElementByName(georss, "georss", "elev");
						if (s)
							document.poi_resource_form.elevation.value=s;
					}
				}
				else if (identifier.childNodes[0].nodeValue=="reason")
					document.poi_resource_form.reason.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="pos_accuracy")
					document.poi_resource_form.pos_accur.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					var puc_modificar=true;
					
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_PoI_detailed_description_no_modification);
					}			
					document.getElementById("poi-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("poi-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("poi-gps-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("poi-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("poi-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
				}
			}
		}
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceFeedback(doc, id)
{
var root, output, identifier, s, feedback_item, user_comment;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");
	if (output && output.length)
	{
		document.feedback_resource_form.open_data.checked=false;								
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="openData")
					document.feedback_resource_form.open_data.checked=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
			}
		}
	}

	var guf=GetRetrieveResourceFeedbackOutputs(root);

	if (!guf)
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
		return;
	}
	
	TargetsOfAFeedback.length=0;
	TargetsOfAFeedbackHaveChanged=false;
	if (guf.target)
	{	
		for (var item=0; item<guf.target.length; item++)
		{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
			if (guf.target[item].identifier)
			{
  			for (var item2=0; item2<guf.target[item].identifier.length; item2++)
  			{
  				if (guf.target[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
  				{	//Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
  					TargetsOfAFeedback[item]={"id_target": guf.target[item].identifier[item2].code, "role": guf.target[item].role};  					
  					break;
  				}
  			}
			} 			
 			if (TargetsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
 				ShowInfo("long", DonaCadenaJSON(Msg_Target_without_NiMMbus_id));
		}
	}
	OmpleRecursTargetsDesDeTargetsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
	
	/*if (guf.title)
		document.feedback_resource_form.title.value=guf.title;
	else
		document.feedback_resource_form.title.value="";*/
	if (guf.abstract)
		document.feedback_resource_form.abstract.value=guf.abstract;
	else
		document.feedback_resource_form.abstract.value="";
	if (guf.purpose)
	{
		document.feedback_resource_form.reason.value=guf.purpose;
		CollapseFieldset(document.getElementById("reason-feedback-resource"), "block"); //not collapsed if it has content
	}
	else
	{
		document.feedback_resource_form.reason.value="";		
		CollapseFieldset(document.getElementById("reason-feedback-resource"), "none"); //default is collapsed
	}
	if (guf.contactRole)
		SeleccionaSelectDesDeValor(document.feedback_resource_form.contactRole, guf.contactRole);
	else //--> en aquest desplegable no hi ha un indefinit perquè és obligatori, valor per defecte el posem a publicGeneral
		SeleccionaSelectDesDeValor(document.feedback_resource_form.contactRole, "generalPublic");
	
	if (guf.user_comment)
	{
		if (guf.user_comment.comment)
			document.feedback_resource_form.comment.value=guf.user_comment.comment;
		else
			document.feedback_resource_form.comment.value="";
		if (guf.user_comment.motivation)
			SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, guf.user_comment.motivation);
		else //Valor per defecte és undefined, que es marca amb CadenaBuida
			SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, "undefined");
	}
	else
	{
		document.feedback_resource_form.comment.value="";
		SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, "undefined");
	}	
	CollapseFieldset(document.getElementById("user-comment-feedback-resource"), "block"); //default is not collapsed so shown even if empty
		
	//if (guf.rating) -> dins la funció ja es mira i, si no, es marca tot a indefinit! (sino veuria "la darrera" puntuació!)
	SeleccionaRadioDesDeValor(document.feedback_resource_form.rating, guf.rating);
	/* Ara sempre que entrem a CREAR un nou FB, el rating està indefinit (encara que el darrer cop hagués vist un element
	que si tenia rating. El que encara NO es pot fer es posar un altre cop a indefinit un rating d'un FB pel que si havia definit
	un valor, però això és estrany de voler fer, per tant ho deixem així. */

	//usage
	document.getElementById("reportAspect-feedback-usage").checked = false;
	document.getElementById("reportAspect-feedback-fitness-for-purpose").checked = false;
	document.getElementById("reportAspect-feedback-limitation").checked = false;
	document.getElementById("reportAspect-feedback-alternative").checked = false;
	document.getElementById("reportAspect-feedback-problem").checked = false;	
	if (guf.usage)
	{
		CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
		if (guf.usage.reportAspect && guf.usage.reportAspect.length>0)
		{
			for (var item=0; item<guf.usage.reportAspect.length; item++)
			{							
			 	if (guf.usage.reportAspect[item]=="usage")
			 		document.getElementById("reportAspect-feedback-usage").checked = true;
			 	else if (guf.usage.reportAspect[item]=="fitnessForPurpose")
			 		document.getElementById("reportAspect-feedback-fitness-for-purpose").checked = true;
			 	else if (guf.usage.reportAspect[item]=="limitation")			 					 	
					document.getElementById("reportAspect-feedback-limitation").checked = true;
				else if (guf.usage.reportAspect[item]=="alternative")
					document.getElementById("reportAspect-feedback-alternative").checked = true;
				else if (guf.usage.reportAspect[item]=="problem")
					document.getElementById("reportAspect-feedback-problem").checked = true;
			}		
		}
		
		if (guf.usage.usage_descr)
		{
			var hi_ha_reprod_usage=false;
			
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content
			if (guf.usage.usage_descr.specific_usage)
				document.feedback_resource_form.specific_usage.value=guf.usage.usage_descr.specific_usage;
			else
				document.feedback_resource_form.specific_usage.value="";

			if (guf.usage.usage_descr.usage_dt)
			{
				if (guf.usage.usage_descr.usage_dt.date)
					document.feedback_resource_form.usage_date.value=guf.usage.usage_descr.usage_dt.date;	
				else
					document.feedback_resource_form.usage_date.value="";	
				if (guf.usage.usage_descr.usage_dt.time)
					document.feedback_resource_form.usage_time.value=guf.usage.usage_descr.usage_dt.time;			
				else
					document.feedback_resource_form.usage_time.value="";			
			}
			else
			{
				document.feedback_resource_form.usage_date.value="";	
				document.feedback_resource_form.usage_time.value="";			
			}				

			if (guf.usage.usage_descr.user_det_lim)
				document.feedback_resource_form.user_determined_limitations.value=guf.usage.usage_descr.user_det_lim;
			else
				document.feedback_resource_form.user_determined_limitations.value="";

			if (guf.usage.usage_descr.response)
				document.feedback_resource_form.response.value=guf.usage.usage_descr.response;
			else
				document.feedback_resource_form.response.value="";

			AddDocsOfAFeedback.length=0;
			AddDocsOfAFeedbackHaveChanged=false;
			if (guf.usage.usage_descr.add_doc)
			{					
				for (var item=0; item<guf.usage.usage_descr.add_doc.length; item++)
				{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
					if (guf.usage.usage_descr.add_doc[item].identifier)
					{
		  			for (var item2=0; item2<guf.usage.usage_descr.add_doc[item].identifier.length; item2++)
		  			{		  				
		  				if (guf.usage.usage_descr.add_doc[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
		  				{ //Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
		  					AddDocsOfAFeedback[item]={"id_citation": guf.usage.usage_descr.add_doc[item].identifier[item2].code};
		  					break;
		  				}
		  			}
					} 			
		 			if (AddDocsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
		 				ShowInfo("long", DonaCadenaJSON(Msg_AddDoc_without_NiMMbus_id));
				}
				if (guf.usage.usage_descr.add_doc.length>0)
					CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "block"); //not collapsed if it has content
				else				
					CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "none"); //default is collapsed	
			}
			else				
				CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "none"); //default is collapsed	
							
			OmpleRecursAddDocsDesDeAddDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);

			hi_ha_reprod_usage=HiHaReprodUsage(guf.usage.usage_descr);			
			if (hi_ha_reprod_usage)
			{
				if (guf.usage.usage_descr.code)
					document.feedback_resource_form.code.value=guf.usage.usage_descr.code;
				else
					document.feedback_resource_form.code.value="";				
				//if (guf.usage.usage_descr.codeLink) -> ara és un onlineResource que potser té de tot però de moment només usem el linkage
				if (guf.usage.usage_descr.codeLink.linkage)
					document.feedback_resource_form.codeLink.value=guf.usage.usage_descr.codeLink.linkage;
				else
					document.feedback_resource_form.codeLink.value="";			
				if (guf.usage.usage_descr.codeMediaType)
					SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, guf.usage.usage_descr.codeMediaType);
				else
					SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ""); //"other"			
				if (guf.usage.usage_descr.platform)
					document.feedback_resource_form.platform.value=guf.usage.usage_descr.platform;
				else
					document.feedback_resource_form.platform.value="";
				if (guf.usage.usage_descr.version)
					document.feedback_resource_form.version.value=guf.usage.usage_descr.version;		
				else
					document.feedback_resource_form.version.value="";
				if (guf.usage.usage_descr.schema)
					document.feedback_resource_form.schema.value=guf.usage.usage_descr.schema;
				else
					document.feedback_resource_form.schema.value="";
				if (guf.usage.usage_descr.suggestedApplication)
					document.feedback_resource_form.sugg_app.value=guf.usage.usage_descr.suggestedApplication;
				else
					document.feedback_resource_form.sugg_app.value="";
				if (guf.usage.usage_descr.diagram)
					document.feedback_resource_form.diagram.value=guf.usage.usage_descr.diagram;
				else
					document.feedback_resource_form.diagram.value="";
				//if (guf.usage.usage_descr.diagramLink) -> ara és un onlineResource que potser té de tot però de moment només usem el linkage
				if (guf.usage.usage_descr.diagramLink.linkage)
					document.feedback_resource_form.diagramLink.value=guf.usage.usage_descr.diagramLink.linkage;
				else
					document.feedback_resource_form.diagramLink.value="";
				if (guf.usage.usage_descr.diagramMediaType)
					SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, guf.usage.usage_descr.diagramMediaType);
				else
					SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, ""); //"other"

				//Si té content ho faré gran
				CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
			}
			else //Si no té content ho faré petit
			{
				document.feedback_resource_form.code.value="";
				document.feedback_resource_form.codeLink.value="";
				SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ""); //"other"
				document.feedback_resource_form.platform.value="";
				document.feedback_resource_form.version.value="";
				document.feedback_resource_form.schema.value="";
				document.feedback_resource_form.sugg_app.value="";
				document.feedback_resource_form.diagram.value="";
				document.feedback_resource_form.diagramLink.value="";
				SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, ""); //"other"			
				CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "none");
			}

			hi_ha_reprod_usage=false;
		}
		else
		{
			document.feedback_resource_form.specific_usage.value="";
			document.feedback_resource_form.usage_date.value="";	
			document.feedback_resource_form.usage_time.value="";	
			document.feedback_resource_form.user_determined_limitations.value="";
			document.feedback_resource_form.response.value="";			
			AddDocsOfAFeedback.length=0;
			AddDocsOfAFeedbackHaveChanged=false;
			OmpleRecursAddDocsDesDeAddDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);			
			document.feedback_resource_form.code.value="";
			document.feedback_resource_form.codeLink.value="";
			SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ""); //"other"
			document.feedback_resource_form.platform.value="";
			document.feedback_resource_form.version.value="";
			document.feedback_resource_form.schema.value="";
			document.feedback_resource_form.sugg_app.value="";
			document.feedback_resource_form.diagram.value="";
			document.feedback_resource_form.diagramLink.value="";
			SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, ""); //"other"			
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "none"); //default is collapsed
			CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "none"); //default is collapsed			
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "none"); //default is collapsed
		}
		
		if (guf.usage.discov_issue)
		{
			CollapseFieldset(document.getElementById("discovered-issue-feedback-resource"), "block"); //not collapsed if it has content
			if (guf.usage.discov_issue.known_problem)
				document.feedback_resource_form.known_problem.value=guf.usage.discov_issue.known_problem;
			else
				document.feedback_resource_form.known_problem.value="";

			if (guf.usage.discov_issue.problem_dt)
			{
				if (guf.usage.discov_issue.problem_dt.date)
					document.feedback_resource_form.problem_date.value=guf.usage.discov_issue.problem_dt.date;	
				else
					document.feedback_resource_form.problem_date.value="";	
				if (guf.usage.discov_issue.problem_dt.time)
					document.feedback_resource_form.problem_time.value=guf.usage.discov_issue.problem_dt.time;			
				else
					document.feedback_resource_form.problem_time.value="";			
			}
			else
			{
				document.feedback_resource_form.problem_date.value="";	
				document.feedback_resource_form.problem_time.value="";			
			}
				
			if (guf.usage.discov_issue.work_around)
				document.feedback_resource_form.work_around.value=guf.usage.discov_issue.work_around;
			else
				document.feedback_resource_form.work_around.value="";

			RefDocsOfAFeedback.length=0;
			RefDocsOfAFeedbackHaveChanged=false;
			if (guf.usage.discov_issue.ref_doc)
			{					
				for (var item=0; item<guf.usage.discov_issue.ref_doc.length; item++)
				{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
					if (guf.usage.discov_issue.ref_doc[item].identifier)
					{
		  			for (var item2=0; item2<guf.usage.discov_issue.ref_doc[item].identifier.length; item2++)
		  			{		  				
		  				if (guf.usage.discov_issue.ref_doc[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
		  				{ //Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
		  					RefDocsOfAFeedback[item]={"id_public": guf.usage.discov_issue.ref_doc[item].identifier[item2].code};
		  					break;
		  				}
		  			}
					} 			
		 			if (RefDocsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
		 				ShowInfo("long", DonaCadenaJSON(Msg_RefDoc_without_NiMMbus_id));
				}
				if (guf.usage.discov_issue.ref_doc.length>0)
					CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "block"); //not collapsed if it has content
				else				
					CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "none"); //default is collapsed	
			}
			else				
				CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "none"); //default is collapsed	
			OmpleRecursRefDocsDesDeRefDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
			
			if (guf.usage.discov_issue.exp_fix_date)
				document.feedback_resource_form.expected_fix_date.value=guf.usage.discov_issue.exp_fix_date;
			else
				document.feedback_resource_form.expected_fix_date.value="";	

			FixRsrcsOfAFeedback.length=0;
			FixRsrcsOfAFeedbackHaveChanged=false;
			if (guf.usage.discov_issue.fix_rsrc)
			{					
				for (var item=0; item<guf.usage.discov_issue.fix_rsrc.length; item++)
				{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
					if (guf.usage.discov_issue.fix_rsrc[item].identifier)
					{
		  			for (var item2=0; item2<guf.usage.discov_issue.fix_rsrc[item].identifier.length; item2++)
		  			{		  				
		  				if (guf.usage.discov_issue.fix_rsrc[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
		  				{ //Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
		  					FixRsrcsOfAFeedback[item]={"id_citation": guf.usage.discov_issue.fix_rsrc[item].identifier[item2].code};
		  					break;
		  				}
		  			}
					} 			
		 			if (FixRsrcsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
		 				ShowInfo("long", DonaCadenaJSON(Msg_FixRsrc_without_NiMMbus_id));
				}
				if (guf.usage.discov_issue.fix_rsrc.length>0)
					CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "block"); //not collapsed if it has content
				else				
					CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "none"); //default is collapsed	
			}
			else				
				CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "none"); //default is collapsed	
			OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);

			AltRsrcsOfAFeedback.length=0;
			AltRsrcsOfAFeedbackHaveChanged=false;
			if (guf.usage.discov_issue.alt_rsrc)
			{					
				for (var item=0; item<guf.usage.discov_issue.alt_rsrc.length; item++)
				{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
					if (guf.usage.discov_issue.alt_rsrc[item].identifier)
					{
		  			for (var item2=0; item2<guf.usage.discov_issue.alt_rsrc[item].identifier.length; item2++)
		  			{		  				
		  				if (guf.usage.discov_issue.alt_rsrc[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
		  				{ //Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
		  					AltRsrcsOfAFeedback[item]={"id_citation": guf.usage.discov_issue.alt_rsrc[item].identifier[item2].code};
		  					break;
		  				}
		  			}
					} 			
		 			if (AltRsrcsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
		 				ShowInfo("long", DonaCadenaJSON(Msg_AltRsrc_without_NiMMbus_id));
				}
				if (guf.usage.discov_issue.alt_rsrc.length>0)
					CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "block"); //not collapsed if it has content
				else				
					CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "none"); //default is collapsed	
			}
			else				
				CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "none"); //default is collapsed	
			OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
		}
		else
		{
			document.feedback_resource_form.known_problem.value="";
			document.feedback_resource_form.problem_date.value="";	
			document.feedback_resource_form.problem_time.value="";
			document.feedback_resource_form.work_around.value="";		
			RefDocsOfAFeedback.length=0;
			RefDocsOfAFeedbackHaveChanged=false;
			OmpleRecursRefDocsDesDeRefDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
			document.feedback_resource_form.expected_fix_date.value="";	
			FixRsrcsOfAFeedback.length=0;
			FixRsrcsOfAFeedbackHaveChanged=false;
			OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
			AltRsrcsOfAFeedback.length=0;
			AltRsrcsOfAFeedbackHaveChanged=false;
			OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
			CollapseFieldset(document.getElementById("discovered-issue-feedback-resource"), "none"); //default is collapsed
			CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "none"); //default is collapsed
			CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "none"); //default is collapsed
			CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "none"); //default is collapsed		
		}
	}
	else //tot en blanc
	{
		document.feedback_resource_form.specific_usage.value="";
		document.feedback_resource_form.usage_date.value="";	
		document.feedback_resource_form.usage_time.value="";	
		document.feedback_resource_form.user_determined_limitations.value="";
		document.feedback_resource_form.response.value="";			
		AddDocsOfAFeedback.length=0;
		AddDocsOfAFeedbackHaveChanged=false;
		OmpleRecursAddDocsDesDeAddDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
		document.feedback_resource_form.code.value="";
		document.feedback_resource_form.codeLink.value="";
		SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ""); //"other"
		document.feedback_resource_form.platform.value="";
		document.feedback_resource_form.version.value="";
		document.feedback_resource_form.schema.value="";
		document.feedback_resource_form.sugg_app.value="";
		document.feedback_resource_form.diagram.value="";
		document.feedback_resource_form.diagramLink.value="";
		SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, ""); //"other"			
		document.feedback_resource_form.known_problem.value="";
		document.feedback_resource_form.problem_date.value="";	
		document.feedback_resource_form.problem_time.value="";
		document.feedback_resource_form.work_around.value="";		
		RefDocsOfAFeedback.length=0;
		RefDocsOfAFeedbackHaveChanged=false;
		OmpleRecursRefDocsDesDeRefDocsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
		document.feedback_resource_form.expected_fix_date.value="";	
		FixRsrcsOfAFeedback.length=0;
		FixRsrcsOfAFeedbackHaveChanged=false;
		OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
		AltRsrcsOfAFeedback.length=0;
		AltRsrcsOfAFeedbackHaveChanged=false;
		OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);	
		CollapseFieldset(document.getElementById("usage-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "none"); //default is collapsed	
		CollapseFieldset(document.getElementById("discovered-issue-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "none"); //default is collapsed
		CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "none"); //default is collapsed		
	}

	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;
	if (guf.public)
	{	
		for (var item=0; item<guf.public.length; item++)
		{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)
			if (guf.public[item].identifier)
			{
  			for (var item2=0; item2<guf.public[item].identifier.length; item2++)
  			{
  				if (guf.public[item].identifier[item2].codeSpace=="https://www.nimmbus.cat/resourceId")
  				{ //Aquí encara no sé si es open data o no, però ja ho "ompliré" quan faci el retrieve de l'element
  					PublicsOfAFeedback[item]={"id_public": guf.public[item].identifier[item2].code};
  					break;
  				}
  			}
			} 			
 			if (PublicsOfAFeedback.length!=item+1) 	//cas molt estrany que no he trobat id NiMMbus
 				ShowInfo("long", DonaCadenaJSON(Msg_Public_without_NiMMbus_id));
		}
		if (guf.public.length>0)
			CollapseFieldset(document.getElementById("public-feedback-resource"), "block"); //not collapsed if it has content	
		else
			CollapseFieldset(document.getElementById("public-feedback-resource"), "none"); //default is collapsed			
	}
	else
		CollapseFieldset(document.getElementById("public-feedback-resource"), "none"); //default is collapsed			
	OmpleRecursPublicsDesDePublicsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);

	if (guf.rights)
	{
		var rights=guf.rights;
		var puc_modificar=true;

		if (rights.indexOf("W")==-1)
		{
			puc_modificar=false;
			document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_FB_item_detailed_description_no_modification);
		}			
		document.getElementById("feedback-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("feedback-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
		document.getElementById("target_feedback-resource_compact_add_btn").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("target_feedback-resource_compact_add_descrip").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("public_feedback-resource_compact_add_btn").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("public_feedback-resource_compact_add_descrip").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("feedback-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
		document.getElementById("feedback-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';		
	}
	RemoveInfo("permanent");
	IdResourceToSaveChanges=id;	
	UpdateLastServer();
	return;
}

function AvaluaRespostaRetrieveResourceCitation(doc, id)
{
var root, output, identifier, s, elem, citation, md_identifier, onlineResource;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		ResponsiblesOfACitation.length=0;	
		ResponsiblesOfACitationHaveChanged=false;
		puc_modificar=false;

		document.citation_resource_form.title.value="";
		document.citation_resource_form.edition.value="";
		document.citation_resource_form.edition_date.value="";		
		document.citation_resource_form.id_code.value="";
		document.citation_resource_form.id_namespace.value="";
		document.citation_resource_form.series_name.value="";
		document.citation_resource_form.series_issue.value="";
		document.citation_resource_form.series_page.value="";		
		document.citation_resource_form.other_cit_details.value="";
		document.citation_resource_form.url_link.value="";
		document.citation_resource_form.url_descrip.value="";		
		SeleccionaSelectDesDeValor(document.citation_resource_form.function_code, "undefined");
		document.citation_resource_form.open_data.checked=false;
						
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.citation_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="openData")
					document.citation_resource_form.open_data.checked=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="citation")
				{					
					citation=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (citation)
					{ 
						//EDITION						
						elem=GetXMLElementByName(citation, "cit", "edition");
						if (elem)
							document.citation_resource_form.edition.value=DonaTextDesDeGcoCharacterString(elem);
						
						//EDITION_DATE						
						elem=GetXMLElementByName(citation, "cit", "editionDate");
						if (elem)
							document.citation_resource_form.edition_date.value=DonaDataDesDeGcoDateTime(elem);				
						
						//identifier -> n'hi pot haver més d'un, de fet sempre hi ha el de NiMMbus i potser altres. En teoria pot ser n, nosaltres mostrem 1 (a banda del de NiMbus que no es veu)
						output_2=GetXMLElementCollectionByName(citation, "mcc", "MD_Identifier");
						if (output_2 && output_2.length)							
						{	
							for (var item_2=0; item_2<output_2.length; item_2++)
							{
									var code="", namespace="";
									
									//CODE						
									elem=GetXMLElementByName(output_2.item(item_2), "mcc", "code");
									if (elem)
										code=DonaTextDesDeGcoCharacterString(elem);
									//NAMESPACE
									elem=GetXMLElementByName(output_2.item(item_2), "mcc", "codeSpace");
									if (elem)
										namespace=DonaTextDesDeGcoCharacterStringOGcxAnchor(elem);
									
									if (code)
									{
										if (namespace=="https://www.nimmbus.cat/resourceId")
										//aquest és el IdNiMMbus, no el vull mostrar!
											continue;
										
										//si arribo aquí és que tinc un codi amb un namespace que NO és el de NiMMbus (p.ex. és blanc) --> per tant el mostro i plego pq només en mostro un.										
										document.citation_resource_form.id_namespace.value=namespace;									
										document.citation_resource_form.id_code.value=code;
										break;										
								}									
							}
						}
						
						//citedResponsibleParty
						{		
							output_2=GetXMLElementCollectionByName(citation, "cit", "citedResponsibleParty");
							//puc tenir diversos citedResponsibleParty, cada un amb un rol								
							if (output_2 && output_2.length)							
							{	
								i_resp=0; //aniré anotant quants vaig carregant
								for (var item_2=0; item_2<output_2.length; item_2++)
								{
									//role									
									elem=GetXMLElementByName(output_2.item(item_2), "cit", "role");
									if (elem)
										role=DonaTextDesDeCodeList(elem, "cit", "CI_RoleCode");														
									else
										role="";
									
									output_3=GetXMLElementCollectionByName(output_2.item(item_2), "cit", "party");
									//puc tenir diversos party a dins del mateix citedResponsibleParty, que són diversos individus o organitzacions amb igual rol
									if (output_3 && output_3.length)							
									{			
										//per cada party, tant si és de tipus Individual o de tipus Organisation puc tenir un o més partyIdentifier, un dels quals és el IdNiMMbus 										
										for (var item_3=0; item_3<output_3.length; item_3++)
										{
											output_4=GetXMLElementCollectionByName(output_3.item(item_3), "cit", "partyIdentifier");
											if (output_4 && output_4.length)	
											{
												for (var item_4=0; item_4<output_4.length; item_4++)
												{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)													
													p_id=GetXMLElementByName(output_4.item(item_4), "mcc", "MD_Identifier");
													if (p_id)
													{
														//CODE						
														p_code=GetXMLElementByName(p_id, "mcc", "code");

														//NAMESPACE
														p_codeSpace=GetXMLElementByName(p_id, "mcc", "codeSpace");
														if (p_codeSpace)
															code_space=DonaTextDesDeGcoCharacterString(p_codeSpace);
														else
															code_space="";
														
														if (p_code && p_codeSpace && code_space=="https://www.nimmbus.cat/resourceId")
														{ //aquest és el IdNiMMbus d'aquesta party
															ResponsiblesOfACitation[i_resp]={"id_responsible": DonaTextDesDeGcoCharacterString(p_code), "role": role};
															i_resp++;															
															break
														}															
													}
												}
										 		if (item_4==output_4.length) 	//cas molt estrany que no he trobat id NiMMbus
										 			ShowInfo("long", DonaCadenaJSON(Msg_Responsible_without_NiMMbus_id));																							  	
											} 			
										}
									}
								}
							}
						}
						
						//series
						series=GetXMLElementByName(citation, "cit", "series");
						if (series)
						{
							//NAME						
							elem=GetXMLElementByName(series, "cit", "name");
							if (elem)
								document.citation_resource_form.series_name.value=DonaTextDesDeGcoCharacterString(elem);
							//ISSUE_ID
							elem=GetXMLElementByName(series, "cit", "issueIdentification");
							if (elem)
								document.citation_resource_form.series_issue.value=DonaTextDesDeGcoCharacterString(elem);
							//PAGE
							elem=GetXMLElementByName(series, "cit", "page");
							if (elem)
								document.citation_resource_form.series_page.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//other_citation_details						
						elem=GetXMLElementByName(citation, "cit", "otherCitationDetails");
						if (elem)
							document.citation_resource_form.other_cit_details.value=DonaTextDesDeGcoCharacterString(elem);

						//online_resource
						onlineResource=GetXMLElementByName(citation, "cit", "CI_OnlineResource");
						if (onlineResource)
						{					
							//LINK
							elem=GetXMLElementByName(onlineResource, "cit", "linkage");
							if (elem)
								document.citation_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
							//DESCRIPTION
							elem=GetXMLElementByName(onlineResource, "cit", "description");
							if (elem)
								document.citation_resource_form.url_descrip.value=DonaTextDesDeGcoCharacterString(elem);
							//FUNCTION
							elem=GetXMLElementByName(onlineResource, "cit", "function");
							if (elem)
								SeleccionaSelectDesDeValor(document.citation_resource_form.function_code, 
												DonaTextDesDeCodeList(elem, "cit", "CI_OnLineFunctionCode"));														
						}
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
										
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Citation_detailed_description_no_modification);
					}					
					else
						puc_modificar=true;
					document.getElementById("citation-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("citation-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("citation-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("responsible-citation-resource_compact_add_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("responsible-citation-resource_compact_add_descrip").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("citation-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';					
				}
			}
		}		
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		UpdateLastServer();
		OmpleRecursResponsiblesDesDeResponsiblesOfACitation(puc_modificar);
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourcePublication(doc, id)
{
var root, output, identifier, s, elem, publication, md_identifier, onlineResource;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");
	
	if (output && output.length)
	{
		var puc_modificar=false;
		
		ResponsiblesOfAPublication.length=0;	
		ResponsiblesOfAPublicationHaveChanged=false;

		document.publication_resource_form.title.value="";
		document.publication_resource_form.edition.value="";
		document.publication_resource_form.edition_date.value="";		
		document.publication_resource_form.id_code.value="";
		document.publication_resource_form.id_namespace.value="";
		document.publication_resource_form.series_name.value="";
		document.publication_resource_form.series_issue.value="";
		document.publication_resource_form.series_page.value="";		
		document.publication_resource_form.other_cit_details.value="";
		document.publication_resource_form.url_link.value="";
		document.publication_resource_form.url_descrip.value="";		
		SeleccionaSelectDesDeValor(document.publication_resource_form.function_code, "undefined");
		document.publication_resource_form.abstract.value="";		
		SeleccionaSelectDesDeValor(document.publication_resource_form.category_code, "undefined");
		document.publication_resource_form.open_data.checked=false;							
								
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.publication_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="openData")
					document.publication_resource_form.open_data.checked=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="publication")
				{					
					publication=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (publication)
					{ 
						//EDITION						
						elem=GetXMLElementByName(publication, "cit", "edition");
						if (elem)
							document.publication_resource_form.edition.value=DonaTextDesDeGcoCharacterString(elem);
						
						//EDITION_DATE						
						elem=GetXMLElementByName(publication, "cit", "editionDate");
						if (elem)
							document.publication_resource_form.edition_date.value=DonaDataDesDeGcoDateTime(elem);
						
						//identifier -> n'hi pot haver més d'un, de fet sempre hi ha el de NiMMbus i potser altres. En teoria pot ser n, nosaltres mostrem 1 (a banda del de NiMbus que no es veu)
						output_2=GetXMLElementCollectionByName(publication, "mcc", "MD_Identifier");
						if (output_2 && output_2.length)							
						{	
							for (var item_2=0; item_2<output_2.length; item_2++)
							{
									var code="", namespace="";
									
									//CODE						
									elem=GetXMLElementByName(output_2.item(item_2), "mcc", "code");
									if (elem)
										code=DonaTextDesDeGcoCharacterString(elem);
									//NAMESPACE
									elem=GetXMLElementByName(output_2.item(item_2), "mcc", "codeSpace");
									if (elem)
										namespace=DonaTextDesDeGcoCharacterStringOGcxAnchor(elem);
									
									if (code)
									{
										if (namespace=="https://www.nimmbus.cat/resourceId")
										//aquest és el IdNiMMbus, no el vull mostrar!
											continue;
										
										//si arribo aquí és que tinc un codi amb un namespace que NO és el de NiMMbus (p.ex. és blanc) --> per tant el mostro i plego pq només en mostro un.										
										document.publication_resource_form.id_namespace.value=namespace;									
										document.publication_resource_form.id_code.value=code;
										break;										
								}									
							}
						}
						
						//citedResponsibleParty
						output_2=GetXMLElementCollectionByName(publication, "cit", "citedResponsibleParty");
						//puc tenir diversos citedResponsibleParty, cada un amb un rol								
						if (output_2 && output_2.length)							
						{	
							i_resp=0; //aniré anotant quants vaig carregant
							for (var item_2=0; item_2<output_2.length; item_2++)
							{
								//role									
								elem=GetXMLElementByName(output_2.item(item_2), "cit", "role");
								if (elem)
									role=DonaTextDesDeCodeList(elem, "cit", "CI_RoleCode");														
								else
									role="";
								
								output_3=GetXMLElementCollectionByName(output_2.item(item_2), "cit", "party");
								//puc tenir diversos party a dins del mateix citedResponsibleParty, que són diversos individus o organitzacions amb igual rol
								if (output_3 && output_3.length)							
								{			
									//per cada party, tant si és de tipus Individual o de tipus Organisation puc tenir un o més partyIdentifier, un dels quals és el IdNiMMbus 										
									for (var item_3=0; item_3<output_3.length; item_3++)
									{
										output_4=GetXMLElementCollectionByName(output_3.item(item_3), "cit", "partyIdentifier");
										if (output_4 && output_4.length)	
										{
											for (var item_4=0; item_4<output_4.length; item_4++)
											{	//Intento deduir si tinc IdNimmbus (que sempre l'hauria de trobar)													
												p_id=GetXMLElementByName(output_4.item(item_4), "mcc", "MD_Identifier");
												if (p_id)
												{
													//CODE						
													p_code=GetXMLElementByName(p_id, "mcc", "code");

													//NAMESPACE
													p_codeSpace=GetXMLElementByName(p_id, "mcc", "codeSpace");
													if (p_codeSpace)
														code_space=DonaTextDesDeGcoCharacterString(p_codeSpace);
													else
														code_space="";
													
													if (p_code && p_codeSpace && code_space=="https://www.nimmbus.cat/resourceId")
													{ //aquest és el IdNiMMbus d'aquesta party
														ResponsiblesOfAPublication[i_resp]={"id_responsible": DonaTextDesDeGcoCharacterString(p_code), "role": role};
														i_resp++;															
														break
													}															
												}
											}
									 		if (item_4==output_4.length) 	//cas molt estrany que no he trobat id NiMMbus
									 			ShowInfo("long", DonaCadenaJSON(Msg_Responsible_without_NiMMbus_id));																							  	
										} 			
									}
								}
							}
						}
			
						//series
						series=GetXMLElementByName(publication, "cit", "series");
						if (series)
						{
							//NAME						
							elem=GetXMLElementByName(series, "cit", "name");
							if (elem)
								document.publication_resource_form.series_name.value=DonaTextDesDeGcoCharacterString(elem);
							//ISSUE_ID
							elem=GetXMLElementByName(series, "cit", "issueIdentification");
							if (elem)
								document.publication_resource_form.series_issue.value=DonaTextDesDeGcoCharacterString(elem);
							//PAGE
							elem=GetXMLElementByName(series, "cit", "page");
							if (elem)
								document.publication_resource_form.series_page.value=DonaTextDesDeGcoCharacterString(elem);
						}
						
						//other_citation_details						
						elem=GetXMLElementByName(publication, "cit", "otherCitationDetails");
						if (elem)
							document.publication_resource_form.other_cit_details.value=DonaTextDesDeGcoCharacterString(elem);

						//online_resource
						onlineResource=GetXMLElementByName(publication, "cit", "CI_OnlineResource");
						if (onlineResource)
						{					
							//LINK
							elem=GetXMLElementByName(onlineResource, "cit", "linkage");
							if (elem)
								document.publication_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
							//DESCRIPTION
							elem=GetXMLElementByName(onlineResource, "cit", "description");
							if (elem)
								document.publication_resource_form.url_descrip.value=DonaTextDesDeGcoCharacterString(elem);
							//FUNCTION
							elem=GetXMLElementByName(onlineResource, "cit", "function");
							if (elem)
								SeleccionaSelectDesDeValor(document.publication_resource_form.function_code, 
												DonaTextDesDeCodeList(elem, "cit", "CI_OnLineFunctionCode"));
						}
						
						//ABSTRACT
						elem=GetXMLElementByName(publication, "qcm", "abstract");
						if (elem)
							document.publication_resource_form.abstract.value=DonaTextDesDeGcoCharacterString(elem);	
												
						//CATEGORY
						category=GetXMLElementByName(publication, "qcm", "category");
						if (category)
						{					
								SeleccionaSelectDesDeValor(document.publication_resource_form.category_code, 
												DonaTextDesDeCodeList(category, "qcm", "QCM_PublicationCategoryCode"));
						}					
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{					
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
									
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Publication_detailed_description_no_modification);
					}					
					else
						puc_modificar=true;
						
					document.getElementById("publication-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("publication-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("publication-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("responsible-publication-resource_compact_add_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("responsible-publication-resource_compact_add_descrip").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("publication-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';					
				}
			}
		}
		
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		UpdateLastServer();
		OmpleRecursResponsiblesDesDeResponsiblesOfAPublication(puc_modificar);
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceIndividual(doc, id)
{
var root, output, identifier, s, elem, individual, contact, partyIdentifier, md_identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.individual_resource_form.title.value="";
		document.individual_resource_form.email.value="";
		document.individual_resource_form.url_link.value="";		
		document.individual_resource_form.id_code_1.value="";
		document.individual_resource_form.id_namespace_1.value="";
		document.individual_resource_form.id_code_2.value="";
		document.individual_resource_form.id_namespace_2.value="";
		document.individual_resource_form.open_data.checked=false;							
								
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.individual_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="openData")
					document.individual_resource_form.open_data.checked=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="individual")
				{					
					individual=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (individual)
					{ 
						//EMAIL i URL de 	<cit:contactInfo>
						contact=GetXMLElementByName(individual, "cit", "contactInfo");
						if (contact)
						{
							//email, demano un i si n'hi ha més em quedo el primer
							elem=GetXMLElementByName(contact, "cit", "electronicMailAddress");
							if (elem)							
								document.individual_resource_form.email.value=DonaTextDesDeGcoCharacterString(elem);
							
							//online_resource, demano directament el cit_linkage i s'hi ha més... també el primer
							elem=GetXMLElementByName(contact, "cit", "linkage");
							if (elem)
								document.individual_resource_form.url_link.value=DonaTextDesDeGcoCharacterString(elem);
						}				
				
						//identifier, hi pot haver diversos partyIdentifier
						partyIdentifier=GetXMLElementCollectionByName(individual, "cit", "partyIdentifier");
						if (partyIdentifier && partyIdentifier.length)
						{
							for (var item_2=item_ple=0; item_2<partyIdentifier.length; item_2++)
							{
								if (item_ple==2) //només tinc lloc al form per mostrar el 0 i el 1
									break;
								
								//item_ple el pujo si l'acabo enviant. el id intern de nimmbus no el mostro 	
								md_identifier=GetXMLElementByName(partyIdentifier.item(item_2), "mcc", "MD_Identifier");								
								if (md_identifier)
								{								
									//CODE						
									elem=GetXMLElementByName(md_identifier, "mcc", "code");
									if (elem)
									{
										//NAMESPACE
										elem2=GetXMLElementByName(md_identifier, "mcc", "codeSpace");
										if (elem2)
										{
											var namespace=DonaTextDesDeGcoCharacterString(elem2);
											var n=namespace.includes("nimmbus.cat/resourceId");
											if (n) //aquest no el mostro
												continue;
											
											item_ple++;											
											if (item_ple==1)
											{
												document.individual_resource_form.id_code_1.value=DonaTextDesDeGcoCharacterString(elem);
												document.individual_resource_form.id_namespace_1.value=namespace;
											}
											else
											{
												document.individual_resource_form.id_code_2.value=DonaTextDesDeGcoCharacterString(elem);
												document.individual_resource_form.id_namespace_2.value=namespace;
											}
										}
										else //puc tenir code sense codespace
										{
											item_ple++;											
											if (item_ple==1)
												document.individual_resource_form.id_code_1.value=DonaTextDesDeGcoCharacterString(elem);
											else
												document.individual_resource_form.id_code_2.value=DonaTextDesDeGcoCharacterString(elem);
										}
									}
								}
							}
						}					
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					var puc_modificar=true;
					
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("individual-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Individual_detailed_description_no_modification);
					}
					document.getElementById("individual-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("individual-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("individual-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("individual-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
				}
			}
		}
		
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function AvaluaRespostaRetrieveResourceOrganism(doc, id)
{
	var root, output, identifier, s, elem, organism;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		document.organism_resource_form.title.value="";
		document.organism_resource_form.delivery_point.value="";
		document.organism_resource_form.city.value="";		
		document.organism_resource_form.administrative_area.value="";
		document.organism_resource_form.postal_code.value="";
		document.organism_resource_form.country.value="";
		document.organism_resource_form.open_data.checked=false;							
								
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="title")
					document.organism_resource_form.title.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="openData")
					document.organism_resource_form.open_data.checked=TornaBooleaDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="organism")
				{					
					organism=OmpleInputDesDeWPSComplexOutput(output.item(item));
					if (organism)
					{
						//Adreça <cit:contactInfo>
						contact=GetXMLElementByName(organism, "cit", "contactInfo");
						if (contact)
						{
							//delivery_point
							elem=GetXMLElementByName(contact, "cit", "deliveryPoint");
							if (elem)							
								document.organism_resource_form.delivery_point.value=DonaTextDesDeGcoCharacterString(elem);
							
							//city
							elem=GetXMLElementByName(contact, "cit", "city");
							if (elem)
								document.organism_resource_form.city.value=DonaTextDesDeGcoCharacterString(elem);
								
							//administrative_area
							elem=GetXMLElementByName(contact, "cit", "administrativeArea");
							if (elem)
								document.organism_resource_form.administrative_area.value=DonaTextDesDeGcoCharacterString(elem);
								
							//postal_code
							elem=GetXMLElementByName(contact, "cit", "postalCode");
							if (elem)
								document.organism_resource_form.postal_code.value=DonaTextDesDeGcoCharacterString(elem);

							//country
							elem=GetXMLElementByName(contact, "cit", "country");
							if (elem)
								document.organism_resource_form.country.value=DonaTextDesDeGcoCharacterString(elem);
						}											
					}
				}	
				else if (identifier.childNodes[0].nodeValue=="rights")
				{
					var rights=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					var puc_modificar=true;
					
					if (rights.indexOf("W")==-1)
					{
						puc_modificar=false;
						document.getElementById("organism-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Organism_detailed_description_no_modification);
					}
					document.getElementById("organism-resource_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("organism-resource-exit_btn").style.display=puc_modificar ? 'none' : 'inline';
					document.getElementById("organism-resource-close_btn").style.display=puc_modificar ? 'inline' : 'none';
					document.getElementById("organism-resource-delete_btn").style.display=(rights.indexOf("O")==-1) ? 'none' : 'inline';
				}
			}
		}
		
		RemoveInfo("permanent");
		IdResourceToSaveChanges=id;
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function PopulateCompactDescriptionResource(id, compact_element, role, select_role, del_item, del_function, open_data, is_target_public_or_none)
{
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaRetrieveResourceCompacte, "text/xml", 
				{"compact_element": compact_element, "role": role, "select_role": select_role, "del_item": del_item, "del_function": del_function, "open_data": open_data, 
				"is_target_public_or_none": is_target_public_or_none});
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
}

function EditResource(query, type)
{	
var id=DonaValorDeFormulari("RESOURCE", query, true);
var AvaluaRespostaRetrieveResource;

	if (id==null)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	if (type=="HREF")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceHref;
		MostraHRefResource(id);
	}
	else if (type=="POI")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourcePoi;
		MostraPoiResource(id);
	}
	else if (type=="FEEDBACK")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceFeedback;
		MostraFeedbackResource(id, '');
	}
	else if (type=="CITATION")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceCitation;
		MostraCitationResource(id);
	}
	else if (type=="PUBLICAT")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourcePublication;
		MostraPublicationResource(id);
	}
	else if (type=="INDIVIDU")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceIndividual;
		MostraIndividualResource(id);
	}
	else if (type=="ORGANISM")
	{
		AvaluaRespostaRetrieveResource=AvaluaRespostaRetrieveResourceOrganism;
		MostraOrganismResource(id);
	}
	else
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Unsupported_resource_type)+": "+type);
		return;
	}

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaRetrieveResource, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
}


function DonaNomImgTipusRecurs(type, small)
{
	if (small==true)
	{
		if (type=="HREF")
			return "link36.png";
		if (type=="POI")
			return "point36.png";  
		if (type=="FEEDBACK")
			return "feedback36.png";             
		if (type=="CITATION")
			return "citation36.png";			
		if (type=="PUBLICAT")
			return "publication36.png";
		if (type=="INDIVIDU")
			return "indv36.png";
		if (type=="ORGANISM")
			return "org36.png";
		return "";
	}
	if (type=="HREF")
		return "link48.png";
	if (type=="POI")
		return "point48.png";  
	if (type=="FEEDBACK")
		return "feedback48.png";             
	if (type=="CITATION")
		return "citation48.png";
	if (type=="PUBLICAT")
		return "publication48.png";
	if (type=="INDIVIDU")
			return "indv48.png";
	if (type=="ORGANISM")
			return "org48.png";
	return "";
}

var ResourcesPerPage=10;  //solució provisional a l'espera de que sigui configurable per usuari

function BuidaLlistatResource(type_enum, resource_type, resource_origin, element_origin)
{
		if (type_enum=="resources")
			document.getElementById(type_enum+"-hits-text").innerHTML="<small>"+DonaCadenaJSON(Msg_Use_New_button_to_create_resources)+"</small>";
		else //type_enum=="resource-selector")
		{
			document.resource_selector_form.resource_type.value=resource_type; 
			document.resource_selector_form.resource_origin.value=resource_origin;
			document.resource_selector_form.element_origin.value=element_origin;
			
			if (resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
				document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixTargetOfAFeedback(null, false)\"/> ";	
			else if (resource_type=="PARTY")
			{
				if (resource_origin=="CITATION")	
					document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"indv_add20.png\" onClick=\"MostraIndividualResource('')\"/>"+
						" <input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"org_add20.png\" onClick=\"MostraOrganismResource('')\"/>"+
						" <input class=\"submit_btn\" type=\"button\" value=\""+DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixResponsibleOfACitation(null, false)\"/ >  ";
				else //PUBLICAT
					document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"indv_add20.png\" onClick=\"MostraIndividualResource('')\"/>"+
						" <input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"org_add20.png\" onClick=\"MostraOrganismResource('')\"/>"+
						" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixResponsibleOfAPublication(null, false)\"/ >  ";
			}
			else if (resource_type=="PUBLICAT") //o per escollir publics de FBitems
			{
				if (resource_origin=="FEEDBACK")
				{
					if (element_origin=="PUBLICAT")
						document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"publication_add20.png\" onClick=\"MostraPublicationResource('')\"/>"+
							" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixPublicOfAFeedback(null, false)\"/ >  ";						
					else //REF_DOC
						document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"publication_add20.png\" onClick=\"MostraPublicationResource('')\"/>"+
							" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixRefDocOfAFeedback(null, false)\"/ >  ";						
				}
			}
			else //només queda CITATION
			{
				if (resource_origin=="FEEDBACK")
				{
					if (element_origin=="FIX_RSRC")
						document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"+
							" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixFixRsrcOfAFeedback(null, false)\"/ >  ";						
					else if (element_origin=="ALT_RSRC")
						document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"+
							" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixAltRsrcOfAFeedback(null, false)\"/ >  ";						
					else //if (element_origin=="ADD_DOC")
						document.getElementById(type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn_upper\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"+
							" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixAddDocOfAFeedback(null, false)\"/ >  ";						
				}
				//else resource_origin PUBLICAT --> element_origin=="REL_RSRC" pendent
			}
		}
		document.getElementById("newer-"+type_enum+"_btn").disabled=true;
		document.getElementById("older-"+type_enum+"_btn").disabled=true;
		document.getElementById(type_enum+"-list").innerHTML="";
}

function AvaluaRespostaEnumerateResources(doc, dades)
{
var root, s, type;
	root=DonaRootXML(doc, document);
	if (!root)
	{
		if (dades.text)
			ShowInfo("long", dades.text); 

		return;
	}
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=ParseOWSContextAtom(root);

	if (dades.make_pannel_visible) //només es passa a true quan estem "anant endavant"
		ChangePannel(dades.type_enum, true);

	if (dades.type_enum=="resource-selector")
	{
		if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
		{
			document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Targeted_resources);
			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_resources_as_targets);
		}
		else if (dades.resource_type=="PARTY")
		{
			document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Related_responsibles);
			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_responsibles);
		}
		else if (dades.resource_type=="PUBLICAT")
		{
			if (dades.element_origin=="PUBLICAT")
				document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Related_Publications);
			else
				document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Reference_documents);
			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_publications);		
		}
		else //queda el CITATION
		{
			/*if (dades.element_origin=="FIX_RSRC")
				document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Fixed_Resource);			
			else*/ if (dades.element_origin=="ALT_RSRC")
				document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Alternative_Resource);			
			else //if (dades.element_origin=="ADD_DOC")
				document.getElementById(dades.type_enum+"-title-text").innerHTML=DonaCadenaJSON(Msg_Additional_documentation);

			document.getElementById(dades.type_enum+"-subtitle-text").innerHTML=DonaCadenaJSON(Msg_List_available_citations);
		}
	}//else if (type_enum=="resources") no cal fer res perquè els textos ja són posats
	
	if (owc.properties.totalResults==0)
		BuidaLlistatResource(dades.type_enum, dades.resource_type, dades.resource_origin, dades.element_origin);
	else
	{
		if (dades.type_enum=="resource-selector")
		{
			document.resource_selector_form.resource_type.value=dades.resource_type; 
			document.resource_selector_form.resource_origin.value=dades.resource_origin;		
			document.resource_selector_form.element_origin.value=dades.element_origin;		
			
			if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
				document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixTargetOfAFeedback(null, false)\"/> ";	
			else if (dades.resource_type=="PARTY")
			{	//El llistat de individus el puc haver demanat des de dos orígens: "resource_origin": "CITATION" o "resource_origin": "PUBLICAT"
				if (dades.resource_origin=="CITATION")	
				{
					document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"indv_add20.png\" onClick=\"MostraIndividualResource('')\"/>"+
						" <input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"org_add20.png\" onClick=\"MostraOrganismResource('')\"/>"+
						" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixResponsibleOfACitation(null, false)\"/ >  ";				
				}
				else //PUBLICAT
				{
					document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"indv_add20.png\" onClick=\"MostraIndividualResource('')\"/>"+
						" <input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"org_add20.png\" onClick=\"MostraOrganismResource('')\"/>"+
						" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixResponsibleOfAPublication(null, false)\"/ >  ";
				}
				document.individual_resource_form.resource_origin.value=dades.resource_origin;
				document.organism_resource_form.resource_origin.value=dades.resource_origin;
			}
			else if (dades.resource_type=="PUBLICAT")
			{			
				if (dades.resource_origin=="FEEDBACK")
				{		
					document.publication_resource_form.element_origin.value=dades.element_origin;
					if (dades.element_origin=="PUBLICAT")
						document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"publication_add20.png\" onClick=\"MostraPublicationResource('')\"/>"
							+" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixPublicOfAFeedback(null, false)\"/ >  ";
					else //REF_DOC
						document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"publication_add20.png\" onClick=\"MostraPublicationResource('')\"/>"
							+" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixRefDocOfAFeedback(null, false)\"/ >  ";						
				}
				//si algun dia algun altre resource_origen diferent de FB pot tenir publics, aleshores caldrà crear element ocult de resource_origin a citation_form (explicació com a NOTA_AZ_20190517 a sota)
			}
			else //queda el CITATION
			{
				if (dades.resource_origin=="FEEDBACK")
				{
					document.citation_resource_form.element_origin.value=dades.element_origin;
					if (dades.element_origin=="FIX_RSRC")
						document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"
							+" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixFixRsrcOfAFeedback(null, false)\"/ >  ";
					else if (dades.element_origin=="ALT_RSRC")
						document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"
							+" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixAltRsrcOfAFeedback(null, false)\"/ >  ";
					else //dades.element_origin:	ADD_DOC
						document.getElementById(dades.type_enum+"-hits-text").innerHTML="<input class=\"add_resource_btn\" type=\"image\" alt=\"new href\" src=\"citation_add20.png\" onClick=\"MostraCitationResource('')\"/>"
							+" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Cancel) +"\" onClick=\"AfegeixAddDocOfAFeedback(null, false)\"/ >  ";
				}
				//else (dades.resource_origin=="PUBLICAT") --> NOTA_AZ_20190517:
				//dades.element_origin:	REL_RSRC	NOU AfegeixRelatedResourceOfAPublication N)) --> quan faci això, dincs el form de CITATION m'he de posar també el 
				//element ocult de resource_origin perquè en aquest moment podrà valdre no només FB si no també publicat. Ara no el tinc pq dades.resource_origin sempre es "FEEDBACK" quan dades.resource_type=CITATION
			}
		}
		else //poso en blanc per no anar acumunat 1de10 en anar passant de pàgina!
		{
			document.resource_selector_form.resource_type.value=""; 
			document.resource_selector_form.resource_origin.value="";		
			document.resource_selector_form.element_origin.value="";		
			document.getElementById(dades.type_enum+"-hits-text").innerHTML="";
			document.individual_resource_form.resource_origin.value="";
			document.organism_resource_form.resource_origin.value="";
			document.citation_resource_form.element_origin.value="";
			document.publication_resource_form.element_origin.value="";
		}
		// Afegeixo el text	1 de X
		document.getElementById(dades.type_enum+"-hits-text").innerHTML+="["+owc.properties.startIndex + "," +(parseInt(owc.properties.startIndex)+owc.features.length-1)+ "] "+ DonaCadenaJSON(Msg_of) + " " +  owc.properties.totalResults;
	
		if (owc.properties.startIndex==1)
		{
			document.getElementById("newer-"+dades.type_enum+"_btn").disabled=true;
		}
		else
		{
			//var dades_temp=Object.assign({},dades);
			var dades_temp=JSON.parse(JSON.stringify(dades));  //duplico l'objecte
			dades_temp.make_pannel_visible=false;
			document.getElementById("newer-"+dades.type_enum+"_btn").onclick=new Function("EnumerateResources("+((owc.properties.startIndex<=ResourcesPerPage) ? 1 : owc.properties.startIndex-ResourcesPerPage)+", "+JSON.stringify(dades_temp)+");");
			document.getElementById("newer-"+dades.type_enum+"_btn").disabled=false;
		}
	
		if (parseInt(owc.properties.startIndex)+owc.features.length-1==owc.properties.totalResults)
		{
			document.getElementById("older-"+dades.type_enum+"_btn").disabled=true;
		}
		else
		{
			//var dades_temp=Object.assign({},dades);
			var dades_temp=JSON.parse(JSON.stringify(dades));  //duplico l'objecte
			dades_temp.make_pannel_visible=false;		
			document.getElementById("older-"+dades.type_enum+"_btn").onclick=new Function("EnumerateResources("+(parseInt(owc.properties.startIndex)+ResourcesPerPage)+", "+JSON.stringify(dades_temp)+");");
			document.getElementById("older-"+dades.type_enum+"_btn").disabled=false;
		}	
		
		if (owc.features)
		{
			s="<ol class=\"white-area-list\">";
			for (var i=0; i<owc.features.length; i++)
			{
				type=GetNimmbusTypeOfAOWCFeature(owc.features[i]);
	
				var object_id=owc.features[i].id.slice(owc.features[i].id.indexOf("RESOURCE=")+9);
				object_id.slice(0,object_id.indexOf("&")); // si darrera de RESOURCE hi ha algun paràmetre més, que comença sempre amb "&", ho elimino. Si no ho ha trobat indexOf torna -1 i slice no fa res.
				ja_seleccionat=false;
				es_ell_mateix=false;
				es_un_target=false;
	
				//Color de fons segons si són meus, compartits directament amb mi o "només" publics?
				if (owc.features[i].properties.rights.indexOf("O")!=-1) //en sóc el propietari -> fons blanc
					p_color="";								
				else if (owc.features[i].properties.rights.indexOf("W")!=-1 || owc.features[i].properties.rights.indexOf("S")!=-1) //si el puc escriure o compartir és que me l'ahn compartit directament -> fons blau cel
					p_color="#e6f7ff";								
				else //si només puc R escric que és openData, perquè NO PUC diferenciar si me l'han compartit a mi com a només lectura, o si el veig "només" perquè és openData -> gris clar
					p_color="#f2f2f2";
				
					s+="<div class=\"white-area-li\" style=\"background-color:"+p_color+"\"><li class=\"white-area-li-text\"";
				if (dades.type_enum=="resources")
					s+=" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'"+type+"\');\"";
				else if (dades.type_enum=="resource-selector")
				{	
					if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
					{	//comprovo si aquest target ja forma part de la valoració o si és ell mateix, i en cas que sí ho indico i no l'afegeixo onclick
						for (var item=0; item<TargetsOfAFeedback.length; item++)
						{
							if (TargetsOfAFeedback[item].id_target==object_id)
							{
								ja_seleccionat=true;
								break;
							}
							if (IdFeedbackResourceToSaveChanges==object_id) //abans estava IdResourceToSaveChanges i ara és equivalent perquè en aquest context no deixem crear recursos,
							{	//però per si de cas obrir aquest porta algun dia, comparant amb IdFeedbackResourceToSaveChanges sempre anirà bé, tot i que IdResourceToSaveChanges pugui haver canviat si hem creat un nou recurs
								es_ell_mateix=true;
								break;
							}						
						}
						if (ja_seleccionat || es_ell_mateix)				
							;//s+=" onClick=\"AfegeixTargetOfAFeedback(\'\', false);\"";  No fem res
						else
							s+=" onClick=\"AfegeixTargetOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
					}
					else if (dades.resource_type=="PARTY")
					{	//comprovo si aquest individu/organisme ja forma està relacionat amb la citació/publicació, i en cas que sí ho indico i no l'afegeixo onclick				
						if (dades.resource_origin=="CITATION")	
						{
							for (var item=0; item<ResponsiblesOfACitation.length; item++)
							{
								if (ResponsiblesOfACitation[item].id_responsible==object_id)
								{
									ja_seleccionat=true;
									break;
								}
							}
							if (ja_seleccionat)				
								;//s+=" onClick=\"AfegeixResponsibleOfACitation(\'\', false);\"";  No fem res
							else
								s+=" onClick=\"AfegeixResponsibleOfACitation(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
						}
						else //if (dades.resource_origin=="PUBLICAT")
						{
							for (var item=0; item<ResponsiblesOfAPublication.length; item++)
							{
								if (ResponsiblesOfAPublication[item].id_responsible==object_id)
								{
									ja_seleccionat=true;
									break;
								}
							}
							if (ja_seleccionat)
								;//s+=" onClick=\"AfegeixResponsibleOfAPublication(\'\', false);\"";  No fem res
							else
								s+=" onClick=\"AfegeixResponsibleOfAPublication(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
						}
						//si algun dia deixo triar party relacionades amb un dades.resource_origin==FEEDBACK , hauré de vigilar que aquella party no sigui target -> buscar ús de es_un_target						 
					}
					else if (dades.resource_type=="PUBLICAT")
					{
						if (dades.resource_origin=="FEEDBACK")	
						{
							//Primer comprovo si el recurs que tinc als dits és un dels elements seleccionats com a targets, perquè aleshores no pot ser triat com a publicació/ref_doc/alt_rsrc/etc
							for (var item=0; item<TargetsOfAFeedback.length; item++)
							{
								if (TargetsOfAFeedback[item].id_target==object_id)
								{
									es_un_target=true;
									break;
								}
							}
							
							if (dades.element_origin=="PUBLICAT")	
							{
								//comprovo si aquesta public ja forma part de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
								for (var item=0; item<PublicsOfAFeedback.length; item++)
								{
									if (PublicsOfAFeedback[item].id_public==object_id)
									{
										ja_seleccionat=true;
										break;
									}
								}
								if (ja_seleccionat || es_un_target)				
									;//s+=" onClick=\"AfegeixPublicOfAFeedback(\'\', false);\"";  No fem res
								else
									s+=" onClick=\"AfegeixPublicOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
							}
							else //dades.element_origin:	REF_DOC
							{
									//comprovo si aquesta public ja forma part dels reference_docs de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
									for (var item=0; item<RefDocsOfAFeedback.length; item++)
									{
										if (RefDocsOfAFeedback[item].id_public==object_id)
										{
											ja_seleccionat=true;
											break;
										}
									}
									if (ja_seleccionat || es_un_target)				
										;//s+=" onClick=\"AfegeixRefDocOfAFeedback(\'\', false);\"";  No fem res
									else
										s+=" onClick=\"AfegeixRefDocOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
							}
						}
					}
					else //if (dades.resource_type=="CITATION")
					{
						if (dades.resource_origin=="FEEDBACK")
						{
							//Primer comprovo si el recurs que tinc als dits és un dels elements seleccionats com a targets, perquè aleshores no pot ser triat com a publicació/ref_doc/alt_rsrc/etc
							for (var item=0; item<TargetsOfAFeedback.length; item++)
							{
								if (TargetsOfAFeedback[item].id_target==object_id)
								{
									es_un_target=true;
									break;
								}
							}

							if (dades.element_origin=="FIX_RSRC")
							{
									//comprovo si aquesta citation ja forma part dels fixed_resources de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
									for (var item=0; item<FixRsrcsOfAFeedback.length; item++)
									{
										if (FixRsrcsOfAFeedback[item].id_citation==object_id)
										{
											ja_seleccionat=true;
											break;
										}
									}
									if (ja_seleccionat || es_un_target)				
										;//s+=" onClick=\"AfegeixFixRsrcOfAFeedback(\'\', false);\"";  No fem res
									else
										s+=" onClick=\"AfegeixFixRsrcOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
							}
							else if (dades.element_origin=="ALT_RSRC")
							{
									//comprovo si aquesta citation ja forma part dels alt_rsrc de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
									for (var item=0; item<AltRsrcsOfAFeedback.length; item++)
									{
										if (AltRsrcsOfAFeedback[item].id_citation==object_id)
										{
											ja_seleccionat=true;
											break;
										}
									}
									if (ja_seleccionat || es_un_target)				
										;//s+=" onClick=\"AfegeixAltRsrcOfAFeedback(\'\', false);\"";  No fem res
									else
										s+=" onClick=\"AfegeixAltRsrcOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
							}
							else //if (dades.element_origin=="ADD_DOC")
							{
									//comprovo si aquesta citation ja forma part dels add_doc de la valoració, i en cas que sí ho indico i no l'afegeixo onclick
									for (var item=0; item<AddDocsOfAFeedback.length; item++)
									{
										if (AddDocsOfAFeedback[item].id_citation==object_id)
										{
											ja_seleccionat=true;
											break;
										}
									}
									if (ja_seleccionat || es_un_target)				
										;//s+=" onClick=\"AfegeixAddDocOfAFeedback(\'\', false);\"";  No fem res
									else
										s+=" onClick=\"AfegeixAddDocOfAFeedback(\'"+object_id+"\', "+owc.features[i].properties.openData+");\"";
							}
						}
						//((-- resource_origin PUBLICAT)) --> ((dades.element_origin:	REL_RSRC	NOU AfegeixRelatedResourceOfAPublication N))			
					}					
				}
								
				s+="><img class=\"white-area-li-img\" src=\"";
				s+=DonaNomImgTipusRecurs(type, false);
				if (owc.features[i].properties.openData && owc.features[i].properties.openData=="true")
					s+="\"><img class=\"white-area-li-img-small\" src=\"OpenAccess.png";
				s+="\"><strong>" +owc.features[i].properties.authors[0].name+"</strong> "+DonaDataISOComAText(owc.features[i].properties.updated)+"<br/>";
				
				if (type=="HREF")
					s+=" <a class=\"white-area-li-text-link\" href=\""+owc.features[i].properties.links.enclosures[0].href+"\" target=\"_blank\" onClick=\"StopPropagationClick(event);return true;\">"+owc.features[i].properties.title+"</a>";
				else if (type=="POI")
					s+=owc.features[i].properties.title+" (lat/long: "+ owc.features[i].geometry.coordinates[1]+","+owc.features[i].geometry.coordinates[0]+")";
				else if (type=="FEEDBACK" || type=="CITATION" || type=="PUBLICAT" || type=="INDIVIDU" || type=="ORGANISM")
					s+=owc.features[i].properties.title; 
	      
	      if (dades.type_enum=="resources")
	      {
					s+="<br/><span class=\"white-area-li-shadow\"> ";
					s+="<a class=\"white-area-li-shadow-link\" id=\"fb-resource-"+i+"\" onClick=\"MostraFeedbackList(event, \'"+owc.features[i].id+"\');\">"+DonaCadenaJSON(Msg_Feedback)+"</a>&nbsp;&nbsp;&nbsp; ";
	    	                  		
					if (owc.features[i].properties.rights && owc.features[i].properties.rights.indexOf("S")!=-1)
						s+="<a class=\"white-area-li-shadow-link\" id=\"share-resource-"+i+"\" onClick=\"MostraShareResource(event, \'"+owc.features[i].id+"\', \'"+type+"\');\">"+DonaCadenaJSON(Msg_Share)+"</a>&nbsp;&nbsp;&nbsp; ";
						
					s+="<a class=\"white-area-li-shadow-link\" id=\"tag-resource-"+i+"\" onClick=\"MostraTagResource(event, \'"+owc.features[i].id+"\');\">"+DonaCadenaJSON(Msg_Tag)+"</a>&nbsp;&nbsp;&nbsp; ";
					s+="<a class=\"white-area-li-shadow-link\" id=\"delete-resource-"+i+"\" onClick=\"SendResourceDelete(event, \'"+owc.features[i].id+"\', \'"+type+"\', false);\">"+DonaCadenaJSON(Msg_Delete)+"</a></span>"
				}		
				else if (dades.type_enum=="resource-selector")			
				{
					if (ja_seleccionat)
					{
						if (dades.resource_type=="") //he entrat a resource-selector per escollir targets de valoracions
							s+="<br/><i>"+DonaCadenaJSON(Msg_Resource_already_targeted)+"</i>";
						else if (dades.resource_type=="PARTY")
							s+="<br/><i>"+DonaCadenaJSON(Msg_Responsible_already_related)+"</i>";					
						else if (dades.resource_type=="PUBLICAT")
							s+="<br/><i>"+DonaCadenaJSON(Msg_Publication_already_related)+"</i>";					
						else //queda "CITATION"
							s+="<br/><i>"+DonaCadenaJSON(Msg_Citation_already_related)+"</i>";					
					}
					else if (es_ell_mateix) //només pot passar als targets que no es trii a ell, per les publics/ref_docs/add_doc/etc d'un feedback o pels responsibles de citations/publics el enumerate només mostra pubs/cits/indv/org i per tant mai és ell mateix
						s+="<br/><i>"+DonaCadenaJSON(Msg_Feedback_item_selecting_targets_for)+"</i>";
					else if (es_un_target)
					{
						s+="<br/><i>"+DonaCadenaJSON(Msg_Resource_is_a_target)+" "+DonaCadenaJSON(Msg_Cant_be_selected)+".</i>";
						/* ja no cal l'aclariment aqui perquè ho diu al títol de la pàgina
						if (dades.element_origin=="PUBLICAT")
							s+=": "+DonaCadenaJSON(Msg_Related_Publications);
						else if (dades.element_origin=="REF_DOC")
							s+=": "+DonaCadenaJSON(Msg_Reference_documents);
						/*else if (dades.element_origin=="FIX_RSRC")
							s+=": "+DonaCadenaJSON(Msg_Fixed_Resource);* /
						else if (dades.element_origin=="ALT_RSRC")
							s+=": "+DonaCadenaJSON(Msg_Alternative_Resource);
						else //if (dades.element_origin=="ADD_DOC")
							s+=": "+DonaCadenaJSON(Msg_Additional_documentation);
						s+=".</i>";*/
					}
				}			
				s+="</li></div>";
			}
			s+="</ol>";
		}
		document.getElementById(dades.type_enum+"-list").innerHTML=s;
	}
	
	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function EnumeraResourcesQueTocaASelector()
{	
	//Quan crido a aquesta funció ja entrat ni que sigui una vegada a EnumerateResources de Resources-Selector, així que tinc el type i el origin apuntat	
	EnumerateResources(1, {"type_enum":"resource-selector", "make_pannel_visible":false, 
		"resource_type": document.resource_selector_form.resource_type.value, 
		"resource_origin": document.resource_selector_form.resource_origin.value});
	return;
}

var ajaxExecuteNBResource;

function EnumerateResources(start_index, dades)
{
	var s;
	
	RemoveInfo("long");		

	s="";
	if (dades.type_enum=="resource-selector")
	{ 
		if (dades.resource_type!="")
			s="&TYPE="+dades.resource_type;					
		
		if (document.getElementById("selector-owner-type_screen_value").selectedIndex>0)
		//miro el que hi ha seleccionat a la dropdown-list owner-type de la pàgina de resource-selector. Només m'interessa si selectedIndex>1 perquè -1 indica que no hi ha selecció i 0 és "Tots"
			s=s+"&OWNER="+document.getElementById("selector-owner-type_screen_value").options[document.getElementById("selector-owner-type_screen_value").selectedIndex].value;	
	}
	else //if (dades.type_enum=="resources")
	{ 
		if (document.getElementById("resource-type_screen_value").selectedIndex>0)
			//miro el que hi ha seleccionat a la dropdown-list resource-type. Només m'interessa si selectedIndex>1 perquè -1 indica que no hi ha selecció i 0 és "Tots"
			s="&TYPE="+document.getElementById("resource-type_screen_value").options[document.getElementById("resource-type_screen_value").selectedIndex].value;	
	
		if (document.getElementById("owner-type_screen_value").selectedIndex>0)
		//miro el que hi ha seleccionat a la dropdown-list owner-type de la pàgina de resources. Només m'interessa si selectedIndex>1 perquè -1 indica que no hi ha selecció i 0 és "Tots"
				s=s+"&OWNER="+document.getElementById("owner-type_screen_value").options[document.getElementById("owner-type_screen_value").selectedIndex].value;	
	}

	ajaxExecuteNBResource=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNBResource, null, null);
	ajaxExecuteNBResource.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&STARTINDEX="+start_index+"&COUNT="+ResourcesPerPage+s, AvaluaRespostaEnumerateResources, "text/xml", dades);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_resource_list_));
	return false;
}

function AvaluaRespostaRetrieveUserData(doc, no_usat)
{
var root, output, identifier;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier)
			{
				if (identifier.childNodes[0].nodeValue=="language")
				{					
					var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
					if (s!="")
					{
						for (var i=0; i<LanguagesNB.length; i++)
						{
							if (LanguagesNB[i]==s)
							{
								if (ActiveLanguage!=i)
								{
									ChangeLanguage(i, ResourcesPerPage);
									document.account_form.language.selectedIndex=ActiveLanguage;
									ShowInfo("short", DonaCadenaJSON(Msg_Language_changed_preferences));
								}
								break;
							}
						}
					}
				}
				else if (identifier.childNodes[0].nodeValue=="email")
					document.account_form.email.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="name")
					document.account_form.name.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				else if (identifier.childNodes[0].nodeValue=="bio")
					document.account_form.bio.value=OmpleInputDesDeWPSLiteralOutput(output.item(item));
			}
		}
		RemoveInfo("permanent");
		UpdateLastServer();
	}
	else
	{	
		RemoveInfo("permanent");
		TiraAPantallaRespostaSiNoEntenc(root, document);
	}
	return;
}

function RetrieveUserData()
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RETRIEVE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				, AvaluaRespostaRetrieveUserData, "text/xml", null);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));
	return false;
}

function ChangePannel(id, add_hash)
{
var i_pannel, 
	pannel=[{"id": "front-page", "parent": null, "title": Msg_NiMMbus_login}, 
		{"id": "reset-pass-page", "parent": null, "title": Msg_NiMMbus_reset_pwd}, 
		{"id": "new-pass-page", "parent": null, "title": Msg_NiMMbus_reset_pwd}, 
		{"id": "new-user-page", "parent": null, "title": Msg_SignUp_NiMMbus},
		{"id": "execute-token-page", "parent": null, "title": Msg_NiMMbus},
		//{"id": "new-user-page", "parent": null, "title": {"cat": "Registra't al NiMMbus", "spa": "Regístrese en NiMMbus", "eng": "Sign up for NiMMbus"}},
		{"id": "main-page", "parent": null, "title": Msg_NiMMbus},
		{"id": "account", "parent": "main-page", "title": Msg_NiMMbus_account}, 
		{"id": "href-resource", "parent": "main-page", "title": Msg_NiMMbus_Href}, 
		{"id": "poi-resource", "parent": "main-page", "title": Msg_NiMMbus_PoI}, 
		{"id": "feedback-resource", "parent": "main-page", "title": Msg_NiMMbus_Feedback}, 
		{"id": "citation-resource", "parent": "main-page", "title": Msg_NiMMbus_Citation}, 
		{"id": "publication-resource", "parent": "main-page", "title": Msg_NiMMbus_Publication}, 
		{"id": "individual-resource", "parent": "main-page", "title": Msg_NiMMbus_Individual}, 
		{"id": "organism-resource", "parent": "main-page", "title": Msg_NiMMbus_Organism}, 
		{"id": "resources", "parent": "main-page", "title": Msg_NiMMbus_Resources}, 
		{"id": "resource-selector", "parent": "main-page", "title": Msg_NiMMbus_ResourcesSelector}, 
		{"id": "feedback", "parent": "main-page", "title": Msg_NiMMbus_Feedbacks}, 
		{"id": "share", "parent": "main-page", "title": Msg_NiMMbus_Share}
		/*, {"id": "tag", "parent": "main-page", "title": Msg_NiMMbus} */];

	if (add_hash)
		location.hash=id;

	for (var i in pannel)
	{ 
		if (id==pannel[i].id)
		{
			i_pannel=i;
			break;
		}
	}

	for (var i in pannel)
	{ 
		if (i!=i_pannel)
		{
			if (pannel[i].id==pannel[i_pannel].parent)
				;  //Evito apagar el pare del id escollit.
			else
			{
				document.getElementById(pannel[i].id).style.visibility='hidden';
				if (pannel[i].parent && pannel[i].parent!=pannel[i_pannel].parent)  //Evito apagar el pare que és el mateix pare que l'escollit.
					document.getElementById(pannel[i].parent).style.visibility='hidden';
			}
		}
		else 
		{
		  document.title = DonaCadenaJSON(pannel[i_pannel].title);
			document.getElementById(pannel[i_pannel].id).style.visibility='visible';
			if (pannel[i_pannel].parent)
				document.getElementById(pannel[i_pannel].parent).style.visibility='visible';
		}
	}
	window.scrollTo(0, 0);
}

function MostraAccount(es_nou)
{
	NewUserChangeTimeOut=0;
	document.account_form.new_user.value=document.sign_in.user.value;
	document.account_form.email.value="";
	document.account_form.email.value="";
	document.account_form.name.value="";
	document.account_form.bio.value="";
	document.account_form.current_pass="";
	document.account_form.new_pass="";
	document.account_form.new_pass_valid="";
	document.account_form.language.selectedIndex=ActiveLanguage;
	
	RetrieveUserData();
	if (es_nou)
	{
		document.getElementById("current_pass_fieldset").style.display='none';
		document.getElementById("new_user_fieldset").style.display='none';
		document.getElementById("new_pass_fieldset").style.display='none';
		document.getElementById("new_pass_valid_fieldset").style.display='none';
		document.getElementById("account-close_btn").style.display='none';
	}
	else
	{
		document.getElementById("current_pass_fieldset").style.display='table';
		document.getElementById("new_user_fieldset").style.display='table';
		document.getElementById("new_pass_fieldset").style.display='table';
		document.getElementById("new_pass_valid_fieldset").style.display='table';
		document.getElementById("account-close_btn").style.display='inline';
	}
	ChangePannel("account", true);
}

var IdResourceToSaveChanges="";
var IdTargetResourceToSaveChanges="";
var IdFeedbackResourceToSaveChanges="";

var TargetsOfAFeedback=[];
var TargetsOfAFeedbackHaveChanged=false;

var	AddDocsOfAFeedback=[];
var AddDocsOfAFeedbackHaveChanged=false;
var	RefDocsOfAFeedback=[];
var RefDocsOfAFeedbackHaveChanged=false;
var	FixRsrcsOfAFeedback=[];
var FixRsrcsOfAFeedbackHaveChanged=false;
var	AltRsrcsOfAFeedback=[];
var AltRsrcsOfAFeedbackHaveChanged=false;

var	PublicsOfAFeedback=[];
var PublicsOfAFeedbackHaveChanged=false;
var IdCitationResourceToSaveChanges="";	
var ResponsiblesOfACitation=[];
var ResponsiblesOfACitationHaveChanged=false;
var IdPublicationResourceToSaveChanges="";	
var ResponsiblesOfAPublication=[];
var ResponsiblesOfAPublicationHaveChanged=false;
var BackNeededAfterDelete="";

var ElementsOfAFeedback=null;

function MostraHRefResource(id)
{
	ChangePannel("href-resource", true);
	IdResourceToSaveChanges=id;

	document.getElementById("href-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_Hyperlink);
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_hyperlink_characteristics);
		document.getElementById("href-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("href-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("href-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Hyperlink);
		document.getElementById("href-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_hyperlink_characteristics);
		document.getElementById("href-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("href-resource-delete_btn").style.display='inline';
	}
}

function MostraPoiResource(id)
{
	ChangePannel("poi-resource", true);
	IdResourceToSaveChanges=id;

	//document.getElementById("long-poi-resource_alert").style.display='none';
	//document.getElementById("lat-poi-resource_alert").style.display='none';
	document.getElementById("elevation-poi-resource_alert").style.display='none';
	document.getElementById("reason-poi-resource_alert").style.display='none';
	document.getElementById("poi-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_PoI);
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_PoI_characteristics);
		document.getElementById("poi-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("poi-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("poi-resource-title-text").innerHTML=DonaCadenaJSON(Msg_PoI);
		document.getElementById("poi-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_PoI_characteristics);
		document.getElementById("poi-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("poi-resource-delete_btn").style.display='inline';
	}
}

function OmpleElementsOfAFeedback()
{	//per a omplir la pàgina de FB amb les info que han vingut per la URL
	if (ElementsOfAFeedback)
	{	//poso cada text en el recurs que toca, inclús la data actual, de manera similar com els llegeixo del XML
		//Si estic en aquest context, esborro tot el que hi pugui haver
		BuidaPlegaFeedbackElements();
		if (ElementsOfAFeedback.abstract)
			document.feedback_resource_form.abstract.value=ElementsOfAFeedback.abstract;			
		if (ElementsOfAFeedback.report_aspect) 
		{	//ara asumeixo que només m'arriba un, es podria fer millor
		 	if (ElementsOfAFeedback.report_aspect=="usage")
		 		document.getElementById("reportAspect-feedback-usage").checked = true;
		 	else if (ElementsOfAFeedback.report_aspect=="fitnessForPurpose")
		 		document.getElementById("reportAspect-feedback-fitness-for-purpose").checked = true;
		 	else if (ElementsOfAFeedback.report_aspect=="limitation")			 					 	
				document.getElementById("reportAspect-feedback-limitation").checked = true;
			else if (ElementsOfAFeedback.report_aspect=="alternative")
				document.getElementById("reportAspect-feedback-alternative").checked = true;
			else if (ElementsOfAFeedback.report_aspect=="problem")
				document.getElementById("reportAspect-feedback-problem").checked = true;
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
		}		
		if (ElementsOfAFeedback.specific_usage)
		{
			document.feedback_resource_form.specific_usage.value=ElementsOfAFeedback.specific_usage;			
			var d = new Date();
			document.feedback_resource_form.usage_date.value=d.toISOString().substring(0, 10);
			document.feedback_resource_form.usage_time.value=d.toISOString().substring(11, 16);		
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
		}
		if (ElementsOfAFeedback.ru_code)
		{
			document.feedback_resource_form.code.value=ElementsOfAFeedback.ru_code;
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		if (ElementsOfAFeedback.ru_code_format)
		{
			SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ElementsOfAFeedback.ru_code_format);
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		if (ElementsOfAFeedback.ru_platform)
		{
			document.feedback_resource_form.platform.value=ElementsOfAFeedback.ru_platform;
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		if (ElementsOfAFeedback.ru_version)
		{
			document.feedback_resource_form.version.value=ElementsOfAFeedback.ru_version;		
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		if (ElementsOfAFeedback.ru_schema)
		{
			document.feedback_resource_form.schema.value=ElementsOfAFeedback.ru_schema;
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		if (ElementsOfAFeedback.ru_sugg_app)
		{			
			document.feedback_resource_form.sugg_app.value=ElementsOfAFeedback.ru_sugg_app;
			CollapseFieldset(document.getElementById("usage-feedback-resource"), "block"); //not collapsed if it has content
			CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "block"); //not collapsed if it has content	
			CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "block");
		}
		ElementsOfAFeedback=null; //perquè un cop usat no es torni a usar més
	}
}

//define is_none=0;
//define is_target=1;
//define is_public=2;
//define is_party_a_citation=3;
//define is_party_a_publication=4;
function OmpleRecursTargetsDesDeTargetsOfAFeedback(puc_editar)
{
	document.getElementById("target_feedback-resource_compact_list").innerHTML="";		
	if (TargetsOfAFeedback.length==0)
		return;		

	for (var item=0; item<TargetsOfAFeedback.length; item++)
	{
		document.getElementById("target_feedback-resource_compact_list").innerHTML+="<div id=\""+"target_feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(TargetsOfAFeedback[item].id_target, "target_feedback-resource_compact_list", TargetsOfAFeedback[item].role,  puc_editar ? "targetRole" : "", 
			(item+1), puc_editar ? "EliminaTargetOfAFeedback" : "", document.feedback_resource_form.open_data.checked, 1 /*is_target*/);
	}
	return;
}

function OmpleRecursPublicsDesDePublicsOfAFeedback(puc_editar)
{
	document.getElementById("public_feedback-resource_compact_list").innerHTML="";		
	if (PublicsOfAFeedback.length==0)
	{	//buido per si hi havia alguna cosa
		document.getElementById("public_feedback-resource_compact_list").innerHTML="";
		return;		
	}

	for (var item=0; item<PublicsOfAFeedback.length; item++)
	{
		document.getElementById("public_feedback-resource_compact_list").innerHTML+="<div id=\""+"public_feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(PublicsOfAFeedback[item].id_public, "public_feedback-resource_compact_list", null, null, (item+1), puc_editar ? "EliminaPublicOfAFeedback" : "", 
			document.feedback_resource_form.open_data.checked, 2 /*is_public*/);
	}
	return;
}

function OmpleRecursRefDocsDesDeRefDocsOfAFeedback(puc_editar)
{
	document.getElementById("ref-doc-feedback-resource_compact_list").innerHTML="";		
	if (RefDocsOfAFeedback.length==0)
	{	//buido per si hi havia alguna cosa
		document.getElementById("ref-doc-feedback-resource_compact_list").innerHTML="";
		return;		
	}

	for (var item=0; item<RefDocsOfAFeedback.length; item++)
	{
		document.getElementById("ref-doc-feedback-resource_compact_list").innerHTML+="<div id=\""+"ref-doc-feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(RefDocsOfAFeedback[item].id_public, "ref-doc-feedback-resource_compact_list", null, null, (item+1), puc_editar ? "EliminaRefDocOfAFeedback" : "", 
			document.feedback_resource_form.open_data.checked, 5 /*is_ref_doc*/);
	}
	return;
}

function OmpleRecursAddDocsDesDeAddDocsOfAFeedback(puc_editar)
{
	document.getElementById("add-doc-feedback-resource_compact_list").innerHTML="";		
	if (AddDocsOfAFeedback.length==0)
	{	//buido per si hi havia alguna cosa
		document.getElementById("add-doc-feedback-resource_compact_list").innerHTML="";
		return;		
	}

	for (var item=0; item<AddDocsOfAFeedback.length; item++)
	{
		document.getElementById("add-doc-feedback-resource_compact_list").innerHTML+="<div id=\""+"add-doc-feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(AddDocsOfAFeedback[item].id_citation, "add-doc-feedback-resource_compact_list", null, null, (item+1), puc_editar ? "EliminaAddDocOfAFeedback" : "", 
			document.feedback_resource_form.open_data.checked, 6 /*is_add_doc*/);
	}
	return;
}

function OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback(puc_editar)
{
	document.getElementById("alt-rsrc-feedback-resource_compact_list").innerHTML="";		
	if (AltRsrcsOfAFeedback.length==0)
	{	//buido per si hi havia alguna cosa
		document.getElementById("alt-rsrc-feedback-resource_compact_list").innerHTML="";
		return;		
	}

	for (var item=0; item<AltRsrcsOfAFeedback.length; item++)
	{
		document.getElementById("alt-rsrc-feedback-resource_compact_list").innerHTML+="<div id=\""+"alt-rsrc-feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(AltRsrcsOfAFeedback[item].id_citation, "alt-rsrc-feedback-resource_compact_list", null, null, (item+1), puc_editar ? "EliminaAltRsrcOfAFeedback" : "", 
			document.feedback_resource_form.open_data.checked, 7 /*is_alt_rsrc*/);
	}
	return;
}

function OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback(puc_editar)
{
	document.getElementById("fix-rsrc-feedback-resource_compact_list").innerHTML="";		
	if (FixRsrcsOfAFeedback.length==0)
	{	//buido per si hi havia alguna cosa
		document.getElementById("fix-rsrc-feedback-resource_compact_list").innerHTML="";
		return;		
	}

	for (var item=0; item<FixRsrcsOfAFeedback.length; item++)
	{
		document.getElementById("fix-rsrc-feedback-resource_compact_list").innerHTML+="<div id=\""+"fix-rsrc-feedback-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(FixRsrcsOfAFeedback[item].id_citation, "fix-rsrc-feedback-resource_compact_list", null, null, (item+1), puc_editar ? "EliminaFixRsrcOfAFeedback" : "", 
			document.feedback_resource_form.open_data.checked, 8 /*is_fix_rsrc*/);
	}
	return;
}

function MostraOAmagaExclamacioDeShareAElementsDeFeedback()
{
	for (var item=0; item<TargetsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("target_feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("target_feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}

	for (var item=0; item<RefDocsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("ref-doc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("ref-doc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}

	for (var item=0; item<AddDocsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("add-doc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("add-doc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}

	for (var item=0; item<AltRsrcsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("alt-rsrc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("alt-rsrc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}

	for (var item=0; item<FixRsrcsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("fix-rsrc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("fix-rsrc-feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}

	for (var item=0; item<PublicsOfAFeedback.length; item++)
	{
		if (document.feedback_resource_form.open_data.checked)
			document.getElementById("public_feedback-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("public_feedback-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}
}

function BuidaPlegaFeedbackElements()
{
	//Es fa des de fora pq és un tema que es gestiona sempre a banda
	
	//TargetsOfAFeedback.length=0;
	//TargetsOfAFeedbackHaveChanged=false;
	//OmpleRecursTargetsDesDeTargetsOfAFeedback((guf.rights && guf.rights.indexOf("W")!=-1) ? true : false);
	//També he de marcar-me que els recursos de selecció "han canviat", si no si no els toco, quan envii dirà que no han canviat i no s'enviarà encara que jo ho estava veient!!!
	document.feedback_resource_form.abstract.value="";
	document.feedback_resource_form.reason.value="";		
	CollapseFieldset(document.getElementById("reason-feedback-resource"), "none"); //default is collapsed
	
	SeleccionaSelectDesDeValor(document.feedback_resource_form.contactRole, "generalPublic");
	
	document.feedback_resource_form.comment.value="";
	SeleccionaSelectDesDeValor(document.feedback_resource_form.motivation, "undefined");
	CollapseFieldset(document.getElementById("user-comment-feedback-resource"), "block"); //default is not collapsed so shown even if empty
	
	SeleccionaRadioDesDeValor(document.feedback_resource_form.rating, "");

	document.getElementById("reportAspect-feedback-usage").checked = false;
	document.getElementById("reportAspect-feedback-fitness-for-purpose").checked = false;
	document.getElementById("reportAspect-feedback-limitation").checked = false;
	document.getElementById("reportAspect-feedback-alternative").checked = false;
	document.getElementById("reportAspect-feedback-problem").checked = false;

	document.feedback_resource_form.specific_usage.value="";
	document.feedback_resource_form.usage_date.value="";	
	document.feedback_resource_form.usage_time.value="";	
	document.feedback_resource_form.user_determined_limitations.value="";
	document.feedback_resource_form.response.value="";			
	AddDocsOfAFeedback.length=0;
	AddDocsOfAFeedbackHaveChanged=false;
	OmpleRecursAddDocsDesDeAddDocsOfAFeedback(true);
	document.feedback_resource_form.code.value="";
	document.feedback_resource_form.codeLink.value="";
	SeleccionaSelectDesDeValor(document.feedback_resource_form.codeMediaType, ""); //"other"
	document.feedback_resource_form.platform.value="";
	document.feedback_resource_form.version.value="";
	document.feedback_resource_form.schema.value="";	
	document.feedback_resource_form.sugg_app.value="";	
	document.feedback_resource_form.diagram.value="";
	document.feedback_resource_form.diagramLink.value="";
	SeleccionaSelectDesDeValor(document.feedback_resource_form.diagramMediaType, ""); //"other"
	document.feedback_resource_form.known_problem.value="";
	document.feedback_resource_form.problem_date.value="";	
	document.feedback_resource_form.problem_time.value="";
	document.feedback_resource_form.work_around.value="";		
	RefDocsOfAFeedback.length=0;
	RefDocsOfAFeedbackHaveChanged=false;
	OmpleRecursRefDocsDesDeRefDocsOfAFeedback(true);
	document.feedback_resource_form.expected_fix_date.value="";	
	FixRsrcsOfAFeedback.length=0;
	FixRsrcsOfAFeedbackHaveChanged=false;
	OmpleRecursFixRsrcsDesDeFixRsrcsOfAFeedback(true);
	AltRsrcsOfAFeedback.length=0;
	AltRsrcsOfAFeedbackHaveChanged=false;
	OmpleRecursAltRsrcsDesDeAltRsrcsOfAFeedback(true);	
	CollapseFieldset(document.getElementById("usage-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("usage-description-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("add-doc-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("reprodUsage-feedback-resource"), "none"); //default is collapsed		
	CollapseFieldset(document.getElementById("discovered-issue-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("ref-doc-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("fix-rsrc-feedback-resource"), "none"); //default is collapsed
	CollapseFieldset(document.getElementById("alt-rsrc-feedback-resource"), "none"); //default is collapsed		

	PublicsOfAFeedback.length=0;
	PublicsOfAFeedbackHaveChanged=false;
	CollapseFieldset(document.getElementById("public-feedback-resource"), "none"); //default is collapsed			
	OmpleRecursPublicsDesDePublicsOfAFeedback(true);	
}

//function MostraFeedbackResource(id, target, target_role, i_target)
function MostraFeedbackResource(id, target)
{	
	TargetsOfAFeedbackHaveChanged=false;
	if (id=='')
	{
		if (target==null)
			;// en aquest cas estic en un context de creació de FB a un target seleccionat per la via de ADDFEEDBACK i TargetsOfAFeedback pot estar ple d'abans!
		else
			TargetsOfAFeedback.length=0;		
		//Estic creant un FB nou, per tant he de posar tot en blanc (també el rating a indefinit perquè si no em queda
			//el rating de la darrer FB que he obert, i en aquest cas no interessa (per si vull fer un comment SENSE rating!))
		BuidaPlegaFeedbackElements();		
		document.getElementById("open-data-feedback-resource_screen_value").checked=true; //una valoració nova la marco compartida amb anònim per defecte		
	}
		
	if (id=='' && target==null)  //Marca de que estic afegint un feedback a un target seleccionat 
	{
		if (IdTargetResourceToSaveChanges) /* Estic mirant els FB existents d'un cert recurs al client "normal", per tant he passat per la pàgina de FB_list 
				i he demanat això en aquest context NO PUC usar IdResourceToSaveChanges perquè si des de la pàgina de FB_list en creava un de nou, 
				després entrava a editar-lo, i després en volia crear un altre, el segon q creava tenia de target el primer!!!*/
			TargetsOfAFeedback[0]={"id_target": IdTargetResourceToSaveChanges, "role": "primary"};				
		/*else -> En aquest segon cas, estic en un context de creació de FB a un target seleccionat per la via de ADDFEEDBACK (p.ex. des de CKAN o un navegador
				de mapes, etc), i per tant NO he entrat per la via de FB_list i IdTargetResourceToSaveChanges és blanc, però IdResourceToSaveChanges és el que vull.
			ABANS es feia aquí usant IdResourceToSaveChanges, però ara es fa a on s'omplia IdResourceToSaveChanges per permetre N targets si cal)
				TargetsOfAFeedback[0]={"id_target": IdResourceToSaveChanges, "role": "primary"};
			però ara ja no cal fer res perquè ja està fet */
		TargetsOfAFeedbackHaveChanged=true; //Si no no s'enviarà el text "TARGET_1=... en el CREATE
	}
	else
	{
		if  (target && target!='')
		{
			TargetsOfAFeedback[0]={"id_target": target, "role": (target_role ? target_role : "primary")};
			TargetsOfAFeedbackHaveChanged=true; //Si no no s'enviarà el text "TARGET_1=... en el CREATE
		}
	}	
	OmpleRecursTargetsDesDeTargetsOfAFeedback(true);
	OmpleElementsOfAFeedback();
	ChangePannel("feedback-resource", true);

	IdResourceToSaveChanges=id;
	IdFeedbackResourceToSaveChanges=id; //perquè si des de la pàgina de FB acabo creant una publicació, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo
	
	document.getElementById("feedback-resource-exit_btn").style.display='none';
	if (id=="")
	{		
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_feedback);
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_feedback_characteristics);
		//document.getElementById("open-data-feedback-resource_fieldset").style.display='inline';
		document.getElementById("open-data-feedback-resource_screen_value").disabled=false;
		//fet abans -> document.getElementById("open-data-feedback-resource_screen_value").checked=true; //una valoració nova la marco compartida amb anònim per defecte		
		document.getElementById("feedback-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("feedback-resource-delete_btn").style.display='none';		
	}
	else
	{
		document.getElementById("feedback-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Feedback);
		document.getElementById("feedback-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_feedback_characteristics);
		//document.getElementById("open-data-feedback-resource_fieldset").style.display='none';
		document.getElementById("open-data-feedback-resource_screen_value").disabled=true;
		document.getElementById("feedback-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("feedback-resource-delete_btn").style.display='inline';
	}
}

function SurtDeAddFeedbackCallBack(obj_amb_targets)
/* obj_amb_targets.targets és en aquest moment un array amb 0 elements perquè ja s'han processat tots */
{
	//DetermineCitationID
	/*ShowInfo("short", DonaCadenaJSON(Msg_Citation_created));*/
	RetrieveUserMinPreferences();

	//En un context de ADDFEEDBACK:
	document.getElementById("new-resource").style.display='none';
	document.getElementById("settings-signout").style.display='none'; //trec la "signout" del menu de tools. Si se n'agefeixen més pensar si les vull o no en aquest context

	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":false});	
	MostraFeedbackResource('', null); 
	//MostraFeedbackResource('', null, target_role, i_target);
}

function AvaluaRespostaCreaTargetNoNecessari(doc)
{
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return null;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return null;
	}

	process_succeeded=GetXMLElementByName(root, "wps", "ProcessSucceeded");
	if (process_succeeded)
	{
		//Si ha retornat de manera immediata amb una ProcessSucceeded vol dir que no calia crear cap target. Es podria comprobar més bé mirant is "msg_id:" és 99 però no em cal.
		id_obj=DonaIDRecursDesDeRootXML(root);
		RemoveInfo("permanent");
		return id_obj;
	}
	return "";
}

function AvaluaRespostaRetrieveTarget(doc, nom_funcio_i_params)
{
var target_id;
	
	//Determina si la resposta ha estat "error" "ja existeix" i puc obtenir el target_id
	target_id=AvaluaRespostaCreaTargetNoNecessari(doc);
	if (target_id==null)  // El fitxer doc no és ni tant sols un xml que es pugui entendre.
		return;
	if (target_id=="")
	{
		AvaluaResposta(doc, nom_funcio_i_params, true);	//El recurs no existia i està en procés de creació
		ShowInfo("short", DonaCadenaJSON(Msg_Citation_created));
	}
	else
	{
		var json_funcio_i_params=JSON.parse(nom_funcio_i_params);
		var json_params=JSON.parse(json_funcio_i_params.params);
		TargetsOfAFeedback.push({"id_target": target_id, "role": (json_params.current_role ? json_params.current_role : "primary")}); 

		if (typeof window[json_funcio_i_params.nom_funcio] === "function")
			window[json_funcio_i_params.nom_funcio](json_params);
		else 
			alert("AvaluaRespostaRetrieveTarget(doc, nom_funcio_i_params) error in parameter \"nom_funcio_i_params.nom_funcio\": "+ json_funcio_i_params.nom_funcio +" is not a function.");
	}
}

//Funció inspirada en SendCitationResourceChanges() però molt més automàtica.
function EntraAAddFeedback(obj_amb_targets)
//Quan s'arriba a la funció per primera vegada obj_amb_targets només té un array de N targets dins obj_amb_targets.targets
//en les crides recursives obj_amb_targets.targets va contenint cada vegada la resta (els targets no processats), i també
//conté el obj_amb_targets.current_role que és el role que vull pel target que estic gestionant
{
var resta_targets = obj_amb_targets.targets.slice();
var params_str;

	resta_targets.splice(0,1);
	params_str=JSON.stringify({targets: resta_targets, current_role: obj_amb_targets.targets[0].role ? obj_amb_targets.targets[0].role : "primary"});
	params_str=params_str.replaceAll("\"", "\\\"");

	ActionAfterSignIn=TancaFinestraNimmbus;
	ParamActionAfterSignIn=null;

	ShowInfo("permanent", DonaCadenaJSON(Msg_Citation_sent));
	ajaxExecuteNB=new Ajax();	
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:CREATE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=CITATION"+"&TITLE="+obj_amb_targets.targets[0].title+
				"&ID_CODE="+obj_amb_targets.targets[0].code+"&ID_NAMESPACE="+obj_amb_targets.targets[0].code_space+
				"&URL_LINK=&URL_DESCRIP=&URL_FUNCTION="+(obj_amb_targets.targets[0].share_borrower_1!="" ? "&SHARE_BORROWER_1="+obj_amb_targets.targets[0].share_borrower_1 : ""), AvaluaRespostaRetrieveTarget, "text/xml", 
				"{\"nom_funcio\": \""+ (resta_targets.length ? "EntraAAddFeedback" : "SurtDeAddFeedbackCallBack") +"\","+ 
				"\"params\": \""+params_str+"\"}");
	return false;
}

function OmpleRecursResponsiblesDesDeResponsiblesOfACitation(puc_editar)
{
	document.getElementById("responsible-citation-resource_compact_list").innerHTML="";		
	if (ResponsiblesOfACitation.length==0)
		return;		

	for (var item=0; item<ResponsiblesOfACitation.length; item++)
	{
		document.getElementById("responsible-citation-resource_compact_list").innerHTML+="<div id=\""+"responsible-citation-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(ResponsiblesOfACitation[item].id_responsible, "responsible-citation-resource_compact_list", ResponsiblesOfACitation[item].role, puc_editar ? "responsibleRole" : "", 
			(item+1), puc_editar ? "EliminaResponsibleOfACitation" : "", document.citation_resource_form.open_data.checked, 3 /*is_party_a_citation*/);
	}
	return;
}

function OmpleRecursResponsiblesDesDeResponsiblesOfAPublication(puc_editar)
{
	document.getElementById("responsible-publication-resource_compact_list").innerHTML="";		
	if (ResponsiblesOfAPublication.length==0)
		return;		

	for (var item=0; item<ResponsiblesOfAPublication.length; item++)
	{
		document.getElementById("responsible-publication-resource_compact_list").innerHTML+="<div id=\""+"responsible-publication-resource_compact_list"+"_"+(item+1)+"\"></div>";
		PopulateCompactDescriptionResource(ResponsiblesOfAPublication[item].id_responsible, "responsible-publication-resource_compact_list", ResponsiblesOfAPublication[item].role, puc_editar ? "responsibleRole" : "", 
			(item+1), puc_editar ? "EliminaResponsibleOfAPublication" : "", document.citation_resource_form.open_data.checked, 4 /*is_party_a_publication*/);
	}
	return;
}

function MostraOAmagaExclamacioDeShareAResponsiblesOfACitation()
{
	for (var item=0; item<ResponsiblesOfACitation.length; item++)
	{
		if (document.citation_resource_form.open_data.checked)
			document.getElementById("responsible-citation-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("responsible-citation-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}
}

function MostraCitationResource(id)
{
	ChangePannel("citation-resource", true);
	IdResourceToSaveChanges=id;
	IdCitationResourceToSaveChanges=id; //perquè si des de la pàgina de cita acabo creant un nou individual, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo

	document.getElementById("citation-resource-exit_btn").style.display='none';
	if (id=="") //estic creant una cita nova
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_citation);
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_citation_characteristics);
		//document.getElementById("open-data-citation-resource_fieldset").style.display='inline';
		document.getElementById("open-data-citation-resource_screen_value").disabled=false;
		document.getElementById("open-data-citation-resource_screen_value").checked=true; //una publicació nova la marco compartida amb anònim per defecte		
		document.getElementById("citation-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("citation-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("citation-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Citation);
		document.getElementById("citation-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_citation_characteristics);
		//document.getElementById("open-data-citation-resource_fieldset").style.display='none';
		document.getElementById("open-data-citation-resource_screen_value").disabled=true;
		document.getElementById("citation-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("citation-resource-delete_btn").style.display='inline';
	}
}

function MostraOAmagaExclamacioDeShareAResponsiblesOfAPublication()
{
	for (var item=0; item<ResponsiblesOfAPublication.length; item++)
	{
		if (document.citation_resource_form.open_data.checked)
			document.getElementById("responsible-publication-resource_compact_list_"+(item+1)+"_open").style.display='inline';
		else
			document.getElementById("responsible-publication-resource_compact_list_"+(item+1)+"_open").style.display='none';		
	}
}

function MostraPublicationResource(id)
{
	ChangePannel("publication-resource", true);
	IdResourceToSaveChanges=id;
	IdPublicationResourceToSaveChanges=id; //perquè si des de la pàgina de publicació acabo creant un nou individual, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo

	document.getElementById("publication-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("publication-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_publication);
		document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_publication_characteristics);
		//document.getElementById("open-data-publication-resource_fieldset").style.display='inline';
		document.getElementById("open-data-publication-resource_screen_value").disabled=false;
		document.getElementById("open-data-publication-resource_screen_value").checked=true; //una publicació nova la marco compartida amb anònim per defecte		
		document.getElementById("publication-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("publication-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("publication-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Publication);
		document.getElementById("publication-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_publication_characteristics);
		//document.getElementById("open-data-publication-resource_fieldset").style.display='none';
		document.getElementById("open-data-publication-resource_screen_value").disabled=true;
		document.getElementById("publication-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("publication-resource-delete_btn").style.display='inline';
	}
}

function MostraIndividualResource(id)
{
	ChangePannel("individual-resource", true);
	IdResourceToSaveChanges=id;

	document.getElementById("individual-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("individual-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_individual);
		document.getElementById("individual-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_individual_characteristics);
		//document.getElementById("open-data-individual-resource_fieldset").style.display='inline';
		document.getElementById("open-data-individual-resource_screen_value").disabled=false;
		document.getElementById("open-data-individual-resource_screen_value").checked=true; //un individu nou el marco compartit amb anònim per defecte		
		document.getElementById("individual-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("individual-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("individual-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Individual);
		document.getElementById("individual-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_individual_characteristics);
		//document.getElementById("open-data-individual-resource_fieldset").style.display='none';
		document.getElementById("open-data-individual-resource_screen_value").disabled=true;
		document.getElementById("individual-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("individual-resource-delete_btn").style.display='inline';
	}
}


function MostraOrganismResource(id)
{
	ChangePannel("organism-resource", true);
	IdResourceToSaveChanges=id;

	document.getElementById("organism-resource-exit_btn").style.display='none';
	if (id=="")
	{
		document.getElementById("organism-resource-title-text").innerHTML=DonaCadenaJSON(Msg_New_organism);
		document.getElementById("organism-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Define_organism_characteristics);
		//document.getElementById("open-data-organism-resource_fieldset").style.display='inline';
		document.getElementById("open-data-organism-resource_screen_value").disabled=false;
		document.getElementById("open-data-organism-resource_screen_value").checked=true; //un organisme nou el marco compartit amb anònim per defecte		
		document.getElementById("organism-resource_btn").value=DonaCadenaJSON(Msg_Create);
		document.getElementById("organism-resource-delete_btn").style.display='none';
	}
	else
	{
		document.getElementById("organism-resource-title-text").innerHTML=DonaCadenaJSON(Msg_Organism);
		document.getElementById("organism-resource-subtitle-text").innerHTML=DonaCadenaJSON(Msg_Modify_organism_characteristics);
		//document.getElementById("open-data-organism-resource_fieldset").style.display='none';
		document.getElementById("open-data-organism-resource_screen_value").disabled=true;
		document.getElementById("organism-resource_btn").value=DonaCadenaJSON(Msg_Save_changes);
		document.getElementById("organism-resource-delete_btn").style.display='inline';
	}
}

function MostraShareResource(event, query, type)
{	//Ara per ara no cal patir per els hash perque mai canvia de pàgina. si algun moment permitim entrar a llista de usuaris, p.ex, caldrà vigilar lo de ChangePannel, etc
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);
	IdResourceToSaveChanges=id;

	RetrieveShareAuthorizedList(type);
	EnumerateShareResource(id);

	ChangePannel("share", true);
}

/*This function draws the "Feedback items" form.*/
function MostraFeedbackList(event, query, id_to_use)
{
var id;

	if (event)
		StopPropagationClick(event);

	if (id_to_use)
		id=id_to_use;
	else
		id=DonaValorDeFormulari("RESOURCE", query, true);
	
	IdResourceToSaveChanges=id;
	IdTargetResourceToSaveChanges=id;

	EnumerateFeedbackResource(id);
	document.getElementById("feedback_target_compact_descrip").innerHTML="";		
	PopulateCompactDescriptionResource(id, "feedback_target_compact_descrip", null, null, null, null, false, 0 /*is_none*/);
}

function MostraTagResource(event, query)
{
var id=DonaValorDeFormulari("RESOURCE", query, true);

	StopPropagationClick(event);

	//IdResourceToSaveChanges=id;

	alert(DonaCadenaJSON(Msg_Not_implemented_yet));
		
	//NewUserChangeTimeOut=0;
	//RetrieveUserData();
	//ChangePannel("tag", true);
}

function AvaluaRespostaShareEnumerate(doc, id)
{
var root, output, identifier, text_current_share_list, has_anonymous=false;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	text_current_share_list="";

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="borrower" ||
			    identifier.childNodes[0].nodeValue=="owner")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					var rights=GetValueXMLElementByName(nb_user, "nb_share", "rights");
					var user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					//La llista de share ara només mostra rights i user, però ni name ni email
					//var name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					//var email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					if (user=="Anonymous")
					{
						has_anonymous=true;
						text_current_share_list+=DonaCadenaJSON({cat: "Compartit amb tothom", spa: "Compartir con todos", eng: "Share with everybody"});						
					}
					else
						text_current_share_list+=user;
					if (user==document.sign_in.user.value)  //soc jo mateix.
						text_current_share_list+=" (<i>"+DonaCadenaJSON(Msg_Myself)+"</i>)";						
					text_current_share_list+=": ";
					text_current_share_list += (rights.indexOf("R")==-1 ? "" : " " + DonaCadenaJSON(Msg_Read)+"<img src=\"check16.png\"/>") + (rights.indexOf("W")==-1 ? "" : " " + DonaCadenaJSON(Msg_Write)+"<img src=\"check16.png\"/>") + (rights.indexOf("S")==-1 ? "" : " " + DonaCadenaJSON(Msg_Share)+"<img src=\"check16.png\"/>") + (rights.indexOf("O")==-1 ? "" : " " + DonaCadenaJSON(Msg_Owner)+"<img src=\"check16.png\"/>");
					if (identifier.childNodes[0].nodeValue=="borrower")
						text_current_share_list+=" <a href=\'javascript:void(0);\' onclick=\'DeleteShareResource(\""+user+"\")\'><img src=\"delete16.png\" border=\"0\"/></a>"
					text_current_share_list+="<br/>";
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	document.getElementById("current_share_list").innerHTML=text_current_share_list;
	document.getElementById("current_share_fieldset").style.display=(text_current_share_list=="") ? 'none' : 'inline';
	document.getElementById("new_share_open_fieldset").style.display=(has_anonymous) ? 'none': 'inline';
	return;
}

function EnumerateShareResource(id)
{	
	if (id==null)
	{
    ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+id, AvaluaRespostaShareEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function AvaluaRespostaFeedbackEnumerate(doc, id)
{
var root, text_current_feedback_list;

	root=DonaRootXML(doc, document);
	if (!root)
		return;
	if (AnalitzaExceptionReport(root, document))
		return;
	var owc=ParseOWSContextAtom(root);

	if (location.hash!="#feedback") 
		ChangePannel("feedback", true);
	//else -> si ja hi soc no cal

	document.getElementById("current_feedback_fieldset").style.display=(!owc.features || owc.features.length) ? 'inline' : 'none';

	text_current_feedback_list="";
	if (owc.features)
	{
		for (var i=0; i<owc.features.length; i++)
		{
			//We are supposing that all the returned objects are of the same type: FEEDBACK
			text_current_feedback_list+=owc.features[i].properties.title;
			text_current_feedback_list+=" <input class=\"submit_btn\" type=\"button\" value=\""+ DonaCadenaJSON(Msg_Edit) +"\" onClick=\"EditResource(\'"+owc.features[i].id+"\', \'FEEDBACK\')\"/>";
			text_current_feedback_list+="<br/>";			
		}
	}
	document.getElementById("current_feedback_list").innerHTML=text_current_feedback_list;

	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function EnumerateFeedbackResource(id)
{	
	if (id==null)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:ENUMERATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE=FEEDBACK&TARGET="+id, AvaluaRespostaFeedbackEnumerate, "text/xml", id);
        ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function AvaluaRespostaShareAuthorized(doc, no_usat)
{
var root, output, identifier, nb_user;
var user, name, email;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}
	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	output=GetXMLElementCollectionByName(root, "wps", "Output");

	//En aquest punt esborro el contingut del select si n'hi havia.
	while (document.share_form.new_share_select.options.length)
		document.share_form.new_share_select.options[0]=null;

	//Aquest és una mica especial donat que si no hi ha outputs també té sentit la resposta.
	for (var item=0; output && item<output.length; item++)
	{
		identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
		if (identifier)
		{
			if (identifier.childNodes[0].nodeValue=="authorized")
			{					
				var nb_user=OmpleInputDesDeWPSComplexOutput(output.item(item))
				if (nb_user)
				{
					user=GetValueXMLElementByName(nb_user, "nb_user", "user");
					name=GetValueXMLElementByName(nb_user, "nb_user", "name");
					email=GetValueXMLElementByName(nb_user, "nb_user", "email");
					document.share_form.new_share_select.options[document.share_form.new_share_select.options.length]=new Option(user+ "  " +name+ "  " +(email=="" ? "": "<" +email+">"), user);
				}
			}
		}
	}
	RemoveInfo("permanent");
	UpdateLastServer();
	return;
}

function RetrieveShareAuthorizedList(type)
{	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:AUTHORIZED&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&TYPE="+type, AvaluaRespostaShareAuthorized, "text/xml", null);
        //En aquest cas no dic res: ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting_data_));

	return true;
}

function SurtDeAddShareCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Added));
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateShareResource(IdResourceToSaveChanges);
}

function AddShareResource(tothom)
{	
	if (IdResourceToSaveChanges=="")
	{
	  ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	if (tothom)
	{
		ajaxExecuteNB=new Ajax();
		AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaResposta, "text/xml",
				"{nom_funcio: \"SurtDeAddShareCallBack\", params: null}"); 
	}
	else
	{
		if (document.share_form.new_share.value=="")
		{
			ShowInfo("long", DonaCadenaIdNoPotSerBuit("new_share_screen"));
			return false;
		}
		ajaxExecuteNB=new Ajax();
		AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
		ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+document.share_form.new_share.value+"&BORROWER_TOKEN_TYPE=&RIGHTS=R"+(document.share_form.W.checked ? "W":"")+(document.share_form.S.checked ? "S":""),
				AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeAddShareCallBack\", params: null}");
	}
  ShowInfo("permanent", DonaCadenaJSON(Msg_Adding_));

	return true;
}

function SurtDeDeleteShareCallBack()
{
	ShowInfo("short", DonaCadenaJSON(Msg_Deleted));
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateShareResource(IdResourceToSaveChanges);
}

function DeleteShareResource(user)
{	
	if (IdResourceToSaveChanges=="")
	{
	        ShowInfo("long", DonaCadenaJSON(Msg_Cannot_found_resource_identifier));
		return;
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:DELETE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges+"&BORROWER="+user+"&BORROWER_TOKEN_TYPE=", AvaluaResposta, "text/xml", 
				"{nom_funcio: \"SurtDeDeleteShareCallBack\", params: null}");
  ShowInfo("permanent", DonaCadenaJSON(Msg_Deleting_));
  return false;
}

function ShowShareAuthorizedList()
{
	if (document.share_form.new_share_select.options.length)
		document.getElementById("new_share_select").style.display='inline';
}

function HideShareAuthorizedList()
{
	document.getElementById("new_share_select").style.display='none';
}

function SelectionShareAuthorizedList()
{
	if (document.share_form.new_share_select.selectedIndex!=-1)
		document.share_form.new_share.value=document.share_form.new_share_select.options[document.share_form.new_share_select.selectedIndex].value;
}

function SendHRefResourceChanges()
{
var s,s2;
	if (document.href_resource_form.href.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("href-href-resource_screen"));
		return false;
	}
	if (document.href_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-href-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	 	ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	 	
	 	// En una creació els elements buits no s'han d'enviar
		if (document.href_resource_form.mimetype.value!="")
			s2+="&MIMETYPE="+document.href_resource_form.mimetype.value;					
		if (document.href_resource_form.reason.value!="")
			s2+="&REASON="+DonaCadenaPerValorDeFormulari(document.href_resource_form.reason.value);			
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));	  
	  
	  // En una modificació els elements buits SI que s'han d'enviar
	  s2+="&MIMETYPE="+document.href_resource_form.mimetype.value+"&REASON="+DonaCadenaPerValorDeFormulari(document.href_resource_form.reason.value);
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=HREF"+"&HREF="+DonaCadenaPerValorDeFormulari(document.href_resource_form.href.value)+"&TITLE="+DonaCadenaPerValorDeFormulari(document.href_resource_form.title.value)+
				s2, AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"HREF\"}");
	return false;
}

function SendPoiResourceChanges()
{
var s,s2;
	if (document.poi_resource_form.long.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("long-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.lat.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("lat-poi-resource_screen"));
		return false;
	}
	if (document.poi_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-poi-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2="";
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	  
	  // En una creació els elements buits no s'han d'enviar
	  if (document.poi_resource_form.reason.value!="")
			s2+="&REASON="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.reason.value);
		if (document.poi_resource_form.pos_accur.value!="")
			s2+="&POS_ACCURACY="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.pos_accur.value);
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	  
	  // En una modificació els elements buits SI que s'han d'enviar
	  s2+="&REASON="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.reason.value)+"&POS_ACCURACY="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.pos_accur.value);
	}
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=POI"+"&POSITION=<gml:Point><gml:pos>" + document.poi_resource_form.lat.value+ " " +document.poi_resource_form.long.value+ "</gml:pos></gml:Point>"+
				(document.poi_resource_form.elevation.value=="" ? "" : "&ELEVATION="+document.poi_resource_form.elevation.value)+
				"&TITLE="+DonaCadenaPerValorDeFormulari(document.poi_resource_form.title.value)+s2, 
				AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"POI\"}");
	return false;
}

function RecuperaCanvisARolesATargetsOfAFeedback()
{
		for (var item=0; item<TargetsOfAFeedback.length; item++)
		{
			var role_temp;
			role_temp=DonaCadenaCodelistDeSelect(eval("document.feedback_resource_form.targetRole_"+(item+1)));
			
			if (TargetsOfAFeedback[item].role!=role_temp)
			{
				TargetsOfAFeedback[item].role=role_temp;
				TargetsOfAFeedbackHaveChanged=true;
			}
		}	
		return;
}

function RecuperaCanvisARolesAResponsiblesOfACitation()
{
		for (var item=0; item<ResponsiblesOfACitation.length; item++)
		{
			var role_temp;
			role_temp=DonaCadenaCodelistDeSelect(eval("document.citation_resource_form.responsibleRole_"+(item+1)));
			
			if (ResponsiblesOfACitation[item].role!=role_temp)
			{
				ResponsiblesOfACitation[item].role=role_temp;
				ResponsiblesOfACitationHaveChanged=true;
			}
		}	
		return;
}

function RecuperaCanvisARolesAResponsiblesOfAPublication()
{
		for (var item=0; item<ResponsiblesOfAPublication.length; item++)
		{
			var role_temp;
			role_temp=DonaCadenaCodelistDeSelect(eval("document.publication_resource_form.responsibleRole_"+(item+1)));
			
			if (ResponsiblesOfAPublication[item].role!=role_temp)
			{
				ResponsiblesOfAPublication[item].role=role_temp;
				ResponsiblesOfAPublicationHaveChanged=true;
			}
		}	
		return;
}

function AvaluaRespostaAddShareAddicional(doc, no_usat)
{	
var root, id_proces, id_obj;

	root=DonaRootXML(doc, document);
	if (!root)
	{
		RemoveInfo("permanent");
		return;
	}

	if (AnalitzaExceptionReport(root, document))
	{
		RemoveInfo("permanent");
		return;
	}

	//en aquest cas si el add_share no s'ha fet bé doncs "no passa res" pq era secundari per fer-ho polit
	RemoveInfo("permanent");
	return;
}

function DonaCadenaDeReportAspect()
{
var algun=false;

	var s=""; 
	if (document.getElementById("reportAspect-feedback-usage").checked)
	{
		s=document.getElementById("reportAspect-feedback-usage").value;
		algun=true;
	}
	if (document.getElementById("reportAspect-feedback-fitness-for-purpose").checked)
	{
		if (algun)
			s+=",";
		else
			algun=true;
		s+=document.getElementById("reportAspect-feedback-fitness-for-purpose").value;
	}
	if (document.getElementById("reportAspect-feedback-limitation").checked)
	{
		if (algun)
			s+=",";
		else
			algun=true;
		s+=document.getElementById("reportAspect-feedback-limitation").value;
	}
	if (document.getElementById("reportAspect-feedback-alternative").checked)
	{
		if (algun)
			s+=",";
		else
			algun=true;
		s+=document.getElementById("reportAspect-feedback-alternative").value;
	}			
	if (document.getElementById("reportAspect-feedback-problem").checked)
	{
		if (algun)
			s+=",";
		else
			algun=true;
		s+=document.getElementById("reportAspect-feedback-problem").value;
	}			
	return s;
}

function SendFeedbackResourceChanges()
{
var s,s2;

	if (document.feedback_resource_form.abstract.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("abstract-feedback-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	
	IdResourceToSaveChanges=IdFeedbackResourceToSaveChanges; //perquè si des de la pàgina de FB acabo creant una nova public, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo
	IdFeedbackResourceToSaveChanges=""; //faig "net"

	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.feedback_resource_form.open_data.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
    ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
    
    var p;
 		// En una creació els elements buits no s'han d'enviar
		if (document.feedback_resource_form.reason.value!="")
			s2+="&REASON="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.reason.value);					
		if ((p=DonaCadenaCodelistDeSelect(document.feedback_resource_form.contactRole))!="")
			s2+="&CONTACT_ROLE="+p;
		if ((p=DonaCadenaCodelistDeRadio(document.feedback_resource_form.rating))!="")
			s2+="&RATING="+p;
		if (document.feedback_resource_form.comment.value!="")
			s2+="&COMMENT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.comment.value);
		if ((p=DonaCadenaCodelistDeSelect(document.feedback_resource_form.motivation))!="")
			s2+="&MOTIVATION="+p;
		if ((p=DonaCadenaDeReportAspect())!="")
			s2+="&REPORT_ASPECT="+p;
		if (document.feedback_resource_form.specific_usage.value!="")
			s2+="&SPECIFIC_USAGE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.specific_usage.value);
		if ((p=DonaCadenaDataHoraPerValorDeFormulari(document.feedback_resource_form.usage_date.value,document.feedback_resource_form.usage_time.value))!="")
			s2+="&USAGE_DATE_TIME="+p;
		if (document.feedback_resource_form.user_determined_limitations.value!="")
			s2+="&USER_DETERMINED_LIMITATIONS="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.user_determined_limitations.value);
		if (document.feedback_resource_form.response.value!="")
			s2+="&RESPONSE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.response.value);
		if (document.feedback_resource_form.code.value!="")
			s2+="&RU_CODE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.code.value);
		if (document.feedback_resource_form.codeLink.value!="")
			s2+="&RU_CODE_LINK="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.codeLink.value);
		if ((p=DonaCadenaCodelistDeSelect(document.feedback_resource_form.codeMediaType))!="")
			s2+="&RU_CODE_FORMAT="+p;		
		if (document.feedback_resource_form.platform.value!="")
			s2+="&RU_PLATFORM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.platform.value);
		if (document.feedback_resource_form.version.value!="")
			s2+="&RU_VERSION="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.version.value);
		if (document.feedback_resource_form.schema.value!="")
			s2+="&RU_SCHEMA="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.schema.value);		
		if (document.feedback_resource_form.sugg_app.value!="")
			s2+="&RU_SUGG_APP="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.sugg_app.value);		
		if (document.feedback_resource_form.diagram.value!="")			
			s2+="&RU_DIAGRAM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.diagram.value);
		if (document.feedback_resource_form.diagramLink.value!="")
			s2+="&RU_DIAGRAM_LINK="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.diagramLink.value);
		if ((p=DonaCadenaCodelistDeSelect(document.feedback_resource_form.diagramMediaType))!="")
			s2+="&RU_DIAGRAM_FORMAT="+p;	
		if (document.feedback_resource_form.known_problem.value!="")
			s2+="&KNOWN_PROBLEM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.known_problem.value);
		if ((p=DonaCadenaDataHoraPerValorDeFormulari(document.feedback_resource_form.problem_date.value,document.feedback_resource_form.problem_time.value))!="")
			s2+="&PROBLEM_DATE_TIME="+p;
		if (document.feedback_resource_form.work_around.value!="")
			s2+="&WORK_AROUND="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.work_around.value);
		if ((p=DonaCadenaDataPerValorDeFormulari(document.feedback_resource_form.expected_fix_date.value))!="")
			s2+="&EXPECTED_FIX_DATE="+p;
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
    ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
    
    // En una modificació els elements buits SI que s'han d'enviar
		s2+="&REASON="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.reason.value)+
			"&CONTACT_ROLE="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.contactRole)+
			"&RATING="+DonaCadenaCodelistDeRadio(document.feedback_resource_form.rating)+
			"&COMMENT="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.comment.value)+
			"&MOTIVATION="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.motivation)+
			"&REPORT_ASPECT="+DonaCadenaDeReportAspect()+
			"&SPECIFIC_USAGE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.specific_usage.value)+				
			"&USAGE_DATE_TIME="+DonaCadenaDataHoraPerValorDeFormulari(document.feedback_resource_form.usage_date.value,document.feedback_resource_form.usage_time.value)+			
			"&USER_DETERMINED_LIMITATIONS="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.user_determined_limitations.value)+
			"&RESPONSE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.response.value)+
			"&RU_CODE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.code.value)+
			"&RU_CODE_LINK="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.codeLink.value)+
			"&RU_CODE_FORMAT="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.codeMediaType)+
			"&RU_PLATFORM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.platform.value)+
			"&RU_VERSION="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.version.value)+
			"&RU_SCHEMA="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.schema.value)+
			"&RU_SUGG_APP="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.sugg_app.value)+
			"&RU_DIAGRAM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.diagram.value)+
			"&RU_DIAGRAM_LINK="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.diagramLink.value)+
			"&RU_DIAGRAM_FORMAT="+DonaCadenaCodelistDeSelect(document.feedback_resource_form.diagramMediaType)+			
			"&KNOWN_PROBLEM="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.known_problem.value)+
			"&PROBLEM_DATE_TIME="+DonaCadenaDataHoraPerValorDeFormulari(document.feedback_resource_form.problem_date.value,document.feedback_resource_form.problem_time.value)+		
			"&WORK_AROUND="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.work_around.value)+
			"&EXPECTED_FIX_DATE="+DonaCadenaDataPerValorDeFormulari(document.feedback_resource_form.expected_fix_date.value);
	}
	
	//Miro si hi han hagut canvis en els rols dels quals jo no m'he enterat (si hi ha canvis ja es posa a true)
	RecuperaCanvisARolesATargetsOfAFeedback();
	if (TargetsOfAFeedbackHaveChanged)
	{
		if (TargetsOfAFeedback.length)
		{
			for (var item=0; item<TargetsOfAFeedback.length; item++)
					s2+="&TARGET_"+(item+1)+"="+TargetsOfAFeedback[item].id_target+"&TARGET_ROLE_"+(item+1)+"="+TargetsOfAFeedback[item].role;
		}
		else //abans n'hi havia i ara no, escriure TARGET_1 implica que si hi havia targets d'aquesta valoració, s'esborraran
			s2+="&TARGET_1=";
	}
	
	if (PublicsOfAFeedbackHaveChanged)
	{
		if (PublicsOfAFeedback.length)
		{
			for (var item=0; item<PublicsOfAFeedback.length; item++)
					s2+="&PUB_"+(item+1)+"="+PublicsOfAFeedback[item].id_public;
		}
		else //abans n'hi havia i ara no, escriure PUB_1 implica que si hi havia publicacions d'aquesta valoració, s'esborraràn
			s2+="&PUB_1=";
	}

	if (RefDocsOfAFeedbackHaveChanged)
	{
		if (RefDocsOfAFeedback.length)
		{
			for (var item=0; item<RefDocsOfAFeedback.length; item++)
					s2+="&REF_DOC_"+(item+1)+"="+RefDocsOfAFeedback[item].id_public;
		}
		else //abans n'hi havia i ara no, escriure REF_DOC_1 implica que si hi havia documents de referència d'aquesta valoració, s'esborraràn
			s2+="&REF_DOC_1=";
	}
	
	if (AddDocsOfAFeedbackHaveChanged)
	{
		if (AddDocsOfAFeedback.length)
		{
			for (var item=0; item<AddDocsOfAFeedback.length; item++)
					s2+="&ADD_DOC_"+(item+1)+"="+AddDocsOfAFeedback[item].id_citation;
		}
		else //abans n'hi havia i ara no, escriure ADD_DOC_1 implica que si hi havia documents addicionals d'aquesta valoració, s'esborraràn
			s2+="&ADD_DOC_1=";
	}
	
	if (AltRsrcsOfAFeedbackHaveChanged)
	{
		if (AltRsrcsOfAFeedback.length)
		{
			for (var item=0; item<AltRsrcsOfAFeedback.length; item++)
					s2+="&ALT_RSRC_"+(item+1)+"="+AltRsrcsOfAFeedback[item].id_citation;
		}
		else //abans n'hi havia i ara no, escriure ALT_RSRC_1 implica que si hi havia recursos alternatius d'aquesta valoració, s'esborraràn
			s2+="&ALT_RSRC_1=";
	}

	if (FixRsrcsOfAFeedbackHaveChanged)
	{
		if (FixRsrcsOfAFeedback.length)
		{
			for (var item=0; item<FixRsrcsOfAFeedback.length; item++)
					s2+="&FIX_RSRC_"+(item+1)+"="+FixRsrcsOfAFeedback[item].id_citation;
		}
		else //abans n'hi havia i ara no, escriure ALT_RSRC_1 implica que si hi havia recursos alternatius d'aquesta valoració, s'esborraràn
			s2+="&FIX_RSRC_1=";
	}
		
	ajaxExecuteNB=new Ajax();	
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);		
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
			//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
			"&TYPE=FEEDBACK"+//"&TITLE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.title.value)+ 
			//-> eliminem abstract (per redundant) i l'antic abstract serà el títol. Pre compatibilitat i coherència amb altres recursos, en la sintaxi de resource CREATE/MODIFY es diu TITLE
			"&TITLE="+DonaCadenaPerValorDeFormulari(document.feedback_resource_form.abstract.value)+
			s2, AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"FEEDBACK\"}");		

	if (document.feedback_resource_form.open_data.checked)
	{	//Si aquest FB item es compartit anònimament, m'asseguro que els elements relacionats amb ell també ho són
		if (TargetsOfAFeedback.length) // && TargetsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els targets
		{
			for (var item=0; item<TargetsOfAFeedback.length; item++)
			{
				if (!TargetsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+TargetsOfAFeedback[item].id_target+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}

		if (RefDocsOfAFeedback.length) //&& RefDocsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els ref_docs
		{
			for (var item=0; item<RefDocsOfAFeedback.length; item++)
			{	
				if (!RefDocsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+RefDocsOfAFeedback[item].id_public+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);					
				}
			}
		}

		if (AddDocsOfAFeedback.length) //&& AddDocsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els add_docs
		{
			for (var item=0; item<AddDocsOfAFeedback.length; item++)
			{	
				if (!AddDocsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+AddDocsOfAFeedback[item].id_citation+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}

		if (AltRsrcsOfAFeedback.length) //&& AltRsrcsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els alt_rsrcs
		{
			for (var item=0; item<AltRsrcsOfAFeedback.length; item++)
			{	
				if (!AltRsrcsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+AltRsrcsOfAFeedback[item].id_citation+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}

		if (FixRsrcsOfAFeedback.length) //&& FixRsrcsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els fix_rsrcs
		{
			for (var item=0; item<FixRsrcsOfAFeedback.length; item++)
			{	
				if (!FixRsrcsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+FixRsrcsOfAFeedback[item].id_citation+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}

		if (PublicsOfAFeedback.length) //&& PublicsOfAFeedbackHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en les publics
		{
			for (var item=0; item<PublicsOfAFeedback.length; item++)
			{	
				if (!PublicsOfAFeedback[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+PublicsOfAFeedback[item].id_public+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);					
				}
			}
		}
	}
	return false;
}

function SendCitationResourceChanges()
{
var s,s2;
	if (document.citation_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-citation-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	
	IdResourceToSaveChanges=IdCitationResourceToSaveChanges; //perquè si des de la pàgina de Cita acabo creant un nou responsible, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo
	IdCitationResourceToSaveChanges=""; //faig "net"
	
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.citation_resource_form.open_data.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	  
	  var p;
	  // En una creació els elements buits no s'han d'enviar
		if (document.citation_resource_form.edition.value!="")
			s2+="&EDITION="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.edition.value);
		if ((p=DonaCadenaDataPerValorDeFormulari(document.citation_resource_form.edition_date.value))!="")
	  	s2+="&EDITION_DATE="+p;
	  if (document.citation_resource_form.id_code.value!="")
	  	s2+="&ID_CODE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_code.value);
	  if (document.citation_resource_form.id_namespace.value!="")
			s2+="&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_namespace.value);
		if (document.citation_resource_form.series_name.value!="")
			s2+="&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_name.value);
		if (document.citation_resource_form.series_issue.value!="")
			s2+="&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_issue.value);
		if (document.citation_resource_form.series_page.value!="")
			s2+="&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_page.value);
		if (document.citation_resource_form.other_cit_details.value!="")
			s2+="&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.other_cit_details.value);
		if (document.citation_resource_form.url_link.value!="")
			s2+="&URL_LINK="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_link.value);
		if (document.citation_resource_form.url_descrip.value!="")
			s2+="&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_descrip.value);
		if ((p=DonaCadenaCodelistDeSelect(document.citation_resource_form.function_code))!="")
			s2+="&URL_FUNCTION="+p;
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	  
	  // En una modificació els elements buits SI que s'han d'enviar
	  s2+="&EDITION="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.edition.value)+"&EDITION_DATE="+DonaCadenaDataPerValorDeFormulari(document.citation_resource_form.edition_date.value)+
			"&ID_CODE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_code.value)+"&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.id_namespace.value)+
			"&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_name.value)+"&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_issue.value)+
			"&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.series_page.value)+"&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.other_cit_details.value)+
			"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_link.value)+"&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.url_descrip.value)+
			"&URL_FUNCTION="+DonaCadenaCodelistDeSelect(document.citation_resource_form.function_code);
	}
	
	//Miro si hi han hagut canvis en els rols dels quals jo no m'he enterat (si hi ha canvis ja es posa a true)
	RecuperaCanvisARolesAResponsiblesOfACitation();
	if (ResponsiblesOfACitationHaveChanged)
	{
		if (ResponsiblesOfACitation.length)
		{
			for (var item=0; item<ResponsiblesOfACitation.length; item++)
					s2+="&RESPONSIBLE_"+(item+1)+"="+ResponsiblesOfACitation[item].id_responsible+"&RESPONSIBLE_ROLE_"+(item+1)+"="+ResponsiblesOfACitation[item].role;
		}
		else //abans n'hi havia i ara no, escriure TARGET_1 implica que si hi havia targets d'aquesta valoració, s'esborraran
			s2+="&RESPONSIBLE_1=";
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=CITATION"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.citation_resource_form.title.value)+
				s2, AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"CITATION\"}");
				
	if (document.citation_resource_form.open_data.checked)
	{	//Si aquesta cita està compartida anònimament, m'asseguro que els elements relacionats amb ella també ho són
		if (ResponsiblesOfACitation.length) // && ResponsiblesOfACitationHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els responsables
		{
			for (var item=0; item<ResponsiblesOfACitation.length; item++)
			{
				if (!ResponsiblesOfACitation[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+ResponsiblesOfACitation[item].id_responsible+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}
	}
	return false;
}

function SendPublicationResourceChanges()
{
var s,s2;
	if (document.publication_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-publication-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	
	IdResourceToSaveChanges=IdPublicationResourceToSaveChanges; //perquè si des de la pàgina de Cita acabo creant un nou responsible, el IdResourceToSaveChanges passa a ser el del nou recurs creat i el perdo
	IdPublicationResourceToSaveChanges=""; //faig "net"	

	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.publication_resource_form.open_data.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	  
	  var p;
	  // En una creació els elements buits no s'han d'enviar
	  if (document.publication_resource_form.edition.value!="")
			s2+="&EDITION="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.edition.value);
		if ((p=DonaCadenaDataPerValorDeFormulari(document.publication_resource_form.edition_date.value))!="")
	  	s2+="&EDITION_DATE="+p;
	  if (document.publication_resource_form.id_code.value!="")
	  	s2+="&ID_CODE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_code.value);
	  if (document.publication_resource_form.id_namespace.value!="")
			s2+="&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_namespace.value);
		if (document.publication_resource_form.series_name.value!="")
			s2+="&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_name.value);
		if (document.publication_resource_form.series_issue.value!="")
			s2+="&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_issue.value);
		if (document.publication_resource_form.series_page.value!="")
			s2+="&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_page.value);
		if (document.publication_resource_form.other_cit_details.value!="")
			s2+="&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.other_cit_details.value);
		if (document.publication_resource_form.url_link.value!="")
			s2+="&URL_LINK="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_link.value);
		if (document.publication_resource_form.url_descrip.value!="")
			s2+="&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_descrip.value);
		if ((p=DonaCadenaCodelistDeSelect(document.publication_resource_form.function_code))!="")
			s2+="&URL_FUNCTION="+p;
		if ((p=DonaCadenaCodelistDeSelect(document.publication_resource_form.category_code))!="")
			s2+="&CATEGORY="+p;
		if (DonaCadenaPerValorDeFormulari(document.publication_resource_form.abstract.value)!="")
			s2+="&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.abstract.value);
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	  
	  // En una modificació els elements buits SI que s'han d'enviar
	  s2+="&EDITION="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.edition.value)+"&EDITION_DATE="+DonaCadenaDataPerValorDeFormulari(document.publication_resource_form.edition_date.value)+
	  	"&ID_CODE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_code.value)+"&ID_NAMESPACE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.id_namespace.value)+
			"&SERIES_NAME="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_name.value)+"&SERIES_ISSUE_ID="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_issue.value)+
			"&SERIES_PAGE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.series_page.value)+"&OTHER_CIT_DETAILS="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.other_cit_details.value)+
			"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_link.value)+"&URL_DESCRIP="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.url_descrip.value)+
			"&URL_FUNCTION="+DonaCadenaCodelistDeSelect(document.publication_resource_form.function_code)+"&CATEGORY="+DonaCadenaCodelistDeSelect(document.publication_resource_form.category_code)+
			"&ABSTRACT="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.abstract.value);
	}
	
	//Miro si hi han hagut canvis en els rols dels quals jo no m'he enterat (si hi ha canvis ja es posa a true)
	RecuperaCanvisARolesAResponsiblesOfAPublication();
	if (ResponsiblesOfAPublicationHaveChanged)
	{
		if (ResponsiblesOfAPublication.length)
		{
			for (var item=0; item<ResponsiblesOfAPublication.length; item++)
					s2+="&RESPONSIBLE_"+(item+1)+"="+ResponsiblesOfAPublication[item].id_responsible+"&RESPONSIBLE_ROLE_"+(item+1)+"="+ResponsiblesOfAPublication[item].role;
		}
		else //abans n'hi havia i ara no, escriure TARGET_1 implica que si hi havia targets d'aquesta valoració, s'esborraran
			s2+="&RESPONSIBLE_1=";
	}

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=PUBLICAT"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.publication_resource_form.title.value)+				
				s2, AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"PUBLICAT\"}");
							
	if (document.publication_resource_form.open_data.checked)
	{	//Si aquesta publicació està compartida anònimament, m'asseguro que els elements relacionats amb ella també ho són
		if (ResponsiblesOfAPublication.length) // && ResponsiblesOfAPublicationHaveChanged -> cal sempre perquè ara pot passar que existeixi algun cas que no està resolt i l'he de solucionar encara que no hi hagi canvis en els responsables
		{
			for (var item=0; item<ResponsiblesOfAPublication.length; item++)
			{
				if (!ResponsiblesOfAPublication[item].open_data) //si encara no és un recurs públic ho demano
				{
					ajaxExecuteNB=new Ajax();
					AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
					ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_SHARE:ADD&LANGUAGE="+LanguagesNB[ActiveLanguage]
						//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
						+"&RESOURCE="+ResponsiblesOfAPublication[item].id_responsible+"&BORROWER=Anonymous&BORROWER_TOKEN_TYPE=&RIGHTS=R", AvaluaRespostaAddShareAddicional, "text/xml", null);
				}
			}
		}
	}				
	return false;
}

function SendIndividualResourceChanges()
{
var s,s2;
	if (document.individual_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-individual-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.individual_resource_form.open_data.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));

		// En una creació els elements buits no s'han d'enviar
		if (document.individual_resource_form.email.value!="")
	  	s2+="&EMAIL="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.email.value);
	  if (document.individual_resource_form.url_link.value!="")
		  s2+="&URL_LINK="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.url_link.value);
	  if (document.individual_resource_form.id_code_1.value!="")
			s2+="&ID_CODE_1="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_code_1.value);
		if (document.individual_resource_form.id_namespace_1.value!="")
			s2+="&ID_NAMESPACE_1="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_namespace_1.value);
		if (document.individual_resource_form.id_code_2.value!="")
			s2+="&ID_CODE_2="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_code_2.value);
		if (document.individual_resource_form.id_namespace_2.value!="")
			s2+="&ID_NAMESPACE_2="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_namespace_2.value);
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	  
	  // En una modificació els elements buits SI que s'han d'enviar
	  s2+="&EMAIL="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.email.value)+"&URL_LINK="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.url_link.value)+
			"&ID_CODE_1="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_code_1.value)+"&ID_NAMESPACE_1="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_namespace_1.value)+
			"&ID_CODE_2="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_code_2.value)+"&ID_NAMESPACE_2="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.id_namespace_2.value);
	}
	
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=INDIVIDU"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.individual_resource_form.title.value)+
				s2,	AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"PARTY\"}");
				
	return false;
}


function SendOrganismResourceChanges()
{
var s,s2;
	if (document.organism_resource_form.title.value=="")
	{
		ShowInfo("long", DonaCadenaIdNoPotSerBuit("title-organism-resource_screen"));
		return false;
	}
	RemoveInfo("long");
	
	if (IdResourceToSaveChanges=="")
	{
		s="CREATE";
		s2=(document.organism_resource_form.open_data.checked) ? "&SHARE_BORROWER_1=Anonymous" : "";
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Resource_sent));
	  
	  // En una creació els elements buits no s'han d'enviar
	  if (document.organism_resource_form.delivery_point.value!="")
			s2+="&DELIVERY_POINT="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.delivery_point.value);
		if (document.organism_resource_form.city.value!="")
			s2+="&CITY="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.city.value);
		if (document.organism_resource_form.administrative_area.value!="")
			s2+="&ADM_AREA="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.administrative_area.value);
		if (document.organism_resource_form.postal_code.value!="")
			s2+="&POSTAL_CODE="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.postal_code.value);
		if (document.organism_resource_form.country.value!="")
			s2+="&COUNTRY="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.country.value);
	}
	else
	{
		s="MODIFY";
		s2="&RESOURCE="+IdResourceToSaveChanges;
	  ShowInfo("permanent", DonaCadenaJSON(Msg_Modifications_sent));
	  
	  // En una modificació els elements buits SI que s'han d'enviar
		s2+="&DELIVERY_POINT="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.delivery_point.value)+"&CITY="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.city.value)+
			"&ADM_AREA="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.administrative_area.value)+"&POSTAL_CODE="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.postal_code.value)+
			"&COUNTRY="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.country.value);
	}

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:"+s+"&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+
				//"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)+
				"&TYPE=ORGANISM"+"&TITLE="+DonaCadenaPerValorDeFormulari(document.organism_resource_form.title.value)+
				s2, AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceChangesCallBack\", params: \"PARTY\"}");
	return false;
}

function SendResourceDelete(event, query, type, cal_history_back)
{
	if (event)
		StopPropagationClick(event);
		
	if (query)
	{
		var id=DonaValorDeFormulari("RESOURCE", query, true);
		IdResourceToSaveChanges=id;
	}
	//else -> estic a dins la pàgina d'un recurs i IdResourceToSaveChanges ja conté el que cal

	if (cal_history_back)
		BackNeededAfterDelete=true;
	else
		BackNeededAfterDelete=false;

	s=DonaCadenaJSON(Msg_Sure_completely_delete_);

	if (type=="HREF")
		s+=DonaCadenaJSON(Msg_this_Hyperlink);
	else if (type=="POI")
		s+=DonaCadenaJSON(Msg_this_PoI);
	else if (type=="FEEDBACK")
		s+=DonaCadenaJSON(Msg_this_feedback_item);
	else if (type=="CITATION")
		s+=DonaCadenaJSON(Msg_this_citation);
	else if (type=="PUBLICAT")
		s+=DonaCadenaJSON(Msg_this_publication);
	else if (type=="INDIVIDU")
		s+=DonaCadenaJSON(Msg_this_individual);
	else if (type=="ORGANISM")
		s+=DonaCadenaJSON(Msg_this_organism);
	else
	{
	  ShowInfo("long", DonaCadenaJSON(Msg_Unidentified_resource_type));
		return false;
	}
	s+="?";

	if (false==confirm(s))
		return false;

	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_RESOURCE:DELETE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&RESOURCE="+IdResourceToSaveChanges,
				AvaluaResposta, "text/xml", "{nom_funcio: \"SurtDeQualsevolResourceDeleteCallBack\", params: \""+type+"\"}");				 
  ShowInfo("permanent", DonaCadenaJSON(Msg_Request_sent));
	return false;
}

function SurtDeQualsevolResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	//ChangePannel("resources", true);
	history.back();
}

function SurtDeQualsevolResourceChangesCallBack(type)
{
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));

	if (type=="FEEDBACK")
		SurtDeFeedbackResourceChanges(false);
	else if (type=="CITATION")
		SurtDeCitationResourceChanges(false);
	else if (type=="PUBLICAT")
		SurtDePublicationResourceChanges(false);
	else
		SurtDeQualsevolResourceChanges(false);

	setTimeout("OmpleRecursosQueTocaSortintDeQualsevolResource(\""+type+"\");",100);
}

function SurtDeQualsevolResourceDeleteCallBack(type)
{
var s;
	
	if (type=="HREF")
		s=DonaCadenaJSON(Msg_Hyperlink_deleted);
	else if (type=="POI")
		s=DonaCadenaJSON(Msg_this_PoI);
	else if (type=="FEEDBACK")
		s=DonaCadenaJSON(Msg_this_feedback_item);
	else if (type=="CITATION")
		s=DonaCadenaJSON(Msg_this_citation);
	else if (type=="PUBLICAT")
		s=DonaCadenaJSON(Msg_this_publication);
	else if (type=="INDIVIDU")
		s=DonaCadenaJSON(Msg_this_individual);
	else if (type=="ORGANISM")
		s=DonaCadenaJSON(Msg_this_organism);
	else
		  return;
	
	if (BackNeededAfterDelete)
	{
		if (type=="FEEDBACK")
		{
			SurtDeFeedbackResourceChanges(false);
			//Si estic sortint d'un FB i venia de la pàgina de FBList, em cal reescriure-la, per que el recurs esborrat desaparegui. 
			//Si estic sortint del FB per anar a la llista general de recursos això tampoc no fa mal
			setTimeout("OmpleRecursosQueTocaSortintDeQualsevolResource(\""+type+"\");",100);
		}
		else if (type=="CITATION")
			SurtDeCitationResourceChanges(false);
		else if (type=="PUBLICAT")
			SurtDePublicationResourceChanges(false);
		else //per la resta
			SurtDeQualsevolResourceChanges(false);	
	}
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100); 
	EnumerateResources(1, {"type_enum":"resources"});
}

function GetPoiFromDeviceCallBack(position) 
{
var d;
	setTimeout("RemoveInfo('permanent');ShowInfo('short', DonaCadenaJSON(Msg_Done));", 1200);
	
	document.poi_resource_form.long.value=position.coords.longitude;
	/*document.getElementById("long-poi-resource_alert").style.display='inline';
	document.getElementById("long-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.lat.value=position.coords.latitude;
	/*document.getElementById("lat-poi-resource_alert").style.display='inline';
	document.getElementById("lat-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.accuracy+" m";*/
	document.poi_resource_form.pos_accur.value=position.coords.accuracy+"m";

	if (position.coords.altitude)
	{
		document.poi_resource_form.elevation.value=position.coords.altitude;
		document.getElementById("elevation-poi-resource_alert").style.display='inline';
		if (position.coords.coords.altitudeAccuracy)
			document.getElementById("elevation-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Accuracy)+": "+position.coords.coords.altitudeAccuracy+" m";
	}
	document.getElementById("reason-poi-resource_alert").style.display='inline';
	d = new Date(position.timestamp);
	document.getElementById("reason-poi-resource_alert").innerHTML=DonaCadenaJSON(Msg_Got_it_at) + ": " + DonaDataJSComAText(d) +". ";
	if (position.coords.speed && position.coords.speed!=0.0)
	{
		document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadenaJSON(Msg_Speed)+": "+position.coords.speed*3.6 + " km/h. ";
		if (position.coords.heading)
			document.getElementById("reason-poi-resource_alert").innerHTML+=DonaCadenaJSON(Msg_Heading)+": "+position.coords.heading + ".";
	}
}

function GetPoiFromDeviceErrorCallBack(error)
{
	switch (error.code) 
	{
		case error.PERMISSION_DENIED:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_denied));
			break;
	        case error.POSITION_UNAVAILABLE:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_unavailable));
			break;
        	case error.TIMEOUT:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_timed_out));
			break;
		case error.UNKNOWN_ERROR:
		default:
			ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_unkown_error));
			break;
	}
}

var TimeOutGPS=0;

function GetPoiFromDevice()
{
	if (navigator.geolocation) 
	{
		ShowInfo("permanent", DonaCadenaJSON(Msg_Geolocation_trying));
		navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack);		
		if (TimeOutGPS)
			clearTimeout(TimeOutGPS);
		TimeOutGPS=setTimeout("ShowInfo('short', DonaCadenaJSON(Msg_Trying_get_more_accuracy));navigator.geolocation.getCurrentPosition(GetPoiFromDeviceCallBack, GetPoiFromDeviceErrorCallBack, {maximumAge:600000, timeout:12000, enableHighAccuracy: true});", 1800);
	}
	else 
		ShowInfo("long", DonaCadenaJSON(Msg_Geolocation_not_supported));
}

function SurtDeFeedbackResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	//Si cal ja he enviat els canvis en els targets i publics
	TargetsOfAFeedbackHaveChanged=false;
	RefDocsOfAFeedbackHaveChanged=false;
	AddDocsOfAFeedbackHaveChanged=false;
	FixRsrcsOfAFeedbackHaveChanged=false;
	AltRsrcsOfAFeedbackHaveChanged=false;
	PublicsOfAFeedbackHaveChanged=false;
	
	if (ActionAfterSignIn==TancaFinestraNimmbus)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
	{
		//Si vaig a recursos qui decideix repintar la llista després d'esborrar?
		history.back();
		//ChangePannel("resources", true);
	}
}

function SurtDeFeedbackResourceChangesIRecarregaResources(avis)
{	// Encara que surti de la pàgina de FB sense desar (tancar/descartar) he de demanar que es repinti la pàgina de recursos, perquè potser des de la pàgina del FB he creat una publicació nova
	SurtDeFeedbackResourceChanges(avis);
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateResources(1, {"type_enum":"resources"});
}

function SurtDeCitationResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	//Si cal ja he enviat els canvis en els responsables
	ResponsiblesOfACitationHaveChanged=false;

	history.back();
	//ChangePannel("resources", true);
}

function SurtDeCitationResourceChangesIRecarregaResources(avis)
{	// Encara que surti de la pàgina de citation sense desar (tancar/descartar) he de demanar que es repinti la pàgina de recursos, perquè potser des de la pàgina de la citació he creat un responsible nou
	SurtDeCitationResourceChanges(avis);
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateResources(1, {"type_enum":"resources"});
}

function SurtDePublicationResourceChanges(avis)
{
	if (avis)
	{
		if (false==confirm(DonaCadenaJSON(Msg_Exit_without_saving_changes)))
			return false;
	}
	//Si cal ja he enviat els canvis en els responsables
	ResponsiblesOfAPublicationHaveChanged=false;

	history.back();
	//ChangePannel("resources", true);
}

function SurtDePublicationResourceChangesIRecarregaResources(avis)
{	// Encara que surti de la pàgina de publication sense desar (tancar/descartar) he de demanar que es repinti la pàgina de recursos, perquè potser des de la pàgina de la publicació he creat un responsible nou
	SurtDePublicationResourceChanges(avis);
	//if (location.hash=="#resources") --> caldrà fer l'estil de setTimeout("OmpleRecursosQueTocaSortintDeXXXXX();",100);
	EnumerateResources(1, {"type_enum":"resources"});
}

function OmpleRecursosQueTocaSortintDeQualsevolResource(type)
{
	//En alguns casos sortint d'un recurs no he de tornar a la pàgina general de recursos, 
	//si no a una altra pàgina
	if (location.hash=="#resources")
		EnumerateResources(1, {"type_enum":"resources"});
	else
	{	
		if (type=="FEEDBACK") //Torno des de la pàgina de creació d'un nou FB, a la pàgina de llista de FB sobre un recurs
			MostraFeedbackList(null, null, IdTargetResourceToSaveChanges);
		else if (type=="PUBLICAT")
			ObreSelectorGeneral(false, type, "FEEDBACK", document.publication_resource_form.element_origin.value);
		else if (type=="CITATION")
			ObreSelectorGeneral(false, type, "FEEDBACK", document.citation_resource_form.element_origin.value);
		else if (type=="PARTY")
		{	//aquí potser venia de citation o de publication!	
			//Puc mirar organism_resource_form o indv_resource_form perquè els tinc sincronitzats
			if (document.organism_resource_form.resource_origin.value=="CITATION")
				ObreSelectorGeneral(false, type, "CITATION");
			else //PUBLICAT
				ObreSelectorGeneral(false, type, "PUBLICAT");
		}


		//else //estic tornant a pàgina selector de recursos, per tant he de tornar amb la darrera combinació que hi havia arribat pàgina de selected


			//ObreSelectorGeneral(false, resource_selector_form.resource_type.value, resource_selector_form.resource_origin.value, document.resource_selector_form.element_origin.value);		
		/* if (type=="PUBLICAT")
		{	//aquí, de moment, sempre vinc de FB, però el element_origin pot ser un o un altre	
			ObreSelectorGeneral(false, type, "FEEDBACK", document.resource_selector_form.element_origin.value);
			//resource_selector_form.resource_type
			//resource_selector_form.resource_origin
			//document.resource_selector_form.element_origin
			/*$$$$ no se a quin form etàs element_origin, però el necessito per diferenciar
			ObreSelectorGeneral(true, 'PUBLICAT', 'FEEDBACK', 'REF_DOC');">
			ObreSelectorGeneral(true, 'PUBLICAT', 'FEEDBACK', 'PUBLICAT');* /
		
		}
		else if (type=="CITATION")
		{
			ObreSelectorGeneral(false, type, "FEEDBACK", "CITATION", document.resource_selector_form.element_origin.value);
			/*no entenc les crides antigues u noves aqui, no estenc el citation de la linea de dalt, crec que estacva així per analogia amb el d'abans, però que no s'usava mai, i ara si que caldra posar els 3 de sota
			$$$$ no se a quin form etàs element_origin, però el necessito per diferenciar
			ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'ADD_DOC');">
			ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'FIX_RSRC');">
			ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'ALT_RSRC');">* /

		}
		else if (type=="PARTY")
		{	//aquí potser venia de citation o de publication!	
			ObreSelectorGeneral(false, resource_selector_form.resource_typen.value, resource_selector_form.resource_origin.value, document.resource_selector_form.element_origin.value);
			//if (document.organism_resource_form.resource_origin.value=="CITATION") -> això està malament perquè pot ser indiv!?
			//if (document.resource_selector_form.resource_origin.value=="CITATION")
			//	ObreSelectorGeneral(false, type, "CITATION", ""); //element_origin no cal
			//else //PUBLICAT
			//	ObreSelectorGeneral(false, type, "PUBLICAT", ""); //element_origin no cal
			//else //FEEDBACK -> en el moment que obri la porta a triar PARTY des d'algun element fill
			//de FB, problablement ja em caldrà element_origin per distingir per quins dels de dins 
			//de FB estic escollint responsibles (p.ex.user details dins contact; usercontactinfo dins usage; processors dins procesStep a additionallineage o a usage_extès,
		}*/
	}
}

function EntraAAccountCallBack()
{
	document.sign_in.user.value=document.sign_up.user.value;
	document.sign_in.pass.value=document.sign_up.pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadenaJSON(Msg_Today);

	EntraANimmbus(true);
	MostraAccount(true);
}

function SignUpNB(name_fn_callback)
{
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, document.sign_up.user, document.sign_up.pass);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_up.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_up.pass.value)
				, AvaluaResposta, "text/xml", "{nom_funcio: \""+name_fn_callback+"\", params: null}");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function EntraANewAccountCallBack()
{
	//document.getElementById("new-user-page").style.visibility="hidden";
	document.sign_in.user.value=document.new_user_form.new_user.value;
	document.sign_in.pass.value=document.new_user_form.new_pass.value; 
	document.sign_up.user.value="";
	document.sign_up.pass.value=""; 
	document.getElementById("main-left-pannel-date-text").innerHTML=DonaCadenaJSON(Msg_Today);

	EntraANimmbus(true);
	MostraAccount(true);
}

function SendNewUserNB()
{
var s;
	RemoveInfo("long");

	if (PendingToken=="")
		s="";
	else
		s="&TOKEN="+PendingToken;

	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, document.new_user_form.new_user, document.new_user_form.new_pass);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:CREATE&LANGUAGE="+LanguagesNB[ActiveLanguage]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_user_form.new_pass.value)
				+"&EMAIL="+DonaCadenaPerValorDeFormulari(document.new_user_form.email.value)+s, AvaluaResposta, "text/xml", "{nom_funcio: \"EntraANewAccountCallBack\", params: null}");
        ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function TancaFinestraNimmbus()
{
	window.onbeforeunload=null;
	window.close();
}

function EntraANimmbus(es_nou)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("main-page").style.visibility="visible";
	//ChangePannel("main-page", true);
	
	document.getElementById("new-resource").style.display= es_nou ? "none" : "inline";
	document.getElementById("dropdown-settings").style.display= es_nou ? "none" : "inline";
	document.getElementById("main-left-pannel-title-text").innerHTML=document.sign_in.user.value;  //This is going to be replaced by the name and surname latter.
	document.getElementById("main-left-pannel-subtitle-text").innerHTML=document.sign_in.user.value;
}

function EntraANimmbusMain()
{
	EntraANimmbus(false);
	RetrieveUserMinPreferences();
	EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":true});
}

function EntraAResetPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("reset-pass-page").style.visibility="visible";
	ChangePannel("reset-pass-page",true);
}

function EntraANewPassword()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-pass-page").style.visibility="visible";
	ChangePannel("new-pass-page",true);
}

function EntraANewUser(email)
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("new-user-page").style.visibility="visible";
	ChangePannel("new-user-page",true);	
	document.new_user_form.email.value=email;
}

function EntraAExecuteToken()
{
	//document.getElementById("front-page").style.visibility="hidden";
	//document.getElementById("execute-token-page").style.visibility="visible";
	ChangePannel("execute-token-page",true);	
	if (document.getElementById("execute-token-subtitle-text").innerHTML!="")
	        document.title = document.getElementById("execute-token-subtitle-text").innerHTML;
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&USER="+document.sign_in.user.value, AvaluaResposta, "text/xml", 
				"{nom_funcio: \"SurtDeExecuteTokenCallBack\", params: null}");
  ShowInfo("permanent", DonaCadenaJSON(Msg_Requesting));
}

function EntraAIdentificioNimmbus()
{
	ChangePannel("front-page", true);
}

function SurtDeExecuteTokenCallBack()
{
	//document.getElementById("execute-token-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeResetPasswordCallBack()
{
	//document.getElementById("reset-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNewPasswordCallBack()
{
	//document.getElementById("new-pass-page").style.visibility="hidden";
	EntraAIdentificioNimmbus();
}

function SurtDeNimmbus()
{
	SignOutNB();
	//document.getElementById("main-page").style.visibility="hidden";
	//document.getElementById("resources").style.visibility="hidden";
	EntraAIdentificioNimmbus();
	//window.scrollTo(0, 0);
}

function SignOutNB()
{
	ChangePannel("resources", false);
	document.getElementById("new_user_alert").style.display="none";
	document.getElementById("current_pass_alert").style.display="none";
	document.getElementById("new_pass_alert").style.display="none";
	document.getElementById("new_pass_valid_alert").style.display="none";
	AccessToken="";
	AccessTokenType="";
}

/*function SurtDeShare()
{
	ChangePannel("resources", true);
	return false;
}*/

function SurtITornaEndarrera(recarrega_pagina_recursos, surto_de_fb_list)
{
	history.back();
	//ChangePannel("resources", true);
	if (surto_de_fb_list)
		IdTargetResourceToSaveChanges="";
		
	if (recarrega_pagina_recursos)
	//he de recarregar la pagina de recursos perquè potser s'ha afegit un element nou, o s'ha modificat un dels existents
		EnumerateResources(1, {"type_enum":"resources", "make_pannel_visible":false});	

	return false;
}

function SurtDeAccount()
{
	history.back();
	//ChangePannel("resources", true);
}

function SurtDeAccountCallBack()
{
	if (document.account_form.new_pass.value!="")
		document.sign_in.pass.value=document.account_form.new_pass.value;
	if (document.sign_in.user.value!=document.account_form.new_user.value)
		document.sign_in.user.value=document.account_form.new_user.value;
	document.getElementById("main-left-pannel-title-text").innerHTML=document.account_form.name.value;

	ChangeLanguage(ActiveLanguage=document.account_form.language.selectedIndex, ResourcesPerPage);
	ShowInfo("short", DonaCadenaJSON(Msg_Changes_sent));
	
	if (document.getElementById("current_pass_fieldset").style.display=='none') //new user, resources list needs to be blanked
	{
			BuidaLlistatResource("resources");
			document.getElementById("new-resource").style.display="inline";	
			document.getElementById("dropdown-settings").style.display="inline";				
	}
	
	//SignOutNB();
	if (ActionAfterSignIn)
		ActionAfterSignIn(ParamActionAfterSignIn);
	else
	{
		if (document.getElementById("current_pass_fieldset").style.display=='none') //new user, resources list needs to be blanked
			ChangePannel("resources", true);
		else
			history.back();		
	}
}

function SendAccountChanges()
{
	if (NewUserChangeTimeOut)
		clearTimeout(NewUserChangeTimeOut);
	if (document.account_form.current_pass.value!="" && document.account_form.current_pass.value!=document.sign_in.pass.value)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_Current_pwd_not_match_provided));
		return false;
	}
	if (document.account_form.new_pass.value!="" && document.account_form.new_pass.value!=document.account_form.new_pass_valid.value)
	{
		ShowInfo("long", DonaCadenaJSON(Msg_New_pwd_not_match_validation));
		return false;
	}
	RemoveInfo("long");
	ajaxExecuteNB=new Ajax();
	AfegeixCredencialsUsuari(ajaxExecuteNB, null, null);
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:MODIFY&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]
				//+"&USER="+DonaCadenaPerValorDeFormulari(document.sign_in.user.value)+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.sign_in.pass.value)
				+"&NEW_USER="+((document.account_form.new_user.value==document.sign_in.user.value) ? "" : DonaCadenaPerValorDeFormulari(document.account_form.new_user.value))+"&NEW_PASSWORD="+DonaCadenaPerValorDeFormulari(document.account_form.new_pass.value)+
				"&EMAIL="+DonaCadenaPerValorDeFormulari(document.account_form.email.value)+"&NAME="+DonaCadenaPerValorDeFormulari(document.account_form.name.value)+"&BIO="+DonaCadenaPerValorDeFormulari(document.account_form.bio.value), AvaluaResposta, "text/xml", 
				"{nom_funcio: \"SurtDeAccountCallBack\", params: null}");
  ShowInfo("permanent", DonaCadenaJSON(Msg_Message_sent));
	return false;
}

function SendPasswordReset()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:RESETPASSWORD&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&USER="+DonaCadenaPerValorDeFormulari(document.reset_pass_form.user.value), AvaluaResposta, "text/xml", 
				"{nom_funcio: \"SurtDeResetPasswordCallBack\", params: null}");
 	ShowInfo("permanent", DonaCadenaJSON(Msg_Searching_));
	return false;
}

function SendNewPasswordToken()
{
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_TOKEN:EXECUTE&LANGUAGE="+LanguagesNB[ActiveLanguage]+
				"&TOKEN="+PendingToken+"&PASSWORD="+DonaCadenaPerValorDeFormulari(document.new_pass_form.new_pass.value), AvaluaResposta, "text/xml", 
				"{nom_funcio: \"SurtDeNewPasswordCallBack\", params: null}");
  ShowInfo("permanent", DonaCadenaJSON(Msg_Changing_));
	return false;
}

function GetWPSProcessIdentifierName(root)
{
var process, identifier;
	process=GetXMLElementByName(root, "wps", "Process");
	if (process)
	{
		identifier=GetXMLElementByName(process, "ows", "Identifier");
		if (identifier)
			return identifier.childNodes[0].nodeValue;
	}
	return null;
}


var NewUserChangeTimeOut=0;
var NewPassChangeTimeOut=0;

function EscriuStatusAElement(doc, user_pass)
{
var root, output, identifier, process_name;
var elem;

	elem=document.getElementById(user_pass.alert_id);
	root=DonaRootXML(doc, document);
	if (!root || AnalitzaExceptionReport(root, document))
	{
		NewUserChangeTimeOut=0;
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}

	process_name=GetWPSProcessIdentifierName(root);
	output=GetXMLElementCollectionByName(root, "wps", "Output");

	if (process_name && output && output.length)
	{
		for (var item=0; item<output.length; item++)
		{
			identifier=GetXMLElementByName(output.item(item), "ows", "Identifier");
			if (identifier && identifier.childNodes[0].nodeValue=="statusCode")
			{					
				var s=OmpleInputDesDeWPSLiteralOutput(output.item(item));
				if (s!="")
				{
					if (process_name=="NB_USER:AVAILABLE")
					{
						if (s=="available")
							elem.innerHTML=DonaCadenaJSON(Msg_Available_);
						else if (s=="empty")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_cannot_be_blank);
						else if (s=="same")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_is_what_you_have);
						else if (s=="taken")
							elem.innerHTML=DonaCadenaJSON(Msg_Username_already_taken);							
						UpdateLastServer();
					}
					else if (process_name=="NB_USER:GOODPASSWORD")
					{
						if (s=="strong")
							elem.innerHTML=DonaCadenaJSON(Msg_Strong);
						else if (s=="medium")
							elem.innerHTML=DonaCadenaJSON(Msg_Medium);
						else if (s=="weak")
							elem.innerHTML=DonaCadenaJSON(Msg_Weak);
						else if (s=="user")
							elem.innerHTML=DonaCadenaJSON(Msg_Cannot_contain_username);							
						else if (s=="short")
							elem.innerHTML=DonaCadenaJSON(Msg_Too_short);							
						CheckPassValidCorrectness(user_pass.pass_valid_alert_id, user_pass.pass, user_pass.pass_valid);
						UpdateLastServer();
					}
					else
					{
						alert("Known process id: "+ process_name);
						TiraAPantallaRespostaSiNoEntenc(root, document);
						elem.style.display="none";
					}
				}
			}
		}
	}
	else
	{
		TiraAPantallaRespostaSiNoEntenc(root, document);
		elem.style.display="none";
	}
	NewUserChangeTimeOut=0;
	NewPassChangeTimeOut=0;
	return;
}


function CheckNewUserCorrectness(alert_id, new_user, user)
{
	elem=document.getElementById(alert_id);
	elem.style.display="inline";
	elem.innerHTML=DonaCadenaJSON(Msg_Checking);
	var user_pass = {alert_id:alert_id};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:AVAILABLE&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user)+
				"&NEW_USER="+DonaCadenaPerValorDeFormulari(new_user), EscriuStatusAElement, "text/xml", 
				user_pass);
}

function NewUserInputChange()
{
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new_user_alert\", document.account_form.new_user.value, document.sign_in.user.value);",1500);
}

function NewUserUserInputChange()
{
	if (document.new_user_form.new_user.value=="")
	{
		document.getElementById("new-user_new_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"new-user_new_user_alert\", document.new_user_form.new_user.value, \"\");",1500);
}

function SignUpUserInputChange()
{
	if (document.sign_up.user.value=="")
	{
		document.getElementById("sign_up_user_alert").style.display="none";
		return;
	}
	if (NewUserChangeTimeOut==0)
		NewUserChangeTimeOut=setTimeout("CheckNewUserCorrectness(\"sign_up_user_alert\", document.sign_up.user.value, \"\");",1500);
}

function CheckNewPassCorrectness(pass_alert_id, pass_valid_alert_id, user, pass, pass_valid)
{
	elem=document.getElementById(pass_alert_id);
	if (pass=="")
	{
		NewPassChangeTimeOut=0;
		elem.style.display="none";
		return;
	}
	elem.style.display="inline";
	elem.innerHTML=DonaCadenaJSON(Msg_Checking);
	var user_pass = {alert_id:pass_alert_id, pass_valid_alert_id:pass_valid_alert_id, pass:pass, pass_valid:pass_valid};
	ajaxExecuteNB=new Ajax();
	ajaxExecuteNB.doGet(ServersNB[LastServerNB]+"?SERVICE=WPS&REQUEST=EXECUTE&IDENTIFIER=NB_USER:GOODPASSWORD&LANGUAGE="+LanguagesNB[document.account_form.language.selectedIndex]+"&USER="+DonaCadenaPerValorDeFormulari(user) +
				"&PASSWORD="+DonaCadenaPerValorDeFormulari(pass), EscriuStatusAElement, "text/xml", user_pass);
}

function NewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new_pass_alert\", \"new_pass_valid_alert\", (document.account_form.new_user.value==\"\") ? document.sign_in.user.value : document.account_form.new_user.value, document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}

function NewPassNewPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-pass_new_pass_alert\", \"new-pass_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"new-user_new_pass_alert\", \"new-user_new_pass_valid_alert\", \"Cadena$$Improbable\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassInputChange()
{
	if (NewPassChangeTimeOut==0)
		NewPassChangeTimeOut=setTimeout("CheckNewPassCorrectness(\"sign_up_pass_alert\", \"sign_up_pass_valid_alert\", document.sign_up.user.value, document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var PassValidChangeTimeOut=0;

function CheckPassValidCorrectness(alert_id, pass, pass_valid)
{
	if (pass=="" || pass_valid=="") 
	{
		document.getElementById(alert_id).style.display="none";
	}
	else
	{
		document.getElementById(alert_id).style.display="inline";

		if (pass==pass_valid)
			document.getElementById(alert_id).innerHTML=DonaCadenaJSON(Msg_Ok);
		else
			document.getElementById(alert_id).innerHTML=DonaCadenaJSON(Msg_Pwd_verification_error);
	}
	PassValidChangeTimeOut=0;
	return;
}

function PassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new_pass_valid_alert\", document.account_form.new_pass.value, document.account_form.new_pass_valid.value);",1500);
}


function NewPassPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-pass_new_pass_valid_alert\", document.new_pass_form.new_pass.value, document.new_pass_form.new_pass_valid.value);",1500);
}

function NewUserPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"new-user_new_pass_valid_alert\", document.new_user_form.new_pass.value, document.new_user_form.new_pass_valid.value);",1500);
}

function SignUpPassValidInputChange()
{
	if (PassValidChangeTimeOut==0)
		PassValidChangeTimeOut=setTimeout("CheckPassValidCorrectness(\"sign_up_pass_valid_alert\", document.sign_up.pass.value, document.sign_up.pass_valid.value);",1500);
}

var CurrentPassChangeTimeOut=0;

function CheckCurrentPassCorrectness()
{
	if (document.account_form.current_pass.value=="") 
	{
		document.getElementById("new_pass_alert").style.display="none";
	}
	else
	{
		document.getElementById("current_pass_alert").style.display="inline";
	
		if (document.account_form.current_pass.value==document.sign_in.pass.value)
			document.getElementById("current_pass_alert").innerHTML=DonaCadenaJSON(Msg_Ok);
		else
			document.getElementById("current_pass_alert").innerHTML=DonaCadenaJSON(Msg_Wrong_pwd);
	}
	CurrentPassChangeTimeOut=0;
	return;
}

function CurrentPassInputChange()
{
	if (CurrentPassChangeTimeOut==0)
		CurrentPassChangeTimeOut=setTimeout("CheckCurrentPassCorrectness();",1500);
}

function AnalitzaMessage(event)
{
	if (event && DonaHost(event.origin)==DonaHost(PendingPostMessage)) //PendingPostMessage conté la URL
		AnalitzarParametresURL(event.data);		
}

</script>

<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};HandleGoogleApiLibrary()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>

</head>


<body onLoad="InitFrontPage();" onMessage="AnalitzaMessage(event);">

<div class="long-note-outer">
<div id="long-note" class="note-inner"></div>
</div>

<div class="short-note-outer">
<div id="short-note" class="note-inner"></div>
</div>

<!-- *** IDENTIFICATION FRONT PAGE *** -->

<div id="front-page">

<div class="front-bg">
<img src="topoorto.jpg" style="display: block;">
</div>


<div class="front-welcome-text">
<h1 id="front-welcome-text-title" style="line-height: normal; margin: 0px">Benvinguts al NiMMbus.</h1>
<p id="front-welcome-text-subtitle" style="margin: 10px"></p>
<br>
<!--img src="NiMMbus.png" style="display: block;">
<table><tr><td><img src="nextgeoss36.png" style="display: block;"><img src="prj730329.png" style="display: block;"></td><td><img src="OGC_WPS_GUF.png" width="100" style="display: block;"></td></tr></table-->
<table style="width: 100%">
	<tr><td align="center"><img src="NiMMbus.png" style="display: block;"><br><!--img src="nextgeoss36.png" style="display: block;"--></td><td align="center"><img src="OGC_WPS_GUF.png" width="100" style="display: block;"></td></tr>
	<tr><td align="center"><img src="Eiffel_logo_color_v1.png" width="200" style="display: block;"></td><td align="center"><img src="nextgeoss36.png" style="display: block;"></td></tr></table>
<br>
<table style="width: 100%">
	<tr>
	<td style="text-align: left; width: 26%"><p class="front-conditions-text"><a id="welcome-terms_of_use" href="TermsOfUse.htm" style="color: #CCD6DD">Terms_of_use</a></p></td>
	<td style="text-align: center; width: 39%"><p class="front-conditions-text"><a id="welcome-privacy_statement" href="PrivacyStatement.htm" style="color: #CCD6DD">Privacy_Statement</a></p></td>
	<td style="text-align: right; width: 35%""><p class="front-conditions-text" id="welcome-mail-contact">contact</p></td>
	</tr>
	<tr>
	<td style="text-align: left; width: 26%"><p class="front-conditions-text"><a id="welcome-access_policy" href="AccessPolicy.htm" style="color: #CCD6DD">Access_Policy</a></p></td>
	<td style="text-align: center; width: 39%"><p id="welcome-last_updated" class="front-conditions-text"><i>Last_updated_October_2_2018</i></p></td>
	<td style="text-align: right; width: 35%"><p class="front-conditions-text"><a href="mailto:contacte@miramon.uab.cat" style="color: #CCD6DD">contacte@miramon.uab.cat</a></p></td>
	</tr></table>
</div>

<div class="front-language">
<a class="dropdown-language" id="dropdown-language" onClick="SwitchDropDownList('dropdown-language', 'front-language-list');">
<span id="front-language-lang">
Language: English
</span>
<b class="caret"></b>
</a>
</div>

<div id="front-language-list" class="dropdown-list" style="left: 85%; top: 70px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a class="dropdown-list_active" onClick="ChangeLanguage(0, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
Català</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(1, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
Español</a>
<a class="dropdown-list_active" onClick="ChangeLanguage(2, ResourcesPerPage);SwitchDropDownList('dropdown-language', 'front-language-list');">
English</a>
</div>

<div class="white-area" style="left: 50%; top: 275px; width: 306px; height: 80px;">
<form id="sign_in" name="sign_in" class="packet_paragraph" method="get" onSubmit="return SignInNB();">
<h2 id="front-signin-nimmbus-lang" class="white-area-title"></h2>
<p class="packet_paragraph"><input id="sign_in_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" autocomplete="on"></p>
<p class="packet_paragraph"><input id="sign_in_pass" type="password" size="50" maxlength="39" class="text-input" name="pass" value="" style="width: 140px;" placeholder="Password">
<input id="sign_in_btn" class="submit_btn" type="submit" value="Sign in"></p>
<p class="packet_paragraph"><a id="sign_in_forgot" class="text_button" onClick="EntraAResetPassword();">Forgot password?</a></p>
</form>
</div>

<div class="white-area" style="left: 50%; top: 463px; width: 306px; height: 130px;">
<form id="sign_up" name="sign_up" class="packet_paragraph" method="get" onSubmit='return SignUpNB("EntraAAccountCallBack");'>
<h2 id="front-signup-lang" class="white-area-title">New to NiMMbus? Sign up:</h2>
<p id="sign_up_user_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_user" type="text" size="80" maxlength="79" class="text-input" style="width: 296px;" name="user" value="" placeholder="Username" onkeyup="SignUpUserInputChange();" onpaste="SignUpUserInputChange();" oninput="SignUpUserInputChange();"></p>
<p id="sign_up_pass_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass" value="" placeholder="Password" onkeyup="SignUpPassInputChange();" onpaste="SignUpPassInputChange();" oninput="SignUpPassInputChange();"></p>
<p id="sign_up_pass_valid_alert" class="packet_paragraph" style="display: none;"></p>
<p class="packet_paragraph"><input id="sign_up_pass_valid" type="password" size="80" maxlength="39" class="text-input" style="width: 296px;" name="pass_valid" value="" placeholder="Password" onkeyup="SignUpPassValidInputChange();" onpaste="SignUpPassValidInputChange();" oninput="SignUpPassValidInputChange();"></p>
<p class="packet_paragraph"><input id="sign_up_btn" class="submit_btn" type="submit" value="Sign up for NiMMbus"></p>
</form>
</div>

<div class="white-area" style="left: 50%; top: 130px; width: 306px;">
<h2 id="front-signin-external-lang" class="white-area-title"></h2>
<button id="nextgeoss-button" class="submit_btn" disabled onClick="ValidaSSONextGEOSS(true, SignInNBNextGEOSS, null);">NextGEOSS</button>
<button id="landsense-button" class="submit_btn" disabled onClick="ValidaSSOLandSense(true, SignInNBLandSense, null);">LandSense</button>
<br>
<button id="google-button" class="submit_btn" disabled onClick="ValidaSSOGoogle();">Google</button>
<button id="sso-debug-button" class="submit_btn" disabled onClick="ValidaSSODebug();" style="display: none;">Debug</button>
</div>

</div>  <!--End of id="front-page" -->


<!-- *** MAIN PAGE *** -->
<div id="main-page" style="visibility: hidden;">

<div class="front-bg" style="top: 40px;">
<img src="cloudbackgroud.jpg" style="display: block;">
</div>

<!-- *** MAIN PAGE TOP BAR *** -->

<div class="main-page-bar">
<span style="left: 100px; top:0px; position: absolute; font-size: 20px;">
<img src="nimmbus_icon.png" style="vertical-align: bottom;"/> NiMMbus<sup>Beta</sup> &nbsp;&nbsp; <img src="nextgeoss30.png" style="vertical-align: bottom;"/>
</span>

<span style="left: 85%; top:5px; position: absolute;">
<a target="_blank" href="help/help.htm"><img src="help.png" style="vertical-align: bottom;" /></a>
<a id="dropdown-settings" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');" onMouseOver="document.getElementById('settings-tooltip').style.opacity='1';" onMouseOut="document.getElementById('settings-tooltip').style.opacity='0';">
<img src="gear_icon.png" style="vertical-align: bottom;" />
</a>
</span>

<span id="settings-tooltip" class="tooltip" style="left: 87%; top:34px;">
<b class="tooltip-caret"></b><br>
<span id="settings-tooltip-text" class="tooltip-text">Settings</span>
</span>

<div id="settings-list" class="dropdown-list" style="left: 86%; top: 40px; width: 70px; height: 70px;">
<div class="dropdown-caret">
<span class="caret-outer"></span>
<span class="caret-inner"></span>
</div>
<a id="settings-profile" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');MostraAccount(false);">
Profile</a>
<a id="settings-signout" class="dropdown-list_active" onClick="SwitchDropDownList('dropdown-settings', 'settings-list');SurtDeNimmbus();">
Sign out</a>
</div>  <!--End of id="settings-list" -->
</div>  <!--End of class="main-page-bar" -->

<!-- *** MAIN PAGE LEFT PANNEL *** -->

<div id="main-left-pannel" class="white-area" style="left: 3%; top: 45px; width: 18%; height: 200px;">

<h2 id="main-left-pannel-title-text" class="white-area-title">User</h2>
<p id="main-left-pannel-subtitle-text" class="packet_paragraph">
<p class="packet_paragraph"><span id="main-left-pannel-since-text"></span>: <span id="main-left-pannel-date-text"></span></p>

<div id="new-resource">
<form id="main-left-pannel_form" name="main_left_pannel_form" method="get" onSubmit="return false">

<br><span id="main-left-pannel-create-resources-text"></span>:<br>
<input id="new-resource-href" class="add_resource_btn" type="image" alt="new href" src="link_add20.png" onClick="MostraHRefResource('')"/>
<input id="new-resource-poi" class="add_resource_btn" type="image" alt="new href" src="point_add20.png" onClick="MostraPoiResource('')"/>
<input id="new-resource-citation" class="add_resource_btn" type="image" alt="new href" src="citation_add20.png" onClick="MostraCitationResource('')"/>
<input id="new-resource-publication" class="add_resource_btn" type="image" alt="new href" src="publication_add20.png" onClick="MostraPublicationResource('')"/>
<input id="new-resource-individual" class="add_resource_btn" type="image" alt="new href" src="indv_add20.png" onClick="MostraIndividualResource('')"/>
<input id="new-resource-organism" class="add_resource_btn" type="image" alt="new href" src="org_add20.png" onClick="MostraOrganismResource('')"/>
</form>
</div>  <!--End of id="new-resource" -->

<br>
<!--div id="conditions-left-pannel" style="display: inline;"-->
<table class="front-conditions-text-left-pannel" style="width: 100%;"><tr><td style="text-align: left; width: 50%"><a id="left-pannel-terms_of_use" target="_blank" href="TermsOfUse.htm" style="color: #CCCCCC">Terms_of_use</a>
	<br><a id="left-pannel-privacy_statement" target="_blank" href="PrivacyStatement.htm" style="color: #CCCCCC">Privacy_Statement</a></td>
	<td style="text-align: right"><a id="left-pannel-last_updated"><i>Last_updated<br>October_2_2018</i></a></td></tr></table>
<!--/div-->
</div>  <!--End of id="main-left-pannel" -->

<!-- *** RESOURCES RIGHT PANNEL *** -->

<div id="resources" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto;">
<h2 id="resources-title-text" class="white-area-title">Resources</h2>
<form id="resources_form" name="resources_form" method="get" onSubmit="return false">

<table style="width: 100%;"><tr><td id="resources-subtitle-text">List of resources.</td>
<td align="left">
	<label class="control-label" id="resource-type_screen" for="resource-type_screen_value"></label>
	<select class="text-input" id="resource-type_screen_value" name="resource-type" onchange="EnumerateResources(1, {'type_enum':'resources', 'make_pannel_visible':true})">
	<option value="ALL" id="all-resource-type-value"></option>
	<option value="FEEDBACK" id="feedback-resource-type-value"></option>
	<option value="CITATION" id="citation-resource-type-value"></option>
	<option value="PUBLICAT" id="publicat-resource-type-value"></option>
	<option value="INDIVIDU" id="individual-resource-type-value"></option>
	<option value="ORGANISM" id="organism-resource-type-value"></option>
	<option value="HREF" id="href-resource-type-value"></option>
	<option value="POI" id="poi-resource-type-value"></option>
	</select>
</td>
<td align="left">
	<label class="control-label" id="owner-type_screen" for="owner-type_screen_value"></label>
	<select class="text-input" id="owner-type_screen_value" name="owner-type" onchange="EnumerateResources(1, {'type_enum':'resources', 'make_pannel_visible':true})">
	<option value="ALL" id="all-owner-type-value"></option>
	<option value="ME" id="me-owner-type-value"></option>
	<option value="OTHERS" id="others-owner-type-value"></option>
	<option value="OPEN" id="open-owner-type-value"></option>
	</select>
</td>
<td align="right"><span id="resources-hits-text">1-100 of 123</span> 
<span style="white-space: nowrap;">
<input id="newer-resources_btn" class="submit_btn" type="button" value="<" onMouseOver="document.getElementById('newer-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('newer-resources-tooltip').style.opacity='0';">
<input id="older-resources_btn" class="submit_btn" type="button" value=">" onMouseOver="document.getElementById('older-resources-tooltip').style.opacity='1';" onMouseOut="document.getElementById('older-resources-tooltip').style.opacity='0';">
</span>
<span id="newer-resources-tooltip" class="tooltip" style="right: 40px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="newer-resources-tooltip-text" class="tooltip-text">Newer</span>
</span>

<span id="older-resources-tooltip" class="tooltip" style="right: 0px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="older-resources-tooltip-text" class="tooltip-text">Older</span>
</span>

</td></tr></table>
</form>

<div id="resources-list" style="border-top: 1px solid #e1e8ed;"></div>
</div>  <!--End of id="resources" -->

<!-- *** RESOURCE SELECTOR *** -->

<div id="resource-selector" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="resource-selector-title-text" class="white-area-title">Resources selector</h2>
<form id="resource_selector_form" name="resource_selector_form" method="get" onSubmit="return false">

<table style="width: 100%;"><tr><td id="resource-selector-subtitle-text">List of resources to be selected</td>
<input type="text" class="text-input" name="resource_type" maxlength="10" style="display: none;"/>
<input type="text" class="text-input" name="resource_origin" maxlength="10" style="display: none;"/>
<input type="text" class="text-input" name="element_origin" maxlength="10" style="display: none;"/>
<td align="left">
	<label class="control-label" id="selector-owner-type_screen" for="owner-type_screen_value"></label>
	<select class="text-input" id="selector-owner-type_screen_value" name="owner-type" onchange="EnumeraResourcesQueTocaASelector()">
	<option value="ALL" id="all-selector-owner-type-value"></option>
	<option value="ME" id="me-selector-owner-type-value"></option>
	<option value="OTHERS" id="others-selector-owner-type-value"></option>
	<option value="OPEN" id="open-selector-owner-type-value"></option>
	</select>
</td-->	
<td align="right"><span id="resource-selector-hits-text">1-10 of 12</span> 

<input id="newer-resource-selector_btn" class="submit_btn" type="button" value="<" onMouseOver="document.getElementById('newer-resource-selector-tooltip').style.opacity='1';" onMouseOut="document.getElementById('newer-resource-selector-tooltip').style.opacity='0';">
<input id="older-resource-selector_btn" class="submit_btn" type="button" value=">" onMouseOver="document.getElementById('older-resource-selector-tooltip').style.opacity='1';" onMouseOut="document.getElementById('older-resource-selector-tooltip').style.opacity='0';">

<span id="newer-resource-selector-tooltip" class="tooltip" style="right: 40px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="newer-resource-selector-tooltip-text" class="tooltip-text">Newer</span>
</span>

<span id="older-resource-selector-tooltip" class="tooltip" style="right: 0px; top:86px;">
<b class="tooltip-caret"></b><br>
<span id="older-resource-selector-tooltip-text" class="tooltip-text">Older</span>
</span>

</td></tr></table>
</form>

<div id="resource-selector-list" style="border-top: 1px solid #e1e8ed;"></div>
</div>  <!--End of id="resource-selector" -->


<!-- *** HREF DLG *** -->

<div id="href-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="href-resource-title-text" class="white-area-title">Resource</h2>
<p id="href-resource-subtitle-text">Change your basic resource and language settings.</p>

<form id="href-resource_form" name="href_resource_form" method="get" autocomplete="off" onSubmit="return SendHRefResourceChanges();">

<div id="title-href-resource_fieldset" class="control-group">
<label class="control-label" id="title-href-resource_screen" for="title-href-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-href-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-href-resource_fieldset" -->

<div id="href-href-resource_fieldset" class="control-group">
<label class="control-label" id="href-href-resource_screen" for="href-href-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="href-href-resource_screen_value" name="href" maxlength="1999" style="width: 80%;"/></p>
<p id="href-href-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="href-href-resource_fieldset" -->

<div id="mimetype-href-resource_fieldset" class="control-group">
<label class="control-label" id="mimetype-href-resource_screen" for="mimetype-href-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="mimetype-href-resource_screen_value" name="mimetype">
<option value="application/x-mmzx">MMZX</option>
<option value="application/x-mmz" selected="selected">MMZ</option>
<option value="application/x-zip-compressed">ZIP</option>
<option value="image/jpeg">JPEG</option>
<option value="image/png">PNG</option>
<option value="" id="other-mimetype-href-resource_value"></option>
</select>
<p id="mimetype-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="mimetype-href-resource_fieldset" -->

<div id="reason-href-resource_fieldset" class="control-group">
<label class="control-label" id="reason-href-resource_screen" for="reason-href-resource_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="reason-href-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-href-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="reason-href-resource_fieldset" -->

<div class="form-actions">
<input id="href-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="href-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'HREF', true);" />
<input id="href-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(true);" />
<input id="href-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="href-resource" -->


<!-- *** POI DLG *** -->

<div id="poi-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="poi-resource-title-text" class="white-area-title"></h2>
<p id="poi-resource-subtitle-text"></p>

<form id="poi-resource_form" name="poi_resource_form" method="get" autocomplete="off" onSubmit="return SendPoiResourceChanges();">

<div id="title-poi-resource_fieldset" class="control-group">
<label class="control-label" id="title-poi-resource_screen" for="title-poi-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-poi-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-poi-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-poi-resource_fieldset" -->

<div id="long-poi-resource_fieldset" class="control-group">
<label class="control-label" id="long-poi-resource_screen" for="long-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="long-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="long-poi-resource_screen_value" name="long" maxlength="20" style="width: 40%;"/> <input id="poi-gps-resource_btn" class="submit_btn" type="button" value="GPS" onClick="GetPoiFromDevice();" /></p>
<p id="long-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="long-poi-resource_fieldset" -->

<div id="lat-poi-resource_fieldset" class="control-group">
<label class="control-label" id="lat-poi-resource_screen" for="lat-poi-resource_screen_value"></label>
<div class="controls">
<!--p id="lat-poi-resource_alert" style="display: none;"></p-->
<p><input type="text" class="text-input" value="" id="lat-poi-resource_screen_value" name="lat" maxlength="20" style="width: 40%;"/></p>
<p id="lat-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="lat-poi-resource_fieldset" -->

<div id="pos-accur-poi-resource_fieldset" class="control-group">
<label class="control-label" id="pos-accur-poi-resource_screen" for="pos-accur-poi-resource_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="pos_accur-poi-resource_screen_value" name="pos_accur" maxlength="10" style="width: 40%;"/></p>
<p id="pos-accur-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="pos_accur-poi-resource_fieldset" -->

<div id="elevation-poi-resource_fieldset" class="control-group">
<label class="control-label" id="elevation-poi-resource_screen" for="elevation-poi-resource_screen_value"></label>
<div class="controls">
<p id="elevation-poi-resource_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="elevation-poi-resource_screen_value" name="elevation" maxlength="20" style="width: 40%;"/></p>
<p id="elevation-poi-resource_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="elevation-poi-resource_fieldset" -->

<div id="reason-poi-resource_fieldset" class="control-group">
<label class="control-label" id="reason-poi-resource_screen" for="reason-poi-resource_screen_value"></label>
<div class="controls">
<p id="reason-poi-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="reason-poi-resource_screen_value" name="reason" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="reason-poi-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="reason-poi-resource_fieldset" -->

<div class="form-actions">
<input id="poi-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="poi-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'POI', true);" />
<input id="poi-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(true);" />
<input id="poi-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(false);" />
</div>

</form>

</div>  <!--End of id="poi-resource" -->

<!-- *** FEEDBACK RESOURCE DLG *** -->

<div id="feedback-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-resource-title-text" class="white-area-title"></h2>
<p id="feedback-resource-subtitle-text"></p>

<form id="feedback-resource_form" name="feedback_resource_form" method="get" autocomplete="off" onSubmit="return SendFeedbackResourceChanges();">

<fieldset class="control-fielset-group">
<legend id="target-feedback-resource"></legend>
	<p id="target_feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
	<input id="target_feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
		onClick="ObreSelectorGeneral(true, '', 'FEEDBACK', '');"/> <!-- en aquest context no cal ni resource_type ni element_origin) -->
	<p id="target_feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
</fieldset> <!--End of id="target-feedback-resource" -->

<br>
<div id="abstract-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="abstract-feedback-resource_screen" for="abstract-feedback-resource_screen_value"></label>
<div class="controls">
<p id="abstract-feedback-resource_alert" style="display: none;"></p>
<textarea class="text-input" id="abstract-feedback-resource_screen_value" name="abstract" maxlength="254" style="width: 80%; height: 60px;"></textarea>
<p id="abstract-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="abstract-feedback-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="reason-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'>PROVES</legend>
<div style="display: none;"> <!-- for collapsible -->
	<!-- div id="title-feedback-resource_fieldset">
	<label class="control-label" id="title-feedback-resource_screen" for="title-feedback-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="title-feedback-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
	<p id="title-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!- - End of id="title-feedback-resource_fieldset" -->
	<div id="reason-feedback-resource_fieldset" class="control-group">
	<label class="control-label" id="reason-feedback-resource_screen" for="reason-feedback-resource_screen_value"></label>
	<div class="controls">
	<p id="reason-feedback-resource_alert" style="display: none;"></p>
	<textarea class="text-input" id="reason-feedback-resource_screen_value" name="reason" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
	<p id="reason-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="reason-feedback-resource_fieldset" -->
</div> <!-- End of this collapsible -->
</fieldset> <!--End of id="reason-feedback-resource" -->
<br>

<div id="contactRole-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="contactRole-feedback-resource_screen" for="contactRole-feedback-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="contactRole-feedback-resource_screen_value" name="contactRole">
<option value="commercialDataProducer" id="commercialDataProd-contactRole-feedback-resource_value"></option>
<option value="commercialAddedValue" id="commercialAddedValue-contactRole-feedback-resource_value"></option>
<option value="researchDataProducer" id="researchDataProd-contactRole-feedback-resource_value"></option>
<option value="researchEndUser" id="researchEndUser-contactRole-feedback-resource_value"></option>
<option value="decisionMaker" id="decisionMaker-contactRole-feedback-resource_value"></option>
<option value="generalPublic" id="generalPublic-contactRole-feedback-resource_value" selected="selected"></option>
</select>
<p id="contactRole-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="contactRole-feedback-resource_fieldset" -->

<br>
<div id="rating-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="rating-feedback-resource_screen" for="rating-feedback-resource_screen_value"></label>
<div class="controls">
<!--select class="text-input" id="rating-feedback-resource_screen_value" name="rating">
<option value="" id="undefined-rating-feedback-resource_value" selected="selected"></option>
<option value="1" id="oneStar-rating-feedback-resource_value"></option>
<option value="2" id="twoStars-rating-feedback-resource_value"></option>
<option value="3" id="threeStars-rating-feedback-resource_value"></option>
<option value="4" id="fourStars-rating-feedback-resource_value"></option>
<option value="5" id="fiveStars-rating-feedback-resource_value"></option>
</select-->
      <span class="starRating">
        <input id="rating-feedback-resource_value5" type="radio" name="rating" value="5">
        <label for="rating-feedback-resource_value5">5</label>
        <input id="rating-feedback-resource_value4" type="radio" name="rating" value="4">
        <label for="rating-feedback-resource_value4">4</label>
        <input id="rating-feedback-resource_value3" type="radio" name="rating" value="3">
        <label for="rating-feedback-resource_value3">3</label>
        <input id="rating-feedback-resource_value2" type="radio" name="rating" value="2">
        <label for="rating-feedback-resource_value2">2</label>
        <input id="rating-feedback-resource_value1" type="radio" name="rating" value="1" checked>
        <label for="rating-feedback-resource_value1">1</label>
        <!--input id="rating-feedback-resource_value0" type="radio" name="rating" value="0" checked>
        <label for="rating-feedback-resource_value0">0</label> <!-- indefinit -->
      </span>
<p id="rating-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="rating-feedback-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="user-comment-feedback-resource" class="collapsible" onClick='CollapseFieldset(this);'></legend>
<div> <!-- for collapsible -->
	<div id="comment-feedback-resource_fieldset" class="control-group">
	<label class="control-label" id="comment-feedback-resource_screen" for="comment-feedback-resource_screen_value"></label>
	<div class="controls">
	<p id="comment-feedback-resource_alert" style="display: none;"></p>
	<textarea class="text-input" id="comment-feedback-resource_screen_value" name="comment" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
	<p id="comment-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="comment-feedback-resource_fieldset" -->
	
	<div id="comment-motiv-feedback-resource_fieldset" class="control-group">
	<label class="control-label" id="comment-motiv-feedback-resource_screen" for="comment-motiv-feedback-resource_screen_value"></label>
	<div class="controls">
	<select class="text-input" id="comment-motiv-feedback-resource_screen_value" name="motivation">
	<option value="undefined" id="undefined-motivation-feedback-resource_value" selected="selected"></option>
	<option value="comment" id="comment-motivation-feedback-resource_value"></option>
	<option value="question" id="question-motivation-feedback-resource_value"></option>
	<option value="answer" id="answer-motivation-feedback-resource_value"></option>
	<option value="acceptedAnswer" id="acceptedAnswer-motivation-feedback-resource_value"></option>
	<option value="response" id="response-motivation-feedback-resource_value"></option>		
	<option value="justification" id="justification-motivation-feedback-resource_value"></option>
	<option value="resolution" id="resolution-motivation-feedback-resource_value"></option>
	<option value="moderation" id="moderation-motivation-feedback-resource_value"></option>
	</select>	
	<p id="comment-motiv-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="comment-motiv-feedback-resource_fieldset" -->
</div> <!-- End of this collapsible -->	
</fieldset> <!-- End of id="user-comment-feedback-resource" -->

<fieldset class="control-fielset-group">
<legend id="usage-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
<div style="display: none;">
	<div id="reportAspect-feedback-resource_fieldset" class="control-group">
	<label class="control-label" id="reportAspect-feedback-resource_screen" for="reportAspect-feedback-resource_screen_value"></label>
	<div class="controls">
  	<input type="checkbox" id="reportAspect-feedback-usage" value="usage"><label id="reportAspect-feedback-usage-label" class="compact_descrip_in_FB"></label>
  	<input type="checkbox" id="reportAspect-feedback-fitness-for-purpose" value="fitnessForPurpose"><label id="reportAspect-feedback-fitness-for-purpose-label" class="compact_descrip_in_FB"></label>
  	<input type="checkbox" id="reportAspect-feedback-limitation" value="limitation"><label id="reportAspect-feedback-limitation-label" class="compact_descrip_in_FB"></label>
  	<input type="checkbox" id="reportAspect-feedback-alternative" value="alternative"><label id="reportAspect-feedback-alternative-label" class="compact_descrip_in_FB"></label>
  	<input type="checkbox" id="reportAspect-feedback-problem" value="problem"><label id="reportAspect-feedback-problem-label" class="compact_descrip_in_FB"></label>
  	<input id="reportAspect-feedback-info_btn" class="add_resource_btn" type="image" src="info20.png" onClick="ShowInfo('reportAspect', DonaCadenaJSON(Msg_report_aspect_info));return false;"/>
	<p id="reportAspect-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	<div id="reportAspect-note" class="note-inner"></div>
	</div>  <!--End of id="reportAspect-feedback-resource_fieldset" -->
	
	<fieldset id="f-usage-description-feedback-resource" class="control-fielset-group-level-2">
		<legend id="usage-description-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
		<div style="display: none;"> <!-- usageDesc -->
		
		<div id="specific-usage-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="specific-usage-feedback-resource_screen" for="specific-usage-feedback-resource_screen_value"></label>
			<div class="controls">
			<p id="specific-usage-feedback-resource_alert" style="display: none;"></p>
			<textarea class="text-input" id="specific-usage-feedback-resource_screen_value" name="specific_usage" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
			<p id="specific-usage-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="specific-usage-feedback-resource_fieldset" -->
		
		<div id="usage-date-time-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="usage-date-time-feedback-resource_screen" for="usage-date-time-feedback-resource_screen_value"></label>
			<div class="controls">
			<input type="date" class="text-input" id="usage-date-feedback-resource_screen_value" name="usage_date" style="width:40%;"/>
			<input type="time" class="text-input" id="usage-time-feedback-resource_screen_value" name="usage_time" style="width:40%;"/>
			<p id="usage-date-time-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="usage-date-time-feedback-resource_fieldset" -->
		
		<div id="user-determined-limitations-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="user-determined-limitations-feedback-resource_screen" for="user-determined-limitations-feedback-resource_screen_value"></label>
			<div class="controls">
			<p id="user-determined-limitations-feedback-resource_alert" style="display: none;"></p>
			<textarea class="text-input" id="user-determined-limitations-feedback-resource_screen_value" name="user_determined_limitations" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
			<p id="user-determined-limitations-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="user-determined-limitations-feedback-resource_fieldset" -->
		
		<!-- aqui falta el user-contanc-info: RESPONSIBILITY -->
		
		<div id="response-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="response-feedback-resource_screen" for="response-feedback-resource_screen_value"></label>
			<div class="controls">
			<p id="response-feedback-resource_alert" style="display: none;"></p>
			<textarea class="text-input" id="response-feedback-resource_screen_value" name="response" maxlength="999" style="width: 100%; height: 60px;"></textarea>
			<p id="response-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="response-limitations-feedback-resource_fieldset" -->

		<fieldset id="f-add-doc-feedback-resource" class="control-fielset-group-level-2">			
			<legend id="add-doc-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
			<div style="display: none;"> <!-- for collapsible -->
			<p id="add-doc-feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
			<input id="add-doc-feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
				onClick="ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'ADD_DOC');"/> 
			<p id="add-doc-feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
			</div> <!-- for collapsible -->
		</fieldset> <!--End of id="add-doc-feedback-resource" -->		
		
		<!-- identified-issues -> no ho posem a propòsit perquè a dins GUF ha de ser discovered issues! -->
				
		<fieldset id="f-reprodUsage-feedback-resource" class="control-fielset-group-level-2">
			<legend id="reprodUsage-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>	
			<div style="display: none;"> <!-- for reprodUsage collapsible -->

				<div id="reprodUsage-code-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-code-resource_screen" for="reprodUsage-code-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-code-resource_alert" style="display: none;"></p>
						<textarea class="text-input" id="reprodUsage-code-resource_screen_value" name="code" maxlength="1999" style="width: 100%; height: 100px;"></textarea>
						<p id="reprodUsage-code-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-code-resource_fieldset" -->

				<div id="reprodUsage-codeLink-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-codeLink-resource_screen" for="reprodUsage-codeLink-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-codeLink-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-codeLink-resource_screen_value" name="codeLink" style="width: 100%;" maxlength="149"/>
						<p id="reprodUsage-codeLink-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>					
				</div>  <!--End of id="reprodUsage-code-resource_fieldset" -->

				<p id="reprodUsage-code-codeLink-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
				<hl>

				<div id="reprodUsage-mimetype-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-mimetype-resource_screen" for="reprodUsage-mimetype-resource_screen_value"></label>
					<div class="controls">
					<select class="text-input" id="reprodUsage-mimetype-resource_screen_value" name="codeMediaType">
						<option value="application/json">JSON</option>
						<option value="text/x-python">Phyton</option>
						<option value="text/x-r-source">R</option>
						<option value="application/x-bat" id="bat-reprodUsage-mimetype-resource_value">bat</option>
						<option value="application/x-sh" id="sh-reprodUsage-mimetype-resource_value">Linux command line</option>	
						<option value="application/wpsex+xml" id="wps-reprodUsage-mimetype-resource_value">WPS execute document</option>							
						<option value="application/KVP" id="kvp-reprodUsage-mimetype-resource_value">Key-value pair (KVP)</option>							
						<option value="application/vnd.docker" id="dock-reprodUsage-mimetype-resource_value">docker</option>
						<option value="" id="other-reprodUsage-mimetype-resource_value" selected="selected">other</option>
					</select>
					<p id="reprodUsage-mimetype-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-mimetype-resource_fieldset" -->

				<div id="reprodUsage-platform-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-platform-resource_screen" for="reprodUsage-platform-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-platform-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-platform-resource_screen_value" name="platform" style="width: 100%;" maxlength="254"/>
						<p id="reprodUsage-platform-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-platform-resource_fieldset" -->

				<div id="reprodUsage-version-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-version-resource_screen" for="reprodUsage-version-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-version-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-version-resource_screen_value" name="version" style="width: 100px;" maxlength="9"/>
						<p id="reprodUsage-version-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-version-resource_fieldset" -->

				<div id="reprodUsage-schema-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-schema-resource_screen" for="reprodUsage-schema-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-schema-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-schema-resource_screen_value" name="schema" style="width: 100%;" maxlength="79"/>
						<p id="reprodUsage-schema-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-schema-resource_fieldset" -->
		
				<div id="reprodUsage-suggApp-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-suggApp-resource_screen" for="reprodUsage-suggApp-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-suggApp-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-suggApp-resource_screen_value" name="sugg_app" style="width: 100%;" maxlength="254"/>
						<p id="reprodUsage-suggApp-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-suggApp-resource_fieldset" -->

				<div id="reprodUsage-diagram-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-diagram-resource_screen" for="reprodUsage-diagram-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-diagram-resource_alert" style="display: none;"></p>
						<textarea class="text-input" id="reprodUsage-diagram-resource_screen_value" name="diagram" maxlength="999" style="width: 100%; height: 60px;"></textarea>
						<p id="reprodUsage-diagram-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-diagram-resource_fieldset" -->

				<div id="reprodUsage-diagramLink-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-diagramLink-resource_screen" for="reprodUsage-diagramLink-resource_screen_value"></label>
					<div class="controls">
						<p id="reprodUsage-diagramLink-resource_alert" style="display: none;"></p>
						<input type="text" class="text-input" value="" id="reprodUsage-diagramLink-resource_screen_value" name="diagramLink" style="width: 100%;" maxlength="149"/>
						<p id="reprodUsage-diagramLink-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-diagramLink-resource_fieldset" -->
				
				<p id="reprodUsage-diagram-diagramLink-resource_screen_descrip" class="white-area-screen-descrip-text"></p>

				<div id="reprodUsage-diagram-mimetype-resource_fieldset" class="control-group">
				<label class="control-label" id="reprodUsage-diagram-mimetype-resource_screen" for="reprodUsage-diagram-mimetype-resource_screen_value"></label>
					<div class="controls">
					<select class="text-input" id="reprodUsage-diagram-mimetype-resource_screen_value" name="diagramMediaType">
						<option value="image/jpeg">JPEG</option>
						<option value="image/png">PNG</option>
						<option value="text/x-python">Phyton</option>
						<option value="text/x-yuml">YUML</option>
						<option value="application/xmi+xml">XMI</option>
						<option value="" id="other-reprodUsage-diagram-mimetype-resource_value" selected="selected"></option>
					</select>
					<p id="reprodUsage-diagram-mimetype-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
					</div>
				</div>  <!--End of id="reprodUsage-diagram-mimetype-resource_fieldset" -->

			</div> <!-- End of reprodUsage collapsible -->	
		</fieldset> <!-- End of id="reprodUsage-feedback-resource" -->

 	</div> <!-- End of usageDesc collapsible -->
	</fieldset> <!-- End of id="usage-description-feedback-resource" -->
	
	<fieldset id="f-discovered-issue-feedback-resource" class="control-fielset-group-level-2">
		<legend id="discovered-issue-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>	
		<div style="display: none;"> <!-- for discvIssue collapsible -->
			
		<!-- aqui falta el target, que en aquest cas és el mateix de fb item i no el posem -->		
		<div id="known-problem-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="known-problem-feedback-resource_screen" for="known-problem-feedback-resource_screen_value"></label>
			<div class="controls">
			<p id="known-problem-feedback-resource_alert" style="display: none;"></p>
			<textarea class="text-input" id="known-problem-feedback-resource_screen_value" name="known_problem" maxlength="1999" style="width: 100%; height: 60px;"></textarea>
			<p id="known-problem-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="known-problem-feedback-resource_fieldset" -->
		
		<div id="problem-date-time-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="problem-date-time-feedback-resource_screen" for="problem-date-time-feedback-resource_screen_value"></label>
			<div class="controls">
			<input type="date" class="text-input" id="problem-date-feedback-resource_screen_value" name="problem_date" style="width:40%;"/>
			<input type="time" class="text-input" id="proble-time-feedback-resource_screen_value" name="problem_time" style="width:40%;"/>
			<p id="problem-date-time-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="problem-date-time-feedback-resource_fieldset" -->
		
		<div id="work-around-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="work-around-feedback-resource_screen" for="work-around-feedback-resource_screen_value"></label>
			<div class="controls">
			<p id="work-around-feedback-resource_alert" style="display: none;"></p>
			<textarea class="text-input" id="work-around-feedback-resource_screen_value" name="work_around" maxlength="999" style="width: 100%; height: 60px;"></textarea>
			<p id="work-around-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="work-around-feedback-resource_fieldset" -->
		
		<fieldset id="f-ref-doc-feedback-resource" class="control-fielset-group-level-2">
			<legend id="ref-doc-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
			<div style="display: none;"> <!-- for collapsible -->
			<p id="ref-doc-feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
			<input id="ref-doc-feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
				onClick="ObreSelectorGeneral(true, 'PUBLICAT', 'FEEDBACK', 'REF_DOC');"/> 
			<p id="ref-doc-feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
			</div> <!-- End of this collapsible -->
		</fieldset> <!--End of id="ref-doc-feedback-resource" -->

		<br>
		<div id="expected-fix-date-feedback-resource_fieldset" class="control-group">
			<label class="control-label" id="expected-fix-date-feedback-resource_screen" for="expected-fix-date-feedback-resource_screen_value"></label>
			<div class="controls">
			<input type="date" class="text-input" id="expected-fix-date-feedback-resource_screen_value" name="expected_fix_date" style="width:40%;"/>
			<p id="expected-fix-date-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
			</div>
		</div>  <!--End of id="expected-fix-date-feedback-resource_fieldset" -->
		
		<fieldset id="f-fix-rsrc-feedback-resource" class="control-fielset-group-level-2">
			<legend id="fix-rsrc-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
			<div style="display: none;"> <!-- for collapsible -->
			<p id="fix-rsrc-feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
			<input id="fix-rsrc-feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
				onClick="ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'FIX_RSRC');"/> 
			<p id="fix-rsrc-feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
			</div> <!-- End of this collapsible -->	
		</fieldset> <!--End of id="fix-rsrc-feedback-resource" -->
	
		<br>
		<fieldset id="f-alt-rsrc-feedback-resource" class="control-fielset-group-level-2">
			<legend id="alt-rsrc-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this)';></legend>
			<div style="display: none;"> <!-- for collapsible -->
			<p id="alt-rsrc-feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
			<input id="alt-rsrc-feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
				onClick="ObreSelectorGeneral(true, 'CITATION', 'FEEDBACK', 'ALT_RSRC');"/> 
			<p id="alt-rsrc-feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
			</div> <!-- End of this collapsible -->	
		</fieldset> <!--End of id="alt-rsrc-feedback-resource" -->
	
	</div> <!-- End of discvIssue collapsible -->	
	</fieldset> <!-- End of id="discovered-issue-feedback-resource" -->
</div> <!-- End of usage collapsible -->	
</fieldset> <!-- End of id="usage-feedback-resource" -->

<fieldset id="f-public-feedback-resource" class="control-fielset-group">
<legend id="public-feedback-resource" class="collapsible collapsed" onClick='CollapseFieldset(this);'></legend>
	<div style="display: none;"> <!-- for collapsible -->
	<p id="public_feedback-resource_compact_list" class="compact_descrip_in_FB"></p>
	<input id="public_feedback-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
		onClick="ObreSelectorGeneral(true, 'PUBLICAT', 'FEEDBACK', 'PUBLICAT');"/>
	<p id="public_feedback-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
	</div>
</fieldset> <!--End of id="public-feedback-resource" -->

<br>

<div id="open-data-feedback-resource_fieldset" class="control-group">
<label class="control-label" id="open-data-feedback-resource_screen" for="open-data-feedback-resource_screen_value"></label>
<div class="controls">
<p id="open-data-feedback-resource_alert" style="display: none;"></p>
<input type="checkbox" id="open-data-feedback-resource_screen_value" name="open_data" checked="checked" onclick="MostraOAmagaExclamacioDeShareAElementsDeFeedback()"/>
<p id="open-data-feedback-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="open-data-feedback-resource_fieldset" -->

<div class="form-actions">
<input id="feedback-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="feedback-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'FEEDBACK', true);" />
<input id="feedback-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChangesIRecarregaResources(true);" />
<input id="feedback-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeFeedbackResourceChangesIRecarregaResources(false);" />
</div>

</form>

</div>  <!--End of id="feedback-resource" -->

<!-- *** CITATION RESOURCE DLG *** -->
<div id="citation-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="citation-resource-title-text" class="white-area-title"></h2>
<p id="citation-resource-subtitle-text"></p>

<form id="citation-resource_form" name="citation_resource_form" method="get" autocomplete="off" onSubmit="return SendCitationResourceChanges();">

<div id="title-citation-resource_fieldset" class="control-group">
<label class="control-label" id="title-citation-resource_screen" for="title-citation-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-citation-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-citation-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="edition-citation-resource"></legend>
	
	<div id="edition-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-citation-resource_screen" for="edition-citation-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="edition-citation-resource_screen_value" name="edition" style="width:100%;" maxlength="29"/>
	<p id="edition-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-citation-resource_fieldset" -->
	
	<div id="edition-date-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-date-citation-resource_screen" for="edition-date-citation-resource_screen_value"></label>
	<div class="controls">
	<input type="date" class="text-input" id="edition-date-citation-resource_screen_value" name="edition_date" style="width:100%;" maxlength="29"/>
	<p id="edition-date-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-date-citation-resource_fieldset" -->
</fieldset> <!--End of id="edition-citation-resource" -->	

<fieldset class="control-fielset-group">
<legend id="identifier-citation-resource"></legend>

	<div id="id-code-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="id-code-citation-resource_screen" for="id-code-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="id-code-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-citation-resource_screen_value" name="id_code" maxlength="254" style="width: 100%;"/>
	<p id="id-code-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-code-citation-resource_fieldset" -->
	
	<div id="id-namespace-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="id-namespace-citation-resource_screen" for="id-namespace-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="id-namespace-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-citation-resource_screen_value" name="id_namespace" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-namespace-citation-resource_fieldset" -->
</fieldset> <!--End of id="identifier-citation-resource" -->	

<fieldset class="control-fielset-group">
<legend id="responsible-citation-resource"></legend>
	<p id="responsible-citation-resource_compact_list" class="compact_descrip_in_FB"></p>
	<input id="responsible-citation-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
		onClick="ObreSelectorGeneral(true, 'PARTY', 'CITATION', '');"/>
	<p id="responsible-citation-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
</fieldset> <!--End of id="responsible-citation-resource" -->

<fieldset class="control-fielset-group">
<legend id="series-citation-resource"></legend>

	<div id="series-name-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-name-citation-resource_screen" for="series-name-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-name-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-name-citation-resource_screen_value" name="series_name" maxlength="254" style="width: 100%;"/>
	<p id="series-name-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	
	</div>  <!--End of id="series-name-citation-resource_fieldset" -->
	<div id="series-issue-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-issue-citation-resource_screen" for="series-issue-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-issue-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-issue-citation-resource_screen_value" name="series_issue" maxlength="39" style="width: 100%;"/>
	<p id="series-issue-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	
	</div>  <!--End of id="series-issue-citation-resource_fieldset" -->
	<div id="series-page-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="series-page-citation-resource_screen" for="series-page-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="series-page-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-page-citation-resource_screen_value" name="series_page" maxlength="14" style="width: 100%;"/>
	<p id="series-page-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-page-citation-resource_fieldset" -->

</fieldset> <!--End of id="series-citation-resource" -->	

<br>
<div id="other_cit_details-citation-resource_fieldset" class="control-group">
<label class="control-label" id="other-cit-details-citation-resource_screen" for="other_cit_details-citation-resource_screen_value"></label>
<div class="controls">
<p id="other_cit_details-citation-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="other-cit-details-citation-resource_screen_value" name="other_cit_details" maxlength="254" style="width: 80%;"/>
<p id="other-cit-details-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="other_cit_details-citation-resource_fieldset" -->

<fieldset class="control-fielset-group">
	<legend id="url-citation-resource"></legend>
	
	<div id="url-link-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="url-link-citation-resource_screen" for="url-link-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="url-link-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-link-citation-resource_screen_value" name="url_link" maxlength="149" style="width: 100%;"/>
	<p id="url-link-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-link-citation-resource_fieldset" -->
	
	<div id="url-descrip-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="url-descrip-citation-resource_screen" for="url-descrip-citation-resource_screen_value"></label>
	<div class="controls">
	<p id="url-descrip-citation-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-descrip-citation-resource_screen_value" name="url_descrip" maxlength="254" style="width: 100%;"/>
	<p id="url-descrip-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-descrip-citation-resource_fieldset" -->
	
	<div id="url-function-citation-resource_fieldset" class="control-group">
	<label class="control-label" id="url-function-citation-resource_screen" for="url-function-citation-resource_screen_value"></label>
	<div class="controls">
	<select class="text-input" id="url-function-citation-resource_screen_value" name="function_code">	
	<option value="undefined" id="undefined-url-function-citation-resource_value"></option>
	<option value="download" id="download-url-function-citation-resource_value"></option>
	<option value="information" id="information-url-function-citation-resource_value"></option>
	<option value="offlineAccess" id="offlineAccess-url-function-citation-resource_value"></option>
	<option value="order" id="order-url-function-citation-resource_value"></option>
	<option value="search" id="search-url-function-citation-resource_value"></option>
	<option value="completeMetadata" id="completeMetadata-url-function-citation-resource_value"></option>
	<option value="browseGraphic" id="browseGraphic-url-function-citation-resource_value"></option>
	<option value="upload" id="upload-url-function-citation-resource_value"></option>
	<option value="emailService" id="emailService-url-function-citation-resource_value"></option>
	<option value="browsing" id="browsing-url-function-citation-resource_value"></option>
	<option value="fileAccess" id="fileAccess-url-function-citation-resource_value"></option>
	</select>
	<p id="url-function-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-function-citation-resource_fieldset" -->

</fieldset>  <!--End of id="url-citation-resource" -->	

<div id="open-data-citation-resource_fieldset" class="control-group">
<label class="control-label" id="open-data-citation-resource_screen" for="open-data-citation-resource_screen_value"></label>
<div class="controls">
<p id="open-data-citation-resource_alert" style="display: none;"></p>
<input type="checkbox" id="open-data-citation-resource_screen_value" name="open_data" checked="checked" onclick="MostraOAmagaExclamacioDeShareAResponsiblesOfACitation()"/>
<p id="open-data-citation-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="open-data-citation-resource_fieldset" -->

<div class="form-actions">
<input id="citation-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="citation-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'CITATION', true);" />
<input id="citation-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChangesIRecarregaResources(true);" />
<input id="citation-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeCitationResourceChangesIRecarregaResources(false);" />
</div>

<input type="text" class="text-input" name="element_origin" maxlength="10" style="display: none;"/>
</form>

</div>  <!--End of id="citation-resource" -->


<!-- *** PUBLICAT RESOURCE DLG *** -->

<div id="publication-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="publication-resource-title-text" class="white-area-title"></h2>
<p id="publication-resource-subtitle-text"></p>

<form id="publication_resource_form" name="publication_resource_form" method="get" autocomplete="off" onSubmit="return SendPublicationResourceChanges();">

<div id="title-publication-resource_fieldset" class="control-group">
<label class="control-label" id="title-publication-resource_screen" for="title-publication-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-publication-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-publication-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="edition-publication-resource"></legend>
	
	<div id="edition-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-publication-resource_screen" for="edition-publication-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="edition-publication-resource_screen_value" name="edition" style="width:100%;" maxlength="29"/>
	<p id="edition-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-publication-resource_fieldset" -->
	
	<div id="edition-date-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="edition-date-publication-resource_screen" for="edition-date-publication-resource_screen_value"></label>
	<div class="controls">
	<input type="date" class="text-input" id="edition-date-publication-resource_screen_value" name="edition_date" style="width:100%;" maxlength="29"/>
	<p id="edition-date-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="edition-date-publication-resource_fieldset" -->
	
</fieldset>  <!--End of id="edition-publication-resource" -->	

<fieldset class="control-fielset-group">
<legend id="identifier-publication-resource"></legend>

	<div id="id-code-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="id-code-publication-resource_screen" for="id-code-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="id-code-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-publication-resource_screen_value" name="id_code" maxlength="254" style="width: 100%;"/>
	<p id="id-code-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-code-publication-resource_fieldset" -->
	
	<div id="id-namespace-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="id-namespace-publication-resource_screen" for="id-namespace-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="id-namespace-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-publication-resource_screen_value" name="id_namespace" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-namespace-publication-resource_fieldset" -->
</fieldset>  <!--End of id="identifier-publication-resource" -->	

<fieldset class="control-fielset-group">
<legend id="responsible-publication-resource"></legend>
	<p id="responsible-publication-resource_compact_list" class="compact_descrip_in_FB"></p>
	<input id="responsible-publication-resource_compact_add_btn" class="submit_btn" type="button" value="Add" 
		onClick="ObreSelectorGeneral(true, 'PARTY', 'PUBLICAT', '');"/>
	<p id="responsible-publication-resource_compact_add_descrip" class="white-area-screen-descrip-text"></p> 
</fieldset> <!--End of id="responsible-publication-resource" -->

<fieldset class="control-fielset-group">
<legend id="series-publication-resource"></legend>

	<div id="series-name-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-name-publication-resource_screen" for="series-name-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-name-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-name-publication-resource_screen_value" name="series_name" maxlength="254" style="width: 100%;"/>
	<p id="series-name-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-name-publication-resource_fieldset" -->
	
	<div id="series-issue-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-issue-publication-resource_screen" for="series-issue-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-issue-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-issue-publication-resource_screen_value" name="series_issue" maxlength="39" style="width: 100%;"/>
	<p id="series-issue-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-issue-publication-resource_fieldset" -->
	
	<div id="series-page-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="series-page-publication-resource_screen" for="series-page-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="series-page-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="series-page-publication-resource_screen_value" name="series_page" maxlength="14" style="width: 100%;"/>
	<p id="series-page-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="series-page-publication-resource_fieldset" -->
	
</fieldset>  <!--End of id="series-publication-resource" -->	

<br>
<div id="other_cit_details-publication-resource_fieldset" class="control-group">
<label class="control-label" id="other-cit-details-publication-resource_screen" for="other_cit_details-publication-resource_screen_value"></label>
<div class="controls">
<p id="other_cit_details-publication-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="other-cit-details-publication-resource_screen_value" name="other_cit_details" maxlength="254" style="width: 80%;"/>
<p id="other-cit-details-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="other_cit_details-publication-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="url-publication-resource"></legend>

	<div id="url-link-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="url-link-publication-resource_screen" for="url-link-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="url-link-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-link-publication-resource_screen_value" name="url_link" maxlength="149" style="width: 100%;"/>
	<p id="url-link-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-link-publication-resource_fieldset" -->
	
	<div id="url-descrip-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="url-descrip-publication-resource_screen" for="url-descrip-publication-resource_screen_value"></label>
	<div class="controls">
	<p id="url-descrip-publication-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="url-descrip-publication-resource_screen_value" name="url_descrip" maxlength="254" style="width: 100%;"/>
	<p id="url-descrip-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-descrip-publication-resource_fieldset" -->
	
	<div id="url-function-publication-resource_fieldset" class="control-group">
	<label class="control-label" id="url-function-publication-resource_screen" for="url-function-publication-resource_screen_value"></label>
	<div class="controls">
	<select class="text-input" id="url-function-publication-resource_screen_value" name="function_code">	
	<option value="undefined" id="undefined-url-function-publication-resource_value"></option>
	<option value="download" id="download-url-function-publication-resource_value"></option>
	<option value="information" id="information-url-function-publication-resource_value"></option>
	<option value="offlineAccess" id="offlineAccess-url-function-publication-resource_value"></option>
	<option value="order" id="order-url-function-publication-resource_value"></option>
	<option value="search" id="search-url-function-publication-resource_value"></option>
	<option value="completeMetadata" id="completeMetadata-url-function-publication-resource_value"></option>
	<option value="browseGraphic" id="browseGraphic-url-function-publication-resource_value"></option>
	<option value="upload" id="upload-url-function-publication-resource_value"></option>
	<option value="emailService" id="emailService-url-function-publication-resource_value"></option>
	<option value="browsing" id="browsing-url-function-publication-resource_value"></option>
	<option value="fileAccess" id="fileAccess-url-function-publication-resource_value"></option>
	</select>
	<p id="url-function-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="url-function-publication-resource_fieldset" -->

</fieldset>  <!--End of id="url-publication-resource" -->	

<br>
<div id="abstract-publication-resource_fieldset" class="control-group">
<label class="control-label" id="abstract-publication-resource_screen" for="abstract-publication-resource_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="abstract-publication-resource_screen_value" name="abstract" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="abstract-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="abstract-publication-resource_fieldset" -->

<div id="category-publication-resource_fieldset" class="control-group">
<label class="control-label" id="category-publication-resource_screen" for="category-publication-resource_screen_value"></label>
<div class="controls">
<select class="text-input" id="category-publication-resource_screen_value" name="category_code">	
<option value="undefined" id="undefined-category-publication-resource_value"></option>         
<option value="bookChapter" id="bookChapter-category-publication-resource_value"></option>       
<option value="book" id="book-category-publication-resource_value"></option>              
<option value="report" id="report-category-publication-resource_value"></option>            
<option value="journalArticle" id="journalArticle-category-publication-resource_value"></option>    
<option value="magazineNewspaper" id="magazineNewspaper-category-publication-resource_value"></option> 
<option value="atlasMap" id="atlasMap-category-publication-resource_value"></option>          
<option value="applicationProgram" id="applicationProgram-category-publication-resource_value"></option>
<option value="conferenceProceedings" id="conferenceProceedings-category-publication-resource_value"></option>       
<option value="multimediaContent" id="multimediaContent-category-publication-resource_value"></option> 
<option value="socialMediaComment" id="socialMediaComment-category-publication-resource_value"></option>
<option value="blogWiki" id="blogWiki-category-publication-resource_value"></option>          
<option value="webSite" id="webSite-category-publication-resource_value"></option>           
<option value="webPage" id="webPage-category-publication-resource_value"></option>           
<option value="videoAudio" id="videoAudio-category-publication-resource_value"></option>        
<option value="tutorialManual" id="tutorialManual-publication-resource_screen_value"></option>                                        
</select>
<p id="category-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="category-publication-resource_fieldset" -->

<div id="open-data-publication-resource_fieldset" class="control-group">
<label class="control-label" id="open-data-publication-resource_screen" for="open-data-publication-resource_screen_value"></label>
<div class="controls">
<p id="open-data-publication-resource_alert" style="display: none;"></p>
<input type="checkbox" id="open-data-publication-resource_screen_value" name="open_data" checked="checked" onclick="MostraOAmagaExclamacioDeShareAResponsiblesOfAPublication()"/>
<p id="open-data-publication-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="open-data-publication-resource_fieldset" -->

<div class="form-actions">
<input id="publication-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="publication-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'PUBLICAT', true);" />
<!--input id="publication-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChanges(true);" />
<input id="publication-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChanges(false);" /-->
<input id="publication-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChangesIRecarregaResources(true);" />
<input id="publication-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDePublicationResourceChangesIRecarregaResources(false);" />
</div>

<input type="text" class="text-input" name="element_origin" maxlength="10" style="display: none;"/>
</form>

</div>  <!--End of id="publication-resource" -->


<!-- *** INDIVIDUAL RESOURCE DLG *** -->
<div id="individual-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="individual-resource-title-text" class="white-area-title"></h2>
<p id="individual-resource-subtitle-text"></p>

<form id="individual_resource_form" name="individual_resource_form" method="get" autocomplete="off" onSubmit="return SendIndividualResourceChanges();">

<div id="title-individual-resource_fieldset" class="control-group">
<label class="control-label" id="title-individual-resource_screen" for="title-individual-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-individual-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-individual-resource_fieldset" -->

<div id="email-individual-resource_fieldset" class="control-group">
<label class="control-label" id="email-individual-resource_screen" for="email-individual-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="email-individual-resource_screen_value" name="email" style="width: 80%;" maxlength="254"/>
<p id="email-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="email-individual-resource_fieldset" -->

<div id="url-link-individual-resource_fieldset" class="control-group">
<label class="control-label" id="url-link-individual-resource_screen" for="url-link-individual-resource_screen_value"></label>
<div class="controls">
<p id="url-link-individual-resource_alert" style="display: none;"></p>
<input type="text" class="text-input" id="url-link-individual-resource_screen_value" name="url_link" maxlength="149" style="width: 80%;"/>
<p id="url-link-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="url-link-individual-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="identifier-1-individual-resource"></legend>

	<div id="id-code-1-individual-resource_fieldset" class="control-group">
	<label class="control-label" id="id-code-1-individual-resource_screen" for="id-code-1-individual-resource_screen_value"></label>
	<div class="controls">
	<p id="id-code-1-individual-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-1-individual-resource_screen_value" name="id_code_1" maxlength="254" style="width: 100%;"/>
	<p id="id-code-1-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-code-1-individual-resource_fieldset" -->
	
	<div id="id-namespace-1-individual-resource_fieldset" class="control-group">
	<label class="control-label" id="id-namespace-1-individual-resource_screen" for="id-namespace-1-individual-resource_screen_value"></label>
	<div class="controls">
	<p id="id-namespace-1-individual-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-1-individual-resource_screen_value" name="id_namespace_1" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-1-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-namespace-1-individual-resource_fieldset" -->
</fieldset> <!--End of id="identifier-1-individual-resource" -->	

<fieldset class="control-fielset-group">
<legend id="identifier-2-individual-resource"></legend>

	<div id="id-code-2-individual-resource_fieldset" class="control-group">
	<label class="control-label" id="id-code-2-individual-resource_screen" for="id-code-2-individual-resource_screen_value"></label>
	<div class="controls">
	<p id="id-code-2-individual-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-code-2-individual-resource_screen_value" name="id_code_2" maxlength="254" style="width: 100%;"/>
	<p id="id-code-2-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-code-2-individual-resource_fieldset" -->
	
	<div id="id-namespace-2-individual-resource_fieldset" class="control-group">
	<label class="control-label" id="id-namespace-2-individual-resource_screen" for="id-namespace-2-individual-resource_screen_value"></label>
	<div class="controls">
	<p id="id-namespace-1-individual-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="id-namespace-2-individual-resource_screen_value" name="id_namespace_2" maxlength="254" style="width: 100%;"/>
	<p id="id-namespace-2-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="id-namespace-2-individual-resource_fieldset" -->
</fieldset> <!--End of id="identifier-2-individual-resource" -->	

<div id="open-data-individual-resource_fieldset" class="control-group">
<label class="control-label" id="open-data-individual-resource_screen" for="open-data-individual-resource_screen_value"></label>
<div class="controls">
<p id="open-data-individual-resource_alert" style="display: none;"></p>
<input type="checkbox" id="open-data-individual-resource_screen_value" name="open_data" checked="checked"/>
<p id="open-data-individual-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="open-data-individual-resource_fieldset" -->

<div class="form-actions">
<input id="individual-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="individual-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'INDIVIDU', true);" />
<input id="individual-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(true);" />
<input id="individual-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(false);" />
</div>
<input type="text" class="text-input" name="resource_origin" maxlength="10" style="display: none;"/>
</form>

</div>  <!--End of id="individual-resource" -->


<!-- *** ORGANISM RESOURCE DLG *** -->
<div id="organism-resource" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="organism-resource-title-text" class="white-area-title"></h2>
<p id="organism-resource-subtitle-text"></p>

<form id="organism_resource_form" name="organism_resource_form" method="get" autocomplete="off" onSubmit="return SendOrganismResourceChanges();">

<div id="title-organism-resource_fieldset" class="control-group">
<label class="control-label" id="title-organism-resource_screen" for="title-organism-resource_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="title-organism-resource_screen_value" name="title" style="width: 80%;" maxlength="254"/>
<p id="title-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="title-organism-resource_fieldset" -->

<fieldset class="control-fielset-group">
<legend id="address-organism-resource"></legend>

	<div id="delivery-point-organism-resource_fieldset" class="control-group">
	<label class="control-label" id="delivery-point-organism-resource_screen" for="delivery-point-organism-resource_screen_value"></label>
	<div class="controls">
	<input type="text" class="text-input" value="" id="delivery-point-organism-resource_screen_value" name="delivery_point" style="width: 80%;" maxlength="254"/>
	<p id="delivery-point-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="delivery-point-organism-resource_fieldset" -->
	
	<div id="city-organism-resource_fieldset" class="control-group">
	<label class="control-label" id="city-organism-resource_screen" for="city-organism-resource_screen_value"></label>
	<div class="controls">
	<p id="city-organism-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="city-organism-resource_screen_value" name="city" maxlength="149" style="width: 80%;"/>
	<p id="city-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="city-organism-resource_fieldset" -->

	<div id="administrative-area-organism-resource_fieldset" class="control-group">
	<label class="control-label" id="administrative-area-organism-resource_screen" for="administrative-area-organism-resource_screen_value"></label>
	<div class="controls">
	<p id="administrative-area-organism-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="administrative-area-organism-resource_screen_value" name="administrative_area" maxlength="254" style="width: 100%;"/>
	<p id="administrative-area-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="administrative-area-organism-resource_fieldset" -->
	
	<div id="postal-code-organism-resource_fieldset" class="control-group">
	<label class="control-label" id="postal-code-organism-resource_screen" for="postal-code-organism-resource_screen_value"></label>
	<div class="controls">
	<p id="postal-code-organism-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="postal-code-organism-resource_screen_value" name="postal_code" maxlength="254" style="width: 100%;"/>
	<p id="postal-code-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="postal-code-organism-resource_fieldset" -->
	
	<div id="country-organism-resource_fieldset" class="control-group">
	<label class="control-label" id="country-organism-resource_screen" for="country-organism-resource_screen_value"></label>
	<div class="controls">
	<p id="country-organism-resource_alert" style="display: none;"></p>
	<input type="text" class="text-input" id="country-organism-resource_screen_value" name="country" maxlength="254" style="width: 100%;"/>
	<p id="country-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
	</div>
	</div>  <!--End of id="country-organism-resource_fieldset" -->
	
</fieldset> <!--End of id="address-organism-resource" -->	

<div id="open-data-organism-resource_fieldset" class="control-group">
<label class="control-label" id="open-data-organism-resource_screen" for="open-data-organism-resource_screen_value"></label>
<div class="controls">
<p id="open-data-organism-resource_alert" style="display: none;"></p>
<input type="checkbox" id="open-data-organism-resource_screen_value" name="open_data" checked="checked"/>
<p id="open-data-organism-resource_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="open-data-organism-resource_fieldset" -->

<div class="form-actions">
<input id="organism-resource_btn" class="submit_btn" type="submit" value="Save changes" />
<input id="organism-resource-delete_btn" class="submit_btn" type="button" value="Delete" onclick="SendResourceDelete(null, null, 'ORGANISM', true);" />
<input id="organism-resource-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(true);" />
<input id="organism-resource-exit_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeQualsevolResourceChanges(false);" />
</div>
<input type="text" class="text-input" name="resource_origin" maxlength="10" style="display: none;"/>
</form>

</div>  <!--End of id="organism-resource" -->


<!-- *** ACCOUNT DLG *** -->

<div id="account" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="account-title-text" class="white-area-title">Account</h2>
<p id="account-subtitle-text">Change your basic account and language settings.</p>

<form id="account_form" name="account_form" method="get" autocomplete="off" onSubmit="return SendAccountChanges();">

<div id="new_user_fieldset" class="control-group">
<label class="control-label" id="new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserInputChange();" onpaste="NewUserInputChange();" oninput="NewUserInputChange();"/></p>
<p id="new_user_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_user_fieldset" -->

<div id="email_fieldset" class="control-group">
<label class="control-label" id="email_screen" for="email_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" id="email_screen_value" value="" name="email" style="width: 60%;" maxlength="79"/>
<p id="email_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="email_fieldset" -->

<div id="name_fieldset" class="control-group">
<label class="control-label" id="name_screen" for="name_screen_value"></label>
<div class="controls">
<input type="text" class="text-input" value="" id="name_screen_value" name="name" style="width: 60%;" maxlength="99"/>
<p id="name_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="bio_fieldset" class="control-group">
<label class="control-label" id="bio_screen" for="bio_screen_value"></label>
<div class="controls">
<textarea class="text-input" id="bio_screen_value" name="bio" maxlength="1999" style="width: 80%; height: 60px;"></textarea>
<p id="bio_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="name_fieldset" -->

<div id="current_pass_fieldset" class="control-group">
<label class="control-label" id="current_pass_screen" for="current_pass_screen_value"></label>
<div class="controls">
<p id="current_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="current_pass_screen_value" name="current_pass" maxlength="39" onkeyup="CurrentPassInputChange();" onpaste="CurrentPassInputChange();" oninput="CurrentPassInputChange();"/></p>
<p id="current_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="current_pass_fieldset" -->

<div id="new_pass_fieldset" class="control-group">
<label class="control-label" id="new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassInputChange();" onpaste="NewPassInputChange();" oninput="NewPassInputChange();"/></p>
<p id="new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div id="new_pass_valid_fieldset" class="control-group">
<label class="control-label" id="new_pass_valid_screen" for="new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="PassValidInputChange();" onpaste="PassValidInputChange();" oninput="PassValidInputChange();"/></p>
<p id="new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div id="language_fieldset" class="control-group">
<label class="control-label" id="language_screen" for="language_screen_value"></label>
<div class="controls">
<select class="text-input" id="language_screen_value" name="language">
<option value="cat">Català</option>
<option value="spa">Español</option>
<option value="eng">English</option>
</select>
<p id="language_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="language_fieldset" -->

<div class="form-actions">
<input id="account_btn" class="submit_btn" type="submit" value="Save changes">
<input id="account-close_btn" class="submit_btn" type="button" value="Close" onclick="SurtDeAccount();">
</div>

</form>

</div>  <!--End of id="account" -->

<!-- *** SHARE DLG *** -->

<div id="share" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="share-title-text" class="white-area-title"></h2>
<p id="share-subtitle-text"></p>

<form id="share_form" name="share_form" method="get" autocomplete="off" onSubmit="return SurtITornaEndarrera(true, false);">

<div class="control-group">
<label class="control-label" id="new_share_screen" for="new_share_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new_share_screen_value" name="new_share" maxlength="79" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();"/> <label id="new_share_rights_read_label" for="new_share_rights_read"></label><img src="check16.png" id="new_share_rights_read"/>, <label id="new_share_rights_write_label" for="new_share_rights_write"></label><input type="checkbox" id="new_share_rights_write" name="W" checked="checked"/>, <label id="new_share_rights_share_label" for="new_share_rights_share"></label><input type="checkbox" id="new_share_rights_share" name="S" checked="checked"/> <input id="new_share_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(false);"/></p>
<p id="new_share_select" style="display:none;position:absolute;">
<select size=10 class="text-input" name="new_share_select" style="height:116px;width:250px;" onfocus="ShowShareAuthorizedList();" onblur="HideShareAuthorizedList();" onchange="SelectionShareAuthorizedList();HideShareAuthorizedList();">
</select>
</p>
<p id="new_share_descrip"></p>
</div>
</div>

<div id="new_share_open_fieldset" class="control-group">
<label class="control-label" id="new_share_open_screen"></label>
<div class="controls">
<p><label id="new_share_open_read_label" for="new_share_open_rights_read"></label> <input id="new_share_open_btn" class="submit_btn" type="button" value="" onClick="AddShareResource(true);"/></p>
<p id="new_share_open_descrip"></p>
</div>
</div>  <!--End of id="new_share_open_fieldset" -->

<div id="current_share_fieldset" class="control-group">
<label class="control-label" id="current_share_screen"></label>
<div class="controls">
<p id="current_share_list"></p>
<p id="current_share_descrip"></p>
</div>
</div>  <!--End of id="current_share_fieldset" -->

<div class="form-actions">
<input id="share-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="share" -->


<!-- *** FEEDBACK DLG *** -->

<div id="feedback" class="white-area" style="left: 25%; top: 45px; width: 60%; height: auto; visibility: hidden;">
<h2 id="feedback-title-text" class="white-area-title"></h2>
<p id="feedback-subtitle-text"></p>

<form id="feedback_form" name="feedback_form" method="get" autocomplete="off" onSubmit="return SurtITornaEndarrera(true, true);">

<div class="control-group">
<label class="control-label" id="feedback_target_compact_screen" for="feedback_target_compact_value"></label>
<div class="controls">
<p id="feedback_target_compact_descrip"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new_feedback_screen" for="new_feedback_screen_value"></label>
<div class="controls">
<p><input id="new_feedback_btn" class="submit_btn" type="button" value="" onClick="MostraFeedbackResource('', null);"/></p>
<p id="new_feedback_descrip"></p>
</div>
</div>

<div id="current_feedback_fieldset" class="control-group">
<label class="control-label" id="current_feedback_screen"></label>
<div class="controls">
<p id="current_feedback_list"></p>
<p id="current_feedback_descrip"></p>
</div>
</div>  <!--End of id="current_feedback_fieldset" -->

<div class="form-actions">
<input id="feedback-close_btn" class="submit_btn" type="submit" value="Close">
</div>

</form>

</div>  <!--End of id="feedback" -->


</div>  <!--End of id="main-page" -->

<!-- *** PASSWORD RESET PAGE *** -->

<div id="reset-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="reset-pass-title-text" class="white-area-title">Password reset</h2>
<p id="reset-pass-subtitle-text">Find your NiMMbus account.</p>

<form id="reset-pass_form" name="reset_pass_form" method="get" autocomplete="off" onSubmit="return SendPasswordReset();">
<p><input type="text" class="text-input" value="" id="reset-pass_user_screen_value" name="user" maxlength="79" /></p>
<p id="reset-pass_user_descrip"></p>

<div class="form-actions"><input id="reset-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="reset-pass-page" -->

<!-- *** NEW PASSWORD PAGE *** -->

<div id="new-pass-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-pass-title-text" class="white-area-title">ChangePassword</h2>
<p id="new-pass-subtitle-text">Change password in your NiMMbus account.</p>

<form id="new-pass_form" name="new_pass_form" method="get" autocomplete="off" onSubmit="return SendNewPasswordToken();">

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_screen" for="new_pass_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewPassNewPassInputChange();" onpaste="NewPassNewPassInputChange();" oninput="NewPassNewPassInputChange();"/></p>
<p id="new-pass_new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_fieldset" -->

<div class="control-group">
<label class="control-label" id="new-pass_new_pass_valid_screen" for="new-pass_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-pass_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-pass_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewPassPassValidInputChange();" onpaste="NewPassPassValidInputChange();" oninput="NewPassPassValidInputChange();"/></p>
<p id="new-pass_new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>  <!--End of id="new_pass_valid_fieldset" -->

<div class="form-actions"><input id="new-pass_btn" class="submit_btn" type="submit" value="Search"></div>
</form>

</div>  <!--End of id="new-pass-page" -->

<!-- *** NEW USER PAGE *** -->

<div id="new-user-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="new-user-title-text" class="white-area-title">New User</h2>
<p id="new-user-subtitle-text">Create your NiMMbus account.</p>

<form id="new-user_form" name="new_user_form" method="get" autocomplete="off" onSubmit="return SendNewUserNB();">

<div class="control-group">
<label class="control-label" id="new-user_new_user_screen" for="new_user_screen_value"></label>
<div class="controls">
<p id="new-user_new_user_alert" style="display: none;"></p>
<p><input type="text" class="text-input" value="" id="new-user_new_user_screen_value" name="new_user" maxlength="79" onkeyup="NewUserUserInputChange();" onpaste="NewUserUserInputChange();" oninput="NewUserUserInputChange();"/>
<p id="new-user_new_user_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_screen" for="new-user_new_pass_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_screen_value" name="new_pass" maxlength="39" onkeyup="NewUserPassInputChange();" onpaste="NewUserPassInputChange();" oninput="NewUserPassInputChange();"/></p>
<p id="new-user_new_pass_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_new_pass_valid_screen" for="new-user_new_pass_valid_screen_value"></label>
<div class="controls">
<p id="new-user_new_pass_valid_alert" style="display: none;"></p>
<p><input type="password" class="text-input" value="" id="new-user_new_pass_valid_screen_value" name="new_pass_valid" maxlength="39" onkeyup="NewUserPassValidInputChange();" onpaste="NewUserPassValidInputChange();" oninput="NewUserPassValidInputChange();"/></p>
<p id="new-user_new_pass_valid_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="control-group">
<label class="control-label" id="new-user_email_screen" for="new-user_email_screen_value"></label>
<div class="controls">
<p><input type="text" class="text-input" value="" id="new-user_email_screen_value" name="email" maxlength="79"/></p>
<p id="new-user_email_screen_descrip" class="white-area-screen-descrip-text"></p>
</div>
</div>

<div class="form-actions"><input id="new-user_btn" class="submit_btn" type="submit" value="New"></div>
</form>

</div>  <!--End of id="new-user-page" -->

<!-- *** EXECUTE TOKEN PAGE *** -->

<div id="execute-token-page" class="white-area" style="left: 15%; top: 11px; width: 60%; height: auto; visibility: hidden;">
<h2 id="execute-token-title-text" class="white-area-title">Token</h2>
<p id="execute-token-subtitle-text"></p>
<p id="execute-token-wait-text"></p>

</div>  <!--End of id="execute-token-page" -->
</body>
</html>